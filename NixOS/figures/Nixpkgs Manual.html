<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0040)https://nixos.org/manual/nixpkgs/stable/ -->
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
 <title>Nixpkgs Manual</title>
<style class="anchorjs"></style><link rel="stylesheet" type="text/css" href="./Nixpkgs Manual_files/style.css"><link rel="stylesheet" type="text/css" href="./Nixpkgs Manual_files/mono-blue.css">
<script src="./Nixpkgs Manual_files/highlight.pack.js" type="text/javascript"></script><script src="./Nixpkgs Manual_files/loader.js" type="text/javascript"></script><script src="./Nixpkgs Manual_files/anchor.min.js" type="text/javascript"></script><script src="./Nixpkgs Manual_files/anchor-use.js" type="text/javascript"></script>
 <meta name="generator" content="nixos-render-docs">

 
   <link rel="canonical" url="">
</head>
 <body data-nixpkgs-channels="[{&quot;channel&quot;:&quot;unstable&quot;,&quot;version&quot;:&quot;24.05&quot;},{&quot;channel&quot;:&quot;stable&quot;,&quot;version&quot;:&quot;23.11&quot;}]" class="vsc-initialized">

 <div class="book">
  <div class="titlepage">
   <div>
   <div><h1 class="title"><a id="nixpkgs-manual"></a>Nixpkgs Manual</h1></div>
   <div><h2 class="subtitle">Version 23.11pre-git</h2></div>
   </div>
   <hr>
  </div>
<div class="toc"> <p><strong>Table of Contents</strong></p> <dl class="toc">  <dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#preface">Preface</a> </span></dt><dt> <span class="part">  <a href="https://nixos.org/manual/nixpkgs/stable/#part-using">Using Nixpkgs</a> </span></dt><dd><dl><dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-platform-support">Platform Support</a> </span></dt><dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-packageconfig">Global configuration</a> </span></dt><dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-overlays">Overlays</a> </span></dt><dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-overrides">Overriding</a> </span></dt></dl></dd><dt> <span class="part">  <a href="https://nixos.org/manual/nixpkgs/stable/#id-1.4">Nixpkgs <code class="literal">lib</code></a> </span></dt><dd><dl><dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-functions">Functions reference</a> </span></dt><dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#module-system">Module System</a> </span></dt></dl></dd><dt> <span class="part">  <a href="https://nixos.org/manual/nixpkgs/stable/#part-stdenv">Standard environment</a> </span></dt><dd><dl><dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-stdenv">The Standard Environment</a> </span></dt><dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-meta">Meta-attributes</a> </span></dt><dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-multiple-output">Multiple-output packages</a> </span></dt><dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-cross">Cross-compilation</a> </span></dt><dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-platform-notes">Platform Notes</a> </span></dt></dl></dd><dt> <span class="part">  <a href="https://nixos.org/manual/nixpkgs/stable/#part-builders">Build helpers</a> </span></dt><dd><dl><dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-pkgs-fetchers">Fetchers</a> </span></dt><dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-trivial-builders">Trivial build helpers</a> </span></dt><dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-testers">Testers</a> </span></dt><dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-special">Special build helpers</a> </span></dt><dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-images">Images</a> </span></dt><dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-hooks">Hooks reference</a> </span></dt><dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-language-support">Languages and frameworks</a> </span></dt><dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-packages">Packages</a> </span></dt></dl></dd><dt> <span class="part">  <a href="https://nixos.org/manual/nixpkgs/stable/#part-development">Development of Nixpkgs</a> </span></dt><dd><dl><dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-opening-issues">Opening issues</a> </span></dt></dl></dd><dt> <span class="part">  <a href="https://nixos.org/manual/nixpkgs/stable/#part-contributing">Contributing to Nixpkgs</a> </span></dt><dd><dl><dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-quick-start">Quick Start to Adding a Package</a> </span></dt><dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-conventions">Coding conventions</a> </span></dt><dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-submitting-changes">Submitting changes</a> </span></dt><dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-vulnerability-roundup">Vulnerability Roundup</a> </span></dt><dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-reviewing-contributions">Reviewing contributions</a> </span></dt><dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-contributing">Contributing to Nixpkgs documentation</a> </span></dt></dl></dd> </dl></div><div class="list-of-examples"><p><strong>List of Examples</strong></p><dl><dt>1. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.asserts.assertMsg"><code class="literal">lib.asserts.assertMsg</code> usage example</a></dt><dt>2. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.asserts.assertOneOf"><code class="literal">lib.asserts.assertOneOf</code> usage example</a></dt><dt>3. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.asserts.assertEachOneOf"><code class="literal">lib.asserts.assertEachOneOf</code> usage example</a></dt><dt>4. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.attrsets.attrByPath"><code class="literal">lib.attrsets.attrByPath</code> usage example</a></dt><dt>5. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.attrsets.hasAttrByPath"><code class="literal">lib.attrsets.hasAttrByPath</code> usage example</a></dt><dt>6. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.attrsets.longestValidPathPrefix"><code class="literal">lib.attrsets.longestValidPathPrefix</code> usage example</a></dt><dt>7. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.attrsets.setAttrByPath"><code class="literal">lib.attrsets.setAttrByPath</code> usage example</a></dt><dt>8. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.attrsets.getAttrFromPath"><code class="literal">lib.attrsets.getAttrFromPath</code> usage example</a></dt><dt>9. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.attrsets.concatMapAttrs"><code class="literal">lib.attrsets.concatMapAttrs</code> usage example</a></dt><dt>10. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.attrsets.updateManyAttrsByPath"><code class="literal">lib.attrsets.updateManyAttrsByPath</code> usage example</a></dt><dt>11. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.attrsets.attrVals"><code class="literal">lib.attrsets.attrVals</code> usage example</a></dt><dt>12. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.attrsets.attrValues"><code class="literal">lib.attrsets.attrValues</code> usage example</a></dt><dt>13. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.attrsets.getAttrs"><code class="literal">lib.attrsets.getAttrs</code> usage example</a></dt><dt>14. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.attrsets.catAttrs"><code class="literal">lib.attrsets.catAttrs</code> usage example</a></dt><dt>15. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.attrsets.filterAttrs"><code class="literal">lib.attrsets.filterAttrs</code> usage example</a></dt><dt>16. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.attrsets.filterAttrsRecursive"><code class="literal">lib.attrsets.filterAttrsRecursive</code> usage example</a></dt><dt>17. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.attrsets.foldlAttrs"><code class="literal">lib.attrsets.foldlAttrs</code> usage example</a></dt><dt>18. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.attrsets.foldAttrs"><code class="literal">lib.attrsets.foldAttrs</code> usage example</a></dt><dt>19. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.attrsets.collect"><code class="literal">lib.attrsets.collect</code> usage example</a></dt><dt>20. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.attrsets.cartesianProductOfSets"><code class="literal">lib.attrsets.cartesianProductOfSets</code> usage example</a></dt><dt>21. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.attrsets.nameValuePair"><code class="literal">lib.attrsets.nameValuePair</code> usage example</a></dt><dt>22. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.attrsets.mapAttrs"><code class="literal">lib.attrsets.mapAttrs</code> usage example</a></dt><dt>23. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.attrsets.mapAttrs-prime"><code class="literal">lib.attrsets.mapAttrs'</code> usage example</a></dt><dt>24. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.attrsets.mapAttrsToList"><code class="literal">lib.attrsets.mapAttrsToList</code> usage example</a></dt><dt>25. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.attrsets.attrsToList"><code class="literal">lib.attrsets.attrsToList</code> usage example</a></dt><dt>26. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.attrsets.mapAttrsRecursive"><code class="literal">lib.attrsets.mapAttrsRecursive</code> usage example</a></dt><dt>27. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.attrsets.mapAttrsRecursiveCond"><code class="literal">lib.attrsets.mapAttrsRecursiveCond</code> usage example</a></dt><dt>28. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.attrsets.genAttrs"><code class="literal">lib.attrsets.genAttrs</code> usage example</a></dt><dt>29. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.attrsets.isDerivation"><code class="literal">lib.attrsets.isDerivation</code> usage example</a></dt><dt>30. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.attrsets.optionalAttrs"><code class="literal">lib.attrsets.optionalAttrs</code> usage example</a></dt><dt>31. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.attrsets.zipAttrsWithNames"><code class="literal">lib.attrsets.zipAttrsWithNames</code> usage example</a></dt><dt>32. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.attrsets.zipAttrsWith"><code class="literal">lib.attrsets.zipAttrsWith</code> usage example</a></dt><dt>33. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.attrsets.zipAttrs"><code class="literal">lib.attrsets.zipAttrs</code> usage example</a></dt><dt>34. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.attrsets.mergeAttrsList"><code class="literal">lib.attrsets.mergeAttrsList</code> usage example</a></dt><dt>35. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.attrsets.recursiveUpdateUntil"><code class="literal">lib.attrsets.recursiveUpdateUntil</code> usage example</a></dt><dt>36. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.attrsets.recursiveUpdate"><code class="literal">lib.attrsets.recursiveUpdate</code> usage example</a></dt><dt>37. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.attrsets.matchAttrs"><code class="literal">lib.attrsets.matchAttrs</code> usage example</a></dt><dt>38. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.attrsets.overrideExisting"><code class="literal">lib.attrsets.overrideExisting</code> usage example</a></dt><dt>39. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.attrsets.showAttrPath"><code class="literal">lib.attrsets.showAttrPath</code> usage example</a></dt><dt>40. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.attrsets.getOutput"><code class="literal">lib.attrsets.getOutput</code> usage example</a></dt><dt>41. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.attrsets.getBin"><code class="literal">lib.attrsets.getBin</code> usage example</a></dt><dt>42. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.attrsets.getLib"><code class="literal">lib.attrsets.getLib</code> usage example</a></dt><dt>43. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.attrsets.getDev"><code class="literal">lib.attrsets.getDev</code> usage example</a></dt><dt>44. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.attrsets.getMan"><code class="literal">lib.attrsets.getMan</code> usage example</a></dt><dt>45. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.attrsets.recurseIntoAttrs"><code class="literal">lib.attrsets.recurseIntoAttrs</code> usage example</a></dt><dt>46. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.concatStrings"><code class="literal">lib.strings.concatStrings</code> usage example</a></dt><dt>47. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.concatMapStrings"><code class="literal">lib.strings.concatMapStrings</code> usage example</a></dt><dt>48. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.concatImapStrings"><code class="literal">lib.strings.concatImapStrings</code> usage example</a></dt><dt>49. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.intersperse"><code class="literal">lib.strings.intersperse</code> usage example</a></dt><dt>50. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.concatStringsSep"><code class="literal">lib.strings.concatStringsSep</code> usage example</a></dt><dt>51. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.concatMapStringsSep"><code class="literal">lib.strings.concatMapStringsSep</code> usage example</a></dt><dt>52. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.concatImapStringsSep"><code class="literal">lib.strings.concatImapStringsSep</code> usage example</a></dt><dt>53. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.concatLines"><code class="literal">lib.strings.concatLines</code> usage example</a></dt><dt>54. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.replicate"><code class="literal">lib.strings.replicate</code> usage example</a></dt><dt>55. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.makeSearchPath"><code class="literal">lib.strings.makeSearchPath</code> usage example</a></dt><dt>56. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.makeSearchPathOutput"><code class="literal">lib.strings.makeSearchPathOutput</code> usage example</a></dt><dt>57. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.makeLibraryPath"><code class="literal">lib.strings.makeLibraryPath</code> usage example</a></dt><dt>58. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.makeBinPath"><code class="literal">lib.strings.makeBinPath</code> usage example</a></dt><dt>59. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.normalizePath"><code class="literal">lib.strings.normalizePath</code> usage example</a></dt><dt>60. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.optionalString"><code class="literal">lib.strings.optionalString</code> usage example</a></dt><dt>61. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.hasPrefix"><code class="literal">lib.strings.hasPrefix</code> usage example</a></dt><dt>62. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.hasSuffix"><code class="literal">lib.strings.hasSuffix</code> usage example</a></dt><dt>63. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.hasInfix"><code class="literal">lib.strings.hasInfix</code> usage example</a></dt><dt>64. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.stringToCharacters"><code class="literal">lib.strings.stringToCharacters</code> usage example</a></dt><dt>65. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.stringAsChars"><code class="literal">lib.strings.stringAsChars</code> usage example</a></dt><dt>66. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.charToInt"><code class="literal">lib.strings.charToInt</code> usage example</a></dt><dt>67. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.escape"><code class="literal">lib.strings.escape</code> usage example</a></dt><dt>68. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.escapeC"><code class="literal">lib.strings.escapeC</code> usage example</a></dt><dt>69. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.escapeURL"><code class="literal">lib.strings.escapeURL</code> usage example</a></dt><dt>70. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.escapeShellArg"><code class="literal">lib.strings.escapeShellArg</code> usage example</a></dt><dt>71. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.escapeShellArgs"><code class="literal">lib.strings.escapeShellArgs</code> usage example</a></dt><dt>72. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.isValidPosixName"><code class="literal">lib.strings.isValidPosixName</code> usage example</a></dt><dt>73. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.toShellVar"><code class="literal">lib.strings.toShellVar</code> usage example</a></dt><dt>74. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.toShellVars"><code class="literal">lib.strings.toShellVars</code> usage example</a></dt><dt>75. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.escapeNixString"><code class="literal">lib.strings.escapeNixString</code> usage example</a></dt><dt>76. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.escapeRegex"><code class="literal">lib.strings.escapeRegex</code> usage example</a></dt><dt>77. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.escapeNixIdentifier"><code class="literal">lib.strings.escapeNixIdentifier</code> usage example</a></dt><dt>78. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.escapeXML"><code class="literal">lib.strings.escapeXML</code> usage example</a></dt><dt>79. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.toLower"><code class="literal">lib.strings.toLower</code> usage example</a></dt><dt>80. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.toUpper"><code class="literal">lib.strings.toUpper</code> usage example</a></dt><dt>81. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.addContextFrom"><code class="literal">lib.strings.addContextFrom</code> usage example</a></dt><dt>82. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.splitString"><code class="literal">lib.strings.splitString</code> usage example</a></dt><dt>83. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.removePrefix"><code class="literal">lib.strings.removePrefix</code> usage example</a></dt><dt>84. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.removeSuffix"><code class="literal">lib.strings.removeSuffix</code> usage example</a></dt><dt>85. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.versionOlder"><code class="literal">lib.strings.versionOlder</code> usage example</a></dt><dt>86. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.versionAtLeast"><code class="literal">lib.strings.versionAtLeast</code> usage example</a></dt><dt>87. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.getName"><code class="literal">lib.strings.getName</code> usage example</a></dt><dt>88. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.getVersion"><code class="literal">lib.strings.getVersion</code> usage example</a></dt><dt>89. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.nameFromURL"><code class="literal">lib.strings.nameFromURL</code> usage example</a></dt><dt>90. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.cmakeOptionType"><code class="literal">lib.strings.cmakeOptionType</code> usage example</a></dt><dt>91. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.cmakeBool"><code class="literal">lib.strings.cmakeBool</code> usage example</a></dt><dt>92. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.cmakeFeature"><code class="literal">lib.strings.cmakeFeature</code> usage example</a></dt><dt>93. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.mesonOption"><code class="literal">lib.strings.mesonOption</code> usage example</a></dt><dt>94. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.mesonBool"><code class="literal">lib.strings.mesonBool</code> usage example</a></dt><dt>95. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.mesonEnable"><code class="literal">lib.strings.mesonEnable</code> usage example</a></dt><dt>96. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.enableFeature"><code class="literal">lib.strings.enableFeature</code> usage example</a></dt><dt>97. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.enableFeatureAs"><code class="literal">lib.strings.enableFeatureAs</code> usage example</a></dt><dt>98. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.withFeature"><code class="literal">lib.strings.withFeature</code> usage example</a></dt><dt>99. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.withFeatureAs"><code class="literal">lib.strings.withFeatureAs</code> usage example</a></dt><dt>100. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.fixedWidthString"><code class="literal">lib.strings.fixedWidthString</code> usage example</a></dt><dt>101. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.fixedWidthNumber"><code class="literal">lib.strings.fixedWidthNumber</code> usage example</a></dt><dt>102. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.floatToString"><code class="literal">lib.strings.floatToString</code> usage example</a></dt><dt>103. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.isStorePath"><code class="literal">lib.strings.isStorePath</code> usage example</a></dt><dt>104. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.toInt"><code class="literal">lib.strings.toInt</code> usage example</a></dt><dt>105. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.toIntBase10"><code class="literal">lib.strings.toIntBase10</code> usage example</a></dt><dt>106. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.readPathsFromFile"><code class="literal">lib.strings.readPathsFromFile</code> usage example</a></dt><dt>107. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.fileContents"><code class="literal">lib.strings.fileContents</code> usage example</a></dt><dt>108. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.sanitizeDerivationName"><code class="literal">lib.strings.sanitizeDerivationName</code> usage example</a></dt><dt>109. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.levenshtein"><code class="literal">lib.strings.levenshtein</code> usage example</a></dt><dt>110. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.strings.levenshteinAtMost"><code class="literal">lib.strings.levenshteinAtMost</code> usage example</a></dt><dt>111. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.versions.splitVersion"><code class="literal">lib.versions.splitVersion</code> usage example</a></dt><dt>112. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.versions.major"><code class="literal">lib.versions.major</code> usage example</a></dt><dt>113. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.versions.minor"><code class="literal">lib.versions.minor</code> usage example</a></dt><dt>114. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.versions.patch"><code class="literal">lib.versions.patch</code> usage example</a></dt><dt>115. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.versions.majorMinor"><code class="literal">lib.versions.majorMinor</code> usage example</a></dt><dt>116. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.versions.pad"><code class="literal">lib.versions.pad</code> usage example</a></dt><dt>117. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.trivial.const"><code class="literal">lib.trivial.const</code> usage example</a></dt><dt>118. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.trivial.pipe"><code class="literal">lib.trivial.pipe</code> usage example</a></dt><dt>119. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.trivial.concat"><code class="literal">lib.trivial.concat</code> usage example</a></dt><dt>120. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.trivial.mergeAttrs"><code class="literal">lib.trivial.mergeAttrs</code> usage example</a></dt><dt>121. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.trivial.flip"><code class="literal">lib.trivial.flip</code> usage example</a></dt><dt>122. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.trivial.mapNullable"><code class="literal">lib.trivial.mapNullable</code> usage example</a></dt><dt>123. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.trivial.mod"><code class="literal">lib.trivial.mod</code> usage example</a></dt><dt>124. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.trivial.splitByAndCompare"><code class="literal">lib.trivial.splitByAndCompare</code> usage example</a></dt><dt>125. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.trivial.throwIfNot"><code class="literal">lib.trivial.throwIfNot</code> usage example</a></dt><dt>126. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.trivial.checkListOfEnum"><code class="literal">lib.trivial.checkListOfEnum</code> usage example</a></dt><dt>127. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.trivial.mirrorFunctionArgs"><code class="literal">lib.trivial.mirrorFunctionArgs</code> usage example</a></dt><dt>128. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.trivial.toFunction"><code class="literal">lib.trivial.toFunction</code> usage example</a></dt><dt>129. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.fixedPoints.fix"><code class="literal">lib.fixedPoints.fix</code> usage example</a></dt><dt>130. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.lists.singleton"><code class="literal">lib.lists.singleton</code> usage example</a></dt><dt>131. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.lists.forEach"><code class="literal">lib.lists.forEach</code> usage example</a></dt><dt>132. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.lists.foldr"><code class="literal">lib.lists.foldr</code> usage example</a></dt><dt>133. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.lists.foldl"><code class="literal">lib.lists.foldl</code> usage example</a></dt><dt>134. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.lists.foldl-prime"><code class="literal">lib.lists.foldl'</code> usage example</a></dt><dt>135. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.lists.imap0"><code class="literal">lib.lists.imap0</code> usage example</a></dt><dt>136. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.lists.imap1"><code class="literal">lib.lists.imap1</code> usage example</a></dt><dt>137. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.lists.concatMap"><code class="literal">lib.lists.concatMap</code> usage example</a></dt><dt>138. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.lists.flatten"><code class="literal">lib.lists.flatten</code> usage example</a></dt><dt>139. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.lists.remove"><code class="literal">lib.lists.remove</code> usage example</a></dt><dt>140. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.lists.findSingle"><code class="literal">lib.lists.findSingle</code> usage example</a></dt><dt>141. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.lists.findFirstIndex"><code class="literal">lib.lists.findFirstIndex</code> usage example</a></dt><dt>142. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.lists.findFirst"><code class="literal">lib.lists.findFirst</code> usage example</a></dt><dt>143. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.lists.any"><code class="literal">lib.lists.any</code> usage example</a></dt><dt>144. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.lists.all"><code class="literal">lib.lists.all</code> usage example</a></dt><dt>145. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.lists.count"><code class="literal">lib.lists.count</code> usage example</a></dt><dt>146. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.lists.optional"><code class="literal">lib.lists.optional</code> usage example</a></dt><dt>147. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.lists.optionals"><code class="literal">lib.lists.optionals</code> usage example</a></dt><dt>148. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.lists.toList"><code class="literal">lib.lists.toList</code> usage example</a></dt><dt>149. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.lists.range"><code class="literal">lib.lists.range</code> usage example</a></dt><dt>150. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.lists.replicate"><code class="literal">lib.lists.replicate</code> usage example</a></dt><dt>151. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.lists.partition"><code class="literal">lib.lists.partition</code> usage example</a></dt><dt>152. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.lists.groupBy-prime"><code class="literal">lib.lists.groupBy'</code> usage example</a></dt><dt>153. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.lists.zipListsWith"><code class="literal">lib.lists.zipListsWith</code> usage example</a></dt><dt>154. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.lists.zipLists"><code class="literal">lib.lists.zipLists</code> usage example</a></dt><dt>155. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.lists.reverseList"><code class="literal">lib.lists.reverseList</code> usage example</a></dt><dt>156. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.lists.listDfs"><code class="literal">lib.lists.listDfs</code> usage example</a></dt><dt>157. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.lists.toposort"><code class="literal">lib.lists.toposort</code> usage example</a></dt><dt>158. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.lists.sort"><code class="literal">lib.lists.sort</code> usage example</a></dt><dt>159. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.lists.sortOn"><code class="literal">lib.lists.sortOn</code> usage example</a></dt><dt>160. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.lists.compareLists"><code class="literal">lib.lists.compareLists</code> usage example</a></dt><dt>161. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.lists.naturalSort"><code class="literal">lib.lists.naturalSort</code> usage example</a></dt><dt>162. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.lists.take"><code class="literal">lib.lists.take</code> usage example</a></dt><dt>163. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.lists.drop"><code class="literal">lib.lists.drop</code> usage example</a></dt><dt>164. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.lists.hasPrefix"><code class="literal">lib.lists.hasPrefix</code> usage example</a></dt><dt>165. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.lists.removePrefix"><code class="literal">lib.lists.removePrefix</code> usage example</a></dt><dt>166. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.lists.sublist"><code class="literal">lib.lists.sublist</code> usage example</a></dt><dt>167. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.lists.commonPrefix"><code class="literal">lib.lists.commonPrefix</code> usage example</a></dt><dt>168. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.lists.last"><code class="literal">lib.lists.last</code> usage example</a></dt><dt>169. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.lists.init"><code class="literal">lib.lists.init</code> usage example</a></dt><dt>170. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.lists.crossLists"><code class="literal">lib.lists.crossLists</code> usage example</a></dt><dt>171. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.lists.unique"><code class="literal">lib.lists.unique</code> usage example</a></dt><dt>172. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.lists.allUnique"><code class="literal">lib.lists.allUnique</code> usage example</a></dt><dt>173. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.lists.intersectLists"><code class="literal">lib.lists.intersectLists</code> usage example</a></dt><dt>174. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.lists.subtractLists"><code class="literal">lib.lists.subtractLists</code> usage example</a></dt><dt>175. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.debug.traceIf"><code class="literal">lib.debug.traceIf</code> usage example</a></dt><dt>176. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.debug.traceValFn"><code class="literal">lib.debug.traceValFn</code> usage example</a></dt><dt>177. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.debug.traceVal"><code class="literal">lib.debug.traceVal</code> usage example</a></dt><dt>178. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.debug.traceSeq"><code class="literal">lib.debug.traceSeq</code> usage example</a></dt><dt>179. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.debug.traceSeqN"><code class="literal">lib.debug.traceSeqN</code> usage example</a></dt><dt>180. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.debug.traceFnSeqN"><code class="literal">lib.debug.traceFnSeqN</code> usage example</a></dt><dt>181. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.debug.runTests"><code class="literal">lib.debug.runTests</code> usage example</a></dt><dt>182. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.debug.testAllTrue"><code class="literal">lib.debug.testAllTrue</code> usage example</a></dt><dt>183. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.options.isOption"><code class="literal">lib.options.isOption</code> usage example</a></dt><dt>184. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.options.mkOption"><code class="literal">lib.options.mkOption</code> usage example</a></dt><dt>185. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.options.mkEnableOption"><code class="literal">lib.options.mkEnableOption</code> usage example</a></dt><dt>186. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.options.mkPackageOption"><code class="literal">lib.options.mkPackageOption</code> usage example</a></dt><dt>187. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.options.getValues"><code class="literal">lib.options.getValues</code> usage example</a></dt><dt>188. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.options.getFiles"><code class="literal">lib.options.getFiles</code> usage example</a></dt><dt>189. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.options.showOption"><code class="literal">lib.options.showOption</code> usage example</a></dt><dt>190. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.path.append"><code class="literal">lib.path.append</code> usage example</a></dt><dt>191. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.path.hasPrefix"><code class="literal">lib.path.hasPrefix</code> usage example</a></dt><dt>192. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.path.removePrefix"><code class="literal">lib.path.removePrefix</code> usage example</a></dt><dt>193. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.path.splitRoot"><code class="literal">lib.path.splitRoot</code> usage example</a></dt><dt>194. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.path.hasStorePathPrefix"><code class="literal">lib.path.hasStorePathPrefix</code> usage example</a></dt><dt>195. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.path.subpath.isValid"><code class="literal">lib.path.subpath.isValid</code> usage example</a></dt><dt>196. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.path.subpath.join"><code class="literal">lib.path.subpath.join</code> usage example</a></dt><dt>197. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.path.subpath.components"><code class="literal">lib.path.subpath.components</code> usage example</a></dt><dt>198. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.path.subpath.normalise"><code class="literal">lib.path.subpath.normalise</code> usage example</a></dt><dt>199. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.filesystem.pathType"><code class="literal">lib.filesystem.pathType</code> usage example</a></dt><dt>200. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.filesystem.pathIsDirectory"><code class="literal">lib.filesystem.pathIsDirectory</code> usage example</a></dt><dt>201. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.filesystem.pathIsRegularFile"><code class="literal">lib.filesystem.pathIsRegularFile</code> usage example</a></dt><dt>202. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.fileset.maybeMissing"><code class="literal">lib.fileset.maybeMissing</code> usage example</a></dt><dt>203. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.fileset.trace"><code class="literal">lib.fileset.trace</code> usage example</a></dt><dt>204. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.fileset.traceVal"><code class="literal">lib.fileset.traceVal</code> usage example</a></dt><dt>205. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.fileset.toSource"><code class="literal">lib.fileset.toSource</code> usage example</a></dt><dt>206. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.fileset.toList"><code class="literal">lib.fileset.toList</code> usage example</a></dt><dt>207. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.fileset.union"><code class="literal">lib.fileset.union</code> usage example</a></dt><dt>208. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.fileset.unions"><code class="literal">lib.fileset.unions</code> usage example</a></dt><dt>209. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.fileset.intersection"><code class="literal">lib.fileset.intersection</code> usage example</a></dt><dt>210. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.fileset.difference"><code class="literal">lib.fileset.difference</code> usage example</a></dt><dt>211. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.fileset.fileFilter"><code class="literal">lib.fileset.fileFilter</code> usage example</a></dt><dt>212. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.fileset.fromSource"><code class="literal">lib.fileset.fromSource</code> usage example</a></dt><dt>213. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.fileset.gitTracked"><code class="literal">lib.fileset.gitTracked</code> usage example</a></dt><dt>214. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.fileset.gitTrackedWith"><code class="literal">lib.fileset.gitTrackedWith</code> usage example</a></dt><dt>215. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.sources.commitIdFromGitRepo"><code class="literal">lib.sources.commitIdFromGitRepo</code> usage example</a></dt><dt>216. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.sources.cleanSource"><code class="literal">lib.sources.cleanSource</code> usage example</a></dt><dt>217. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.sources.cleanSourceWith"><code class="literal">lib.sources.cleanSourceWith</code> usage example</a></dt><dt>218. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.sources.sourceByRegex"><code class="literal">lib.sources.sourceByRegex</code> usage example</a></dt><dt>219. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.sources.sourceFilesBySuffices"><code class="literal">lib.sources.sourceFilesBySuffices</code> usage example</a></dt><dt>220. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.cli.toGNUCommandLineShell"><code class="literal">lib.cli.toGNUCommandLineShell</code> usage example</a></dt><dt>221. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.gvariant.mkArray"><code class="literal">lib.gvariant.mkArray</code> usage example</a></dt><dt>222. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.gvariant.mkEmptyArray"><code class="literal">lib.gvariant.mkEmptyArray</code> usage example</a></dt><dt>223. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.gvariant.mkVariant"><code class="literal">lib.gvariant.mkVariant</code> usage example</a></dt><dt>224. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.gvariant.mkDictionaryEntry"><code class="literal">lib.gvariant.mkDictionaryEntry</code> usage example</a></dt><dt>225. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.customisation.overrideDerivation"><code class="literal">lib.customisation.overrideDerivation</code> usage example</a></dt><dt>226. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.customisation.makeOverridable"><code class="literal">lib.customisation.makeOverridable</code> usage example</a></dt><dt>227. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.meta.addMetaAttrs"><code class="literal">lib.meta.addMetaAttrs</code> usage example</a></dt><dt>228. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.meta.updateName"><code class="literal">lib.meta.updateName</code> usage example</a></dt><dt>229. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.meta.getLicenseFromSpdxId"><code class="literal">lib.meta.getLicenseFromSpdxId</code> usage example</a></dt><dt>230. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.meta.getExe"><code class="literal">lib.meta.getExe</code> usage example</a></dt><dt>231. <a href="https://nixos.org/manual/nixpkgs/stable/#function-library-example-lib.meta.getExe-prime"><code class="literal">lib.meta.getExe'</code> usage example</a></dt><dt>232. <a href="https://nixos.org/manual/nixpkgs/stable/#var-passthru-updateScript-example-commit">Standard output of an update script using commit feature</a></dt><dt>233. <a href="https://nixos.org/manual/nixpkgs/stable/#ex-gdb-debug-symbols-socat">Enable debug symbols for use with GDB</a></dt><dt>234. <a href="https://nixos.org/manual/nixpkgs/stable/#ex-runcommand-simple">Invocation of <code class="literal">runCommand</code></a></dt><dt>235. <a href="https://nixos.org/manual/nixpkgs/stable/#ex-beam-ephemeral-shell">Ephemeral shell</a></dt><dt>236. <a href="https://nixos.org/manual/nixpkgs/stable/#ex-beam-declarative-shell">Declarative shell</a></dt><dt>237. <a href="https://nixos.org/manual/nixpkgs/stable/#usage-1-pkgs.zlib.override">Using <code class="literal">pkgs.zlib.override {}</code></a></dt><dt>238. <a href="https://nixos.org/manual/nixpkgs/stable/#usage-2-pkgs.buildemscriptenpackage">Using <code class="literal">pkgs.buildEmscriptenPackage {}</code></a></dt></dl></div>
<div class="chapter"> <div class="titlepage">  <div>   <div>    <h1 id="preface" class="title">Preface   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#preface" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h1>  </div> </div></div><div class="toc"> <p><strong>Table of Contents</strong></p> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#overview-of-nixpkgs">Overview of Nixpkgs</a> </span></dt> </dl></div><p>The Nix Packages collection (Nixpkgs) is a set of thousands of packages for the
<a class="link" href="https://nixos.org/nix/" target="_top">Nix package manager</a>, released under a
<a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/COPYING" target="_top">permissive MIT license</a>.
Packages are available for several platforms, and can be used with the Nix
package manager on most GNU/Linux distributions as well as <a class="link" href="https://nixos.org/nixos" target="_top">NixOS</a>.</p><p>This manual primarily describes how to write packages for the Nix Packages collection
(Nixpkgs). Thus it’s mainly for packagers and developers who want to add packages to
Nixpkgs. If you like to learn more about the Nix package manager and the Nix
expression language, then you are kindly referred to the <a class="link" href="https://nixos.org/nix/manual/" target="_top">Nix manual</a>.
The NixOS distribution is documented in the <a class="link" href="https://nixos.org/nixos/manual/" target="_top">NixOS manual</a>.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h1 id="overview-of-nixpkgs" class="title" style="clear: both">Overview of Nixpkgs   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#overview-of-nixpkgs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h1>  </div> </div></div><p>Nix expressions describe how to build packages from source and are collected in
the <a class="link" href="https://github.com/NixOS/nixpkgs" target="_top">nixpkgs repository</a>. Also included in the
collection are Nix expressions for
<a class="link" href="https://nixos.org/nixos/manual/index.html#sec-writing-modules" target="_top">NixOS modules</a>.
With these expressions the Nix package manager can build binary packages.</p><p>Packages, including the Nix packages collection, are distributed through
<a class="link" href="https://nixos.org/nix/manual/#sec-channels" target="_top">channels</a>. The collection is
distributed for users of Nix on non-NixOS distributions through the channel
<code class="literal">nixpkgs</code>. Users of NixOS generally use one of the <code class="literal">nixos-*</code> channels, e.g.
<code class="literal">nixos-22.11</code>, which includes all packages and modules for the stable NixOS
22.11. Stable NixOS releases are generally only given
security updates. More up to date packages and modules are available via the
<code class="literal">nixos-unstable</code> channel.</p><p>Both <code class="literal">nixos-unstable</code> and <code class="literal">nixpkgs</code> follow the <code class="literal">master</code> branch of the Nixpkgs
repository, although both do lag the <code class="literal">master</code> branch by generally
<a class="link" href="https://status.nixos.org/" target="_top">a couple of days</a>. Updates to a channel are
distributed as soon as all tests for that channel pass, e.g.
<a class="link" href="https://hydra.nixos.org/job/nixpkgs/trunk/unstable#tabs-constituents" target="_top">this table</a>
shows the status of tests for the <code class="literal">nixpkgs</code> channel.</p><p>The tests are conducted by a cluster called <a class="link" href="https://nixos.org/hydra/" target="_top">Hydra</a>,
which also builds binary packages from the Nix expressions in Nixpkgs for
<code class="literal">x86_64-linux</code>, <code class="literal">i686-linux</code> and <code class="literal">x86_64-darwin</code>.
The binaries are made available via a <a class="link" href="https://cache.nixos.org/" target="_top">binary cache</a>.</p><p>The current Nix expressions of the channels are available in the
<a class="link" href="https://github.com/NixOS/nixpkgs" target="_top"><code class="literal">nixpkgs</code></a> repository in branches
that correspond to the channel names (e.g. <code class="literal">nixos-22.11-small</code>).</p>
</div>

</div><div class="part"> <div class="titlepage">  <div>   <div>    <h1 id="part-using" class="title">Using Nixpkgs   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#part-using" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h1>  </div> </div></div><div class="partintro"><div class="toc"> <p><strong>Table of Contents</strong></p> <dl class="toc">  <dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-platform-support">Platform Support</a> </span></dt><dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-packageconfig">Global configuration</a> </span></dt><dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-overlays">Overlays</a> </span></dt><dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-overrides">Overriding</a> </span></dt> </dl></div></div><div class="chapter"> <div class="titlepage">  <div>   <div>    <h2 id="chap-platform-support" class="title">Platform Support   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#chap-platform-support" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>Packages receive varying degrees of support, both in terms of maintainer attention and available computation resources for continuous integration (CI).</p><p>Below is the list of the best supported platforms:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">x86_64-linux</code>: Highest level of support.</p></li><li class="listitem"><p><code class="literal">aarch64-linux</code>: Well supported, with most packages building successfully in CI.</p></li><li class="listitem"><p><code class="literal">aarch64-darwin</code>: Receives better support than <code class="literal">x86_64-darwin</code>.</p></li><li class="listitem"><p><code class="literal">x86_64-darwin</code>: Receives some support.</p></li></ul></div><p>There are many other platforms with varying levels of support.
The provisional platform list in <a class="link" href="https://github.com/NixOS/rfcs/blob/master/rfcs/0046-platform-support-tiers.md#appendix-a-non-normative-description-of-platforms-in-november-2019" target="_top">Appendix A</a> of <a class="link" href="https://github.com/NixOS/rfcs/blob/master/rfcs/0046-platform-support-tiers.md" target="_top">RFC046</a>, while not up to date, can be used as guidance.</p><p>A more formal definition of the platform support tiers is provided in <a class="link" href="https://github.com/NixOS/rfcs/blob/master/rfcs/0046-platform-support-tiers.md" target="_top">RFC046</a>, but has not been fully implemented yet.</p>
</div><div class="chapter"> <div class="titlepage">  <div>   <div>    <h2 id="chap-packageconfig" class="title">Global configuration   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#chap-packageconfig" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <p><strong>Table of Contents</strong></p> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-allow-broken">Installing broken packages</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-allow-unsupported-system">Installing packages on unsupported systems</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-allow-unfree">Installing unfree packages</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-allow-insecure">Installing insecure packages</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-modify-via-packageOverrides">Modify packages via <code class="literal">packageOverrides</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-config-options-reference"><code class="literal">config</code> Options Reference</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-declarative-package-management">Declarative Package Management</a> </span></dt> </dl></div><p>Nix comes with certain defaults about what packages can and cannot be installed, based on a package’s metadata. By default, Nix will prevent installation if any of the following criteria are true:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>The package is thought to be broken, and has had its <code class="literal">meta.broken</code> set to <code class="literal">true</code>.</p></li><li class="listitem"><p>The package isn’t intended to run on the given system, as none of its <code class="literal">meta.platforms</code> match the given system.</p></li><li class="listitem"><p>The package’s <code class="literal">meta.license</code> is set to a license which is considered to be unfree.</p></li><li class="listitem"><p>The package has known security vulnerabilities but has not or can not be updated for some reason, and a list of issues has been entered in to the package’s <code class="literal">meta.knownVulnerabilities</code>.</p></li></ul></div><p>Note that all this is checked during evaluation already, and the check includes any package that is evaluated. In particular, all build-time dependencies are checked. <code class="literal">nix-env -qa</code> will (attempt to) hide any packages that would be refused.</p><p>Each of these criteria can be altered in the nixpkgs configuration.</p><p>The nixpkgs configuration for a NixOS system is set in the <code class="literal">configuration.nix</code>, as in the following example:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{
  nixpkgs.<span class="hljs-attr">config</span> = {
    <span class="hljs-attr">allowUnfree</span> = <span class="hljs-literal">true</span>;
  };
}
</code></pre><p>However, this does not allow unfree software for individual users. Their configurations are managed separately.</p><p>A user’s nixpkgs configuration is stored in a user-specific configuration file located at <code class="literal">~/.config/nixpkgs/config.nix</code>. For example:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{
  <span class="hljs-attr">allowUnfree</span> = <span class="hljs-literal">true</span>;
}
</code></pre><p>Note that we are not able to test or build unfree software on Hydra due to policy. Most unfree licenses prohibit us from either executing or distributing the software.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-allow-broken" class="title" style="clear: both">Installing broken packages   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-allow-broken" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>There are two ways to try compiling a package which has been marked as broken.</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>For allowing the build of a broken package once, you can use an environment variable for a single invocation of the nix tools:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">export</span> NIXPKGS_ALLOW_BROKEN=1</span>
</code></pre></li><li class="listitem"><p>For permanently allowing broken packages to be built, you may add <code class="literal">allowBroken = true;</code> to your user’s configuration file, like this:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{
  <span class="hljs-attr">allowBroken</span> = <span class="hljs-literal">true</span>;
}
</code></pre></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-allow-unsupported-system" class="title" style="clear: both">Installing packages on unsupported systems   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-allow-unsupported-system" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>There are also two ways to try compiling a package which has been marked as unsupported for the given system.</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>For allowing the build of an unsupported package once, you can use an environment variable for a single invocation of the nix tools:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">export</span> NIXPKGS_ALLOW_UNSUPPORTED_SYSTEM=1</span>
</code></pre></li><li class="listitem"><p>For permanently allowing unsupported packages to be built, you may add <code class="literal">allowUnsupportedSystem = true;</code> to your user’s configuration file, like this:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{
  <span class="hljs-attr">allowUnsupportedSystem</span> = <span class="hljs-literal">true</span>;
}
</code></pre></li></ul></div><p>The difference between a package being unsupported on some system and being broken is admittedly a bit fuzzy. If a program <span class="emphasis"><em>ought</em></span> to work on a certain platform, but doesn’t, the platform should be included in <code class="literal">meta.platforms</code>, but marked as broken with e.g.  <code class="literal">meta.broken = !hostPlatform.isWindows</code>. Of course, this begs the question of what “ought” means exactly. That is left to the package maintainer.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-allow-unfree" class="title" style="clear: both">Installing unfree packages   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-allow-unfree" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>All users of Nixpkgs are free software users, and many users (and developers) of Nixpkgs want to limit and tightly control their exposure to unfree software.
At the same time, many users need (or want) to run some specific pieces of proprietary software.
Nixpkgs includes some expressions for unfree software packages.
By default unfree software cannot be installed and doesn’t show up in searches.</p><p>There are several ways to tweak how Nix handles a package which has been marked as unfree.</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>To temporarily allow all unfree packages, you can use an environment variable for a single invocation of the nix tools:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">export</span> NIXPKGS_ALLOW_UNFREE=1</span>
</code></pre></li><li class="listitem"><p>It is possible to permanently allow individual unfree packages, while still blocking unfree packages by default using the <code class="literal">allowUnfreePredicate</code> configuration option in the user configuration file.</p><p>This option is a function which accepts a package as a parameter, and returns a boolean. The following example configuration accepts a package and always returns false:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{
  <span class="hljs-attr">allowUnfreePredicate</span> = (pkg: <span class="hljs-literal">false</span>);
}
</code></pre><p>For a more useful example, try the following. This configuration only allows unfree packages named roon-server and visual studio code:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{
  <span class="hljs-attr">allowUnfreePredicate</span> = pkg: <span class="hljs-built_in">builtins</span>.elem (lib.getName pkg) [
    <span class="hljs-string">"roon-server"</span>
    <span class="hljs-string">"vscode"</span>
  ];
}
</code></pre></li><li class="listitem"><p>It is also possible to allow and block licenses that are specifically acceptable or not acceptable, using <code class="literal">allowlistedLicenses</code> and <code class="literal">blocklistedLicenses</code>, respectively.</p><p>The following example configuration allowlists the licenses <code class="literal">amd</code> and <code class="literal">wtfpl</code>:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{
  <span class="hljs-attr">allowlistedLicenses</span> = <span class="hljs-keyword">with</span> lib.licenses; [ amd wtfpl ];
}
</code></pre><p>The following example configuration blocklists the <code class="literal">gpl3Only</code> and <code class="literal">agpl3Only</code> licenses:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{
  <span class="hljs-attr">blocklistedLicenses</span> = <span class="hljs-keyword">with</span> lib.licenses; [ agpl3Only gpl3Only ];
}
</code></pre><p>Note that <code class="literal">allowlistedLicenses</code> only applies to unfree licenses unless <code class="literal">allowUnfree</code> is enabled. It is not a generic allowlist for all types of licenses. <code class="literal">blocklistedLicenses</code> applies to all licenses.</p></li></ul></div><p>A complete list of licenses can be found in the file <code class="literal">lib/licenses.nix</code> of the nixpkgs tree.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-allow-insecure" class="title" style="clear: both">Installing insecure packages   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-allow-insecure" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>There are several ways to tweak how Nix handles a package which has been marked as insecure.</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>To temporarily allow all insecure packages, you can use an environment variable for a single invocation of the nix tools:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">export</span> NIXPKGS_ALLOW_INSECURE=1</span>
</code></pre></li><li class="listitem"><p>It is possible to permanently allow individual insecure packages, while still blocking other insecure packages by default using the <code class="literal">permittedInsecurePackages</code> configuration option in the user configuration file.</p><p>The following example configuration permits the installation of the hypothetically insecure package <code class="literal">hello</code>, version <code class="literal">1.2.3</code>:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{
  <span class="hljs-attr">permittedInsecurePackages</span> = [
    <span class="hljs-string">"hello-1.2.3"</span>
  ];
}
</code></pre></li><li class="listitem"><p>It is also possible to create a custom policy around which insecure packages to allow and deny, by overriding the <code class="literal">allowInsecurePredicate</code> configuration option.</p><p>The <code class="literal">allowInsecurePredicate</code> option is a function which accepts a package and returns a boolean, much like <code class="literal">allowUnfreePredicate</code>.</p><p>The following configuration example only allows insecure packages with very short names:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{
  <span class="hljs-attr">allowInsecurePredicate</span> = pkg: <span class="hljs-built_in">builtins</span>.stringLength (lib.getName pkg) &lt;= <span class="hljs-number">5</span>;
}
</code></pre><p>Note that <code class="literal">permittedInsecurePackages</code> is only checked if <code class="literal">allowInsecurePredicate</code> is not specified.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-modify-via-packageOverrides" class="title" style="clear: both">Modify packages via <code class="literal">packageOverrides</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-modify-via-packageOverrides" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>You can define a function called <code class="literal">packageOverrides</code> in your local <code class="literal">~/.config/nixpkgs/config.nix</code> to override Nix packages. It must be a function that takes pkgs as an argument and returns a modified set of packages.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{
  <span class="hljs-attr">packageOverrides</span> = pkgs: <span class="hljs-keyword">rec</span> {
    <span class="hljs-attr">foo</span> = pkgs.foo.override { ... };
  };
}
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-config-options-reference" class="title" style="clear: both"><code class="literal">config</code> Options Reference   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-config-options-reference" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>The following attributes can be passed in <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#chap-packageconfig" title="Global configuration"><code class="literal">config</code></a>.</p><div class="variablelist">
<a id="configuration-variable-list"></a>
 <dl class="variablelist">
<dt>
 <span class="term">
 <a id="opt-enableParallelBuildingByDefault"></a><a class="term" href="https://nixos.org/manual/nixpkgs/stable/#opt-enableParallelBuildingByDefault"><code class="option">enableParallelBuildingByDefault</code>
  </a>
 </span>
</dt>
<dd>
<p>Whether to set <code class="literal">enableParallelBuilding</code> to true by default while building nixpkgs packages.
Changing the default may cause a mass rebuild.</p>

<p><span class="emphasis"><em>Type:</em></span>
boolean</p>

<p><span class="emphasis"><em>Default:</em></span>
<code class="literal">false</code></p>

<p><span class="emphasis"><em>Declared by:</em></span></p>
<table border="0" summary="Simple list" class="simplelist">
<tbody><tr><td>
<code class="filename"><a class="filename" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/top-level/config.nix" target="_top">
pkgs/top-level/config.nix
</a></code>
</td></tr>
</tbody></table>
</dd>
<dt>
 <span class="term">
 <a id="opt-allowAliases"></a><a class="term" href="https://nixos.org/manual/nixpkgs/stable/#opt-allowAliases"><code class="option">allowAliases</code>
  </a>
 </span>
</dt>
<dd>
<p>Whether to expose old attribute names for compatibility.</p><p>The recommended setting is to enable this, as it
improves backward compatibity, easing updates.</p><p>The only reason to disable aliases is for continuous
integration purposes. For instance, Nixpkgs should
not depend on aliases in its internal code. Projects
that aren’t Nixpkgs should be cautious of instantly
removing all usages of aliases, as migrating too soon
can break compatibility with the stable Nixpkgs releases.</p>

<p><span class="emphasis"><em>Type:</em></span>
boolean</p>

<p><span class="emphasis"><em>Default:</em></span>
<code class="literal">true</code></p>

<p><span class="emphasis"><em>Declared by:</em></span></p>
<table border="0" summary="Simple list" class="simplelist">
<tbody><tr><td>
<code class="filename"><a class="filename" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/top-level/config.nix" target="_top">
pkgs/top-level/config.nix
</a></code>
</td></tr>
</tbody></table>
</dd>
<dt>
 <span class="term">
 <a id="opt-allowBroken"></a><a class="term" href="https://nixos.org/manual/nixpkgs/stable/#opt-allowBroken"><code class="option">allowBroken</code>
  </a>
 </span>
</dt>
<dd>
<p>Whether to allow broken packages.</p><p>See <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#sec-allow-broken" target="_top">Installing broken packages</a> in the NixOS manual.</p>

<p><span class="emphasis"><em>Type:</em></span>
boolean</p>

<p><span class="emphasis"><em>Default:</em></span>
<code class="literal">false || builtins.getEnv "NIXPKGS_ALLOW_BROKEN" == "1"</code></p>

<p><span class="emphasis"><em>Declared by:</em></span></p>
<table border="0" summary="Simple list" class="simplelist">
<tbody><tr><td>
<code class="filename"><a class="filename" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/top-level/config.nix" target="_top">
pkgs/top-level/config.nix
</a></code>
</td></tr>
</tbody></table>
</dd>
<dt>
 <span class="term">
 <a id="opt-allowUnfree"></a><a class="term" href="https://nixos.org/manual/nixpkgs/stable/#opt-allowUnfree"><code class="option">allowUnfree</code>
  </a>
 </span>
</dt>
<dd>
<p>Whether to allow unfree packages.</p><p>See <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#sec-allow-unfree" target="_top">Installing unfree packages</a> in the NixOS manual.</p>

<p><span class="emphasis"><em>Type:</em></span>
boolean</p>

<p><span class="emphasis"><em>Default:</em></span>
<code class="literal">false || builtins.getEnv "NIXPKGS_ALLOW_UNFREE" == "1"</code></p>

<p><span class="emphasis"><em>Declared by:</em></span></p>
<table border="0" summary="Simple list" class="simplelist">
<tbody><tr><td>
<code class="filename"><a class="filename" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/top-level/config.nix" target="_top">
pkgs/top-level/config.nix
</a></code>
</td></tr>
</tbody></table>
</dd>
<dt>
 <span class="term">
 <a id="opt-allowUnsupportedSystem"></a><a class="term" href="https://nixos.org/manual/nixpkgs/stable/#opt-allowUnsupportedSystem"><code class="option">allowUnsupportedSystem</code>
  </a>
 </span>
</dt>
<dd>
<p>Whether to allow unsupported packages.</p><p>See <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#sec-allow-unsupported-system" target="_top">Installing packages on unsupported systems</a> in the NixOS manual.</p>

<p><span class="emphasis"><em>Type:</em></span>
boolean</p>

<p><span class="emphasis"><em>Default:</em></span>
<code class="literal">false || builtins.getEnv "NIXPKGS_ALLOW_UNSUPPORTED_SYSTEM" == "1"</code></p>

<p><span class="emphasis"><em>Declared by:</em></span></p>
<table border="0" summary="Simple list" class="simplelist">
<tbody><tr><td>
<code class="filename"><a class="filename" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/top-level/config.nix" target="_top">
pkgs/top-level/config.nix
</a></code>
</td></tr>
</tbody></table>
</dd>
<dt>
 <span class="term">
 <a id="opt-checkMeta"></a><a class="term" href="https://nixos.org/manual/nixpkgs/stable/#opt-checkMeta"><code class="option">checkMeta</code>
  </a>
 </span>
</dt>
<dd>
<p>Whether to check that the <code class="literal">meta</code> attribute of derivations are correct during evaluation time.</p>

<p><span class="emphasis"><em>Type:</em></span>
boolean</p>

<p><span class="emphasis"><em>Default:</em></span>
<code class="literal">false</code></p>

<p><span class="emphasis"><em>Declared by:</em></span></p>
<table border="0" summary="Simple list" class="simplelist">
<tbody><tr><td>
<code class="filename"><a class="filename" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/top-level/config.nix" target="_top">
pkgs/top-level/config.nix
</a></code>
</td></tr>
</tbody></table>
</dd>
<dt>
 <span class="term">
 <a id="opt-configurePlatformsByDefault"></a><a class="term" href="https://nixos.org/manual/nixpkgs/stable/#opt-configurePlatformsByDefault"><code class="option">configurePlatformsByDefault</code>
  </a>
 </span>
</dt>
<dd>
<p>Whether to set <code class="literal">configurePlatforms</code> to <code class="literal">["build" "host"]</code> by default while building nixpkgs packages.
Changing the default may cause a mass rebuild.</p>

<p><span class="emphasis"><em>Type:</em></span>
boolean</p>

<p><span class="emphasis"><em>Default:</em></span>
<code class="literal">false</code></p>

<p><span class="emphasis"><em>Declared by:</em></span></p>
<table border="0" summary="Simple list" class="simplelist">
<tbody><tr><td>
<code class="filename"><a class="filename" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/top-level/config.nix" target="_top">
pkgs/top-level/config.nix
</a></code>
</td></tr>
</tbody></table>
</dd>
<dt>
 <span class="term">
 <a id="opt-contentAddressedByDefault"></a><a class="term" href="https://nixos.org/manual/nixpkgs/stable/#opt-contentAddressedByDefault"><code class="option">contentAddressedByDefault</code>
  </a>
 </span>
</dt>
<dd>
<p>Whether to set <code class="literal">__contentAddressed</code> to true by default while building nixpkgs packages.
Changing the default may cause a mass rebuild.</p>

<p><span class="emphasis"><em>Type:</em></span>
boolean</p>

<p><span class="emphasis"><em>Default:</em></span>
<code class="literal">false</code></p>

<p><span class="emphasis"><em>Declared by:</em></span></p>
<table border="0" summary="Simple list" class="simplelist">
<tbody><tr><td>
<code class="filename"><a class="filename" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/top-level/config.nix" target="_top">
pkgs/top-level/config.nix
</a></code>
</td></tr>
</tbody></table>
</dd>
<dt>
 <span class="term">
 <a id="opt-cudaSupport"></a><a class="term" href="https://nixos.org/manual/nixpkgs/stable/#opt-cudaSupport"><code class="option">cudaSupport</code>
  </a>
 </span>
</dt>
<dd>
<p>Whether to build packages with CUDA support by default while building nixpkgs packages.
Changing the default may cause a mass rebuild.</p>

<p><span class="emphasis"><em>Type:</em></span>
boolean</p>

<p><span class="emphasis"><em>Default:</em></span>
<code class="literal">false</code></p>

<p><span class="emphasis"><em>Declared by:</em></span></p>
<table border="0" summary="Simple list" class="simplelist">
<tbody><tr><td>
<code class="filename"><a class="filename" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/top-level/config.nix" target="_top">
pkgs/top-level/config.nix
</a></code>
</td></tr>
</tbody></table>
</dd>
<dt>
 <span class="term">
 <a id="opt-doCheckByDefault"></a><a class="term" href="https://nixos.org/manual/nixpkgs/stable/#opt-doCheckByDefault"><code class="option">doCheckByDefault</code>
  </a>
 </span>
</dt>
<dd>
<p>Whether to run <code class="literal">checkPhase</code> by default while building nixpkgs packages.
Changing the default may cause a mass rebuild.</p>

<p><span class="emphasis"><em>Type:</em></span>
boolean</p>

<p><span class="emphasis"><em>Default:</em></span>
<code class="literal">false</code></p>

<p><span class="emphasis"><em>Declared by:</em></span></p>
<table border="0" summary="Simple list" class="simplelist">
<tbody><tr><td>
<code class="filename"><a class="filename" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/top-level/config.nix" target="_top">
pkgs/top-level/config.nix
</a></code>
</td></tr>
</tbody></table>
</dd>
<dt>
 <span class="term">
 <a id="opt-rocmSupport"></a><a class="term" href="https://nixos.org/manual/nixpkgs/stable/#opt-rocmSupport"><code class="option">rocmSupport</code>
  </a>
 </span>
</dt>
<dd>
<p>Whether to build packages with ROCm support by default while building nixpkgs packages.
Changing the default may cause a mass rebuild.</p>

<p><span class="emphasis"><em>Type:</em></span>
boolean</p>

<p><span class="emphasis"><em>Default:</em></span>
<code class="literal">false</code></p>

<p><span class="emphasis"><em>Declared by:</em></span></p>
<table border="0" summary="Simple list" class="simplelist">
<tbody><tr><td>
<code class="filename"><a class="filename" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/top-level/config.nix" target="_top">
pkgs/top-level/config.nix
</a></code>
</td></tr>
</tbody></table>
</dd>
<dt>
 <span class="term">
 <a id="opt-showDerivationWarnings"></a><a class="term" href="https://nixos.org/manual/nixpkgs/stable/#opt-showDerivationWarnings"><code class="option">showDerivationWarnings</code>
  </a>
 </span>
</dt>
<dd>
<p>Which warnings to display for potentially dangerous
or deprecated values passed into <code class="literal">stdenv.mkDerivation</code>.</p><p>A list of warnings can be found in
<a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/stdenv/generic/check-meta.nix" target="_top">/pkgs/stdenv/generic/check-meta.nix</a>.</p><p>This is not a stable interface; warnings may be added, changed
or removed without prior notice.</p>

<p><span class="emphasis"><em>Type:</em></span>
list of value “maintainerless” (singular enum)</p>

<p><span class="emphasis"><em>Default:</em></span>
<code class="literal">[ ]</code></p>

<p><span class="emphasis"><em>Declared by:</em></span></p>
<table border="0" summary="Simple list" class="simplelist">
<tbody><tr><td>
<code class="filename"><a class="filename" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/top-level/config.nix" target="_top">
pkgs/top-level/config.nix
</a></code>
</td></tr>
</tbody></table>
</dd>
<dt>
 <span class="term">
 <a id="opt-strictDepsByDefault"></a><a class="term" href="https://nixos.org/manual/nixpkgs/stable/#opt-strictDepsByDefault"><code class="option">strictDepsByDefault</code>
  </a>
 </span>
</dt>
<dd>
<p>Whether to set <code class="literal">strictDeps</code> to true by default while building nixpkgs packages.
Changing the default may cause a mass rebuild.</p>

<p><span class="emphasis"><em>Type:</em></span>
boolean</p>

<p><span class="emphasis"><em>Default:</em></span>
<code class="literal">false</code></p>

<p><span class="emphasis"><em>Declared by:</em></span></p>
<table border="0" summary="Simple list" class="simplelist">
<tbody><tr><td>
<code class="filename"><a class="filename" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/top-level/config.nix" target="_top">
pkgs/top-level/config.nix
</a></code>
</td></tr>
</tbody></table>
</dd>
<dt>
 <span class="term">
 <a id="opt-structuredAttrsByDefault"></a><a class="term" href="https://nixos.org/manual/nixpkgs/stable/#opt-structuredAttrsByDefault"><code class="option">structuredAttrsByDefault</code>
  </a>
 </span>
</dt>
<dd>
<p>Whether to set <code class="literal">__structuredAttrs</code> to true by default while building nixpkgs packages.
Changing the default may cause a mass rebuild.</p>

<p><span class="emphasis"><em>Type:</em></span>
boolean</p>

<p><span class="emphasis"><em>Default:</em></span>
<code class="literal">false</code></p>

<p><span class="emphasis"><em>Declared by:</em></span></p>
<table border="0" summary="Simple list" class="simplelist">
<tbody><tr><td>
<code class="filename"><a class="filename" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/top-level/config.nix" target="_top">
pkgs/top-level/config.nix
</a></code>
</td></tr>
</tbody></table>
</dd>
<dt>
 <span class="term">
 <a id="opt-warnUndeclaredOptions"></a><a class="term" href="https://nixos.org/manual/nixpkgs/stable/#opt-warnUndeclaredOptions"><code class="option">warnUndeclaredOptions</code>
  </a>
 </span>
</dt>
<dd>
<p>Whether to warn when <code class="literal">config</code> contains an unrecognized attribute.</p>

<p><span class="emphasis"><em>Type:</em></span>
boolean</p>

<p><span class="emphasis"><em>Default:</em></span>
<code class="literal">false</code></p>

<p><span class="emphasis"><em>Declared by:</em></span></p>
<table border="0" summary="Simple list" class="simplelist">
<tbody><tr><td>
<code class="filename"><a class="filename" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/top-level/config.nix" target="_top">
pkgs/top-level/config.nix
</a></code>
</td></tr>
</tbody></table>
</dd>
 </dl>
</div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-declarative-package-management" class="title" style="clear: both">Declarative Package Management   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-declarative-package-management" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-building-environment">Build an environment</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-getting-documentation">Getting documentation</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-gnu-info-setup">GNU info setup</a> </span></dt> </dl></div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-building-environment" class="title">Build an environment   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-building-environment" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Using <code class="literal">packageOverrides</code>, it is possible to manage packages declaratively. This means that we can list all of our desired packages within a declarative Nix expression. For example, to have <code class="literal">aspell</code>, <code class="literal">bc</code>, <code class="literal">ffmpeg</code>, <code class="literal">coreutils</code>, <code class="literal">gdb</code>, <code class="literal">nixUnstable</code>, <code class="literal">emscripten</code>, <code class="literal">jq</code>, <code class="literal">nox</code>, and <code class="literal">silver-searcher</code>, we could use the following in <code class="literal">~/.config/nixpkgs/config.nix</code>:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{
  <span class="hljs-attr">packageOverrides</span> = pkgs: <span class="hljs-keyword">with</span> pkgs; {
    <span class="hljs-attr">myPackages</span> = pkgs.buildEnv {
      <span class="hljs-attr">name</span> = <span class="hljs-string">"my-packages"</span>;
      <span class="hljs-attr">paths</span> = [
        aspell
        bc
        coreutils
        gdb
        ffmpeg
        nixUnstable
        emscripten
        jq
        nox
        silver-searcher
      ];
    };
  };
}
</code></pre><p>To install it into our environment, you can just run <code class="literal">nix-env -iA nixpkgs.myPackages</code>. If you want to load the packages to be built from a working copy of <code class="literal">nixpkgs</code> you just run <code class="literal">nix-env -f. -iA myPackages</code>. To explore what’s been installed, just look through <code class="literal">~/.nix-profile/</code>. You can see that a lot of stuff has been installed. Some of this stuff is useful some of it isn’t. Let’s tell Nixpkgs to only link the stuff that we want:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{
  <span class="hljs-attr">packageOverrides</span> = pkgs: <span class="hljs-keyword">with</span> pkgs; {
    <span class="hljs-attr">myPackages</span> = pkgs.buildEnv {
      <span class="hljs-attr">name</span> = <span class="hljs-string">"my-packages"</span>;
      <span class="hljs-attr">paths</span> = [
        aspell
        bc
        coreutils
        gdb
        ffmpeg
        nixUnstable
        emscripten
        jq
        nox
        silver-searcher
      ];
      <span class="hljs-attr">pathsToLink</span> = [ <span class="hljs-string">"/share"</span> <span class="hljs-string">"/bin"</span> ];
    };
  };
}
</code></pre><p><code class="literal">pathsToLink</code> tells Nixpkgs to only link the paths listed which gets rid of the extra stuff in the profile. <code class="literal">/bin</code> and <code class="literal">/share</code> are good defaults for a user environment, getting rid of the clutter. If you are running on Nix on MacOS, you may want to add another path as well, <code class="literal">/Applications</code>, that makes GUI apps available.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-getting-documentation" class="title">Getting documentation   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-getting-documentation" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>After building that new environment, look through <code class="literal">~/.nix-profile</code> to make sure everything is there that we wanted. Discerning readers will note that some files are missing. Look inside <code class="literal">~/.nix-profile/share/man/man1/</code> to verify this. There are no man pages for any of the Nix tools! This is because some packages like Nix have multiple outputs for things like documentation (see section 4). Let’s make Nix install those as well.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{
  <span class="hljs-attr">packageOverrides</span> = pkgs: <span class="hljs-keyword">with</span> pkgs; {
    <span class="hljs-attr">myPackages</span> = pkgs.buildEnv {
      <span class="hljs-attr">name</span> = <span class="hljs-string">"my-packages"</span>;
      <span class="hljs-attr">paths</span> = [
        aspell
        bc
        coreutils
        ffmpeg
        nixUnstable
        emscripten
        jq
        nox
        silver-searcher
      ];
      <span class="hljs-attr">pathsToLink</span> = [ <span class="hljs-string">"/share/man"</span> <span class="hljs-string">"/share/doc"</span> <span class="hljs-string">"/bin"</span> ];
      <span class="hljs-attr">extraOutputsToInstall</span> = [ <span class="hljs-string">"man"</span> <span class="hljs-string">"doc"</span> ];
    };
  };
}
</code></pre><p>This provides us with some useful documentation for using our packages.  However, if we actually want those manpages to be detected by man, we need to set up our environment. This can also be managed within Nix expressions.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{
  <span class="hljs-attr">packageOverrides</span> = pkgs: <span class="hljs-keyword">with</span> pkgs; <span class="hljs-keyword">rec</span> {
    <span class="hljs-attr">myProfile</span> = writeText <span class="hljs-string">"my-profile"</span> <span class="hljs-string">''
      export PATH=$HOME/.nix-profile/bin:/nix/var/nix/profiles/default/bin:/sbin:/bin:/usr/sbin:/usr/bin
      export MANPATH=$HOME/.nix-profile/share/man:/nix/var/nix/profiles/default/share/man:/usr/share/man
    ''</span>;
    <span class="hljs-attr">myPackages</span> = pkgs.buildEnv {
      <span class="hljs-attr">name</span> = <span class="hljs-string">"my-packages"</span>;
      <span class="hljs-attr">paths</span> = [
        (runCommand <span class="hljs-string">"profile"</span> {} <span class="hljs-string">''
          mkdir -p $out/etc/profile.d
          cp <span class="hljs-subst">${myProfile}</span> $out/etc/profile.d/my-profile.sh
        ''</span>)
        aspell
        bc
        coreutils
        ffmpeg
        man
        nixUnstable
        emscripten
        jq
        nox
        silver-searcher
      ];
      <span class="hljs-attr">pathsToLink</span> = [ <span class="hljs-string">"/share/man"</span> <span class="hljs-string">"/share/doc"</span> <span class="hljs-string">"/bin"</span> <span class="hljs-string">"/etc"</span> ];
      <span class="hljs-attr">extraOutputsToInstall</span> = [ <span class="hljs-string">"man"</span> <span class="hljs-string">"doc"</span> ];
    };
  };
}
</code></pre><p>For this to work fully, you must also have this script sourced when you are logged in. Try adding something like this to your <code class="literal">~/.profile</code> file:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/sh</span>
if [ -d "${HOME}/.nix-profile/etc/profile.d" ]; then
  for i in "${HOME}/.nix-profile/etc/profile.d/"*.sh; do
    if [ -r "$i" ]; then
      . "$i"
    fi
  done
fi
</code></pre><p>Now just run <code class="literal">. "${HOME}/.profile"</code> and you can start loading man pages from your environment.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-gnu-info-setup" class="title">GNU info setup   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-gnu-info-setup" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Configuring GNU info is a little bit trickier than man pages. To work correctly, info needs a database to be generated. This can be done with some small modifications to our environment scripts.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{
  <span class="hljs-attr">packageOverrides</span> = pkgs: <span class="hljs-keyword">with</span> pkgs; <span class="hljs-keyword">rec</span> {
    <span class="hljs-attr">myProfile</span> = writeText <span class="hljs-string">"my-profile"</span> <span class="hljs-string">''
      export PATH=$HOME/.nix-profile/bin:/nix/var/nix/profiles/default/bin:/sbin:/bin:/usr/sbin:/usr/bin
      export MANPATH=$HOME/.nix-profile/share/man:/nix/var/nix/profiles/default/share/man:/usr/share/man
      export INFOPATH=$HOME/.nix-profile/share/info:/nix/var/nix/profiles/default/share/info:/usr/share/info
    ''</span>;
    <span class="hljs-attr">myPackages</span> = pkgs.buildEnv {
      <span class="hljs-attr">name</span> = <span class="hljs-string">"my-packages"</span>;
      <span class="hljs-attr">paths</span> = [
        (runCommand <span class="hljs-string">"profile"</span> {} <span class="hljs-string">''
          mkdir -p $out/etc/profile.d
          cp <span class="hljs-subst">${myProfile}</span> $out/etc/profile.d/my-profile.sh
        ''</span>)
        aspell
        bc
        coreutils
        ffmpeg
        man
        nixUnstable
        emscripten
        jq
        nox
        silver-searcher
        texinfoInteractive
      ];
      <span class="hljs-attr">pathsToLink</span> = [ <span class="hljs-string">"/share/man"</span> <span class="hljs-string">"/share/doc"</span> <span class="hljs-string">"/share/info"</span> <span class="hljs-string">"/bin"</span> <span class="hljs-string">"/etc"</span> ];
      <span class="hljs-attr">extraOutputsToInstall</span> = [ <span class="hljs-string">"man"</span> <span class="hljs-string">"doc"</span> <span class="hljs-string">"info"</span> ];
      <span class="hljs-attr">postBuild</span> = <span class="hljs-string">''
        if [ -x $out/bin/install-info -a -w $out/share/info ]; then
          shopt -s nullglob
          for i in $out/share/info/*.info $out/share/info/*.info.gz; do
              $out/bin/install-info $i $out/share/info/dir
          done
        fi
      ''</span>;
    };
  };
}
</code></pre><p><code class="literal">postBuild</code> tells Nixpkgs to run a command after building the environment. In this case, <code class="literal">install-info</code> adds the installed info pages to <code class="literal">dir</code> which is GNU info’s default root node. Note that <code class="literal">texinfoInteractive</code> is added to the environment to give the <code class="literal">install-info</code> command.</p>
</div>

</div>

</div><div class="chapter"> <div class="titlepage">  <div>   <div>    <h2 id="chap-overlays" class="title">Overlays   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#chap-overlays" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <p><strong>Table of Contents</strong></p> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-overlays-install">Installing overlays</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-overlays-definition">Defining overlays</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-overlays-alternatives">Using overlays to configure alternatives</a> </span></dt> </dl></div><p>This chapter describes how to extend and change Nixpkgs using overlays.  Overlays are used to add layers in the fixed-point used by Nixpkgs to compose the set of all packages.</p><p>Nixpkgs can be configured with a list of overlays, which are applied in order. This means that the order of the overlays can be significant if multiple layers override the same package.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-overlays-install" class="title" style="clear: both">Installing overlays   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-overlays-install" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-overlays-argument">Set overlays in NixOS or Nix expressions</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-overlays-lookup">Install overlays via configuration lookup</a> </span></dt> </dl></div><p>The list of overlays can be set either explicitly in a Nix expression, or through <code class="literal">&lt;nixpkgs-overlays&gt;</code> or user configuration files.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-overlays-argument" class="title">Set overlays in NixOS or Nix expressions   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-overlays-argument" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>On a NixOS system the value of the <code class="literal">nixpkgs.overlays</code> option, if present, is passed to the system Nixpkgs directly as an argument. Note that this does not affect the overlays for non-NixOS operations (e.g.  <code class="literal">nix-env</code>), which are <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#sec-overlays-lookup" title="Install overlays via configuration lookup">looked up</a> independently.</p><p>The list of overlays can be passed explicitly when importing nixpkgs, for example <code class="literal">import &lt;nixpkgs&gt; { overlays = [ overlay1 overlay2 ]; }</code>.</p><p>NOTE: DO NOT USE THIS in nixpkgs. Further overlays can be added by calling the <code class="literal">pkgs.extend</code> or <code class="literal">pkgs.appendOverlays</code>, although it is often preferable to avoid these functions, because they recompute the Nixpkgs fixpoint, which is somewhat expensive to do.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-overlays-lookup" class="title">Install overlays via configuration lookup   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-overlays-lookup" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The list of overlays is determined as follows.</p><div class="orderedlist"><ol class="orderedlist " type="1"><li class="listitem"><p>First, if an <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#sec-overlays-argument" title="Set overlays in NixOS or Nix expressions"><code class="literal">overlays</code> argument</a> to the Nixpkgs function itself is given, then that is used and no path lookup will be performed.</p></li><li class="listitem"><p>Otherwise, if the Nix path entry <code class="literal">&lt;nixpkgs-overlays&gt;</code> exists, we look for overlays at that path, as described below.</p><p>See the <a class="link" href="https://nixos.org/manual/nix/stable/command-ref/env-common#env-NIX_PATH" target="_top">section on <code class="literal">NIX_PATH</code></a> in the Nix manual for more details on how to set a value for <code class="literal">&lt;nixpkgs-overlays&gt;.</code></p></li><li class="listitem"><p>If one of <code class="literal">~/.config/nixpkgs/overlays.nix</code> and <code class="literal">~/.config/nixpkgs/overlays/</code> exists, then we look for overlays at that path, as described below. It is an error if both exist.</p></li></ol></div><p>If we are looking for overlays at a path, then there are two cases:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>If the path is a file, then the file is imported as a Nix expression and used as the list of overlays.</p></li><li class="listitem"><p>If the path is a directory, then we take the content of the directory, order it lexicographically, and attempt to interpret each as an overlay by:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p>Importing the file, if it is a <code class="literal">.nix</code> file.</p></li><li class="listitem"><p>Importing a top-level <code class="literal">default.nix</code> file, if it is a directory.</p></li></ul></div></li></ul></div><p>Because overlays that are set in NixOS configuration do not affect non-NixOS operations such as <code class="literal">nix-env</code>, the <code class="literal">overlays.nix</code> option provides a convenient way to use the same overlays for a NixOS system configuration and user configuration: the same file can be used as <code class="literal">overlays.nix</code> and imported as the value of <code class="literal">nixpkgs.overlays</code>.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-overlays-definition" class="title" style="clear: both">Defining overlays   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-overlays-definition" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>Overlays are Nix functions which accept two arguments, conventionally called <code class="literal">self</code> and <code class="literal">super</code>, and return a set of packages. For example, the following is a valid overlay.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">self: super:

{
  <span class="hljs-attr">boost</span> = super.boost.override {
    <span class="hljs-attr">python</span> = self.python3;
  };
  <span class="hljs-attr">rr</span> = super.callPackage ./pkgs/rr {
    <span class="hljs-attr">stdenv</span> = self.stdenv_32bit;
  };
}
</code></pre><p>The first argument (<code class="literal">self</code>) corresponds to the final package set. You should use this set for the dependencies of all packages specified in your overlay. For example, all the dependencies of <code class="literal">rr</code> in the example above come from <code class="literal">self</code>, as well as the overridden dependencies used in the <code class="literal">boost</code> override.</p><p>The second argument (<code class="literal">super</code>) corresponds to the result of the evaluation of the previous stages of Nixpkgs. It does not contain any of the packages added by the current overlay, nor any of the following overlays. This set should be used either to refer to packages you wish to override, or to access functions defined in Nixpkgs. For example, the original recipe of <code class="literal">boost</code> in the above example, comes from <code class="literal">super</code>, as well as the <code class="literal">callPackage</code> function.</p><p>The value returned by this function should be a set similar to <code class="literal">pkgs/top-level/all-packages.nix</code>, containing overridden and/or new packages.</p><p>Overlays are similar to other methods for customizing Nixpkgs, in particular the <code class="literal">packageOverrides</code> attribute described in <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#sec-modify-via-packageOverrides" title="Modify packages via packageOverrides">the section called “Modify packages via <code class="literal">packageOverrides</code>”</a>. Indeed, <code class="literal">packageOverrides</code> acts as an overlay with only the <code class="literal">super</code> argument. It is therefore appropriate for basic use, but overlays are more powerful and easier to distribute.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-overlays-alternatives" class="title" style="clear: both">Using overlays to configure alternatives   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-overlays-alternatives" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-overlays-alternatives-blas-lapack">BLAS/LAPACK</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-overlays-alternatives-mpi">Switching the MPI implementation</a> </span></dt> </dl></div><p>Certain software packages have different implementations of the same interface. Other distributions have functionality to switch between these. For example, Debian provides <a class="link" href="https://wiki.debian.org/DebianAlternatives" target="_top">DebianAlternatives</a>.  Nixpkgs has what we call <code class="literal">alternatives</code>, which are configured through overlays.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-overlays-alternatives-blas-lapack" class="title">BLAS/LAPACK   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-overlays-alternatives-blas-lapack" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>In Nixpkgs, we have multiple implementations of the BLAS/LAPACK numerical linear algebra interfaces. They are:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><a class="link" href="https://www.openblas.net/" target="_top">OpenBLAS</a></p><p>The Nixpkgs attribute is <code class="literal">openblas</code> for ILP64 (integer width = 64 bits) and <code class="literal">openblasCompat</code> for LP64 (integer width = 32 bits).  <code class="literal">openblasCompat</code> is the default.</p></li><li class="listitem"><p><a class="link" href="https://www.netlib.org/lapack/" target="_top">LAPACK reference</a> (also provides BLAS and CBLAS)</p><p>The Nixpkgs attribute is <code class="literal">lapack-reference</code>.</p></li><li class="listitem"><p><a class="link" href="https://software.intel.com/en-us/mkl" target="_top">Intel MKL</a> (only works on the x86_64 architecture, unfree)</p><p>The Nixpkgs attribute is <code class="literal">mkl</code>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/flame/blis" target="_top">BLIS</a></p><p>BLIS, available through the attribute <code class="literal">blis</code>, is a framework for linear algebra kernels. In addition, it implements the BLAS interface.</p></li><li class="listitem"><p><a class="link" href="https://developer.amd.com/amd-aocl/blas-library/" target="_top">AMD BLIS/LIBFLAME</a> (optimized for modern AMD x86_64 CPUs)</p><p>The AMD fork of the BLIS library, with attribute <code class="literal">amd-blis</code>, extends BLIS with optimizations for modern AMD CPUs. The changes are usually submitted to the upstream BLIS project after some time. However, AMD BLIS typically provides some performance improvements on AMD Zen CPUs. The complementary AMD LIBFLAME library, with attribute <code class="literal">amd-libflame</code>, provides a LAPACK implementation.</p></li></ul></div><p>Introduced in <a class="link" href="https://github.com/NixOS/nixpkgs/pull/83888" target="_top">PR #83888</a>, we are able to override the <code class="literal">blas</code> and <code class="literal">lapack</code> packages to use different implementations, through the <code class="literal">blasProvider</code> and <code class="literal">lapackProvider</code> argument. This can be used to select a different provider. BLAS providers will have symlinks in <code class="literal">$out/lib/libblas.so.3</code> and <code class="literal">$out/lib/libcblas.so.3</code> to their respective BLAS libraries.  Likewise, LAPACK providers will have symlinks in <code class="literal">$out/lib/liblapack.so.3</code> and <code class="literal">$out/lib/liblapacke.so.3</code> to their respective LAPACK libraries. For example, Intel MKL is both a BLAS and LAPACK provider. An overlay can be created to use Intel MKL that looks like:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">self: super:

{
  <span class="hljs-attr">blas</span> = super.blas.override {
    <span class="hljs-attr">blasProvider</span> = self.mkl;
  };

  <span class="hljs-attr">lapack</span> = super.lapack.override {
    <span class="hljs-attr">lapackProvider</span> = self.mkl;
  };
}
</code></pre><p>This overlay uses Intel’s MKL library for both BLAS and LAPACK interfaces. Note that the same can be accomplished at runtime using <code class="literal">LD_LIBRARY_PATH</code> of <code class="literal">libblas.so.3</code> and <code class="literal">liblapack.so.3</code>. For instance:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">LD_LIBRARY_PATH=$(nix-build -A mkl)/lib<span class="hljs-variable">${LD_LIBRARY_PATH:+:}</span><span class="hljs-variable">$LD_LIBRARY_PATH</span> nix-shell -p octave --run octave</span>
</code></pre><p>Intel MKL requires an <code class="literal">openmp</code> implementation when running with multiple processors. By default, <code class="literal">mkl</code> will use Intel’s <code class="literal">iomp</code> implementation if no other is specified, but this is a runtime-only dependency and binary compatible with the LLVM implementation. To use that one instead, Intel recommends users set it with <code class="literal">LD_PRELOAD</code>. Note that <code class="literal">mkl</code> is only available on <code class="literal">x86_64-linux</code> and <code class="literal">x86_64-darwin</code>. Moreover, Hydra is not building and distributing pre-compiled binaries using it.</p><p>To override <code class="literal">blas</code> and <code class="literal">lapack</code> with its reference implementations (i.e. for development purposes), one can use the following overlay:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">self: super:

{
  <span class="hljs-attr">blas</span> = super.blas.override {
    <span class="hljs-attr">blasProvider</span> = self.lapack-reference;
  };

  <span class="hljs-attr">lapack</span> = super.lapack.override {
    <span class="hljs-attr">lapackProvider</span> = self.lapack-reference;
  };
}
</code></pre><p>For BLAS/LAPACK switching to work correctly, all packages must depend on <code class="literal">blas</code> or <code class="literal">lapack</code>. This ensures that only one BLAS/LAPACK library is used at one time. There are two versions of BLAS/LAPACK currently in the wild, <code class="literal">LP64</code> (integer size = 32 bits) and <code class="literal">ILP64</code> (integer size = 64 bits). The attributes <code class="literal">blas</code> and <code class="literal">lapack</code> are <code class="literal">LP64</code> by default. Their <code class="literal">ILP64</code> version are provided through the attributes <code class="literal">blas-ilp64</code> and <code class="literal">lapack-ilp64</code>. Some software needs special flags or patches to work with <code class="literal">ILP64</code>. You can check if <code class="literal">ILP64</code> is used in Nixpkgs with <code class="literal">blas.isILP64</code> and <code class="literal">lapack.isILP64</code>. Some software does NOT work with <code class="literal">ILP64</code>, and derivations need to specify an assertion to prevent this. You can prevent <code class="literal">ILP64</code> from being used with the following:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ stdenv, blas, lapack, ... }:

<span class="hljs-keyword">assert</span> (!blas.isILP64) &amp;&amp; (!lapack.isILP64);

stdenv.mkDerivation {
  ...
}
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-overlays-alternatives-mpi" class="title">Switching the MPI implementation   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-overlays-alternatives-mpi" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>All programs that are built with <a class="link" href="https://en.wikipedia.org/wiki/Message_Passing_Interface" target="_top">MPI</a> support use the generic attribute <code class="literal">mpi</code> as an input. At the moment Nixpkgs natively provides two different MPI implementations:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><a class="link" href="https://www.open-mpi.org/" target="_top">Open MPI</a> (default), attribute name
<code class="literal">openmpi</code></p></li><li class="listitem"><p><a class="link" href="https://www.mpich.org/" target="_top">MPICH</a>, attribute name <code class="literal">mpich</code></p></li><li class="listitem"><p><a class="link" href="https://mvapich.cse.ohio-state.edu/" target="_top">MVAPICH</a>, attribute name <code class="literal">mvapich</code></p></li></ul></div><p>To provide MPI enabled applications that use <code class="literal">MPICH</code>, instead of the default <code class="literal">Open MPI</code>, use the following overlay:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">self: super:

{
  <span class="hljs-attr">mpi</span> = self.mpich;
}
</code></pre>
</div>

</div>

</div><div class="chapter"> <div class="titlepage">  <div>   <div>    <h2 id="chap-overrides" class="title">Overriding   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#chap-overrides" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <p><strong>Table of Contents</strong></p> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-pkg-override">&lt;pkg&gt;.override</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-pkg-overrideAttrs">&lt;pkg&gt;.overrideAttrs</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-pkg-overrideDerivation">&lt;pkg&gt;.overrideDerivation</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-lib-makeOverridable">lib.makeOverridable</a> </span></dt> </dl></div><p>Sometimes one wants to override parts of <code class="literal">nixpkgs</code>, e.g. derivation attributes, the results of derivations.</p><p>These functions are used to make changes to packages, returning only single packages. <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#chap-overlays" title="Overlays">Overlays</a>, on the other hand, can be used to combine the overridden packages across the entire package set of Nixpkgs.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-pkg-override" class="title" style="clear: both">&lt;pkg&gt;.override   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-pkg-override" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>The function <code class="literal">override</code> is usually available for all the derivations in the nixpkgs expression (<code class="literal">pkgs</code>).</p><p>It is used to override the arguments passed to a function.</p><p>Example usages:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">pkgs.foo.override { <span class="hljs-attr">arg1</span> = val1; <span class="hljs-attr">arg2</span> = val2; ... }
</code></pre><p>It’s also possible to access the previous arguments.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">pkgs.foo.override (previous: { <span class="hljs-attr">arg1</span> = previous.arg1; ... })
</code></pre><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-built_in">import</span> pkgs.path { <span class="hljs-attr">overlays</span> = [ (self: super: {
  <span class="hljs-attr">foo</span> = super.foo.override { <span class="hljs-attr">barSupport</span> = <span class="hljs-literal">true</span> ; };
  })]};
</code></pre><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">mypkg</span> = pkgs.callPackage ./mypkg.nix {
  <span class="hljs-attr">mydep</span> = pkgs.mydep.override { ... };
  }
</code></pre><p>In the first example, <code class="literal">pkgs.foo</code> is the result of a function call with some default arguments, usually a derivation. Using <code class="literal">pkgs.foo.override</code> will call the same function with the given new arguments.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-pkg-overrideAttrs" class="title" style="clear: both">&lt;pkg&gt;.overrideAttrs   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-pkg-overrideAttrs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>The function <code class="literal">overrideAttrs</code> allows overriding the attribute set passed to a <code class="literal">stdenv.mkDerivation</code> call, producing a new derivation based on the original one. This function is available on all derivations produced by the <code class="literal">stdenv.mkDerivation</code> function, which is most packages in the nixpkgs expression <code class="literal">pkgs</code>.</p><p>Example usages:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">helloBar</span> = pkgs.hello.overrideAttrs (finalAttrs: previousAttrs: {
  <span class="hljs-attr">pname</span> = previousAttrs.pname + <span class="hljs-string">"-bar"</span>;
});
</code></pre><p>In the above example, “-bar” is appended to the pname attribute, while all other attributes will be retained from the original <code class="literal">hello</code> package.</p><p>The argument <code class="literal">previousAttrs</code> is conventionally used to refer to the attr set originally passed to <code class="literal">stdenv.mkDerivation</code>.</p><p>The argument <code class="literal">finalAttrs</code> refers to the final attributes passed to <code class="literal">mkDerivation</code>, plus the <code class="literal">finalPackage</code> attribute which is equal to the result of <code class="literal">mkDerivation</code> or subsequent <code class="literal">overrideAttrs</code> calls.</p><p>If only a one-argument function is written, the argument has the meaning of <code class="literal">previousAttrs</code>.</p><p>Function arguments can be omitted entirely if there is no need to access <code class="literal">previousAttrs</code> or <code class="literal">finalAttrs</code>.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">helloWithDebug</span> = pkgs.hello.overrideAttrs {
  <span class="hljs-attr">separateDebugInfo</span> = <span class="hljs-literal">true</span>;
};
</code></pre><p>In the above example, the <code class="literal">separateDebugInfo</code> attribute is overridden to be true, thus building debug info for <code class="literal">helloWithDebug</code>.</p><div class="note"><h3 class="title">Note</h3><p>Note that <code class="literal">separateDebugInfo</code> is processed only by the <code class="literal">stdenv.mkDerivation</code> function, not the generated, raw Nix derivation. Thus, using <code class="literal">overrideDerivation</code> will not work in this case, as it overrides only the attributes of the final derivation. It is for this reason that <code class="literal">overrideAttrs</code> should be preferred in (almost) all cases to <code class="literal">overrideDerivation</code>, i.e. to allow using <code class="literal">stdenv.mkDerivation</code> to process input arguments, as well as the fact that it is easier to use (you can use the same attribute names you see in your Nix code, instead of the ones generated (e.g. <code class="literal">buildInputs</code> vs <code class="literal">nativeBuildInputs</code>), and it involves less typing).</p></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-pkg-overrideDerivation" class="title" style="clear: both">&lt;pkg&gt;.overrideDerivation   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-pkg-overrideDerivation" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="warning"><h3 class="title">Warning</h3><p>You should prefer <code class="literal">overrideAttrs</code> in almost all cases, see its documentation for the reasons why. <code class="literal">overrideDerivation</code> is not deprecated and will continue to work, but is less nice to use and does not have as many abilities as <code class="literal">overrideAttrs</code>.</p></div><div class="warning"><h3 class="title">Warning</h3><p>Do not use this function in Nixpkgs as it evaluates a derivation before modifying it, which breaks package abstraction. In addition, this evaluation-per-function application incurs a performance penalty, which can become a problem if many overrides are used. It is only intended for ad-hoc customisation, such as in <code class="literal">~/.config/nixpkgs/config.nix</code>.</p></div><p>The function <code class="literal">overrideDerivation</code> creates a new derivation based on an existing one by overriding the original’s attributes with the attribute set produced by the specified function. This function is available on all derivations defined using the <code class="literal">makeOverridable</code> function. Most standard derivation-producing functions, such as <code class="literal">stdenv.mkDerivation</code>, are defined using this function, which means most packages in the nixpkgs expression, <code class="literal">pkgs</code>, have this function.</p><p>Example usage:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">mySed</span> = pkgs.gnused.overrideDerivation (oldAttrs: {
  <span class="hljs-attr">name</span> = <span class="hljs-string">"sed-4.2.2-pre"</span>;
  <span class="hljs-attr">src</span> = fetchurl {
    <span class="hljs-attr">url</span> = <span class="hljs-string">"ftp://alpha.gnu.org/gnu/sed/sed-4.2.2-pre.tar.bz2"</span>;
    <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-MxBJRcM2rYzQYwJ5XKxhXTQByvSg5jZc5cSHEZoB2IY="</span>;
  };
  <span class="hljs-attr">patches</span> = [];
});
</code></pre><p>In the above example, the <code class="literal">name</code>, <code class="literal">src</code>, and <code class="literal">patches</code> of the derivation will be overridden, while all other attributes will be retained from the original derivation.</p><p>The argument <code class="literal">oldAttrs</code> is used to refer to the attribute set of the original derivation.</p><div class="note"><h3 class="title">Note</h3><p>A package’s attributes are evaluated <span class="emphasis"><em>before</em></span> being modified by the <code class="literal">overrideDerivation</code> function. For example, the <code class="literal">name</code> attribute reference in <code class="literal">url = "mirror://gnu/hello/${name}.tar.gz";</code> is filled-in <span class="emphasis"><em>before</em></span> the <code class="literal">overrideDerivation</code> function modifies the attribute set. This means that overriding the <code class="literal">name</code> attribute, in this example, <span class="emphasis"><em>will not</em></span> change the value of the <code class="literal">url</code> attribute. Instead, we need to override both the <code class="literal">name</code> <span class="emphasis"><em>and</em></span> <code class="literal">url</code> attributes.</p></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-lib-makeOverridable" class="title" style="clear: both">lib.makeOverridable   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-lib-makeOverridable" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>The function <code class="literal">lib.makeOverridable</code> is used to make the result of a function easily customizable. This utility only makes sense for functions that accept an argument set and return an attribute set.</p><p>Example usage:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">f</span> = { a, b }: { <span class="hljs-attr">result</span> = a+b; };
<span class="hljs-attr">c</span> = lib.makeOverridable f { <span class="hljs-attr">a</span> = <span class="hljs-number">1</span>; <span class="hljs-attr">b</span> = <span class="hljs-number">2</span>; };
</code></pre><p>The variable <code class="literal">c</code> is the value of the <code class="literal">f</code> function applied with some default arguments. Hence the value of <code class="literal">c.result</code> is <code class="literal">3</code>, in this example.</p><p>The variable <code class="literal">c</code> however also has some additional functions, like
<a class="link" href="https://nixos.org/manual/nixpkgs/stable/#sec-pkg-override" title="&lt;pkg&gt;.override">c.override</a> which can be used to override the
default arguments. In this example the value of
<code class="literal">(c.override { a = 4; }).result</code> is 6.</p>
</div>

</div>
</div><div class="part"> <div class="titlepage">  <div>   <div>    <h1 id="id-1.4" class="title">Nixpkgs <code class="literal">lib</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#id-1.4" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h1>  </div> </div></div><div class="partintro"><div class="toc"> <p><strong>Table of Contents</strong></p> <dl class="toc">  <dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-functions">Functions reference</a> </span></dt><dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#module-system">Module System</a> </span></dt> </dl></div></div><div class="chapter"> <div class="titlepage">  <div>   <div>    <h2 id="chap-functions" class="title">Functions reference   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#chap-functions" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <p><strong>Table of Contents</strong></p> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-functions-library">Nixpkgs Library Functions</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-generators">Generators</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-debug">Debugging Nix Expressions</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-prefer-remote-fetch">prefer-remote-fetch overlay</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-nix-gitignore">pkgs.nix-gitignore</a> </span></dt> </dl></div><p>The nixpkgs repository has several utility functions to manipulate Nix expressions.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-functions-library" class="title" style="clear: both">Nixpkgs Library Functions   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-functions-library" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-functions-library-asserts">lib.asserts: assertion functions</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-functions-library-attrsets">lib.attrsets: attribute set functions</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-functions-library-strings">lib.strings: string manipulation functions</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-functions-library-versions">lib.versions: version string functions</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-functions-library-trivial">lib.trivial: miscellaneous functions</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-functions-library-fixedPoints">lib.fixedPoints: explicit recursion functions</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-functions-library-lists">lib.lists: list manipulation functions</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-functions-library-debug">lib.debug: debugging functions</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-functions-library-options">lib.options: NixOS / nixpkgs option handling</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-functions-library-path">lib.path: path functions</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-functions-library-filesystem">lib.filesystem: filesystem functions</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-functions-library-fileset">lib.fileset: file set functions</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-functions-library-sources">lib.sources: source filtering functions</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-functions-library-cli">lib.cli: command-line serialization functions</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-functions-library-gvariant">lib.gvariant: GVariant formatted string serialization functions</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-functions-library-customisation">lib.customisation: Functions to customise (derivation-related) functions, derivatons, or attribute sets</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-functions-library-meta">lib.meta: functions for derivation metadata</a> </span></dt> </dl></div><p>Nixpkgs provides a standard library at <code class="literal">pkgs.lib</code>, or through <code class="literal">import &lt;nixpkgs/lib&gt;</code>.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-functions-library-asserts" class="title">lib.asserts: assertion functions   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-functions-library-asserts" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.asserts.assertMsg" class="title"><code class="literal">lib.asserts.assertMsg</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.asserts.assertMsg" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">assertMsg :: Bool -&gt; String -&gt; Bool</code></p><p>Throw if pred is false, else return pred.
Intended to be used to augment asserts with helpful error messages.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">pred</code></span></dt><dd><p>Predicate that needs to succeed, otherwise <code class="literal">msg</code> is thrown</p></dd><dt><span class="term"><code class="literal">msg</code></span></dt><dd><p>Message to throw in case <code class="literal">pred</code> fails</p></dd></dl></div><div class="example"><span id="function-library-example-lib.asserts.assertMsg"></span><p class="title"><strong>Example&nbsp;1.&nbsp;<code class="literal">lib.asserts.assertMsg</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">assertMsg <span class="hljs-literal">false</span> <span class="hljs-string">"nope"</span>
stderr&gt; error: nope

<span class="hljs-keyword">assert</span> assertMsg (<span class="hljs-string">"foo"</span> == <span class="hljs-string">"bar"</span>) <span class="hljs-string">"foo is not bar, silly"</span>; <span class="hljs-string">""</span>
stderr&gt; error: foo is not bar, silly
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/asserts.nix#L19" target="_top">lib/asserts.nix:19</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.asserts.assertOneOf" class="title"><code class="literal">lib.asserts.assertOneOf</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.asserts.assertOneOf" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">assertOneOf :: String -&gt; ComparableVal -&gt; List ComparableVal -&gt; Bool</code></p><p>Specialized <code class="literal">assertMsg</code> for checking if <code class="literal">val</code> is one of the elements
of the list <code class="literal">xs</code>. Useful for checking enums.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">name</code></span></dt><dd><p>The name of the variable the user entered <code class="literal">val</code> into, for inclusion in the error message</p></dd><dt><span class="term"><code class="literal">val</code></span></dt><dd><p>The value of what the user provided, to be compared against the values in <code class="literal">xs</code></p></dd><dt><span class="term"><code class="literal">xs</code></span></dt><dd><p>The list of valid values</p></dd></dl></div><div class="example"><span id="function-library-example-lib.asserts.assertOneOf"></span><p class="title"><strong>Example&nbsp;2.&nbsp;<code class="literal">lib.asserts.assertOneOf</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">let</span> <span class="hljs-attr">sslLibrary</span> = <span class="hljs-string">"libressl"</span>;
<span class="hljs-keyword">in</span> assertOneOf <span class="hljs-string">"sslLibrary"</span> sslLibrary [ <span class="hljs-string">"openssl"</span> <span class="hljs-string">"bearssl"</span> ]
stderr&gt; error: sslLibrary must be one of [
stderr&gt;   <span class="hljs-string">"openssl"</span>
stderr&gt;   <span class="hljs-string">"bearssl"</span>
stderr&gt; ], but is: <span class="hljs-string">"libressl"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/asserts.nix#L40" target="_top">lib/asserts.nix:40</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.asserts.assertEachOneOf" class="title"><code class="literal">lib.asserts.assertEachOneOf</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.asserts.assertEachOneOf" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">assertEachOneOf :: String -&gt; List ComparableVal -&gt; List ComparableVal -&gt; Bool</code></p><p>Specialized <code class="literal">assertMsg</code> for checking if every one of <code class="literal">vals</code> is one of the elements
of the list <code class="literal">xs</code>. Useful for checking lists of supported attributes.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">name</code></span></dt><dd><p>The name of the variable the user entered <code class="literal">val</code> into, for inclusion in the error message</p></dd><dt><span class="term"><code class="literal">vals</code></span></dt><dd><p>The list of values of what the user provided, to be compared against the values in <code class="literal">xs</code></p></dd><dt><span class="term"><code class="literal">xs</code></span></dt><dd><p>The list of valid values</p></dd></dl></div><div class="example"><span id="function-library-example-lib.asserts.assertEachOneOf"></span><p class="title"><strong>Example&nbsp;3.&nbsp;<code class="literal">lib.asserts.assertEachOneOf</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">let</span> <span class="hljs-attr">sslLibraries</span> = [ <span class="hljs-string">"libressl"</span> <span class="hljs-string">"bearssl"</span> ];
<span class="hljs-keyword">in</span> assertEachOneOf <span class="hljs-string">"sslLibraries"</span> sslLibraries [ <span class="hljs-string">"openssl"</span> <span class="hljs-string">"bearssl"</span> ]
stderr&gt; error: each element <span class="hljs-keyword">in</span> sslLibraries must be one of [
stderr&gt;   <span class="hljs-string">"openssl"</span>
stderr&gt;   <span class="hljs-string">"bearssl"</span>
stderr&gt; ], but is: [
stderr&gt;   <span class="hljs-string">"libressl"</span>
stderr&gt;   <span class="hljs-string">"bearssl"</span>
stderr&gt; ]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/asserts.nix#L70" target="_top">lib/asserts.nix:70</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-functions-library-attrsets" class="title">lib.attrsets: attribute set functions   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-functions-library-attrsets" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Operations on attribute sets.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.attrsets.attrByPath" class="title"><code class="literal">lib.attrsets.attrByPath</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.attrByPath" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">attrByPath :: [String] -&gt; Any -&gt; AttrSet -&gt; Any</code></p><p>Return an attribute from nested attribute sets.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">attrPath</code></span></dt><dd><p>A list of strings representing the attribute path to return from <code class="literal">set</code></p></dd><dt><span class="term"><code class="literal">default</code></span></dt><dd><p>Default value if <code class="literal">attrPath</code> does not resolve to an existing value</p></dd><dt><span class="term"><code class="literal">set</code></span></dt><dd><p>The nested attribute set to select values from</p></dd></dl></div><div class="example"><span id="function-library-example-lib.attrsets.attrByPath"></span><p class="title"><strong>Example&nbsp;4.&nbsp;<code class="literal">lib.attrsets.attrByPath</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">x</span> = { <span class="hljs-attr">a</span> = { <span class="hljs-attr">b</span> = <span class="hljs-number">3</span>; }; }
<span class="hljs-comment"># ["a" "b"] is equivalent to x.a.b</span>
<span class="hljs-comment"># 6 is a default value to return if the path does not exist in attrset</span>
attrByPath [<span class="hljs-string">"a"</span> <span class="hljs-string">"b"</span>] <span class="hljs-number">6</span> <span class="hljs-attr">x</span>
=&gt; <span class="hljs-number">3</span>
attrByPath [<span class="hljs-string">"z"</span> <span class="hljs-string">"z"</span>] <span class="hljs-number">6</span> <span class="hljs-attr">x</span>
=&gt; <span class="hljs-number">6</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/attrsets.nix#L30" target="_top">lib/attrsets.nix:30</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.attrsets.hasAttrByPath" class="title"><code class="literal">lib.attrsets.hasAttrByPath</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.hasAttrByPath" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">hasAttrByPath :: [String] -&gt; AttrSet -&gt; Bool</code></p><p>Return if an attribute from nested attribute set exists.</p><p><span class="strong"><strong>Laws</strong></span>:</p><div class="orderedlist"><ol class="orderedlist compact" type="1"><li class="listitem"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">hasAttrByPath [] <span class="hljs-attr">x</span> == <span class="hljs-literal">true</span>
</code></pre></li></ol></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">attrPath</code></span></dt><dd><p>A list of strings representing the attribute path to check from <code class="literal">set</code></p></dd><dt><span class="term"><code class="literal">e</code></span></dt><dd><p>The nested attribute set to check</p></dd></dl></div><div class="example"><span id="function-library-example-lib.attrsets.hasAttrByPath"></span><p class="title"><strong>Example&nbsp;5.&nbsp;<code class="literal">lib.attrsets.hasAttrByPath</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">x</span> = { <span class="hljs-attr">a</span> = { <span class="hljs-attr">b</span> = <span class="hljs-number">3</span>; }; }
hasAttrByPath [<span class="hljs-string">"a"</span> <span class="hljs-string">"b"</span>] <span class="hljs-attr">x</span>
=&gt; <span class="hljs-literal">true</span>
hasAttrByPath [<span class="hljs-string">"z"</span> <span class="hljs-string">"z"</span>] <span class="hljs-attr">x</span>
=&gt; <span class="hljs-literal">false</span>
hasAttrByPath [] (<span class="hljs-built_in">throw</span> <span class="hljs-string">"no need"</span>)
=&gt; <span class="hljs-literal">true</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/attrsets.nix#L63" target="_top">lib/attrsets.nix:63</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.attrsets.longestValidPathPrefix" class="title"><code class="literal">lib.attrsets.longestValidPathPrefix</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.longestValidPathPrefix" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">attrsets.longestValidPathPrefix :: [String] -&gt; Value -&gt; [String]</code></p><p>Return the longest prefix of an attribute path that refers to an existing attribute in a nesting of attribute sets.</p><p>Can be used after <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.mapAttrsRecursiveCond" title="lib.attrsets.mapAttrsRecursiveCond"><code class="literal">mapAttrsRecursiveCond</code></a> to apply a condition,
although this will evaluate the predicate function on sibling attributes as well.</p><p>Note that the empty attribute path is valid for all values, so this function only throws an exception if any of its inputs does.</p><p><span class="strong"><strong>Laws</strong></span>:</p><div class="orderedlist"><ol class="orderedlist compact" type="1"><li class="listitem"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">attrsets.longestValidPathPrefix [] <span class="hljs-attr">x</span> == []
</code></pre></li><li class="listitem"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">hasAttrByPath (attrsets.longestValidPathPrefix p x) <span class="hljs-attr">x</span> == <span class="hljs-literal">true</span>
</code></pre></li></ol></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">attrPath</code></span></dt><dd><p>A list of strings representing the longest possible path that may be returned.</p></dd><dt><span class="term"><code class="literal">v</code></span></dt><dd><p>The nested attribute set to check.</p></dd></dl></div><div class="example"><span id="function-library-example-lib.attrsets.longestValidPathPrefix"></span><p class="title"><strong>Example&nbsp;6.&nbsp;<code class="literal">lib.attrsets.longestValidPathPrefix</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">x</span> = { <span class="hljs-attr">a</span> = { <span class="hljs-attr">b</span> = <span class="hljs-number">3</span>; }; }
attrsets.longestValidPathPrefix [<span class="hljs-string">"a"</span> <span class="hljs-string">"b"</span> <span class="hljs-string">"c"</span>] <span class="hljs-attr">x</span>
=&gt; [<span class="hljs-string">"a"</span> <span class="hljs-string">"b"</span>]
attrsets.longestValidPathPrefix [<span class="hljs-string">"a"</span>] <span class="hljs-attr">x</span>
=&gt; [<span class="hljs-string">"a"</span>]
attrsets.longestValidPathPrefix [<span class="hljs-string">"z"</span> <span class="hljs-string">"z"</span>] <span class="hljs-attr">x</span>
=&gt; []
attrsets.longestValidPathPrefix [<span class="hljs-string">"z"</span> <span class="hljs-string">"z"</span>] (<span class="hljs-built_in">throw</span> <span class="hljs-string">"no need"</span>)
=&gt; []
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/attrsets.nix#L107" target="_top">lib/attrsets.nix:107</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.attrsets.setAttrByPath" class="title"><code class="literal">lib.attrsets.setAttrByPath</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.setAttrByPath" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">setAttrByPath :: [String] -&gt; Any -&gt; AttrSet</code></p><p>Create a new attribute set with <code class="literal">value</code> set at the nested attribute location specified in <code class="literal">attrPath</code>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">attrPath</code></span></dt><dd><p>A list of strings representing the attribute path to set</p></dd><dt><span class="term"><code class="literal">value</code></span></dt><dd><p>The value to set at the location described by <code class="literal">attrPath</code></p></dd></dl></div><div class="example"><span id="function-library-example-lib.attrsets.setAttrByPath"></span><p class="title"><strong>Example&nbsp;7.&nbsp;<code class="literal">lib.attrsets.setAttrByPath</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">setAttrByPath [<span class="hljs-string">"a"</span> <span class="hljs-string">"b"</span>] <span class="hljs-number">3</span>
=&gt; { <span class="hljs-attr">a</span> = { <span class="hljs-attr">b</span> = <span class="hljs-number">3</span>; }; }
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/attrsets.nix#L150" target="_top">lib/attrsets.nix:150</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.attrsets.getAttrFromPath" class="title"><code class="literal">lib.attrsets.getAttrFromPath</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.getAttrFromPath" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">getAttrFromPath :: [String] -&gt; AttrSet -&gt; Any</code></p><p>Like <code class="literal">attrByPath</code>, but without a default value. If it doesn’t find the
path it will throw an error.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">attrPath</code></span></dt><dd><p>A list of strings representing the attribute path to get from <code class="literal">set</code></p></dd><dt><span class="term"><code class="literal">set</code></span></dt><dd><p>The nested attribute set to find the value in.</p></dd></dl></div><div class="example"><span id="function-library-example-lib.attrsets.getAttrFromPath"></span><p class="title"><strong>Example&nbsp;8.&nbsp;<code class="literal">lib.attrsets.getAttrFromPath</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">x</span> = { <span class="hljs-attr">a</span> = { <span class="hljs-attr">b</span> = <span class="hljs-number">3</span>; }; }
getAttrFromPath [<span class="hljs-string">"a"</span> <span class="hljs-string">"b"</span>] <span class="hljs-attr">x</span>
=&gt; <span class="hljs-number">3</span>
getAttrFromPath [<span class="hljs-string">"z"</span> <span class="hljs-string">"z"</span>] <span class="hljs-attr">x</span>
=&gt; error: cannot find attribute `z.z'
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/attrsets.nix#L176" target="_top">lib/attrsets.nix:176</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.attrsets.concatMapAttrs" class="title"><code class="literal">lib.attrsets.concatMapAttrs</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.concatMapAttrs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">concatMapAttrs :: (String -&gt; a -&gt; AttrSet) -&gt; AttrSet -&gt; AttrSet</code></p><p>Map each attribute in the given set and merge them into a new attribute set.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">f</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">v</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.attrsets.concatMapAttrs"></span><p class="title"><strong>Example&nbsp;9.&nbsp;<code class="literal">lib.attrsets.concatMapAttrs</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">concatMapAttrs
  (name: value: {
    ${name} = value;
    ${name + value} = value;
  })
  { <span class="hljs-attr">x</span> = <span class="hljs-string">"a"</span>; <span class="hljs-attr">y</span> = <span class="hljs-string">"b"</span>; }
=&gt; { <span class="hljs-attr">x</span> = <span class="hljs-string">"a"</span>; <span class="hljs-attr">xa</span> = <span class="hljs-string">"a"</span>; <span class="hljs-attr">y</span> = <span class="hljs-string">"b"</span>; <span class="hljs-attr">yb</span> = <span class="hljs-string">"b"</span>; }
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/attrsets.nix#L198" target="_top">lib/attrsets.nix:198</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.attrsets.updateManyAttrsByPath" class="title"><code class="literal">lib.attrsets.updateManyAttrsByPath</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.updateManyAttrsByPath" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">updateManyAttrsByPath :: [{ path :: [String]; update :: (Any -&gt; Any); }] -&gt; AttrSet -&gt; AttrSet</code></p><p>Update or set specific paths of an attribute set.</p><p>Takes a list of updates to apply and an attribute set to apply them to,
and returns the attribute set with the updates applied. Updates are
represented as <code class="literal">{ path = ...; update = ...; }</code> values, where <code class="literal">path</code> is a
list of strings representing the attribute path that should be updated,
and <code class="literal">update</code> is a function that takes the old value at that attribute path
as an argument and returns the new
value it should be.</p><p>Properties:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>Updates to deeper attribute paths are applied before updates to more
shallow attribute paths</p></li><li class="listitem"><p>Multiple updates to the same attribute path are applied in the order
they appear in the update list</p></li><li class="listitem"><p>If any but the last <code class="literal">path</code> element leads into a value that is not an
attribute set, an error is thrown</p></li><li class="listitem"><p>If there is an update for an attribute path that doesn’t exist,
accessing the argument in the update function causes an error, but
intermediate attribute sets are implicitly created as needed</p></li></ul></div><div class="example"><span id="function-library-example-lib.attrsets.updateManyAttrsByPath"></span><p class="title"><strong>Example&nbsp;10.&nbsp;<code class="literal">lib.attrsets.updateManyAttrsByPath</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">updateManyAttrsByPath [
  {
    <span class="hljs-attr">path</span> = [ <span class="hljs-string">"a"</span> <span class="hljs-string">"b"</span> ];
    <span class="hljs-attr">update</span> = old: { <span class="hljs-attr">d</span> = old.c; };
  }
  {
    <span class="hljs-attr">path</span> = [ <span class="hljs-string">"a"</span> <span class="hljs-string">"b"</span> <span class="hljs-string">"c"</span> ];
    <span class="hljs-attr">update</span> = old: old + <span class="hljs-number">1</span>;
  }
  {
    <span class="hljs-attr">path</span> = [ <span class="hljs-string">"x"</span> <span class="hljs-string">"y"</span> ];
    <span class="hljs-attr">update</span> = old: <span class="hljs-string">"xy"</span>;
  }
] { a.b.<span class="hljs-attr">c</span> = <span class="hljs-number">0</span>; }
=&gt; { <span class="hljs-attr">a</span> = { <span class="hljs-attr">b</span> = { <span class="hljs-attr">d</span> = <span class="hljs-number">1</span>; }; }; <span class="hljs-attr">x</span> = { <span class="hljs-attr">y</span> = <span class="hljs-string">"xy"</span>; }; }
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/attrsets.nix#L249" target="_top">lib/attrsets.nix:249</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.attrsets.attrVals" class="title"><code class="literal">lib.attrsets.attrVals</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.attrVals" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">attrVals :: [String] -&gt; AttrSet -&gt; [Any]</code></p><p>Return the specified attributes from a set.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">nameList</code></span></dt><dd><p>The list of attributes to fetch from <code class="literal">set</code>. Each attribute name must exist on the attrbitue set</p></dd><dt><span class="term"><code class="literal">set</code></span></dt><dd><p>The set to get attribute values from</p></dd></dl></div><div class="example"><span id="function-library-example-lib.attrsets.attrVals"></span><p class="title"><strong>Example&nbsp;11.&nbsp;<code class="literal">lib.attrsets.attrVals</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">attrVals [<span class="hljs-string">"a"</span> <span class="hljs-string">"b"</span> <span class="hljs-string">"c"</span>] <span class="hljs-attr">as</span>
=&gt; [as.a as.b as.c]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/attrsets.nix#L317" target="_top">lib/attrsets.nix:317</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.attrsets.attrValues" class="title"><code class="literal">lib.attrsets.attrValues</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.attrValues" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">attrValues :: AttrSet -&gt; [Any]</code></p><p>Return the values of all attributes in the given set, sorted by
attribute name.</p><div class="example"><span id="function-library-example-lib.attrsets.attrValues"></span><p class="title"><strong>Example&nbsp;12.&nbsp;<code class="literal">lib.attrsets.attrValues</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">attrValues {<span class="hljs-attr">c</span> = <span class="hljs-number">3</span>; <span class="hljs-attr">a</span> = <span class="hljs-number">1</span>; <span class="hljs-attr">b</span> = <span class="hljs-number">2</span>;}
=&gt; [<span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span>]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/attrsets.nix#L334" target="_top">lib/attrsets.nix:334</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.attrsets.getAttrs" class="title"><code class="literal">lib.attrsets.getAttrs</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.getAttrs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">getAttrs :: [String] -&gt; AttrSet -&gt; AttrSet</code></p><p>Given a set of attribute names, return the set of the corresponding
attributes from the given set.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">names</code></span></dt><dd><p>A list of attribute names to get out of <code class="literal">set</code></p></dd><dt><span class="term"><code class="literal">attrs</code></span></dt><dd><p>The set to get the named attributes from</p></dd></dl></div><div class="example"><span id="function-library-example-lib.attrsets.getAttrs"></span><p class="title"><strong>Example&nbsp;13.&nbsp;<code class="literal">lib.attrsets.getAttrs</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">getAttrs [ <span class="hljs-string">"a"</span> <span class="hljs-string">"b"</span> ] { <span class="hljs-attr">a</span> = <span class="hljs-number">1</span>; <span class="hljs-attr">b</span> = <span class="hljs-number">2</span>; <span class="hljs-attr">c</span> = <span class="hljs-number">3</span>; }
=&gt; { <span class="hljs-attr">a</span> = <span class="hljs-number">1</span>; <span class="hljs-attr">b</span> = <span class="hljs-number">2</span>; }
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/attrsets.nix#L347" target="_top">lib/attrsets.nix:347</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.attrsets.catAttrs" class="title"><code class="literal">lib.attrsets.catAttrs</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.catAttrs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">catAttrs :: String -&gt; [AttrSet] -&gt; [Any]</code></p><p>Collect each attribute named <code class="literal">attr</code> from a list of attribute
sets.  Sets that don’t contain the named attribute are ignored.</p><div class="example"><span id="function-library-example-lib.attrsets.catAttrs"></span><p class="title"><strong>Example&nbsp;14.&nbsp;<code class="literal">lib.attrsets.catAttrs</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">catAttrs <span class="hljs-string">"a"</span> [{<span class="hljs-attr">a</span> = <span class="hljs-number">1</span>;} {<span class="hljs-attr">b</span> = <span class="hljs-number">0</span>;} {<span class="hljs-attr">a</span> = <span class="hljs-number">2</span>;}]
=&gt; [<span class="hljs-number">1</span> <span class="hljs-number">2</span>]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/attrsets.nix#L363" target="_top">lib/attrsets.nix:363</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.attrsets.filterAttrs" class="title"><code class="literal">lib.attrsets.filterAttrs</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.filterAttrs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">filterAttrs :: (String -&gt; Any -&gt; Bool) -&gt; AttrSet -&gt; AttrSet</code></p><p>Filter an attribute set by removing all attributes for which the
given predicate return false.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">pred</code></span></dt><dd><p>Predicate taking an attribute name and an attribute value, which returns <code class="literal">true</code> to include the attribute, or <code class="literal">false</code> to exclude the attribute.</p></dd><dt><span class="term"><code class="literal">set</code></span></dt><dd><p>The attribute set to filter</p></dd></dl></div><div class="example"><span id="function-library-example-lib.attrsets.filterAttrs"></span><p class="title"><strong>Example&nbsp;15.&nbsp;<code class="literal">lib.attrsets.filterAttrs</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">filterAttrs (n: v: <span class="hljs-attr">n</span> == <span class="hljs-string">"foo"</span>) { <span class="hljs-attr">foo</span> = <span class="hljs-number">1</span>; <span class="hljs-attr">bar</span> = <span class="hljs-number">2</span>; }
=&gt; { <span class="hljs-attr">foo</span> = <span class="hljs-number">1</span>; }
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/attrsets.nix#L377" target="_top">lib/attrsets.nix:377</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.attrsets.filterAttrsRecursive" class="title"><code class="literal">lib.attrsets.filterAttrsRecursive</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.filterAttrsRecursive" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">filterAttrsRecursive :: (String -&gt; Any -&gt; Bool) -&gt; AttrSet -&gt; AttrSet</code></p><p>Filter an attribute set recursively by removing all attributes for
which the given predicate return false.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">pred</code></span></dt><dd><p>Predicate taking an attribute name and an attribute value, which returns <code class="literal">true</code> to include the attribute, or <code class="literal">false</code> to exclude the attribute.</p></dd><dt><span class="term"><code class="literal">set</code></span></dt><dd><p>The attribute set to filter</p></dd></dl></div><div class="example"><span id="function-library-example-lib.attrsets.filterAttrsRecursive"></span><p class="title"><strong>Example&nbsp;16.&nbsp;<code class="literal">lib.attrsets.filterAttrsRecursive</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">filterAttrsRecursive (n: v: v != <span class="hljs-literal">null</span>) { <span class="hljs-attr">foo</span> = { <span class="hljs-attr">bar</span> = <span class="hljs-literal">null</span>; }; }
=&gt; { <span class="hljs-attr">foo</span> = {}; }
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/attrsets.nix#L395" target="_top">lib/attrsets.nix:395</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.attrsets.foldlAttrs" class="title"><code class="literal">lib.attrsets.foldlAttrs</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.foldlAttrs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">foldlAttrs :: ( a -&gt; String -&gt; b -&gt; a ) -&gt; a -&gt; { ... :: b } -&gt; a</code></p><p>Like <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.foldl-prime" title="lib.lists.foldl&#39;"><code class="literal">lib.lists.foldl'</code></a> but for attribute sets.
Iterates over every name-value pair in the given attribute set.
The result of the callback function is often called <code class="literal">acc</code> for accumulator. It is passed between callbacks from left to right and the final <code class="literal">acc</code> is the return value of <code class="literal">foldlAttrs</code>.</p><p>Attention:
There is a completely different function
<code class="literal">lib.foldAttrs</code>
which has nothing to do with this function, despite the similar name.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">f</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">init</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">set</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.attrsets.foldlAttrs"></span><p class="title"><strong>Example&nbsp;17.&nbsp;<code class="literal">lib.attrsets.foldlAttrs</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">foldlAttrs
  (acc: name: value: {
    <span class="hljs-attr">sum</span> = acc.sum + value;
    <span class="hljs-attr">names</span> = acc.names ++ [name];
  })
  { <span class="hljs-attr">sum</span> = <span class="hljs-number">0</span>; <span class="hljs-attr">names</span> = []; }
  {
    <span class="hljs-attr">foo</span> = <span class="hljs-number">1</span>;
    <span class="hljs-attr">bar</span> = <span class="hljs-number">10</span>;
  }
-&gt;
  {
    <span class="hljs-attr">sum</span> = <span class="hljs-number">11</span>;
    <span class="hljs-attr">names</span> = [<span class="hljs-string">"bar"</span> <span class="hljs-string">"foo"</span>];
  }

foldlAttrs
  (<span class="hljs-built_in">throw</span> <span class="hljs-string">"function not needed"</span>)
  <span class="hljs-number">123</span>
  {};
-&gt;
  <span class="hljs-number">123</span>

foldlAttrs
  (acc: _: _: acc)
  <span class="hljs-number">3</span>
  { <span class="hljs-attr">z</span> = <span class="hljs-built_in">throw</span> <span class="hljs-string">"value not needed"</span>; <span class="hljs-attr">a</span> = <span class="hljs-built_in">throw</span> <span class="hljs-string">"value not needed"</span>; };
-&gt;
  <span class="hljs-number">3</span>

The accumulator doesn't have to be an attrset.
It can be as simple as a number <span class="hljs-literal">or</span> string.

foldlAttrs
  (acc: _: v: acc * <span class="hljs-number">10</span> + v)
  <span class="hljs-number">1</span>
  { <span class="hljs-attr">z</span> = <span class="hljs-number">1</span>; <span class="hljs-attr">a</span> = <span class="hljs-number">2</span>; };
-&gt;
  <span class="hljs-number">121</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/attrsets.nix#L466" target="_top">lib/attrsets.nix:466</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.attrsets.foldAttrs" class="title"><code class="literal">lib.attrsets.foldAttrs</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.foldAttrs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">foldAttrs :: (Any -&gt; Any -&gt; Any) -&gt; Any -&gt; [AttrSets] -&gt; Any</code></p><p>Apply fold functions to values grouped by key.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">op</code></span></dt><dd><p>A function, given a value and a collector combines the two.</p></dd><dt><span class="term"><code class="literal">nul</code></span></dt><dd><p>The starting value.</p></dd><dt><span class="term"><code class="literal">list_of_attrs</code></span></dt><dd><p>A list of attribute sets to fold together by key.</p></dd></dl></div><div class="example"><span id="function-library-example-lib.attrsets.foldAttrs"></span><p class="title"><strong>Example&nbsp;18.&nbsp;<code class="literal">lib.attrsets.foldAttrs</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">foldAttrs (item: acc: [item] ++ acc) [] [{ <span class="hljs-attr">a</span> = <span class="hljs-number">2</span>; } { <span class="hljs-attr">a</span> = <span class="hljs-number">3</span>; }]
=&gt; { <span class="hljs-attr">a</span> = [ <span class="hljs-number">2</span> <span class="hljs-number">3</span> ]; }
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/attrsets.nix#L482" target="_top">lib/attrsets.nix:482</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.attrsets.collect" class="title"><code class="literal">lib.attrsets.collect</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.collect" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">collect :: (AttrSet -&gt; Bool) -&gt; AttrSet -&gt; [x]</code></p><p>Recursively collect sets that verify a given predicate named <code class="literal">pred</code>
from the set <code class="literal">attrs</code>.  The recursion is stopped when the predicate is
verified.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">pred</code></span></dt><dd><p>Given an attribute’s value, determine if recursion should stop.</p></dd><dt><span class="term"><code class="literal">attrs</code></span></dt><dd><p>The attribute set to recursively collect.</p></dd></dl></div><div class="example"><span id="function-library-example-lib.attrsets.collect"></span><p class="title"><strong>Example&nbsp;19.&nbsp;<code class="literal">lib.attrsets.collect</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">collect isList { <span class="hljs-attr">a</span> = { <span class="hljs-attr">b</span> = [<span class="hljs-string">"b"</span>]; }; <span class="hljs-attr">c</span> = [<span class="hljs-number">1</span>]; }
=&gt; [[<span class="hljs-string">"b"</span>] [<span class="hljs-number">1</span>]]

collect (x: x ? outPath)
   { <span class="hljs-attr">a</span> = { <span class="hljs-attr">outPath</span> = <span class="hljs-string">"a/"</span>; }; <span class="hljs-attr">b</span> = { <span class="hljs-attr">outPath</span> = <span class="hljs-string">"b/"</span>; }; }
=&gt; [{ <span class="hljs-attr">outPath</span> = <span class="hljs-string">"a/"</span>; } { <span class="hljs-attr">outPath</span> = <span class="hljs-string">"b/"</span>; }]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/attrsets.nix#L511" target="_top">lib/attrsets.nix:511</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.attrsets.cartesianProductOfSets" class="title"><code class="literal">lib.attrsets.cartesianProductOfSets</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.cartesianProductOfSets" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">cartesianProductOfSets :: AttrSet -&gt; [AttrSet]</code></p><p>Return the cartesian product of attribute set value combinations.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">attrsOfLists</code></span></dt><dd><p>Attribute set with attributes that are lists of values</p></dd></dl></div><div class="example"><span id="function-library-example-lib.attrsets.cartesianProductOfSets"></span><p class="title"><strong>Example&nbsp;20.&nbsp;<code class="literal">lib.attrsets.cartesianProductOfSets</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">cartesianProductOfSets { <span class="hljs-attr">a</span> = [ <span class="hljs-number">1</span> <span class="hljs-number">2</span> ]; <span class="hljs-attr">b</span> = [ <span class="hljs-number">10</span> <span class="hljs-number">20</span> ]; }
=&gt; [
     { <span class="hljs-attr">a</span> = <span class="hljs-number">1</span>; <span class="hljs-attr">b</span> = <span class="hljs-number">10</span>; }
     { <span class="hljs-attr">a</span> = <span class="hljs-number">1</span>; <span class="hljs-attr">b</span> = <span class="hljs-number">20</span>; }
     { <span class="hljs-attr">a</span> = <span class="hljs-number">2</span>; <span class="hljs-attr">b</span> = <span class="hljs-number">10</span>; }
     { <span class="hljs-attr">a</span> = <span class="hljs-number">2</span>; <span class="hljs-attr">b</span> = <span class="hljs-number">20</span>; }
   ]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/attrsets.nix#L536" target="_top">lib/attrsets.nix:536</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.attrsets.nameValuePair" class="title"><code class="literal">lib.attrsets.nameValuePair</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.nameValuePair" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">nameValuePair :: String -&gt; Any -&gt; { name :: String; value :: Any; }</code></p><p>Utility function that creates a <code class="literal">{name, value}</code> pair as expected by <code class="literal">builtins.listToAttrs</code>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">name</code></span></dt><dd><p>Attribute name</p></dd><dt><span class="term"><code class="literal">value</code></span></dt><dd><p>Attribute value</p></dd></dl></div><div class="example"><span id="function-library-example-lib.attrsets.nameValuePair"></span><p class="title"><strong>Example&nbsp;21.&nbsp;<code class="literal">lib.attrsets.nameValuePair</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">nameValuePair <span class="hljs-string">"some"</span> <span class="hljs-number">6</span>
=&gt; { <span class="hljs-attr">name</span> = <span class="hljs-string">"some"</span>; <span class="hljs-attr">value</span> = <span class="hljs-number">6</span>; }
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/attrsets.nix#L555" target="_top">lib/attrsets.nix:555</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.attrsets.mapAttrs" class="title"><code class="literal">lib.attrsets.mapAttrs</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.mapAttrs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">mapAttrs :: (String -&gt; Any -&gt; Any) -&gt; AttrSet -&gt; AttrSet</code></p><p>Apply a function to each element in an attribute set, creating a new attribute set.</p><div class="example"><span id="function-library-example-lib.attrsets.mapAttrs"></span><p class="title"><strong>Example&nbsp;22.&nbsp;<code class="literal">lib.attrsets.mapAttrs</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">mapAttrs (name: value: name + <span class="hljs-string">"-"</span> + value)
   { <span class="hljs-attr">x</span> = <span class="hljs-string">"foo"</span>; <span class="hljs-attr">y</span> = <span class="hljs-string">"bar"</span>; }
=&gt; { <span class="hljs-attr">x</span> = <span class="hljs-string">"x-foo"</span>; <span class="hljs-attr">y</span> = <span class="hljs-string">"y-bar"</span>; }
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/attrsets.nix#L573" target="_top">lib/attrsets.nix:573</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.attrsets.mapAttrs-prime" class="title"><code class="literal">lib.attrsets.mapAttrs'</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.mapAttrs-prime" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">mapAttrs' :: (String -&gt; Any -&gt; { name :: String; value :: Any; }) -&gt; AttrSet -&gt; AttrSet</code></p><p>Like <code class="literal">mapAttrs</code>, but allows the name of each attribute to be
changed in addition to the value.  The applied function should
return both the new name and value as a <code class="literal">nameValuePair</code>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">f</code></span></dt><dd><p>A function, given an attribute’s name and value, returns a new <code class="literal">nameValuePair</code>.</p></dd><dt><span class="term"><code class="literal">set</code></span></dt><dd><p>Attribute set to map over.</p></dd></dl></div><div class="example"><span id="function-library-example-lib.attrsets.mapAttrs-prime"></span><p class="title"><strong>Example&nbsp;23.&nbsp;<code class="literal">lib.attrsets.mapAttrs'</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">mapAttrs' (name: value: nameValuePair (<span class="hljs-string">"foo_"</span> + name) (<span class="hljs-string">"bar-"</span> + value))
   { <span class="hljs-attr">x</span> = <span class="hljs-string">"a"</span>; <span class="hljs-attr">y</span> = <span class="hljs-string">"b"</span>; }
=&gt; { <span class="hljs-attr">foo_x</span> = <span class="hljs-string">"bar-a"</span>; <span class="hljs-attr">foo_y</span> = <span class="hljs-string">"bar-b"</span>; }
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/attrsets.nix#L590" target="_top">lib/attrsets.nix:590</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.attrsets.mapAttrsToList" class="title"><code class="literal">lib.attrsets.mapAttrsToList</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.mapAttrsToList" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">mapAttrsToList :: (String -&gt; a -&gt; b) -&gt; AttrSet -&gt; [b]</code></p><p>Call a function for each attribute in the given set and return
the result in a list.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">f</code></span></dt><dd><p>A function, given an attribute’s name and value, returns a new value.</p></dd><dt><span class="term"><code class="literal">attrs</code></span></dt><dd><p>Attribute set to map over.</p></dd></dl></div><div class="example"><span id="function-library-example-lib.attrsets.mapAttrsToList"></span><p class="title"><strong>Example&nbsp;24.&nbsp;<code class="literal">lib.attrsets.mapAttrsToList</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">mapAttrsToList (name: value: name + value)
   { <span class="hljs-attr">x</span> = <span class="hljs-string">"a"</span>; <span class="hljs-attr">y</span> = <span class="hljs-string">"b"</span>; }
=&gt; [ <span class="hljs-string">"xa"</span> <span class="hljs-string">"yb"</span> ]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/attrsets.nix#L610" target="_top">lib/attrsets.nix:610</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.attrsets.attrsToList" class="title"><code class="literal">lib.attrsets.attrsToList</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.attrsToList" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">attrsToList :: AttrSet -&gt; [ { name :: String; value :: Any; } ]</code></p><p>Deconstruct an attrset to a list of name-value pairs as expected by <a class="link" href="https://nixos.org/manual/nix/stable/language/builtins#builtins-listToAttrs" target="_top"><code class="literal">builtins.listToAttrs</code></a>.
Each element of the resulting list is an attribute set with these attributes:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">name</code> (string): The name of the attribute</p></li><li class="listitem"><p><code class="literal">value</code> (any): The value of the attribute</p></li></ul></div><p>The following is always true:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-built_in">builtins</span>.listToAttrs (attrsToList attrs) == attrs
</code></pre><div class="warning"><h3 class="title">Warning</h3><p>The opposite is not always true. In general expect that</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">attrsToList (<span class="hljs-built_in">builtins</span>.listToAttrs list) != list
</code></pre><p>This is because the <code class="literal">listToAttrs</code> removes duplicate names and doesn’t preserve the order of the list.</p></div><div class="example"><span id="function-library-example-lib.attrsets.attrsToList"></span><p class="title"><strong>Example&nbsp;25.&nbsp;<code class="literal">lib.attrsets.attrsToList</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">attrsToList { <span class="hljs-attr">foo</span> = <span class="hljs-number">1</span>; <span class="hljs-attr">bar</span> = <span class="hljs-string">"asdf"</span>; }
=&gt; [ { <span class="hljs-attr">name</span> = <span class="hljs-string">"bar"</span>; <span class="hljs-attr">value</span> = <span class="hljs-string">"asdf"</span>; } { <span class="hljs-attr">name</span> = <span class="hljs-string">"foo"</span>; <span class="hljs-attr">value</span> = <span class="hljs-number">1</span>; } ]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/attrsets.nix#L645" target="_top">lib/attrsets.nix:645</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.attrsets.mapAttrsRecursive" class="title"><code class="literal">lib.attrsets.mapAttrsRecursive</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.mapAttrsRecursive" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">mapAttrsRecursive :: ([String] -&gt; a -&gt; b) -&gt; AttrSet -&gt; AttrSet</code></p><p>Like <code class="literal">mapAttrs</code>, except that it recursively applies itself to
the <span class="emphasis"><em>leaf</em></span> attributes of a potentially-nested attribute set:
the second argument of the function will never be an attrset.
Also, the first argument of the argument function is a <span class="emphasis"><em>list</em></span>
of the attribute names that form the path to the leaf attribute.</p><p>For a function that gives you control over what counts as a leaf,
see <code class="literal">mapAttrsRecursiveCond</code>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">f</code></span></dt><dd><p>A function, given a list of attribute names and a value, returns a new value.</p></dd><dt><span class="term"><code class="literal">set</code></span></dt><dd><p>Set to recursively map over.</p></dd></dl></div><div class="example"><span id="function-library-example-lib.attrsets.mapAttrsRecursive"></span><p class="title"><strong>Example&nbsp;26.&nbsp;<code class="literal">lib.attrsets.mapAttrsRecursive</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">mapAttrsRecursive (path: value: concatStringsSep <span class="hljs-string">"-"</span> (path ++ [value]))
  { <span class="hljs-attr">n</span> = { <span class="hljs-attr">a</span> = <span class="hljs-string">"A"</span>; <span class="hljs-attr">m</span> = { <span class="hljs-attr">b</span> = <span class="hljs-string">"B"</span>; <span class="hljs-attr">c</span> = <span class="hljs-string">"C"</span>; }; }; <span class="hljs-attr">d</span> = <span class="hljs-string">"D"</span>; }
=&gt; { <span class="hljs-attr">n</span> = { <span class="hljs-attr">a</span> = <span class="hljs-string">"n-a-A"</span>; <span class="hljs-attr">m</span> = { <span class="hljs-attr">b</span> = <span class="hljs-string">"n-m-b-B"</span>; <span class="hljs-attr">c</span> = <span class="hljs-string">"n-m-c-C"</span>; }; }; <span class="hljs-attr">d</span> = <span class="hljs-string">"d-D"</span>; }
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/attrsets.nix#L665" target="_top">lib/attrsets.nix:665</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.attrsets.mapAttrsRecursiveCond" class="title"><code class="literal">lib.attrsets.mapAttrsRecursiveCond</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.mapAttrsRecursiveCond" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">mapAttrsRecursiveCond :: (AttrSet -&gt; Bool) -&gt; ([String] -&gt; a -&gt; b) -&gt; AttrSet -&gt; AttrSet</code></p><p>Like <code class="literal">mapAttrsRecursive</code>, but it takes an additional predicate
function that tells it whether to recurse into an attribute
set.  If it returns false, <code class="literal">mapAttrsRecursiveCond</code> does not
recurse, but does apply the map function.  If it returns true, it
does recurse, and does not apply the map function.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">cond</code></span></dt><dd><p>A function, given the attribute set the recursion is currently at, determine if to recurse deeper into that attribute set.</p></dd><dt><span class="term"><code class="literal">f</code></span></dt><dd><p>A function, given a list of attribute names and a value, returns a new value.</p></dd><dt><span class="term"><code class="literal">set</code></span></dt><dd><p>Attribute set to recursively map over.</p></dd></dl></div><div class="example"><span id="function-library-example-lib.attrsets.mapAttrsRecursiveCond"></span><p class="title"><strong>Example&nbsp;27.&nbsp;<code class="literal">lib.attrsets.mapAttrsRecursiveCond</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-comment"># To prevent recursing into derivations (which are attribute</span>
<span class="hljs-comment"># sets with the attribute "type" equal to "derivation"):</span>
mapAttrsRecursiveCond
  (as: !(as ? <span class="hljs-string">"type"</span> &amp;&amp; as.<span class="hljs-attr">type</span> == <span class="hljs-string">"derivation"</span>))
  (x: ... do something ...)
  attrs
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/attrsets.nix#L690" target="_top">lib/attrsets.nix:690</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.attrsets.genAttrs" class="title"><code class="literal">lib.attrsets.genAttrs</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.genAttrs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">genAttrs :: [ String ] -&gt; (String -&gt; Any) -&gt; AttrSet</code></p><p>Generate an attribute set by mapping a function over a list of
attribute names.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">names</code></span></dt><dd><p>Names of values in the resulting attribute set.</p></dd><dt><span class="term"><code class="literal">f</code></span></dt><dd><p>A function, given the name of the attribute, returns the attribute’s value.</p></dd></dl></div><div class="example"><span id="function-library-example-lib.attrsets.genAttrs"></span><p class="title"><strong>Example&nbsp;28.&nbsp;<code class="literal">lib.attrsets.genAttrs</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">genAttrs [ <span class="hljs-string">"foo"</span> <span class="hljs-string">"bar"</span> ] (name: <span class="hljs-string">"x_"</span> + name)
=&gt; { <span class="hljs-attr">foo</span> = <span class="hljs-string">"x_foo"</span>; <span class="hljs-attr">bar</span> = <span class="hljs-string">"x_bar"</span>; }
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/attrsets.nix#L719" target="_top">lib/attrsets.nix:719</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.attrsets.isDerivation" class="title"><code class="literal">lib.attrsets.isDerivation</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.isDerivation" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">isDerivation :: Any -&gt; Bool</code></p><p>Check whether the argument is a derivation. Any set with
<code class="literal">{ type = "derivation"; }</code> counts as a derivation.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">value</code></span></dt><dd><p>Value to check.</p></dd></dl></div><div class="example"><span id="function-library-example-lib.attrsets.isDerivation"></span><p class="title"><strong>Example&nbsp;29.&nbsp;<code class="literal">lib.attrsets.isDerivation</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">nixpkgs</span> = <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {}
isDerivation nixpkgs.<span class="hljs-attr">ruby</span>
=&gt; <span class="hljs-literal">true</span>
isDerivation <span class="hljs-string">"foobar"</span>
=&gt; <span class="hljs-literal">false</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/attrsets.nix#L740" target="_top">lib/attrsets.nix:740</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.attrsets.toDerivation" class="title"><code class="literal">lib.attrsets.toDerivation</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.toDerivation" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">toDerivation :: Path -&gt; Derivation</code></p><p>Converts a store path to a fake derivation.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">path</code></span></dt><dd><p>A store path to convert to a derivation.</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/attrsets.nix#L749" target="_top">lib/attrsets.nix:749</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.attrsets.optionalAttrs" class="title"><code class="literal">lib.attrsets.optionalAttrs</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.optionalAttrs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">optionalAttrs :: Bool -&gt; AttrSet -&gt; AttrSet</code></p><p>If <code class="literal">cond</code> is true, return the attribute set <code class="literal">as</code>,
otherwise an empty attribute set.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">cond</code></span></dt><dd><p>Condition under which the <code class="literal">as</code> attribute set is returned.</p></dd><dt><span class="term"><code class="literal">as</code></span></dt><dd><p>The attribute set to return if <code class="literal">cond</code> is <code class="literal">true</code>.</p></dd></dl></div><div class="example"><span id="function-library-example-lib.attrsets.optionalAttrs"></span><p class="title"><strong>Example&nbsp;30.&nbsp;<code class="literal">lib.attrsets.optionalAttrs</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">optionalAttrs (<span class="hljs-literal">true</span>) { <span class="hljs-attr">my</span> = <span class="hljs-string">"set"</span>; }
=&gt; { <span class="hljs-attr">my</span> = <span class="hljs-string">"set"</span>; }
optionalAttrs (<span class="hljs-literal">false</span>) { <span class="hljs-attr">my</span> = <span class="hljs-string">"set"</span>; }
=&gt; { }
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/attrsets.nix#L777" target="_top">lib/attrsets.nix:777</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.attrsets.zipAttrsWithNames" class="title"><code class="literal">lib.attrsets.zipAttrsWithNames</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.zipAttrsWithNames" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">zipAttrsWithNames :: [ String ] -&gt; (String -&gt; [ Any ] -&gt; Any) -&gt; [ AttrSet ] -&gt; AttrSet</code></p><p>Merge sets of attributes and use the function <code class="literal">f</code> to merge attributes
values.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">names</code></span></dt><dd><p>List of attribute names to zip.</p></dd><dt><span class="term"><code class="literal">f</code></span></dt><dd><p>A function, accepts an attribute name, all the values, and returns a combined value.</p></dd><dt><span class="term"><code class="literal">sets</code></span></dt><dd><p>List of values from the list of attribute sets.</p></dd></dl></div><div class="example"><span id="function-library-example-lib.attrsets.zipAttrsWithNames"></span><p class="title"><strong>Example&nbsp;31.&nbsp;<code class="literal">lib.attrsets.zipAttrsWithNames</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">zipAttrsWithNames [<span class="hljs-string">"a"</span>] (name: vs: vs) [{<span class="hljs-attr">a</span> = <span class="hljs-string">"x"</span>;} {<span class="hljs-attr">a</span> = <span class="hljs-string">"y"</span>; <span class="hljs-attr">b</span> = <span class="hljs-string">"z"</span>;}]
=&gt; { <span class="hljs-attr">a</span> = [<span class="hljs-string">"x"</span> <span class="hljs-string">"y"</span>]; }
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/attrsets.nix#L795" target="_top">lib/attrsets.nix:795</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.attrsets.zipAttrsWith" class="title"><code class="literal">lib.attrsets.zipAttrsWith</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.zipAttrsWith" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">zipAttrsWith :: (String -&gt; [ Any ] -&gt; Any) -&gt; [ AttrSet ] -&gt; AttrSet</code></p><p>Merge sets of attributes and use the function f to merge attribute values.
Like <code class="literal">lib.attrsets.zipAttrsWithNames</code> with all key names are passed for <code class="literal">names</code>.</p><p>Implementation note: Common names appear multiple times in the list of
names, hopefully this does not affect the system because the maximal
laziness avoid computing twice the same expression and <code class="literal">listToAttrs</code> does
not care about duplicated attribute names.</p><div class="example"><span id="function-library-example-lib.attrsets.zipAttrsWith"></span><p class="title"><strong>Example&nbsp;32.&nbsp;<code class="literal">lib.attrsets.zipAttrsWith</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">zipAttrsWith (name: values: values) [{<span class="hljs-attr">a</span> = <span class="hljs-string">"x"</span>;} {<span class="hljs-attr">a</span> = <span class="hljs-string">"y"</span>; <span class="hljs-attr">b</span> = <span class="hljs-string">"z"</span>;}]
=&gt; { <span class="hljs-attr">a</span> = [<span class="hljs-string">"x"</span> <span class="hljs-string">"y"</span>]; <span class="hljs-attr">b</span> = [<span class="hljs-string">"z"</span>]; }
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/attrsets.nix#L823" target="_top">lib/attrsets.nix:823</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.attrsets.zipAttrs" class="title"><code class="literal">lib.attrsets.zipAttrs</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.zipAttrs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">zipAttrs :: [ AttrSet ] -&gt; AttrSet</code></p><p>Merge sets of attributes and combine each attribute value in to a list.</p><p>Like <code class="literal">lib.attrsets.zipAttrsWith</code> with <code class="literal">(name: values: values)</code> as the function.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">sets</code></span></dt><dd><p>List of attribute sets to zip together.</p></dd></dl></div><div class="example"><span id="function-library-example-lib.attrsets.zipAttrs"></span><p class="title"><strong>Example&nbsp;33.&nbsp;<code class="literal">lib.attrsets.zipAttrs</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">zipAttrs [{<span class="hljs-attr">a</span> = <span class="hljs-string">"x"</span>;} {<span class="hljs-attr">a</span> = <span class="hljs-string">"y"</span>; <span class="hljs-attr">b</span> = <span class="hljs-string">"z"</span>;}]
=&gt; { <span class="hljs-attr">a</span> = [<span class="hljs-string">"x"</span> <span class="hljs-string">"y"</span>]; <span class="hljs-attr">b</span> = [<span class="hljs-string">"z"</span>]; }
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/attrsets.nix#L838" target="_top">lib/attrsets.nix:838</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.attrsets.mergeAttrsList" class="title"><code class="literal">lib.attrsets.mergeAttrsList</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.mergeAttrsList" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">mergeAttrsList :: [ Attrs ] -&gt; Attrs</code></p><p>Merge a list of attribute sets together using the <code class="literal">//</code> operator.
In case of duplicate attributes, values from later list elements take precedence over earlier ones.
The result is the same as <code class="literal">foldl mergeAttrs { }</code>, but the performance is better for large inputs.
For n list elements, each with an attribute set containing m unique attributes, the complexity of this operation is O(nm log n).</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">list</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.attrsets.mergeAttrsList"></span><p class="title"><strong>Example&nbsp;34.&nbsp;<code class="literal">lib.attrsets.mergeAttrsList</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">mergeAttrsList [ { <span class="hljs-attr">a</span> = <span class="hljs-number">0</span>; <span class="hljs-attr">b</span> = <span class="hljs-number">1</span>; } { <span class="hljs-attr">c</span> = <span class="hljs-number">2</span>; <span class="hljs-attr">d</span> = <span class="hljs-number">3</span>; } ]
=&gt; { <span class="hljs-attr">a</span> = <span class="hljs-number">0</span>; <span class="hljs-attr">b</span> = <span class="hljs-number">1</span>; <span class="hljs-attr">c</span> = <span class="hljs-number">2</span>; <span class="hljs-attr">d</span> = <span class="hljs-number">3</span>; }
mergeAttrsList [ { <span class="hljs-attr">a</span> = <span class="hljs-number">0</span>; } { <span class="hljs-attr">a</span> = <span class="hljs-number">1</span>; } ]
=&gt; { <span class="hljs-attr">a</span> = <span class="hljs-number">1</span>; }
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/attrsets.nix#L858" target="_top">lib/attrsets.nix:858</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.attrsets.recursiveUpdateUntil" class="title"><code class="literal">lib.attrsets.recursiveUpdateUntil</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.recursiveUpdateUntil" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">recursiveUpdateUntil :: ( [ String ] -&gt; AttrSet -&gt; AttrSet -&gt; Bool ) -&gt; AttrSet -&gt; AttrSet -&gt; AttrSet</code></p><p>Does the same as the update operator ‘//’ except that attributes are
merged until the given predicate is verified.  The predicate should
accept 3 arguments which are the path to reach the attribute, a part of
the first attribute set and a part of the second attribute set.  When
the predicate is satisfied, the value of the first attribute set is
replaced by the value of the second attribute set.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">pred</code></span></dt><dd><p>Predicate, taking the path to the current attribute as a list of strings for attribute names, and the two values at that path from the original arguments.</p></dd><dt><span class="term"><code class="literal">lhs</code></span></dt><dd><p>Left attribute set of the merge.</p></dd><dt><span class="term"><code class="literal">rhs</code></span></dt><dd><p>Right attribute set of the merge.</p></dd></dl></div><div class="example"><span id="function-library-example-lib.attrsets.recursiveUpdateUntil"></span><p class="title"><strong>Example&nbsp;35.&nbsp;<code class="literal">lib.attrsets.recursiveUpdateUntil</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">recursiveUpdateUntil (path: l: r: <span class="hljs-attr">path</span> == [<span class="hljs-string">"foo"</span>]) {
  <span class="hljs-comment"># first attribute set</span>
  foo.<span class="hljs-attr">bar</span> = <span class="hljs-number">1</span>;
  foo.<span class="hljs-attr">baz</span> = <span class="hljs-number">2</span>;
  <span class="hljs-attr">bar</span> = <span class="hljs-number">3</span>;
} {
  <span class="hljs-comment">#second attribute set</span>
  foo.<span class="hljs-attr">bar</span> = <span class="hljs-number">1</span>;
  foo.<span class="hljs-attr">quz</span> = <span class="hljs-number">2</span>;
  <span class="hljs-attr">baz</span> = <span class="hljs-number">4</span>;
}

=&gt; {
  foo.<span class="hljs-attr">bar</span> = <span class="hljs-number">1</span>; <span class="hljs-comment"># 'foo.*' from the second set</span>
  foo.<span class="hljs-attr">quz</span> = <span class="hljs-number">2</span>; <span class="hljs-comment">#</span>
  <span class="hljs-attr">bar</span> = <span class="hljs-number">3</span>;     <span class="hljs-comment"># 'bar' from the first set</span>
  <span class="hljs-attr">baz</span> = <span class="hljs-number">4</span>;     <span class="hljs-comment"># 'baz' from the second set</span>
}
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/attrsets.nix#L910" target="_top">lib/attrsets.nix:910</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.attrsets.recursiveUpdate" class="title"><code class="literal">lib.attrsets.recursiveUpdate</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.recursiveUpdate" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">recursiveUpdate :: AttrSet -&gt; AttrSet -&gt; AttrSet</code></p><p>A recursive variant of the update operator ‘//’.  The recursion
stops when one of the attribute values is not an attribute set,
in which case the right hand side value takes precedence over the
left hand side value.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">lhs</code></span></dt><dd><p>Left attribute set of the merge.</p></dd><dt><span class="term"><code class="literal">rhs</code></span></dt><dd><p>Right attribute set of the merge.</p></dd></dl></div><div class="example"><span id="function-library-example-lib.attrsets.recursiveUpdate"></span><p class="title"><strong>Example&nbsp;36.&nbsp;<code class="literal">lib.attrsets.recursiveUpdate</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">recursiveUpdate {
  boot.loader.grub.<span class="hljs-attr">enable</span> = <span class="hljs-literal">true</span>;
  boot.loader.grub.<span class="hljs-attr">device</span> = <span class="hljs-string">"/dev/hda"</span>;
} {
  boot.loader.grub.<span class="hljs-attr">device</span> = <span class="hljs-string">""</span>;
}

returns: {
  boot.loader.grub.<span class="hljs-attr">enable</span> = <span class="hljs-literal">true</span>;
  boot.loader.grub.<span class="hljs-attr">device</span> = <span class="hljs-string">""</span>;
}
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/attrsets.nix#L950" target="_top">lib/attrsets.nix:950</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.attrsets.matchAttrs" class="title"><code class="literal">lib.attrsets.matchAttrs</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.matchAttrs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">matchAttrs :: AttrSet -&gt; AttrSet -&gt; Bool</code></p><p>Recurse into every attribute set of the first argument and check that:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>Each attribute path also exists in the second argument.</p></li><li class="listitem"><p>If the attribute’s value is not a nested attribute set, it must have the same value in the right argument.</p></li></ul></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">pattern</code></span></dt><dd><p>Attribute set structure to match</p></dd><dt><span class="term"><code class="literal">attrs</code></span></dt><dd><p>Attribute set to check</p></dd></dl></div><div class="example"><span id="function-library-example-lib.attrsets.matchAttrs"></span><p class="title"><strong>Example&nbsp;37.&nbsp;<code class="literal">lib.attrsets.matchAttrs</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">matchAttrs { <span class="hljs-attr">cpu</span> = {}; } { <span class="hljs-attr">cpu</span> = { <span class="hljs-attr">bits</span> = <span class="hljs-number">64</span>; }; }
=&gt; <span class="hljs-literal">true</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/attrsets.nix#L970" target="_top">lib/attrsets.nix:970</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.attrsets.overrideExisting" class="title"><code class="literal">lib.attrsets.overrideExisting</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.overrideExisting" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">overrideExisting :: AttrSet -&gt; AttrSet -&gt; AttrSet</code></p><p>Override only the attributes that are already present in the old set
useful for deep-overriding.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">old</code></span></dt><dd><p>Original attribute set</p></dd><dt><span class="term"><code class="literal">new</code></span></dt><dd><p>Attribute set with attributes to override in <code class="literal">old</code>.</p></dd></dl></div><div class="example"><span id="function-library-example-lib.attrsets.overrideExisting"></span><p class="title"><strong>Example&nbsp;38.&nbsp;<code class="literal">lib.attrsets.overrideExisting</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">overrideExisting {} { <span class="hljs-attr">a</span> = <span class="hljs-number">1</span>; }
=&gt; {}
overrideExisting { <span class="hljs-attr">b</span> = <span class="hljs-number">2</span>; } { <span class="hljs-attr">a</span> = <span class="hljs-number">1</span>; }
=&gt; { <span class="hljs-attr">b</span> = <span class="hljs-number">2</span>; }
overrideExisting { <span class="hljs-attr">a</span> = <span class="hljs-number">3</span>; <span class="hljs-attr">b</span> = <span class="hljs-number">2</span>; } { <span class="hljs-attr">a</span> = <span class="hljs-number">1</span>; }
=&gt; { <span class="hljs-attr">a</span> = <span class="hljs-number">1</span>; <span class="hljs-attr">b</span> = <span class="hljs-number">2</span>; }
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/attrsets.nix#L1006" target="_top">lib/attrsets.nix:1006</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.attrsets.showAttrPath" class="title"><code class="literal">lib.attrsets.showAttrPath</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.showAttrPath" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">showAttrPath :: [String] -&gt; String</code></p><p>Turns a list of strings into a human-readable description of those
strings represented as an attribute path. The result of this function is
not intended to be machine-readable.
Create a new attribute set with <code class="literal">value</code> set at the nested attribute location specified in <code class="literal">attrPath</code>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">path</code></span></dt><dd><p>Attribute path to render to a string</p></dd></dl></div><div class="example"><span id="function-library-example-lib.attrsets.showAttrPath"></span><p class="title"><strong>Example&nbsp;39.&nbsp;<code class="literal">lib.attrsets.showAttrPath</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">showAttrPath [ <span class="hljs-string">"foo"</span> <span class="hljs-string">"10"</span> <span class="hljs-string">"bar"</span> ]
=&gt; <span class="hljs-string">"foo.\"</span><span class="hljs-number">10</span>\<span class="hljs-string">".bar"</span>
showAttrPath []
=&gt; <span class="hljs-string">"&lt;root attribute path&gt;"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/attrsets.nix#L1028" target="_top">lib/attrsets.nix:1028</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.attrsets.getOutput" class="title"><code class="literal">lib.attrsets.getOutput</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.getOutput" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">getOutput :: String -&gt; Derivation -&gt; String</code></p><p>Get a package output.
If no output is found, fallback to <code class="literal">.out</code> and then to the default.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">output</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">pkg</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.attrsets.getOutput"></span><p class="title"><strong>Example&nbsp;40.&nbsp;<code class="literal">lib.attrsets.getOutput</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">getOutput <span class="hljs-string">"dev"</span> pkgs.<span class="hljs-attr">openssl</span>
=&gt; <span class="hljs-string">"/nix/store/9rz8gxhzf8sw4kf2j2f1grr49w8zx5vj-openssl-1.0.1r-dev"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/attrsets.nix#L1045" target="_top">lib/attrsets.nix:1045</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.attrsets.getBin" class="title"><code class="literal">lib.attrsets.getBin</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.getBin" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">getBin :: Derivation -&gt; String</code></p><p>Get a package’s <code class="literal">bin</code> output.
If the output does not exist, fallback to <code class="literal">.out</code> and then to the default.</p><div class="example"><span id="function-library-example-lib.attrsets.getBin"></span><p class="title"><strong>Example&nbsp;41.&nbsp;<code class="literal">lib.attrsets.getBin</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">getBin pkgs.<span class="hljs-attr">openssl</span>
=&gt; <span class="hljs-string">"/nix/store/9rz8gxhzf8sw4kf2j2f1grr49w8zx5vj-openssl-1.0.1r"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/attrsets.nix#L1060" target="_top">lib/attrsets.nix:1060</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.attrsets.getLib" class="title"><code class="literal">lib.attrsets.getLib</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.getLib" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">getLib :: Derivation -&gt; String</code></p><p>Get a package’s <code class="literal">lib</code> output.
If the output does not exist, fallback to <code class="literal">.out</code> and then to the default.</p><div class="example"><span id="function-library-example-lib.attrsets.getLib"></span><p class="title"><strong>Example&nbsp;42.&nbsp;<code class="literal">lib.attrsets.getLib</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">getLib pkgs.<span class="hljs-attr">openssl</span>
=&gt; <span class="hljs-string">"/nix/store/9rz8gxhzf8sw4kf2j2f1grr49w8zx5vj-openssl-1.0.1r-lib"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/attrsets.nix#L1073" target="_top">lib/attrsets.nix:1073</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.attrsets.getDev" class="title"><code class="literal">lib.attrsets.getDev</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.getDev" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">getDev :: Derivation -&gt; String</code></p><p>Get a package’s <code class="literal">dev</code> output.
If the output does not exist, fallback to <code class="literal">.out</code> and then to the default.</p><div class="example"><span id="function-library-example-lib.attrsets.getDev"></span><p class="title"><strong>Example&nbsp;43.&nbsp;<code class="literal">lib.attrsets.getDev</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">getDev pkgs.<span class="hljs-attr">openssl</span>
=&gt; <span class="hljs-string">"/nix/store/9rz8gxhzf8sw4kf2j2f1grr49w8zx5vj-openssl-1.0.1r-dev"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/attrsets.nix#L1086" target="_top">lib/attrsets.nix:1086</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.attrsets.getMan" class="title"><code class="literal">lib.attrsets.getMan</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.getMan" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">getMan :: Derivation -&gt; String</code></p><p>Get a package’s <code class="literal">man</code> output.
If the output does not exist, fallback to <code class="literal">.out</code> and then to the default.</p><div class="example"><span id="function-library-example-lib.attrsets.getMan"></span><p class="title"><strong>Example&nbsp;44.&nbsp;<code class="literal">lib.attrsets.getMan</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">getMan pkgs.<span class="hljs-attr">openssl</span>
=&gt; <span class="hljs-string">"/nix/store/9rz8gxhzf8sw4kf2j2f1grr49w8zx5vj-openssl-1.0.1r-man"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/attrsets.nix#L1099" target="_top">lib/attrsets.nix:1099</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.attrsets.chooseDevOutputs" class="title"><code class="literal">lib.attrsets.chooseDevOutputs</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.chooseDevOutputs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">chooseDevOutputs :: [Derivation] -&gt; [String]</code></p><p>Pick the outputs of packages to place in <code class="literal">buildInputs</code></p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">drvs</code></span></dt><dd><p>List of packages to pick <code class="literal">dev</code> outputs from</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/attrsets.nix#L1106" target="_top">lib/attrsets.nix:1106</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.attrsets.recurseIntoAttrs" class="title"><code class="literal">lib.attrsets.recurseIntoAttrs</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.recurseIntoAttrs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">recurseIntoAttrs :: AttrSet -&gt; AttrSet</code></p><p>Make various Nix tools consider the contents of the resulting
attribute set when looking for what to build, find, etc.</p><p>This function only affects a single attribute set; it does not
apply itself recursively for nested attribute sets.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">attrs</code></span></dt><dd><p>An attribute set to scan for derivations.</p></dd></dl></div><div class="example"><span id="function-library-example-lib.attrsets.recurseIntoAttrs"></span><p class="title"><strong>Example&nbsp;45.&nbsp;<code class="literal">lib.attrsets.recurseIntoAttrs</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ pkgs ? <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {} }:
{
  <span class="hljs-attr">myTools</span> = pkgs.lib.recurseIntoAttrs {
    <span class="hljs-keyword">inherit</span> (pkgs) hello figlet;
  };
}
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/attrsets.nix#L1129" target="_top">lib/attrsets.nix:1129</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.attrsets.dontRecurseIntoAttrs" class="title"><code class="literal">lib.attrsets.dontRecurseIntoAttrs</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.dontRecurseIntoAttrs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">dontRecurseIntoAttrs :: AttrSet -&gt; AttrSet</code></p><p>Undo the effect of recurseIntoAttrs.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">attrs</code></span></dt><dd><p>An attribute set to not scan for derivations.</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/attrsets.nix#L1139" target="_top">lib/attrsets.nix:1139</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.attrsets.unionOfDisjoint" class="title"><code class="literal">lib.attrsets.unionOfDisjoint</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.unionOfDisjoint" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">unionOfDisjoint :: AttrSet -&gt; AttrSet -&gt; AttrSet</code></p><p><code class="literal">unionOfDisjoint x y</code> is equal to <code class="literal">x // y // z</code> where the
attrnames in <code class="literal">z</code> are the intersection of the attrnames in <code class="literal">x</code> and
<code class="literal">y</code>, and all values <code class="literal">assert</code> with an error message.  This
operator is commutative, unlike (//).</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">x</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">y</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/attrsets.nix#L1151" target="_top">lib/attrsets.nix:1151</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-functions-library-strings" class="title">lib.strings: string manipulation functions   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-functions-library-strings" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>String manipulation functions.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.concatStrings" class="title"><code class="literal">lib.strings.concatStrings</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.concatStrings" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">concatStrings :: [string] -&gt; string</code></p><p>Concatenate a list of strings.</p><div class="example"><span id="function-library-example-lib.strings.concatStrings"></span><p class="title"><strong>Example&nbsp;46.&nbsp;<code class="literal">lib.strings.concatStrings</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">concatStrings [<span class="hljs-string">"foo"</span> <span class="hljs-string">"bar"</span>]
=&gt; <span class="hljs-string">"foobar"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L50" target="_top">lib/strings.nix:50</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.concatMapStrings" class="title"><code class="literal">lib.strings.concatMapStrings</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.concatMapStrings" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">concatMapStrings :: (a -&gt; string) -&gt; [a] -&gt; string</code></p><p>Map a function over a list and concatenate the resulting strings.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">f</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">list</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.concatMapStrings"></span><p class="title"><strong>Example&nbsp;47.&nbsp;<code class="literal">lib.strings.concatMapStrings</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">concatMapStrings (x: <span class="hljs-string">"a"</span> + x) [<span class="hljs-string">"foo"</span> <span class="hljs-string">"bar"</span>]
=&gt; <span class="hljs-string">"afooabar"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L60" target="_top">lib/strings.nix:60</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.concatImapStrings" class="title"><code class="literal">lib.strings.concatImapStrings</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.concatImapStrings" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">concatImapStrings :: (int -&gt; a -&gt; string) -&gt; [a] -&gt; string</code></p><p>Like <code class="literal">concatMapStrings</code> except that the f functions also gets the
position as a parameter.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">f</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">list</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.concatImapStrings"></span><p class="title"><strong>Example&nbsp;48.&nbsp;<code class="literal">lib.strings.concatImapStrings</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">concatImapStrings (pos: x: <span class="hljs-string">"<span class="hljs-subst">${<span class="hljs-built_in">toString</span> pos}</span>-<span class="hljs-subst">${x}</span>"</span>) [<span class="hljs-string">"foo"</span> <span class="hljs-string">"bar"</span>]
=&gt; <span class="hljs-string">"1-foo2-bar"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L71" target="_top">lib/strings.nix:71</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.intersperse" class="title"><code class="literal">lib.strings.intersperse</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.intersperse" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">intersperse :: a -&gt; [a] -&gt; [a]</code></p><p>Place an element between each element of a list</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">separator</code></span></dt><dd><p>Separator to add between elements</p></dd><dt><span class="term"><code class="literal">list</code></span></dt><dd><p>Input list</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.intersperse"></span><p class="title"><strong>Example&nbsp;49.&nbsp;<code class="literal">lib.strings.intersperse</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">intersperse <span class="hljs-string">"/"</span> [<span class="hljs-string">"usr"</span> <span class="hljs-string">"local"</span> <span class="hljs-string">"bin"</span>]
=&gt; [<span class="hljs-string">"usr"</span> <span class="hljs-string">"/"</span> <span class="hljs-string">"local"</span> <span class="hljs-string">"/"</span> <span class="hljs-string">"bin"</span>].
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L81" target="_top">lib/strings.nix:81</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.concatStringsSep" class="title"><code class="literal">lib.strings.concatStringsSep</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.concatStringsSep" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">concatStringsSep :: string -&gt; [string] -&gt; string</code></p><p>Concatenate a list of strings with a separator between each element</p><div class="example"><span id="function-library-example-lib.strings.concatStringsSep"></span><p class="title"><strong>Example&nbsp;50.&nbsp;<code class="literal">lib.strings.concatStringsSep</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">concatStringsSep <span class="hljs-string">"/"</span> [<span class="hljs-string">"usr"</span> <span class="hljs-string">"local"</span> <span class="hljs-string">"bin"</span>]
=&gt; <span class="hljs-string">"usr/local/bin"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L98" target="_top">lib/strings.nix:98</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.concatMapStringsSep" class="title"><code class="literal">lib.strings.concatMapStringsSep</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.concatMapStringsSep" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">concatMapStringsSep :: string -&gt; (a -&gt; string) -&gt; [a] -&gt; string</code></p><p>Maps a function over a list of strings and then concatenates the
result with the specified separator interspersed between
elements.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">sep</code></span></dt><dd><p>Separator to add between elements</p></dd><dt><span class="term"><code class="literal">f</code></span></dt><dd><p>Function to map over the list</p></dd><dt><span class="term"><code class="literal">list</code></span></dt><dd><p>List of input strings</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.concatMapStringsSep"></span><p class="title"><strong>Example&nbsp;51.&nbsp;<code class="literal">lib.strings.concatMapStringsSep</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">concatMapStringsSep <span class="hljs-string">"-"</span> (x: toUpper x)  [<span class="hljs-string">"foo"</span> <span class="hljs-string">"bar"</span> <span class="hljs-string">"baz"</span>]
=&gt; <span class="hljs-string">"FOO-BAR-BAZ"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L111" target="_top">lib/strings.nix:111</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.concatImapStringsSep" class="title"><code class="literal">lib.strings.concatImapStringsSep</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.concatImapStringsSep" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">concatIMapStringsSep :: string -&gt; (int -&gt; a -&gt; string) -&gt; [a] -&gt; string</code></p><p>Same as <code class="literal">concatMapStringsSep</code>, but the mapping function
additionally receives the position of its argument.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">sep</code></span></dt><dd><p>Separator to add between elements</p></dd><dt><span class="term"><code class="literal">f</code></span></dt><dd><p>Function that receives elements and their positions</p></dd><dt><span class="term"><code class="literal">list</code></span></dt><dd><p>List of input strings</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.concatImapStringsSep"></span><p class="title"><strong>Example&nbsp;52.&nbsp;<code class="literal">lib.strings.concatImapStringsSep</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">concatImapStringsSep <span class="hljs-string">"-"</span> (pos: x: <span class="hljs-built_in">toString</span> (x / pos)) [ <span class="hljs-number">6</span> <span class="hljs-number">6</span> <span class="hljs-number">6</span> ]
=&gt; <span class="hljs-string">"6-3-2"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L128" target="_top">lib/strings.nix:128</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.concatLines" class="title"><code class="literal">lib.strings.concatLines</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.concatLines" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">concatLines :: [string] -&gt; string</code></p><p>Concatenate a list of strings, adding a newline at the end of each one.
Defined as <code class="literal">concatMapStrings (s: s + "\n")</code>.</p><div class="example"><span id="function-library-example-lib.strings.concatLines"></span><p class="title"><strong>Example&nbsp;53.&nbsp;<code class="literal">lib.strings.concatLines</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">concatLines [ <span class="hljs-string">"foo"</span> <span class="hljs-string">"bar"</span> ]
=&gt; <span class="hljs-string">"foo\nbar\n"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L145" target="_top">lib/strings.nix:145</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.replicate" class="title"><code class="literal">lib.strings.replicate</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.replicate" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">replicate :: int -&gt; string -&gt; string</code></p><p>Replicate a string n times,
and concatenate the parts into a new string.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">n</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">s</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.replicate"></span><p class="title"><strong>Example&nbsp;54.&nbsp;<code class="literal">lib.strings.replicate</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">replicate <span class="hljs-number">3</span> <span class="hljs-string">"v"</span>
=&gt; <span class="hljs-string">"vvv"</span>
replicate <span class="hljs-number">5</span> <span class="hljs-string">"hello"</span>
=&gt; <span class="hljs-string">"hellohellohellohellohello"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L159" target="_top">lib/strings.nix:159</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.makeSearchPath" class="title"><code class="literal">lib.strings.makeSearchPath</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.makeSearchPath" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">makeSearchPath :: string -&gt; [string] -&gt; string</code></p><p>Construct a Unix-style, colon-separated search path consisting of
the given <code class="literal">subDir</code> appended to each of the given paths.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">subDir</code></span></dt><dd><p>Directory name to append</p></dd><dt><span class="term"><code class="literal">paths</code></span></dt><dd><p>List of base paths</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.makeSearchPath"></span><p class="title"><strong>Example&nbsp;55.&nbsp;<code class="literal">lib.strings.makeSearchPath</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">makeSearchPath <span class="hljs-string">"bin"</span> [<span class="hljs-string">"/root"</span> <span class="hljs-string">"/usr"</span> <span class="hljs-string">"/usr/local"</span>]
=&gt; <span class="hljs-string">"/root/bin:/usr/bin:/usr/local/bin"</span>
makeSearchPath <span class="hljs-string">"bin"</span> [<span class="hljs-string">""</span>]
=&gt; <span class="hljs-string">"/bin"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L172" target="_top">lib/strings.nix:172</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.makeSearchPathOutput" class="title"><code class="literal">lib.strings.makeSearchPathOutput</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.makeSearchPathOutput" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">string -&gt; string -&gt; [package] -&gt; string</code></p><p>Construct a Unix-style search path by appending the given
<code class="literal">subDir</code> to the specified <code class="literal">output</code> of each of the packages. If no
output by the given name is found, fallback to <code class="literal">.out</code> and then to
the default.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">output</code></span></dt><dd><p>Package output to use</p></dd><dt><span class="term"><code class="literal">subDir</code></span></dt><dd><p>Directory name to append</p></dd><dt><span class="term"><code class="literal">pkgs</code></span></dt><dd><p>List of packages</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.makeSearchPathOutput"></span><p class="title"><strong>Example&nbsp;56.&nbsp;<code class="literal">lib.strings.makeSearchPathOutput</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">makeSearchPathOutput <span class="hljs-string">"dev"</span> <span class="hljs-string">"bin"</span> [ pkgs.openssl pkgs.zlib ]
=&gt; <span class="hljs-string">"/nix/store/9rz8gxhzf8sw4kf2j2f1grr49w8zx5vj-openssl-1.0.1r-dev/bin:/nix/store/wwh7mhwh269sfjkm6k5665b5kgp7jrk2-zlib-1.2.8/bin"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L190" target="_top">lib/strings.nix:190</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.makeLibraryPath" class="title"><code class="literal">lib.strings.makeLibraryPath</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.makeLibraryPath" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Construct a library search path (such as RPATH) containing the
libraries for a set of packages</p><div class="example"><span id="function-library-example-lib.strings.makeLibraryPath"></span><p class="title"><strong>Example&nbsp;57.&nbsp;<code class="literal">lib.strings.makeLibraryPath</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">makeLibraryPath [ <span class="hljs-string">"/usr"</span> <span class="hljs-string">"/usr/local"</span> ]
=&gt; <span class="hljs-string">"/usr/lib:/usr/local/lib"</span>
<span class="hljs-attr">pkgs</span> = <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; { }
makeLibraryPath [ pkgs.openssl pkgs.zlib ]
=&gt; <span class="hljs-string">"/nix/store/9rz8gxhzf8sw4kf2j2f1grr49w8zx5vj-openssl-1.0.1r/lib:/nix/store/wwh7mhwh269sfjkm6k5665b5kgp7jrk2-zlib-1.2.8/lib"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L208" target="_top">lib/strings.nix:208</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.makeBinPath" class="title"><code class="literal">lib.strings.makeBinPath</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.makeBinPath" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Construct a binary search path (such as $PATH) containing the
binaries for a set of packages.</p><div class="example"><span id="function-library-example-lib.strings.makeBinPath"></span><p class="title"><strong>Example&nbsp;58.&nbsp;<code class="literal">lib.strings.makeBinPath</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">makeBinPath [<span class="hljs-string">"/root"</span> <span class="hljs-string">"/usr"</span> <span class="hljs-string">"/usr/local"</span>]
=&gt; <span class="hljs-string">"/root/bin:/usr/bin:/usr/local/bin"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L217" target="_top">lib/strings.nix:217</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.normalizePath" class="title"><code class="literal">lib.strings.normalizePath</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.normalizePath" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">normalizePath :: string -&gt; string</code></p><p>Normalize path, removing extraneous /s</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">s</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.normalizePath"></span><p class="title"><strong>Example&nbsp;59.&nbsp;<code class="literal">lib.strings.normalizePath</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">normalizePath <span class="hljs-string">"/a//b///c/"</span>
=&gt; <span class="hljs-string">"/a/b/c/"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L227" target="_top">lib/strings.nix:227</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.optionalString" class="title"><code class="literal">lib.strings.optionalString</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.optionalString" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">optionalString :: bool -&gt; string -&gt; string</code></p><p>Depending on the boolean `cond’, return either the given string
or the empty string. Useful to concatenate against a bigger string.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">cond</code></span></dt><dd><p>Condition</p></dd><dt><span class="term"><code class="literal">string</code></span></dt><dd><p>String to return if condition is true</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.optionalString"></span><p class="title"><strong>Example&nbsp;60.&nbsp;<code class="literal">lib.strings.optionalString</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">optionalString <span class="hljs-literal">true</span> <span class="hljs-string">"some-string"</span>
=&gt; <span class="hljs-string">"some-string"</span>
optionalString <span class="hljs-literal">false</span> <span class="hljs-string">"some-string"</span>
=&gt; <span class="hljs-string">""</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L253" target="_top">lib/strings.nix:253</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.hasPrefix" class="title"><code class="literal">lib.strings.hasPrefix</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.hasPrefix" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">hasPrefix :: string -&gt; string -&gt; bool</code></p><p>Determine whether a string has given prefix.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">pref</code></span></dt><dd><p>Prefix to check for</p></dd><dt><span class="term"><code class="literal">str</code></span></dt><dd><p>Input string</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.hasPrefix"></span><p class="title"><strong>Example&nbsp;61.&nbsp;<code class="literal">lib.strings.hasPrefix</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">hasPrefix <span class="hljs-string">"foo"</span> <span class="hljs-string">"foobar"</span>
=&gt; <span class="hljs-literal">true</span>
hasPrefix <span class="hljs-string">"foo"</span> <span class="hljs-string">"barfoo"</span>
=&gt; <span class="hljs-literal">false</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L269" target="_top">lib/strings.nix:269</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.hasSuffix" class="title"><code class="literal">lib.strings.hasSuffix</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.hasSuffix" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">hasSuffix :: string -&gt; string -&gt; bool</code></p><p>Determine whether a string has given suffix.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">suffix</code></span></dt><dd><p>Suffix to check for</p></dd><dt><span class="term"><code class="literal">content</code></span></dt><dd><p>Input string</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.hasSuffix"></span><p class="title"><strong>Example&nbsp;62.&nbsp;<code class="literal">lib.strings.hasSuffix</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">hasSuffix <span class="hljs-string">"foo"</span> <span class="hljs-string">"foobar"</span>
=&gt; <span class="hljs-literal">false</span>
hasSuffix <span class="hljs-string">"foo"</span> <span class="hljs-string">"barfoo"</span>
=&gt; <span class="hljs-literal">true</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L296" target="_top">lib/strings.nix:296</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.hasInfix" class="title"><code class="literal">lib.strings.hasInfix</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.hasInfix" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">hasInfix :: string -&gt; string -&gt; bool</code></p><p>Determine whether a string contains the given infix</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">infix</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">content</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.hasInfix"></span><p class="title"><strong>Example&nbsp;63.&nbsp;<code class="literal">lib.strings.hasInfix</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">hasInfix <span class="hljs-string">"bc"</span> <span class="hljs-string">"abcd"</span>
=&gt; <span class="hljs-literal">true</span>
hasInfix <span class="hljs-string">"ab"</span> <span class="hljs-string">"abcd"</span>
=&gt; <span class="hljs-literal">true</span>
hasInfix <span class="hljs-string">"cd"</span> <span class="hljs-string">"abcd"</span>
=&gt; <span class="hljs-literal">true</span>
hasInfix <span class="hljs-string">"foo"</span> <span class="hljs-string">"abcd"</span>
=&gt; <span class="hljs-literal">false</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L333" target="_top">lib/strings.nix:333</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.stringToCharacters" class="title"><code class="literal">lib.strings.stringToCharacters</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.stringToCharacters" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">stringToCharacters :: string -&gt; [string]</code></p><p>Convert a string to a list of characters (i.e. singleton strings).
This allows you to, e.g., map a function over each character.  However,
note that this will likely be horribly inefficient; Nix is not a
general purpose programming language. Complex string manipulations
should, if appropriate, be done in a derivation.
Also note that Nix treats strings as a list of bytes and thus doesn’t
handle unicode.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">s</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.stringToCharacters"></span><p class="title"><strong>Example&nbsp;64.&nbsp;<code class="literal">lib.strings.stringToCharacters</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">stringToCharacters <span class="hljs-string">""</span>
=&gt; [ ]
stringToCharacters <span class="hljs-string">"abc"</span>
=&gt; [ <span class="hljs-string">"a"</span> <span class="hljs-string">"b"</span> <span class="hljs-string">"c"</span> ]
stringToCharacters <span class="hljs-string">"🦄"</span>
=&gt; [ <span class="hljs-string">"�"</span> <span class="hljs-string">"�"</span> <span class="hljs-string">"�"</span> <span class="hljs-string">"�"</span> ]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L363" target="_top">lib/strings.nix:363</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.stringAsChars" class="title"><code class="literal">lib.strings.stringAsChars</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.stringAsChars" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">stringAsChars :: (string -&gt; string) -&gt; string -&gt; string</code></p><p>Manipulate a string character by character and replace them by
strings before concatenating the results.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">f</code></span></dt><dd><p>Function to map over each individual character</p></dd><dt><span class="term"><code class="literal">s</code></span></dt><dd><p>Input string</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.stringAsChars"></span><p class="title"><strong>Example&nbsp;65.&nbsp;<code class="literal">lib.strings.stringAsChars</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">stringAsChars (x: <span class="hljs-keyword">if</span> <span class="hljs-attr">x</span> == <span class="hljs-string">"a"</span> <span class="hljs-keyword">then</span> <span class="hljs-string">"i"</span> <span class="hljs-keyword">else</span> x) <span class="hljs-string">"nax"</span>
=&gt; <span class="hljs-string">"nix"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L375" target="_top">lib/strings.nix:375</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.charToInt" class="title"><code class="literal">lib.strings.charToInt</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.charToInt" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">charToInt :: string -&gt; int</code></p><p>Convert char to ascii value, must be in printable range</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">c</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.charToInt"></span><p class="title"><strong>Example&nbsp;66.&nbsp;<code class="literal">lib.strings.charToInt</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">charToInt <span class="hljs-string">"A"</span>
=&gt; <span class="hljs-number">65</span>
charToInt <span class="hljs-string">"("</span>
=&gt; <span class="hljs-number">40</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L394" target="_top">lib/strings.nix:394</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.escape" class="title"><code class="literal">lib.strings.escape</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.escape" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">escape :: [string] -&gt; string -&gt; string</code></p><p>Escape occurrence of the elements of <code class="literal">list</code> in <code class="literal">string</code> by
prefixing it with a backslash.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">list</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.escape"></span><p class="title"><strong>Example&nbsp;67.&nbsp;<code class="literal">lib.strings.escape</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">escape [<span class="hljs-string">"("</span> <span class="hljs-string">")"</span>] <span class="hljs-string">"(foo)"</span>
=&gt; <span class="hljs-string">"\\(foo\\)"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L405" target="_top">lib/strings.nix:405</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.escapeC" class="title"><code class="literal">lib.strings.escapeC</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.escapeC" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">escapeC = [string] -&gt; string -&gt; string</code></p><p>Escape occurrence of the element of <code class="literal">list</code> in <code class="literal">string</code> by
converting to its ASCII value and prefixing it with \x.
Only works for printable ascii characters.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">list</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.escapeC"></span><p class="title"><strong>Example&nbsp;68.&nbsp;<code class="literal">lib.strings.escapeC</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">escapeC [<span class="hljs-string">" "</span>] <span class="hljs-string">"foo bar"</span>
=&gt; <span class="hljs-string">"foo\\x20bar"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L418" target="_top">lib/strings.nix:418</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.escapeURL" class="title"><code class="literal">lib.strings.escapeURL</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.escapeURL" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">escapeURL :: string -&gt; string</code></p><p>Escape the string so it can be safely placed inside a URL
query.</p><div class="example"><span id="function-library-example-lib.strings.escapeURL"></span><p class="title"><strong>Example&nbsp;69.&nbsp;<code class="literal">lib.strings.escapeURL</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">escapeURL <span class="hljs-string">"foo/bar baz"</span>
=&gt; <span class="hljs-string">"foo%2Fbar%20baz"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L429" target="_top">lib/strings.nix:429</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.escapeShellArg" class="title"><code class="literal">lib.strings.escapeShellArg</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.escapeShellArg" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">escapeShellArg :: string -&gt; string</code></p><p>Quote string to be used safely within the Bourne shell.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">arg</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.escapeShellArg"></span><p class="title"><strong>Example&nbsp;70.&nbsp;<code class="literal">lib.strings.escapeShellArg</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">escapeShellArg <span class="hljs-string">"esc'ape\nme"</span>
=&gt; <span class="hljs-string">"'esc'\\''ape\nme'"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L443" target="_top">lib/strings.nix:443</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.escapeShellArgs" class="title"><code class="literal">lib.strings.escapeShellArgs</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.escapeShellArgs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">escapeShellArgs :: [string] -&gt; string</code></p><p>Quote all arguments to be safely passed to the Bourne shell.</p><div class="example"><span id="function-library-example-lib.strings.escapeShellArgs"></span><p class="title"><strong>Example&nbsp;71.&nbsp;<code class="literal">lib.strings.escapeShellArgs</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">escapeShellArgs [<span class="hljs-string">"one"</span> <span class="hljs-string">"two three"</span> <span class="hljs-string">"four'five"</span>]
=&gt; <span class="hljs-string">"'one' 'two three' 'four'\\''five'"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L453" target="_top">lib/strings.nix:453</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.isValidPosixName" class="title"><code class="literal">lib.strings.isValidPosixName</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.isValidPosixName" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">string -&gt; bool</code></p><p>Test whether the given name is a valid POSIX shell variable name.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">name</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.isValidPosixName"></span><p class="title"><strong>Example&nbsp;72.&nbsp;<code class="literal">lib.strings.isValidPosixName</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">isValidPosixName <span class="hljs-string">"foo_bar000"</span>
=&gt; <span class="hljs-literal">true</span>
isValidPosixName <span class="hljs-string">"0-bad.jpg"</span>
=&gt; <span class="hljs-literal">false</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L465" target="_top">lib/strings.nix:465</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.toShellVar" class="title"><code class="literal">lib.strings.toShellVar</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.toShellVar" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">string -&gt; (string | listOf string | attrsOf string) -&gt; string</code></p><p>Translate a Nix value into a shell variable declaration, with proper escaping.</p><p>The value can be a string (mapped to a regular variable), a list of strings
(mapped to a Bash-style array) or an attribute set of strings (mapped to a
Bash-style associative array). Note that “string” includes string-coercible
values like paths or derivations.</p><p>Strings are translated into POSIX sh-compatible code; lists and attribute sets
assume a shell that understands Bash syntax (e.g. Bash or ZSH).</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">name</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">value</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.toShellVar"></span><p class="title"><strong>Example&nbsp;73.&nbsp;<code class="literal">lib.strings.toShellVar</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-string">''
  <span class="hljs-subst">${toShellVar <span class="hljs-string">"foo"</span> <span class="hljs-string">"some string"</span>}</span>
  [[ "$foo" == "some string" ]]
''</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L485" target="_top">lib/strings.nix:485</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.toShellVars" class="title"><code class="literal">lib.strings.toShellVars</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.toShellVars" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">attrsOf (string | listOf string | attrsOf string) -&gt; string</code></p><p>Translate an attribute set into corresponding shell variable declarations
using <code class="literal">toShellVar</code>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">vars</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.toShellVars"></span><p class="title"><strong>Example&nbsp;74.&nbsp;<code class="literal">lib.strings.toShellVars</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">let</span>
  <span class="hljs-attr">foo</span> = <span class="hljs-string">"value"</span>;
  <span class="hljs-attr">bar</span> = foo;
<span class="hljs-keyword">in</span> <span class="hljs-string">''
  <span class="hljs-subst">${toShellVars { <span class="hljs-keyword">inherit</span> foo bar; }</span>}
  [[ "$foo" == "$bar" ]]
''</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L513" target="_top">lib/strings.nix:513</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.escapeNixString" class="title"><code class="literal">lib.strings.escapeNixString</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.escapeNixString" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">string -&gt; string</code></p><p>Turn a string into a Nix expression representing that string</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">s</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.escapeNixString"></span><p class="title"><strong>Example&nbsp;75.&nbsp;<code class="literal">lib.strings.escapeNixString</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">escapeNixString <span class="hljs-string">"hello\<span class="hljs-subst">${}</span>\n"</span>
=&gt; <span class="hljs-string">"\"</span>hello\\\${}\\n\<span class="hljs-string">""</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L523" target="_top">lib/strings.nix:523</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.escapeRegex" class="title"><code class="literal">lib.strings.escapeRegex</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.escapeRegex" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">string -&gt; string</code></p><p>Turn a string into an exact regular expression</p><div class="example"><span id="function-library-example-lib.strings.escapeRegex"></span><p class="title"><strong>Example&nbsp;76.&nbsp;<code class="literal">lib.strings.escapeRegex</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">escapeRegex <span class="hljs-string">"[^a-z]*"</span>
=&gt; <span class="hljs-string">"\\[\\^a-z]\\*"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L533" target="_top">lib/strings.nix:533</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.escapeNixIdentifier" class="title"><code class="literal">lib.strings.escapeNixIdentifier</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.escapeNixIdentifier" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">string -&gt; string</code></p><p>Quotes a string if it can’t be used as an identifier directly.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">s</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.escapeNixIdentifier"></span><p class="title"><strong>Example&nbsp;77.&nbsp;<code class="literal">lib.strings.escapeNixIdentifier</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">escapeNixIdentifier <span class="hljs-string">"hello"</span>
=&gt; <span class="hljs-string">"hello"</span>
escapeNixIdentifier <span class="hljs-string">"0abc"</span>
=&gt; <span class="hljs-string">"\"</span><span class="hljs-number">0</span>abc\<span class="hljs-string">""</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L545" target="_top">lib/strings.nix:545</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.escapeXML" class="title"><code class="literal">lib.strings.escapeXML</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.escapeXML" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">string -&gt; string</code></p><p>Escapes a string such that it is safe to include verbatim in an XML
document.</p><div class="example"><span id="function-library-example-lib.strings.escapeXML"></span><p class="title"><strong>Example&nbsp;78.&nbsp;<code class="literal">lib.strings.escapeXML</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">escapeXML <span class="hljs-string">''"test" 'test' &lt; &amp; &gt;''</span>
=&gt; <span class="hljs-string">"&amp;quot;test&amp;quot; &amp;apos;test&amp;apos; &amp;lt; &amp;amp; &amp;gt;"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L559" target="_top">lib/strings.nix:559</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.toLower" class="title"><code class="literal">lib.strings.toLower</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.toLower" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">toLower :: string -&gt; string</code></p><p>Converts an ASCII string to lower-case.</p><div class="example"><span id="function-library-example-lib.strings.toLower"></span><p class="title"><strong>Example&nbsp;79.&nbsp;<code class="literal">lib.strings.toLower</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">toLower <span class="hljs-string">"HOME"</span>
=&gt; <span class="hljs-string">"home"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L578" target="_top">lib/strings.nix:578</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.toUpper" class="title"><code class="literal">lib.strings.toUpper</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.toUpper" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">toUpper :: string -&gt; string</code></p><p>Converts an ASCII string to upper-case.</p><div class="example"><span id="function-library-example-lib.strings.toUpper"></span><p class="title"><strong>Example&nbsp;80.&nbsp;<code class="literal">lib.strings.toUpper</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">toUpper <span class="hljs-string">"home"</span>
=&gt; <span class="hljs-string">"HOME"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L588" target="_top">lib/strings.nix:588</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.addContextFrom" class="title"><code class="literal">lib.strings.addContextFrom</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.addContextFrom" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Appends string context from another string.  This is an implementation
detail of Nix and should be used carefully.</p><p>Strings in Nix carry an invisible <code class="literal">context</code> which is a list of strings
representing store paths.  If the string is later used in a derivation
attribute, the derivation will properly populate the inputDrvs and
inputSrcs.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">a</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">b</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.addContextFrom"></span><p class="title"><strong>Example&nbsp;81.&nbsp;<code class="literal">lib.strings.addContextFrom</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">pkgs</span> = <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; { };
addContextFrom pkgs.coreutils <span class="hljs-string">"bar"</span>
=&gt; <span class="hljs-string">"bar"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L603" target="_top">lib/strings.nix:603</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.splitString" class="title"><code class="literal">lib.strings.splitString</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.splitString" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Cut a string with a separator and produces a list of strings which
were separated by this separator.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">sep</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">s</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.splitString"></span><p class="title"><strong>Example&nbsp;82.&nbsp;<code class="literal">lib.strings.splitString</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">splitString <span class="hljs-string">"."</span> <span class="hljs-string">"foo.bar.baz"</span>
=&gt; [ <span class="hljs-string">"foo"</span> <span class="hljs-string">"bar"</span> <span class="hljs-string">"baz"</span> ]
splitString <span class="hljs-string">"/"</span> <span class="hljs-string">"/usr/local/bin"</span>
=&gt; [ <span class="hljs-string">""</span> <span class="hljs-string">"usr"</span> <span class="hljs-string">"local"</span> <span class="hljs-string">"bin"</span> ]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L614" target="_top">lib/strings.nix:614</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.removePrefix" class="title"><code class="literal">lib.strings.removePrefix</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.removePrefix" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">string -&gt; string -&gt; string</code></p><p>Return a string without the specified prefix, if the prefix matches.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">prefix</code></span></dt><dd><p>Prefix to remove if it matches</p></dd><dt><span class="term"><code class="literal">str</code></span></dt><dd><p>Input string</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.removePrefix"></span><p class="title"><strong>Example&nbsp;83.&nbsp;<code class="literal">lib.strings.removePrefix</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">removePrefix <span class="hljs-string">"foo."</span> <span class="hljs-string">"foo.bar.baz"</span>
=&gt; <span class="hljs-string">"bar.baz"</span>
removePrefix <span class="hljs-string">"xxx"</span> <span class="hljs-string">"foo.bar.baz"</span>
=&gt; <span class="hljs-string">"foo.bar.baz"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L630" target="_top">lib/strings.nix:630</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.removeSuffix" class="title"><code class="literal">lib.strings.removeSuffix</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.removeSuffix" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">string -&gt; string -&gt; string</code></p><p>Return a string without the specified suffix, if the suffix matches.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">suffix</code></span></dt><dd><p>Suffix to remove if it matches</p></dd><dt><span class="term"><code class="literal">str</code></span></dt><dd><p>Input string</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.removeSuffix"></span><p class="title"><strong>Example&nbsp;84.&nbsp;<code class="literal">lib.strings.removeSuffix</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">removeSuffix <span class="hljs-string">"front"</span> <span class="hljs-string">"homefront"</span>
=&gt; <span class="hljs-string">"home"</span>
removeSuffix <span class="hljs-string">"xxx"</span> <span class="hljs-string">"homefront"</span>
=&gt; <span class="hljs-string">"homefront"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L663" target="_top">lib/strings.nix:663</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.versionOlder" class="title"><code class="literal">lib.strings.versionOlder</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.versionOlder" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Return true if string v1 denotes a version older than v2.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">v1</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">v2</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.versionOlder"></span><p class="title"><strong>Example&nbsp;85.&nbsp;<code class="literal">lib.strings.versionOlder</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">versionOlder <span class="hljs-string">"1.1"</span> <span class="hljs-string">"1.2"</span>
=&gt; <span class="hljs-literal">true</span>
versionOlder <span class="hljs-string">"1.1"</span> <span class="hljs-string">"1.1"</span>
=&gt; <span class="hljs-literal">false</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L694" target="_top">lib/strings.nix:694</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.versionAtLeast" class="title"><code class="literal">lib.strings.versionAtLeast</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.versionAtLeast" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Return true if string v1 denotes a version equal to or newer than v2.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">v1</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">v2</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.versionAtLeast"></span><p class="title"><strong>Example&nbsp;86.&nbsp;<code class="literal">lib.strings.versionAtLeast</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">versionAtLeast <span class="hljs-string">"1.1"</span> <span class="hljs-string">"1.0"</span>
=&gt; <span class="hljs-literal">true</span>
versionAtLeast <span class="hljs-string">"1.1"</span> <span class="hljs-string">"1.1"</span>
=&gt; <span class="hljs-literal">true</span>
versionAtLeast <span class="hljs-string">"1.1"</span> <span class="hljs-string">"1.2"</span>
=&gt; <span class="hljs-literal">false</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L706" target="_top">lib/strings.nix:706</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.getName" class="title"><code class="literal">lib.strings.getName</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.getName" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>This function takes an argument that’s either a derivation or a
derivation’s “name” attribute and extracts the name part from that
argument.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">x</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.getName"></span><p class="title"><strong>Example&nbsp;87.&nbsp;<code class="literal">lib.strings.getName</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">getName <span class="hljs-string">"youtube-dl-2016.01.01"</span>
=&gt; <span class="hljs-string">"youtube-dl"</span>
getName pkgs.<span class="hljs-attr">youtube-dl</span>
=&gt; <span class="hljs-string">"youtube-dl"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L718" target="_top">lib/strings.nix:718</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.getVersion" class="title"><code class="literal">lib.strings.getVersion</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.getVersion" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>This function takes an argument that’s either a derivation or a
derivation’s “name” attribute and extracts the version part from that
argument.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">x</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.getVersion"></span><p class="title"><strong>Example&nbsp;88.&nbsp;<code class="literal">lib.strings.getVersion</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">getVersion <span class="hljs-string">"youtube-dl-2016.01.01"</span>
=&gt; <span class="hljs-string">"2016.01.01"</span>
getVersion pkgs.<span class="hljs-attr">youtube-dl</span>
=&gt; <span class="hljs-string">"2016.01.01"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L735" target="_top">lib/strings.nix:735</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.nameFromURL" class="title"><code class="literal">lib.strings.nameFromURL</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.nameFromURL" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Extract name with version from URL. Ask for separator which is
supposed to start extension.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">url</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">sep</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.nameFromURL"></span><p class="title"><strong>Example&nbsp;89.&nbsp;<code class="literal">lib.strings.nameFromURL</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">nameFromURL <span class="hljs-string">"https://nixos.org/releases/nix/nix-1.7/nix-1.7-x86_64-linux.tar.bz2"</span> <span class="hljs-string">"-"</span>
=&gt; <span class="hljs-string">"nix"</span>
nameFromURL <span class="hljs-string">"https://nixos.org/releases/nix/nix-1.7/nix-1.7-x86_64-linux.tar.bz2"</span> <span class="hljs-string">"_"</span>
=&gt; <span class="hljs-string">"nix-1.7-x86"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L751" target="_top">lib/strings.nix:751</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.cmakeOptionType" class="title"><code class="literal">lib.strings.cmakeOptionType</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.cmakeOptionType" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>:</p><pre><code class="programlisting hljs language-bash" data-highlighted="yes">cmakeOptionType :: string -&gt; string -&gt; string -&gt; string

@param feature The feature to be <span class="hljs-built_in">set</span>
@param <span class="hljs-built_in">type</span> The <span class="hljs-built_in">type</span> of the feature to be <span class="hljs-built_in">set</span>, as described <span class="hljs-keyword">in</span>
            https://cmake.org/cmake/help/latest/command/set.html
            the possible values (<span class="hljs-keyword">case</span> insensitive) are:
            BOOL FILEPATH PATH STRING INTERNAL
@param value The desired value
</code></pre><p>Create a “-D&lt;feature&gt;:&lt;type&gt;=&lt;value&gt;” string that can be passed to typical
CMake invocations.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">type</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">feature</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">value</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.cmakeOptionType"></span><p class="title"><strong>Example&nbsp;90.&nbsp;<code class="literal">lib.strings.cmakeOptionType</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">cmakeOptionType <span class="hljs-string">"string"</span> <span class="hljs-string">"ENGINE"</span> <span class="hljs-string">"sdl2"</span>
=&gt; <span class="hljs-string">"-DENGINE:STRING=sdl2"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L774" target="_top">lib/strings.nix:774</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.cmakeBool" class="title"><code class="literal">lib.strings.cmakeBool</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.cmakeBool" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>:</p><pre><code class="programlisting hljs language-bash" data-highlighted="yes">cmakeBool :: string -&gt; bool -&gt; string

@param condition The condition to be made <span class="hljs-literal">true</span> or <span class="hljs-literal">false</span>
@param flag The controlling flag of the condition
</code></pre><p>Create a -D&lt;condition&gt;={TRUE,FALSE} string that can be passed to typical
CMake invocations.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">condition</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">flag</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.cmakeBool"></span><p class="title"><strong>Example&nbsp;91.&nbsp;<code class="literal">lib.strings.cmakeBool</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">cmakeBool <span class="hljs-string">"ENABLE_STATIC_LIBS"</span> <span class="hljs-attr">false</span>
=&gt; <span class="hljs-string">"-DENABLESTATIC_LIBS:BOOL=FALSE"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L793" target="_top">lib/strings.nix:793</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.cmakeFeature" class="title"><code class="literal">lib.strings.cmakeFeature</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.cmakeFeature" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>:</p><pre><code class="programlisting hljs language-bash" data-highlighted="yes">cmakeFeature :: string -&gt; string -&gt; string

@param condition The condition to be made <span class="hljs-literal">true</span> or <span class="hljs-literal">false</span>
@param flag The controlling flag of the condition
</code></pre><p>Create a -D&lt;feature&gt;:STRING=&lt;value&gt; string that can be passed to typical
CMake invocations.
This is the most typical usage, so it deserves a special case.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">feature</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">value</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.cmakeFeature"></span><p class="title"><strong>Example&nbsp;92.&nbsp;<code class="literal">lib.strings.cmakeFeature</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">cmakeFeature <span class="hljs-string">"MODULES"</span> <span class="hljs-string">"badblock"</span>
=&gt; <span class="hljs-string">"-DMODULES:STRING=badblock"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L811" target="_top">lib/strings.nix:811</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.mesonOption" class="title"><code class="literal">lib.strings.mesonOption</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.mesonOption" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>:</p><pre><code class="programlisting hljs language-bash" data-highlighted="yes">mesonOption :: string -&gt; string -&gt; string

@param feature The feature to be <span class="hljs-built_in">set</span>
@param value The desired value
</code></pre><p>Create a -D&lt;feature&gt;=&lt;value&gt; string that can be passed to typical Meson
invocations.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">feature</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">value</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.mesonOption"></span><p class="title"><strong>Example&nbsp;93.&nbsp;<code class="literal">lib.strings.mesonOption</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">mesonOption <span class="hljs-string">"engine"</span> <span class="hljs-string">"opengl"</span>
=&gt; <span class="hljs-string">"-Dengine=opengl"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L828" target="_top">lib/strings.nix:828</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.mesonBool" class="title"><code class="literal">lib.strings.mesonBool</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.mesonBool" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>:</p><pre><code class="programlisting hljs language-bash" data-highlighted="yes">mesonBool :: string -&gt; bool -&gt; string

@param condition The condition to be made <span class="hljs-literal">true</span> or <span class="hljs-literal">false</span>
@param flag The controlling flag of the condition
</code></pre><p>Create a -D&lt;condition&gt;={true,false} string that can be passed to typical
Meson invocations.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">condition</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">flag</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.mesonBool"></span><p class="title"><strong>Example&nbsp;94.&nbsp;<code class="literal">lib.strings.mesonBool</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">mesonBool <span class="hljs-string">"hardened"</span> <span class="hljs-attr">true</span>
=&gt; <span class="hljs-string">"-Dhardened=true"</span>
mesonBool <span class="hljs-string">"static"</span> <span class="hljs-attr">false</span>
=&gt; <span class="hljs-string">"-Dstatic=false"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L847" target="_top">lib/strings.nix:847</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.mesonEnable" class="title"><code class="literal">lib.strings.mesonEnable</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.mesonEnable" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>:</p><pre><code class="programlisting hljs language-undefined" data-highlighted="yes">mesonEnable :: string -&gt; bool -&gt; string

@param feature The feature to be enabled or disabled
@param flag The controlling flag
</code></pre><p>Create a -D&lt;feature&gt;={enabled,disabled} string that can be passed to
typical Meson invocations.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">feature</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">flag</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.mesonEnable"></span><p class="title"><strong>Example&nbsp;95.&nbsp;<code class="literal">lib.strings.mesonEnable</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">mesonEnable <span class="hljs-string">"docs"</span> <span class="hljs-attr">true</span>
=&gt; <span class="hljs-string">"-Ddocs=enabled"</span>
mesonEnable <span class="hljs-string">"savage"</span> <span class="hljs-attr">false</span>
=&gt; <span class="hljs-string">"-Dsavage=disabled"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L866" target="_top">lib/strings.nix:866</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.enableFeature" class="title"><code class="literal">lib.strings.enableFeature</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.enableFeature" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Create an --{enable,disable}-&lt;feature&gt; string that can be passed to
standard GNU Autoconf scripts.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">flag</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">feature</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.enableFeature"></span><p class="title"><strong>Example&nbsp;96.&nbsp;<code class="literal">lib.strings.enableFeature</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">enableFeature <span class="hljs-literal">true</span> <span class="hljs-string">"shared"</span>
=&gt; <span class="hljs-string">"--enable-shared"</span>
enableFeature <span class="hljs-literal">false</span> <span class="hljs-string">"shared"</span>
=&gt; <span class="hljs-string">"--disable-shared"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L880" target="_top">lib/strings.nix:880</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.enableFeatureAs" class="title"><code class="literal">lib.strings.enableFeatureAs</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.enableFeatureAs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Create an --{enable-&lt;feature&gt;=&lt;value&gt;,disable-&lt;feature&gt;} string that can be passed to
standard GNU Autoconf scripts.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">flag</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">feature</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">value</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.enableFeatureAs"></span><p class="title"><strong>Example&nbsp;97.&nbsp;<code class="literal">lib.strings.enableFeatureAs</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">enableFeatureAs <span class="hljs-literal">true</span> <span class="hljs-string">"shared"</span> <span class="hljs-string">"foo"</span>
=&gt; <span class="hljs-string">"--enable-shared=foo"</span>
enableFeatureAs <span class="hljs-literal">false</span> <span class="hljs-string">"shared"</span> (<span class="hljs-built_in">throw</span> <span class="hljs-string">"ignored"</span>)
=&gt; <span class="hljs-string">"--disable-shared"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L894" target="_top">lib/strings.nix:894</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.withFeature" class="title"><code class="literal">lib.strings.withFeature</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.withFeature" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Create an --{with,without}-&lt;feature&gt; string that can be passed to
standard GNU Autoconf scripts.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">flag</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">feature</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.withFeature"></span><p class="title"><strong>Example&nbsp;98.&nbsp;<code class="literal">lib.strings.withFeature</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">withFeature <span class="hljs-literal">true</span> <span class="hljs-string">"shared"</span>
=&gt; <span class="hljs-string">"--with-shared"</span>
withFeature <span class="hljs-literal">false</span> <span class="hljs-string">"shared"</span>
=&gt; <span class="hljs-string">"--without-shared"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L906" target="_top">lib/strings.nix:906</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.withFeatureAs" class="title"><code class="literal">lib.strings.withFeatureAs</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.withFeatureAs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Create an --{with-&lt;feature&gt;=&lt;value&gt;,without-&lt;feature&gt;} string that can be passed to
standard GNU Autoconf scripts.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">flag</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">feature</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">value</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.withFeatureAs"></span><p class="title"><strong>Example&nbsp;99.&nbsp;<code class="literal">lib.strings.withFeatureAs</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">withFeatureAs <span class="hljs-literal">true</span> <span class="hljs-string">"shared"</span> <span class="hljs-string">"foo"</span>
=&gt; <span class="hljs-string">"--with-shared=foo"</span>
withFeatureAs <span class="hljs-literal">false</span> <span class="hljs-string">"shared"</span> (<span class="hljs-built_in">throw</span> <span class="hljs-string">"ignored"</span>)
=&gt; <span class="hljs-string">"--without-shared"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L919" target="_top">lib/strings.nix:919</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.fixedWidthString" class="title"><code class="literal">lib.strings.fixedWidthString</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.fixedWidthString" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">fixedWidthString :: int -&gt; string -&gt; string -&gt; string</code></p><p>Create a fixed width string with additional prefix to match
required width.</p><p>This function will fail if the input string is longer than the
requested length.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">width</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">filler</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">str</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.fixedWidthString"></span><p class="title"><strong>Example&nbsp;100.&nbsp;<code class="literal">lib.strings.fixedWidthString</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">fixedWidthString <span class="hljs-number">5</span> <span class="hljs-string">"0"</span> (<span class="hljs-built_in">toString</span> <span class="hljs-number">15</span>)
=&gt; <span class="hljs-string">"00015"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L934" target="_top">lib/strings.nix:934</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.fixedWidthNumber" class="title"><code class="literal">lib.strings.fixedWidthNumber</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.fixedWidthNumber" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Format a number adding leading zeroes up to fixed width.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">width</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">n</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.fixedWidthNumber"></span><p class="title"><strong>Example&nbsp;101.&nbsp;<code class="literal">lib.strings.fixedWidthNumber</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">fixedWidthNumber <span class="hljs-number">5</span> <span class="hljs-number">15</span>
=&gt; <span class="hljs-string">"00015"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L951" target="_top">lib/strings.nix:951</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.floatToString" class="title"><code class="literal">lib.strings.floatToString</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.floatToString" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Convert a float to a string, but emit a warning when precision is lost
during the conversion</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">float</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.floatToString"></span><p class="title"><strong>Example&nbsp;102.&nbsp;<code class="literal">lib.strings.floatToString</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">floatToString <span class="hljs-number">0.000001</span>
=&gt; <span class="hljs-string">"0.000001"</span>
floatToString <span class="hljs-number">0.0000001</span>
=&gt; trace: warning: Imprecise conversion from float to string <span class="hljs-number">0.000000</span>
   <span class="hljs-string">"0.000000"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L963" target="_top">lib/strings.nix:963</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.isCoercibleToString" class="title"><code class="literal">lib.strings.isCoercibleToString</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.isCoercibleToString" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Soft-deprecated function. While the original implementation is available as
isConvertibleWithToString, consider using isStringLike instead, if suitable.</p><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L971" target="_top">lib/strings.nix:971</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.isConvertibleWithToString" class="title"><code class="literal">lib.strings.isConvertibleWithToString</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.isConvertibleWithToString" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Check whether a list or other value can be passed to toString.</p><p>Many types of value are coercible to string this way, including int, float,
null, bool, list of similarly coercible values.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">x</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L980" target="_top">lib/strings.nix:980</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.isStringLike" class="title"><code class="literal">lib.strings.isStringLike</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.isStringLike" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Check whether a value can be coerced to a string.
The value must be a string, path, or attribute set.</p><p>String-like values can be used without explicit conversion in
string interpolations and in most functions that expect a string.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">x</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L991" target="_top">lib/strings.nix:991</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.isStorePath" class="title"><code class="literal">lib.strings.isStorePath</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.isStorePath" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Check whether a value is a store path.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">x</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.isStorePath"></span><p class="title"><strong>Example&nbsp;103.&nbsp;<code class="literal">lib.strings.isStorePath</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">isStorePath <span class="hljs-string">"/nix/store/d945ibfx9x185xf04b890y4f9g3cbb63-python-2.7.11/bin/python"</span>
=&gt; <span class="hljs-literal">false</span>
isStorePath <span class="hljs-string">"/nix/store/d945ibfx9x185xf04b890y4f9g3cbb63-python-2.7.11"</span>
=&gt; <span class="hljs-literal">true</span>
isStorePath pkgs.<span class="hljs-attr">python</span>
=&gt; <span class="hljs-literal">true</span>
isStorePath [] || isStorePath <span class="hljs-number">42</span> || isStorePath {} || …
=&gt; <span class="hljs-literal">false</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L1009" target="_top">lib/strings.nix:1009</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.toInt" class="title"><code class="literal">lib.strings.toInt</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.toInt" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">string -&gt; int</code></p><p>Parse a string as an int. Does not support parsing of integers with preceding zero due to
ambiguity between zero-padded and octal numbers. See toIntBase10.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">str</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.toInt"></span><p class="title"><strong>Example&nbsp;104.&nbsp;<code class="literal">lib.strings.toInt</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">toInt <span class="hljs-string">"1337"</span>
=&gt; <span class="hljs-number">1337</span>

toInt <span class="hljs-string">"-4"</span>
=&gt; -<span class="hljs-number">4</span>

toInt <span class="hljs-string">" 123 "</span>
=&gt; <span class="hljs-number">123</span>

toInt <span class="hljs-string">"00024"</span>
=&gt; error: Ambiguity <span class="hljs-keyword">in</span> interpretation of <span class="hljs-number">00024</span> between octal <span class="hljs-literal">and</span> zero padded integer.

toInt <span class="hljs-string">"3.14"</span>
=&gt; error: floating point JSON numbers are not supported
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L1039" target="_top">lib/strings.nix:1039</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.toIntBase10" class="title"><code class="literal">lib.strings.toIntBase10</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.toIntBase10" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">string -&gt; int</code></p><p>Parse a string as a base 10 int. This supports parsing of zero-padded integers.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">str</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.toIntBase10"></span><p class="title"><strong>Example&nbsp;105.&nbsp;<code class="literal">lib.strings.toIntBase10</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">toIntBase10 <span class="hljs-string">"1337"</span>
=&gt; <span class="hljs-number">1337</span>

toIntBase10 <span class="hljs-string">"-4"</span>
=&gt; -<span class="hljs-number">4</span>

toIntBase10 <span class="hljs-string">" 123 "</span>
=&gt; <span class="hljs-number">123</span>

toIntBase10 <span class="hljs-string">"00024"</span>
=&gt; <span class="hljs-number">24</span>

toIntBase10 <span class="hljs-string">"3.14"</span>
=&gt; error: floating point JSON numbers are not supported
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L1090" target="_top">lib/strings.nix:1090</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.readPathsFromFile" class="title"><code class="literal">lib.strings.readPathsFromFile</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.readPathsFromFile" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Read a list of paths from <code class="literal">file</code>, relative to the <code class="literal">rootPath</code>.
Lines beginning with <code class="literal">#</code> are treated as comments and ignored.
Whitespace is significant.</p><p>NOTE: This function is not performant and should be avoided.</p><div class="example"><span id="function-library-example-lib.strings.readPathsFromFile"></span><p class="title"><strong>Example&nbsp;106.&nbsp;<code class="literal">lib.strings.readPathsFromFile</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">readPathsFromFile /prefix
  ./pkgs/development/libraries/qt-<span class="hljs-number">5</span>/<span class="hljs-number">5.4</span>/qtbase/<span class="hljs-attr">series</span>
=&gt; [ <span class="hljs-string">"/prefix/dlopen-resolv.patch"</span> <span class="hljs-string">"/prefix/tzdir.patch"</span>
     <span class="hljs-string">"/prefix/dlopen-libXcursor.patch"</span> <span class="hljs-string">"/prefix/dlopen-openssl.patch"</span>
     <span class="hljs-string">"/prefix/dlopen-dbus.patch"</span> <span class="hljs-string">"/prefix/xdg-config-dirs.patch"</span>
     <span class="hljs-string">"/prefix/nix-profiles-library-paths.patch"</span>
     <span class="hljs-string">"/prefix/compose-search-path.patch"</span> ]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L1133" target="_top">lib/strings.nix:1133</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.fileContents" class="title"><code class="literal">lib.strings.fileContents</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.fileContents" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">fileContents :: path -&gt; string</code></p><p>Read the contents of a file removing the trailing \n</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">file</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.fileContents"></span><p class="title"><strong>Example&nbsp;107.&nbsp;<code class="literal">lib.strings.fileContents</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">$ echo <span class="hljs-string">"1.0"</span> &gt; ./version

fileContents ./<span class="hljs-attr">version</span>
=&gt; <span class="hljs-string">"1.0"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L1153" target="_top">lib/strings.nix:1153</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.sanitizeDerivationName" class="title"><code class="literal">lib.strings.sanitizeDerivationName</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.sanitizeDerivationName" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">sanitizeDerivationName :: String -&gt; String</code></p><p>Creates a valid derivation name from a potentially invalid one.</p><div class="example"><span id="function-library-example-lib.strings.sanitizeDerivationName"></span><p class="title"><strong>Example&nbsp;108.&nbsp;<code class="literal">lib.strings.sanitizeDerivationName</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">sanitizeDerivationName <span class="hljs-string">"../hello.bar # foo"</span>
=&gt; <span class="hljs-string">"-hello.bar-foo"</span>
sanitizeDerivationName <span class="hljs-string">""</span>
=&gt; <span class="hljs-string">"unknown"</span>
sanitizeDerivationName pkgs.<span class="hljs-attr">hello</span>
=&gt; <span class="hljs-string">"-nix-store-2g75chlbpxlrqn15zlby2dfh8hr9qwbk-hello-2.10"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L1168" target="_top">lib/strings.nix:1168</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.levenshtein" class="title"><code class="literal">lib.strings.levenshtein</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.levenshtein" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">levenshtein :: string -&gt; string -&gt; int</code></p><p>Computes the Levenshtein distance between two strings.
Complexity O(n*m) where n and m are the lengths of the strings.
Algorithm adjusted from https://stackoverflow.com/a/9750974/6605742</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">a</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">b</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.strings.levenshtein"></span><p class="title"><strong>Example&nbsp;109.&nbsp;<code class="literal">lib.strings.levenshtein</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">levenshtein <span class="hljs-string">"foo"</span> <span class="hljs-string">"foo"</span>
=&gt; <span class="hljs-number">0</span>
levenshtein <span class="hljs-string">"book"</span> <span class="hljs-string">"hook"</span>
=&gt; <span class="hljs-number">1</span>
levenshtein <span class="hljs-string">"hello"</span> <span class="hljs-string">"Heyo"</span>
=&gt; <span class="hljs-number">3</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L1207" target="_top">lib/strings.nix:1207</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.commonPrefixLength" class="title"><code class="literal">lib.strings.commonPrefixLength</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.commonPrefixLength" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Returns the length of the prefix common to both strings.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">a</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">b</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L1228" target="_top">lib/strings.nix:1228</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.commonSuffixLength" class="title"><code class="literal">lib.strings.commonSuffixLength</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.commonSuffixLength" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Returns the length of the suffix common to both strings.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">a</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">b</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L1236" target="_top">lib/strings.nix:1236</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.strings.levenshteinAtMost" class="title"><code class="literal">lib.strings.levenshteinAtMost</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.strings.levenshteinAtMost" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">levenshteinAtMost :: int -&gt; string -&gt; string -&gt; bool</code></p><p>Returns whether the levenshtein distance between two strings is at most some value
Complexity is O(min(n,m)) for k &lt;= 2 and O(n*m) otherwise</p><div class="example"><span id="function-library-example-lib.strings.levenshteinAtMost"></span><p class="title"><strong>Example&nbsp;110.&nbsp;<code class="literal">lib.strings.levenshteinAtMost</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">levenshteinAtMost <span class="hljs-number">0</span> <span class="hljs-string">"foo"</span> <span class="hljs-string">"foo"</span>
=&gt; <span class="hljs-literal">true</span>
levenshteinAtMost <span class="hljs-number">1</span> <span class="hljs-string">"foo"</span> <span class="hljs-string">"boa"</span>
=&gt; <span class="hljs-literal">false</span>
levenshteinAtMost <span class="hljs-number">2</span> <span class="hljs-string">"foo"</span> <span class="hljs-string">"boa"</span>
=&gt; <span class="hljs-literal">true</span>
levenshteinAtMost <span class="hljs-number">2</span> <span class="hljs-string">"This is a sentence"</span> <span class="hljs-string">"this is a sentense."</span>
=&gt; <span class="hljs-literal">false</span>
levenshteinAtMost <span class="hljs-number">3</span> <span class="hljs-string">"This is a sentence"</span> <span class="hljs-string">"this is a sentense."</span>
=&gt; <span class="hljs-literal">true</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/strings.nix#L1260" target="_top">lib/strings.nix:1260</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-functions-library-versions" class="title">lib.versions: version string functions   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-functions-library-versions" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Version string functions.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.versions.splitVersion" class="title"><code class="literal">lib.versions.splitVersion</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.versions.splitVersion" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Break a version string into its component parts.</p><div class="example"><span id="function-library-example-lib.versions.splitVersion"></span><p class="title"><strong>Example&nbsp;111.&nbsp;<code class="literal">lib.versions.splitVersion</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">splitVersion <span class="hljs-string">"1.2.3"</span>
=&gt; [<span class="hljs-string">"1"</span> <span class="hljs-string">"2"</span> <span class="hljs-string">"3"</span>]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/versions.nix#L12" target="_top">lib/versions.nix:12</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.versions.major" class="title"><code class="literal">lib.versions.major</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.versions.major" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Get the major version string from a string.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">v</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.versions.major"></span><p class="title"><strong>Example&nbsp;112.&nbsp;<code class="literal">lib.versions.major</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">major <span class="hljs-string">"1.2.3"</span>
=&gt; <span class="hljs-string">"1"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/versions.nix#L20" target="_top">lib/versions.nix:20</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.versions.minor" class="title"><code class="literal">lib.versions.minor</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.versions.minor" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Get the minor version string from a string.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">v</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.versions.minor"></span><p class="title"><strong>Example&nbsp;113.&nbsp;<code class="literal">lib.versions.minor</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">minor <span class="hljs-string">"1.2.3"</span>
=&gt; <span class="hljs-string">"2"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/versions.nix#L28" target="_top">lib/versions.nix:28</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.versions.patch" class="title"><code class="literal">lib.versions.patch</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.versions.patch" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Get the patch version string from a string.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">v</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.versions.patch"></span><p class="title"><strong>Example&nbsp;114.&nbsp;<code class="literal">lib.versions.patch</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">patch <span class="hljs-string">"1.2.3"</span>
=&gt; <span class="hljs-string">"3"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/versions.nix#L36" target="_top">lib/versions.nix:36</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.versions.majorMinor" class="title"><code class="literal">lib.versions.majorMinor</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.versions.majorMinor" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Get string of the first two parts (major and minor)
of a version string.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">v</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.versions.majorMinor"></span><p class="title"><strong>Example&nbsp;115.&nbsp;<code class="literal">lib.versions.majorMinor</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">majorMinor <span class="hljs-string">"1.2.3"</span>
=&gt; <span class="hljs-string">"1.2"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/versions.nix#L45" target="_top">lib/versions.nix:45</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.versions.pad" class="title"><code class="literal">lib.versions.pad</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.versions.pad" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Pad a version string with zeros to match the given number of components.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">n</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">version</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.versions.pad"></span><p class="title"><strong>Example&nbsp;116.&nbsp;<code class="literal">lib.versions.pad</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">pad <span class="hljs-number">3</span> <span class="hljs-string">"1.2"</span>
=&gt; <span class="hljs-string">"1.2.0"</span>
pad <span class="hljs-number">3</span> <span class="hljs-string">"1.3-rc1"</span>
=&gt; <span class="hljs-string">"1.3.0-rc1"</span>
pad <span class="hljs-number">3</span> <span class="hljs-string">"1.2.3.4"</span>
=&gt; <span class="hljs-string">"1.2.3"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/versions.nix#L59" target="_top">lib/versions.nix:59</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-functions-library-trivial" class="title">lib.trivial: miscellaneous functions   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-functions-library-trivial" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.trivial.id" class="title"><code class="literal">lib.trivial.id</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.trivial.id" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">id :: a -&gt; a</code></p><p>The identity function
For when you need a function that does “nothing”.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">x</code></span></dt><dd><p>The value to return</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/trivial.nix#L12" target="_top">lib/trivial.nix:12</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.trivial.const" class="title"><code class="literal">lib.trivial.const</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.trivial.const" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">const :: a -&gt; b -&gt; a</code></p><p>The constant function</p><p>Ignores the second argument. If called with only one argument,
constructs a function that always returns a static value.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">x</code></span></dt><dd><p>Value to return</p></dd><dt><span class="term"><code class="literal">y</code></span></dt><dd><p>Value to ignore</p></dd></dl></div><div class="example"><span id="function-library-example-lib.trivial.const"></span><p class="title"><strong>Example&nbsp;117.&nbsp;<code class="literal">lib.trivial.const</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">let</span> <span class="hljs-attr">f</span> = const <span class="hljs-number">5</span>; <span class="hljs-keyword">in</span> f <span class="hljs-number">10</span>
=&gt; <span class="hljs-number">5</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/trivial.nix#L26" target="_top">lib/trivial.nix:26</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.trivial.pipe" class="title"><code class="literal">lib.trivial.pipe</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.trivial.pipe" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">pipe :: a -&gt; [&lt;functions&gt;] -&gt; &lt;return type of last function&gt;</code></p><p>Pipes a value through a list of functions, left to right.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">val</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">functions</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.trivial.pipe"></span><p class="title"><strong>Example&nbsp;118.&nbsp;<code class="literal">lib.trivial.pipe</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">pipe <span class="hljs-number">2</span> [
    (x: x + <span class="hljs-number">2</span>)  <span class="hljs-comment"># 2 + 2 = 4</span>
    (x: x * <span class="hljs-number">2</span>)  <span class="hljs-comment"># 4 * 2 = 8</span>
  ]
  =&gt; <span class="hljs-number">8</span>

  <span class="hljs-comment"># ideal to do text transformations</span>
  pipe [ <span class="hljs-string">"a/b"</span> <span class="hljs-string">"a/c"</span> ] [

    <span class="hljs-comment"># create the cp command</span>
    (<span class="hljs-built_in">map</span> (file: <span class="hljs-string">''cp "<span class="hljs-subst">${src}</span>/<span class="hljs-subst">${file}</span>" $out\n''</span>))

    <span class="hljs-comment"># concatenate all commands into one string</span>
    lib.concatStrings

    <span class="hljs-comment"># make that string into a nix derivation</span>
    (pkgs.runCommand <span class="hljs-string">"copy-to-out"</span> {})

  ]
  =&gt; &lt;drv which copies all files to $out&gt;

The output type of each function has to be the input type
of the next function, <span class="hljs-literal">and</span> the last function returns the
final value.
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/trivial.nix#L61" target="_top">lib/trivial.nix:61</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.trivial.concat" class="title"><code class="literal">lib.trivial.concat</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.trivial.concat" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">concat :: [a] -&gt; [a] -&gt; [a]</code></p><p>Concatenate two lists</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">x</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">y</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.trivial.concat"></span><p class="title"><strong>Example&nbsp;119.&nbsp;<code class="literal">lib.trivial.concat</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">concat [ <span class="hljs-number">1</span> <span class="hljs-number">2</span> ] [ <span class="hljs-number">3</span> <span class="hljs-number">4</span> ]
=&gt; [ <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> ]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/trivial.nix#L80" target="_top">lib/trivial.nix:80</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.trivial.or" class="title"><code class="literal">lib.trivial.or</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.trivial.or" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>boolean “or”</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">x</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">y</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/trivial.nix#L83" target="_top">lib/trivial.nix:83</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.trivial.and" class="title"><code class="literal">lib.trivial.and</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.trivial.and" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>boolean “and”</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">x</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">y</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/trivial.nix#L86" target="_top">lib/trivial.nix:86</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.trivial.bitAnd" class="title"><code class="literal">lib.trivial.bitAnd</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.trivial.bitAnd" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>bitwise “and”</p><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/trivial.nix#L89" target="_top">lib/trivial.nix:89</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.trivial.bitOr" class="title"><code class="literal">lib.trivial.bitOr</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.trivial.bitOr" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>bitwise “or”</p><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/trivial.nix#L94" target="_top">lib/trivial.nix:94</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.trivial.bitXor" class="title"><code class="literal">lib.trivial.bitXor</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.trivial.bitXor" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>bitwise “xor”</p><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/trivial.nix#L99" target="_top">lib/trivial.nix:99</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.trivial.bitNot" class="title"><code class="literal">lib.trivial.bitNot</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.trivial.bitNot" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>bitwise “not”</p><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/trivial.nix#L104" target="_top">lib/trivial.nix:104</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.trivial.boolToString" class="title"><code class="literal">lib.trivial.boolToString</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.trivial.boolToString" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">boolToString :: bool -&gt; string</code></p><p>Convert a boolean to a string.</p><p>This function uses the strings “true” and “false” to represent
boolean values. Calling <code class="literal">toString</code> on a bool instead returns “1”
and “” (sic!).</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">b</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/trivial.nix#L114" target="_top">lib/trivial.nix:114</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.trivial.mergeAttrs" class="title"><code class="literal">lib.trivial.mergeAttrs</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.trivial.mergeAttrs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Merge two attribute sets shallowly, right side trumps left</p><p>mergeAttrs :: attrs -&gt; attrs -&gt; attrs</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">x</code></span></dt><dd><p>Left attribute set</p></dd><dt><span class="term"><code class="literal">y</code></span></dt><dd><p>Right attribute set (higher precedence for equal keys)</p></dd></dl></div><div class="example"><span id="function-library-example-lib.trivial.mergeAttrs"></span><p class="title"><strong>Example&nbsp;120.&nbsp;<code class="literal">lib.trivial.mergeAttrs</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">mergeAttrs { <span class="hljs-attr">a</span> = <span class="hljs-number">1</span>; <span class="hljs-attr">b</span> = <span class="hljs-number">2</span>; } { <span class="hljs-attr">b</span> = <span class="hljs-number">3</span>; <span class="hljs-attr">c</span> = <span class="hljs-number">4</span>; }
=&gt; { <span class="hljs-attr">a</span> = <span class="hljs-number">1</span>; <span class="hljs-attr">b</span> = <span class="hljs-number">3</span>; <span class="hljs-attr">c</span> = <span class="hljs-number">4</span>; }
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/trivial.nix#L124" target="_top">lib/trivial.nix:124</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.trivial.flip" class="title"><code class="literal">lib.trivial.flip</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.trivial.flip" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">flip :: (a -&gt; b -&gt; c) -&gt; (b -&gt; a -&gt; c)</code></p><p>Flip the order of the arguments of a binary function.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">f</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">a</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">b</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.trivial.flip"></span><p class="title"><strong>Example&nbsp;121.&nbsp;<code class="literal">lib.trivial.flip</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">flip concat [<span class="hljs-number">1</span>] [<span class="hljs-number">2</span>]
=&gt; [ <span class="hljs-number">2</span> <span class="hljs-number">1</span> ]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/trivial.nix#L138" target="_top">lib/trivial.nix:138</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.trivial.mapNullable" class="title"><code class="literal">lib.trivial.mapNullable</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.trivial.mapNullable" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Apply function if the supplied argument is non-null.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">f</code></span></dt><dd><p>Function to call</p></dd><dt><span class="term"><code class="literal">a</code></span></dt><dd><p>Argument to check for null before passing it to <code class="literal">f</code></p></dd></dl></div><div class="example"><span id="function-library-example-lib.trivial.mapNullable"></span><p class="title"><strong>Example&nbsp;122.&nbsp;<code class="literal">lib.trivial.mapNullable</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">mapNullable (x: x+<span class="hljs-number">1</span>) <span class="hljs-attr">null</span>
=&gt; <span class="hljs-literal">null</span>
mapNullable (x: x+<span class="hljs-number">1</span>) <span class="hljs-number">22</span>
=&gt; <span class="hljs-number">23</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/trivial.nix#L148" target="_top">lib/trivial.nix:148</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.trivial.version" class="title"><code class="literal">lib.trivial.version</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.trivial.version" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Returns the current full nixpkgs version number.</p><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/trivial.nix#L164" target="_top">lib/trivial.nix:164</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.trivial.release" class="title"><code class="literal">lib.trivial.release</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.trivial.release" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Returns the current nixpkgs release number as string.</p><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/trivial.nix#L167" target="_top">lib/trivial.nix:167</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.trivial.oldestSupportedRelease" class="title"><code class="literal">lib.trivial.oldestSupportedRelease</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.trivial.oldestSupportedRelease" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>The latest release that is supported, at the time of release branch-off,
if applicable.</p><p>Ideally, out-of-tree modules should be able to evaluate cleanly with all
supported Nixpkgs versions (master, release and old release until EOL).
So if possible, deprecation warnings should take effect only when all
out-of-tree expressions/libs/modules can upgrade to the new way without
losing support for supported Nixpkgs versions.</p><p>This release number allows deprecation warnings to be implemented such that
they take effect as soon as the oldest release reaches end of life.</p><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/trivial.nix#L180" target="_top">lib/trivial.nix:180</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.trivial.isInOldestRelease" class="title"><code class="literal">lib.trivial.isInOldestRelease</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.trivial.isInOldestRelease" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Whether a feature is supported in all supported releases (at the time of
release branch-off, if applicable). See <code class="literal">oldestSupportedRelease</code>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">release</code></span></dt><dd><p>Release number of feature introduction as an integer, e.g. 2111 for 21.11.
Set it to the upcoming release, matching the nixpkgs/.version file.</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/trivial.nix#L186" target="_top">lib/trivial.nix:186</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.trivial.codeName" class="title"><code class="literal">lib.trivial.codeName</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.trivial.codeName" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Returns the current nixpkgs release code name.</p><p>On each release the first letter is bumped and a new animal is chosen
starting with that new letter.</p><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/trivial.nix#L198" target="_top">lib/trivial.nix:198</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.trivial.versionSuffix" class="title"><code class="literal">lib.trivial.versionSuffix</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.trivial.versionSuffix" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Returns the current nixpkgs version suffix as string.</p><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/trivial.nix#L201" target="_top">lib/trivial.nix:201</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.trivial.revisionWithDefault" class="title"><code class="literal">lib.trivial.revisionWithDefault</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.trivial.revisionWithDefault" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">revisionWithDefault :: string -&gt; string</code></p><p>Attempts to return the the current revision of nixpkgs and
returns the supplied default value otherwise.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">default</code></span></dt><dd><p>Default value to return if revision can not be determined</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/trivial.nix#L212" target="_top">lib/trivial.nix:212</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.trivial.inNixShell" class="title"><code class="literal">lib.trivial.inNixShell</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.trivial.inNixShell" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">inNixShell :: bool</code></p><p>Determine whether the function is being called from inside a Nix
shell.</p><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/trivial.nix#L230" target="_top">lib/trivial.nix:230</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.trivial.inPureEvalMode" class="title"><code class="literal">lib.trivial.inPureEvalMode</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.trivial.inPureEvalMode" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">inPureEvalMode :: bool</code></p><p>Determine whether the function is being called from inside pure-eval mode
by seeing whether <code class="literal">builtins</code> contains <code class="literal">currentSystem</code>. If not, we must be in
pure-eval mode.</p><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/trivial.nix#L238" target="_top">lib/trivial.nix:238</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.trivial.min" class="title"><code class="literal">lib.trivial.min</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.trivial.min" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Return minimum of two numbers.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">x</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">y</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/trivial.nix#L243" target="_top">lib/trivial.nix:243</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.trivial.max" class="title"><code class="literal">lib.trivial.max</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.trivial.max" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Return maximum of two numbers.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">x</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">y</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/trivial.nix#L246" target="_top">lib/trivial.nix:246</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.trivial.mod" class="title"><code class="literal">lib.trivial.mod</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.trivial.mod" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Integer modulus</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">base</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">int</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.trivial.mod"></span><p class="title"><strong>Example&nbsp;123.&nbsp;<code class="literal">lib.trivial.mod</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">mod <span class="hljs-number">11</span> <span class="hljs-number">10</span>
=&gt; <span class="hljs-number">1</span>
mod <span class="hljs-number">1</span> <span class="hljs-number">10</span>
=&gt; <span class="hljs-number">1</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/trivial.nix#L256" target="_top">lib/trivial.nix:256</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.trivial.compare" class="title"><code class="literal">lib.trivial.compare</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.trivial.compare" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>C-style comparisons</p><p>a &lt; b,  compare a b =&gt; -1
a == b, compare a b =&gt; 0
a &gt; b,  compare a b =&gt; 1</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">a</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">b</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/trivial.nix#L267" target="_top">lib/trivial.nix:267</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.trivial.splitByAndCompare" class="title"><code class="literal">lib.trivial.splitByAndCompare</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.trivial.splitByAndCompare" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">(a -&gt; bool) -&gt; (a -&gt; a -&gt; int) -&gt; (a -&gt; a -&gt; int) -&gt; (a -&gt; a -&gt; int)</code></p><p>Split type into two subtypes by predicate <code class="literal">p</code>, take all elements
of the first subtype to be less than all the elements of the
second subtype, compare elements of a single subtype with <code class="literal">yes</code>
and <code class="literal">no</code> respectively.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">p</code></span></dt><dd><p>Predicate</p></dd><dt><span class="term"><code class="literal">yes</code></span></dt><dd><p>Comparison function if predicate holds for both values</p></dd><dt><span class="term"><code class="literal">no</code></span></dt><dd><p>Comparison function if predicate holds for neither value</p></dd><dt><span class="term"><code class="literal">a</code></span></dt><dd><p>First value to compare</p></dd><dt><span class="term"><code class="literal">b</code></span></dt><dd><p>Second value to compare</p></dd></dl></div><div class="example"><span id="function-library-example-lib.trivial.splitByAndCompare"></span><p class="title"><strong>Example&nbsp;124.&nbsp;<code class="literal">lib.trivial.splitByAndCompare</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">let</span> <span class="hljs-attr">cmp</span> = splitByAndCompare (hasPrefix <span class="hljs-string">"foo"</span>) compare compare; <span class="hljs-keyword">in</span>

cmp <span class="hljs-string">"a"</span> <span class="hljs-string">"z"</span> =&gt; -<span class="hljs-number">1</span>
cmp <span class="hljs-string">"fooa"</span> <span class="hljs-string">"fooz"</span> =&gt; -<span class="hljs-number">1</span>

cmp <span class="hljs-string">"f"</span> <span class="hljs-string">"a"</span> =&gt; <span class="hljs-number">1</span>
cmp <span class="hljs-string">"fooa"</span> <span class="hljs-string">"a"</span> =&gt; -<span class="hljs-number">1</span>
<span class="hljs-comment"># while</span>
compare <span class="hljs-string">"fooa"</span> <span class="hljs-string">"a"</span> =&gt; <span class="hljs-number">1</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/trivial.nix#L292" target="_top">lib/trivial.nix:292</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.trivial.importJSON" class="title"><code class="literal">lib.trivial.importJSON</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.trivial.importJSON" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">importJSON :: path -&gt; any</code></p><p>Reads a JSON file.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">path</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/trivial.nix#L312" target="_top">lib/trivial.nix:312</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.trivial.importTOML" class="title"><code class="literal">lib.trivial.importTOML</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.trivial.importTOML" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">importTOML :: path -&gt; any</code></p><p>Reads a TOML file.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">path</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/trivial.nix#L319" target="_top">lib/trivial.nix:319</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.trivial.warn" class="title"><code class="literal">lib.trivial.warn</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.trivial.warn" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">string -&gt; a -&gt; a</code></p><p>Print a warning before returning the second argument. This function behaves
like <code class="literal">builtins.trace</code>, but requires a string message and formats it as a
warning, including the <code class="literal">warning: </code> prefix.</p><p>To get a call stack trace and abort evaluation, set the environment variable
<code class="literal">NIX_ABORT_ON_WARN=true</code> and set the Nix options <code class="literal">--option pure-eval false --show-trace</code></p><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/trivial.nix#L347" target="_top">lib/trivial.nix:347</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.trivial.warnIf" class="title"><code class="literal">lib.trivial.warnIf</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.trivial.warnIf" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">bool -&gt; string -&gt; a -&gt; a</code></p><p>Like warn, but only warn when the first argument is <code class="literal">true</code>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">cond</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">msg</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/trivial.nix#L357" target="_top">lib/trivial.nix:357</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.trivial.warnIfNot" class="title"><code class="literal">lib.trivial.warnIfNot</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.trivial.warnIfNot" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">bool -&gt; string -&gt; a -&gt; a</code></p><p>Like warnIf, but negated (warn if the first argument is <code class="literal">false</code>).</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">cond</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">msg</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/trivial.nix#L364" target="_top">lib/trivial.nix:364</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.trivial.throwIfNot" class="title"><code class="literal">lib.trivial.throwIfNot</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.trivial.throwIfNot" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">bool -&gt; string -&gt; a -&gt; a</code></p><p>Like the <code class="literal">assert b; e</code> expression, but with a custom error message and
without the semicolon.</p><p>If true, return the identity function, <code class="literal">r: r</code>.</p><p>If false, throw the error message.</p><p>Calls can be juxtaposed using function application, as <code class="literal">(r: r) a = a</code>, so
<code class="literal">(r: r) (r: r) a = a</code>, and so forth.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">cond</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">msg</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.trivial.throwIfNot"></span><p class="title"><strong>Example&nbsp;125.&nbsp;<code class="literal">lib.trivial.throwIfNot</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">throwIfNot (lib.isList overlays) <span class="hljs-string">"The overlays argument to nixpkgs must be a list."</span>
lib.foldr (x: throwIfNot (lib.isFunction x) <span class="hljs-string">"All overlays passed to nixpkgs must be functions."</span>) (r: r) overlays
pkgs
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/trivial.nix#L386" target="_top">lib/trivial.nix:386</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.trivial.throwIf" class="title"><code class="literal">lib.trivial.throwIf</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.trivial.throwIf" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">bool -&gt; string -&gt; a -&gt; a</code></p><p>Like throwIfNot, but negated (throw if the first argument is <code class="literal">true</code>).</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">cond</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">msg</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/trivial.nix#L393" target="_top">lib/trivial.nix:393</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.trivial.checkListOfEnum" class="title"><code class="literal">lib.trivial.checkListOfEnum</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.trivial.checkListOfEnum" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">String -&gt; List ComparableVal -&gt; List ComparableVal -&gt; a -&gt; a</code></p><p>Check if the elements in a list are valid values from a enum, returning the identity function, or throwing an error message otherwise.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">msg</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">valid</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">given</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.trivial.checkListOfEnum"></span><p class="title"><strong>Example&nbsp;126.&nbsp;<code class="literal">lib.trivial.checkListOfEnum</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">let</span> <span class="hljs-attr">colorVariants</span> = [<span class="hljs-string">"bright"</span> <span class="hljs-string">"dark"</span> <span class="hljs-string">"black"</span>]
<span class="hljs-keyword">in</span> checkListOfEnum <span class="hljs-string">"color variants"</span> [ <span class="hljs-string">"standard"</span> <span class="hljs-string">"light"</span> <span class="hljs-string">"dark"</span> ] colorVariants;
=&gt;
error: color variants: bright, black unexpected; valid ones: standard, light, dark
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/trivial.nix#L405" target="_top">lib/trivial.nix:405</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.trivial.setFunctionArgs" class="title"><code class="literal">lib.trivial.setFunctionArgs</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.trivial.setFunctionArgs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Add metadata about expected function arguments to a function.
The metadata should match the format given by
builtins.functionArgs, i.e. a set from expected argument to a bool
representing whether that argument has a default or not.
setFunctionArgs : (a → b) → Map String Bool → (a → b)</p><p>This function is necessary because you can’t dynamically create a
function of the { a, b ? foo, … }: format, but some facilities
like callPackage expect to be able to query expected arguments.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">f</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">args</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/trivial.nix#L428" target="_top">lib/trivial.nix:428</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.trivial.functionArgs" class="title"><code class="literal">lib.trivial.functionArgs</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.trivial.functionArgs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Extract the expected function arguments from a function.
This works both with nix-native { a, b ? foo, … }: style
functions and functions with args set with ‘setFunctionArgs’. It
has the same return type and semantics as builtins.functionArgs.
setFunctionArgs : (a → b) → Map String Bool.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">f</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/trivial.nix#L440" target="_top">lib/trivial.nix:440</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.trivial.isFunction" class="title"><code class="literal">lib.trivial.isFunction</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.trivial.isFunction" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Check whether something is a function or something
annotated with function args.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">f</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/trivial.nix#L448" target="_top">lib/trivial.nix:448</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.trivial.mirrorFunctionArgs" class="title"><code class="literal">lib.trivial.mirrorFunctionArgs</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.trivial.mirrorFunctionArgs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">mirrorFunctionArgs :: (a -&gt; b) -&gt; (a -&gt; c) -&gt; (a -&gt; c)</code></p><p><code class="literal">mirrorFunctionArgs f g</code> creates a new function <code class="literal">g'</code> with the same behavior as <code class="literal">g</code> (<code class="literal">g' x == g x</code>)
but its function arguments mirroring <code class="literal">f</code> (<code class="literal">lib.functionArgs g' == lib.functionArgs f</code>).</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">f</code></span></dt><dd><p>Function to provide the argument metadata</p></dd></dl></div><div class="example"><span id="function-library-example-lib.trivial.mirrorFunctionArgs"></span><p class="title"><strong>Example&nbsp;127.&nbsp;<code class="literal">lib.trivial.mirrorFunctionArgs</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">addab</span> = {a, b}: a + b
addab { <span class="hljs-attr">a</span> = <span class="hljs-number">2</span>; <span class="hljs-attr">b</span> = <span class="hljs-number">4</span>; }
=&gt; <span class="hljs-number">6</span>
lib.functionArgs <span class="hljs-attr">addab</span>
=&gt; { <span class="hljs-attr">a</span> = <span class="hljs-literal">false</span>; <span class="hljs-attr">b</span> = <span class="hljs-literal">false</span>; }
<span class="hljs-attr">addab1</span> = attrs: addab attrs + <span class="hljs-number">1</span>
addab1 { <span class="hljs-attr">a</span> = <span class="hljs-number">2</span>; <span class="hljs-attr">b</span> = <span class="hljs-number">4</span>; }
=&gt; <span class="hljs-number">7</span>
lib.functionArgs <span class="hljs-attr">addab1</span>
=&gt; { }
addab1' = lib.mirrorFunctionArgs addab addab1
addab1' { <span class="hljs-attr">a</span> = <span class="hljs-number">2</span>; <span class="hljs-attr">b</span> = <span class="hljs-number">4</span>; }
=&gt; <span class="hljs-number">7</span>
lib.functionArgs addab1'
=&gt; { <span class="hljs-attr">a</span> = <span class="hljs-literal">false</span>; <span class="hljs-attr">b</span> = <span class="hljs-literal">false</span>; }
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/trivial.nix#L475" target="_top">lib/trivial.nix:475</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.trivial.toFunction" class="title"><code class="literal">lib.trivial.toFunction</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.trivial.toFunction" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Turns any non-callable values into constant functions.
Returns callable values as is.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">v</code></span></dt><dd><p>Any value</p></dd></dl></div><div class="example"><span id="function-library-example-lib.trivial.toFunction"></span><p class="title"><strong>Example&nbsp;128.&nbsp;<code class="literal">lib.trivial.toFunction</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">nix-repl&gt; lib.toFunction <span class="hljs-number">1</span> <span class="hljs-number">2</span>
<span class="hljs-number">1</span>

nix-repl&gt; lib.toFunction (x: x + <span class="hljs-number">1</span>) <span class="hljs-number">2</span>
<span class="hljs-number">3</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/trivial.nix#L497" target="_top">lib/trivial.nix:497</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.trivial.toHexString" class="title"><code class="literal">lib.trivial.toHexString</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.trivial.toHexString" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Convert the given positive integer to a string of its hexadecimal
representation. For example:</p><p>toHexString 0 =&gt; “0”</p><p>toHexString 16 =&gt; “10”</p><p>toHexString 250 =&gt; “FA”</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">i</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/trivial.nix#L513" target="_top">lib/trivial.nix:513</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.trivial.toBaseDigits" class="title"><code class="literal">lib.trivial.toBaseDigits</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.trivial.toBaseDigits" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><code class="literal">toBaseDigits base i</code> converts the positive integer i to a list of its
digits in the given base. For example:</p><p>toBaseDigits 10 123 =&gt; [ 1 2 3 ]</p><p>toBaseDigits 2 6 =&gt; [ 1 1 0 ]</p><p>toBaseDigits 16 250 =&gt; [ 15 10 ]</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">base</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">i</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/trivial.nix#L539" target="_top">lib/trivial.nix:539</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-functions-library-fixedPoints" class="title">lib.fixedPoints: explicit recursion functions   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-functions-library-fixedPoints" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.fixedPoints.fix" class="title"><code class="literal">lib.fixedPoints.fix</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fixedPoints.fix" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">fix :: (a -&gt; a) -&gt; a</code></p><p><code class="literal">fix f</code> computes the fixed point of the given function <code class="literal">f</code>. In other words, the return value is <code class="literal">x</code> in <code class="literal">x = f x</code>.</p><p><code class="literal">f</code> must be a lazy function.
This means that <code class="literal">x</code> must be a value that can be partially evaluated,
such as an attribute set, a list, or a function.
This way, <code class="literal">f</code> can use one part of <code class="literal">x</code> to compute another part.</p><p><span class="strong"><strong>Relation to syntactic recursion</strong></span></p><p>This section explains <code class="literal">fix</code> by refactoring from syntactic recursion to a call of <code class="literal">fix</code> instead.</p><p>For context, Nix lets you define attributes in terms of other attributes syntactically using the <a class="link" href="https://nixos.org/manual/nix/stable/language/constructs#recursive-sets" target="_top"><code class="literal">rec { }</code> syntax</a>.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">nix-repl&gt; <span class="hljs-keyword">rec</span> {
  <span class="hljs-attr">foo</span> = <span class="hljs-string">"foo"</span>;
  <span class="hljs-attr">bar</span> = <span class="hljs-string">"bar"</span>;
  <span class="hljs-attr">foobar</span> = foo + bar;
}
{ <span class="hljs-attr">bar</span> = <span class="hljs-string">"bar"</span>; <span class="hljs-attr">foo</span> = <span class="hljs-string">"foo"</span>; <span class="hljs-attr">foobar</span> = <span class="hljs-string">"foobar"</span>; }
</code></pre><p>This is convenient when constructing a value to pass to a function for example,
but an equivalent effect can be achieved with the <code class="literal">let</code> binding syntax:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">nix-repl&gt; <span class="hljs-keyword">let</span> <span class="hljs-attr">self</span> = {
  <span class="hljs-attr">foo</span> = <span class="hljs-string">"foo"</span>;
  <span class="hljs-attr">bar</span> = <span class="hljs-string">"bar"</span>;
  <span class="hljs-attr">foobar</span> = self.foo + self.bar;
}; <span class="hljs-keyword">in</span> self
{ <span class="hljs-attr">bar</span> = <span class="hljs-string">"bar"</span>; <span class="hljs-attr">foo</span> = <span class="hljs-string">"foo"</span>; <span class="hljs-attr">foobar</span> = <span class="hljs-string">"foobar"</span>; }
</code></pre><p>But in general you can get more reuse out of <code class="literal">let</code> bindings by refactoring them to a function.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">nix-repl&gt; <span class="hljs-attr">f</span> = self: {
  <span class="hljs-attr">foo</span> = <span class="hljs-string">"foo"</span>;
  <span class="hljs-attr">bar</span> = <span class="hljs-string">"bar"</span>;
  <span class="hljs-attr">foobar</span> = self.foo + self.bar;
}
</code></pre><p>This is where <code class="literal">fix</code> comes in, it contains the syntactic recursion that’s not in <code class="literal">f</code> anymore.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">nix-repl&gt; <span class="hljs-attr">fix</span> = f:
  <span class="hljs-keyword">let</span> <span class="hljs-attr">self</span> = f self; <span class="hljs-keyword">in</span> self;
</code></pre><p>By applying <code class="literal">fix</code> we get the final result.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">nix-repl&gt; fix f
{ <span class="hljs-attr">bar</span> = <span class="hljs-string">"bar"</span>; <span class="hljs-attr">foo</span> = <span class="hljs-string">"foo"</span>; <span class="hljs-attr">foobar</span> = <span class="hljs-string">"foobar"</span>; }
</code></pre><p>Such a refactored <code class="literal">f</code> using <code class="literal">fix</code> is not useful by itself.
See <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fixedPoints.extends" title="lib.fixedPoints.extends"><code class="literal">extends</code></a> for an example use case.
There <code class="literal">self</code> is also often called <code class="literal">final</code>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">f</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.fixedPoints.fix"></span><p class="title"><strong>Example&nbsp;129.&nbsp;<code class="literal">lib.fixedPoints.fix</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">fix (self: { <span class="hljs-attr">foo</span> = <span class="hljs-string">"foo"</span>; <span class="hljs-attr">bar</span> = <span class="hljs-string">"bar"</span>; <span class="hljs-attr">foobar</span> = self.foo + self.bar; })
=&gt; { <span class="hljs-attr">bar</span> = <span class="hljs-string">"bar"</span>; <span class="hljs-attr">foo</span> = <span class="hljs-string">"foo"</span>; <span class="hljs-attr">foobar</span> = <span class="hljs-string">"foobar"</span>; }

fix (self: [ <span class="hljs-number">1</span> <span class="hljs-number">2</span> (elemAt self <span class="hljs-number">0</span> + elemAt self <span class="hljs-number">1</span>) ])
=&gt; [ <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> ]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/fixed-points.nix#L75" target="_top">lib/fixed-points.nix:75</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.fixedPoints.fix-prime" class="title"><code class="literal">lib.fixedPoints.fix'</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fixedPoints.fix-prime" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>A variant of <code class="literal">fix</code> that records the original recursive attribute set in the
result, in an attribute named <code class="literal">__unfix__</code>.</p><p>This is useful in combination with the <code class="literal">extends</code> function to
implement deep overriding.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">f</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/fixed-points.nix#L84" target="_top">lib/fixed-points.nix:84</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.fixedPoints.converge" class="title"><code class="literal">lib.fixedPoints.converge</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fixedPoints.converge" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">(a -&gt; a) -&gt; a -&gt; a</code></p><p>Return the fixpoint that <code class="literal">f</code> converges to when called iteratively, starting
with the input <code class="literal">x</code>.</p><pre><code class="programlisting hljs language-shell" data-highlighted="yes"><span class="hljs-meta prompt_">nix-repl&gt; </span><span class="language-bash">converge (x: x / 2) 16</span>
0
</code></pre><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">f</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">x</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/fixed-points.nix#L97" target="_top">lib/fixed-points.nix:97</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.fixedPoints.extends" class="title"><code class="literal">lib.fixedPoints.extends</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fixedPoints.extends" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Modify the contents of an explicitly recursive attribute set in a way that
honors <code class="literal">self</code>-references. This is accomplished with a function</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">g</span> = self: super: { <span class="hljs-attr">foo</span> = super.foo + <span class="hljs-string">" + "</span>; }
</code></pre><p>that has access to the unmodified input (<code class="literal">super</code>) as well as the final
non-recursive representation of the attribute set (<code class="literal">self</code>). <code class="literal">extends</code>
differs from the native <code class="literal">//</code> operator insofar as that it’s applied <span class="emphasis"><em>before</em></span>
references to <code class="literal">self</code> are resolved:</p><pre><code class="programlisting hljs language-nix" data-highlighted="yes">nix-repl&gt; fix (extends g f)
{ <span class="hljs-attr">bar</span> = <span class="hljs-string">"bar"</span>; <span class="hljs-attr">foo</span> = <span class="hljs-string">"foo + "</span>; <span class="hljs-attr">foobar</span> = <span class="hljs-string">"foo + bar"</span>; }
</code></pre><p>The name of the function is inspired by object-oriented inheritance, i.e.
think of it as an infix operator <code class="literal">g extends f</code> that mimics the syntax from
Java. It may seem counter-intuitive to have the “base class” as the second
argument, but it’s nice this way if several uses of <code class="literal">extends</code> are cascaded.</p><p>To get a better understanding how <code class="literal">extends</code> turns a function with a fix
point (the package set we start with) into a new function with a different fix
point (the desired packages set) lets just see, how <code class="literal">extends g f</code>
unfolds with <code class="literal">g</code> and <code class="literal">f</code> defined above:</p><pre><code class="programlisting hljs language-nix" data-highlighted="yes">extends g <span class="hljs-attr">f</span> = self: <span class="hljs-keyword">let</span> <span class="hljs-attr">super</span> = f self; <span class="hljs-keyword">in</span> super // g self super;
            = self: <span class="hljs-keyword">let</span> <span class="hljs-attr">super</span> = { <span class="hljs-attr">foo</span> = <span class="hljs-string">"foo"</span>; <span class="hljs-attr">bar</span> = <span class="hljs-string">"bar"</span>; <span class="hljs-attr">foobar</span> = self.foo + self.bar; }; <span class="hljs-keyword">in</span> super // g self <span class="hljs-attr">super</span>
            = self: { <span class="hljs-attr">foo</span> = <span class="hljs-string">"foo"</span>; <span class="hljs-attr">bar</span> = <span class="hljs-string">"bar"</span>; <span class="hljs-attr">foobar</span> = self.foo + self.bar; } // g self { <span class="hljs-attr">foo</span> = <span class="hljs-string">"foo"</span>; <span class="hljs-attr">bar</span> = <span class="hljs-string">"bar"</span>; <span class="hljs-attr">foobar</span> = self.foo + self.bar; }
            = self: { <span class="hljs-attr">foo</span> = <span class="hljs-string">"foo"</span>; <span class="hljs-attr">bar</span> = <span class="hljs-string">"bar"</span>; <span class="hljs-attr">foobar</span> = self.foo + self.bar; } // { <span class="hljs-attr">foo</span> = <span class="hljs-string">"foo"</span> + <span class="hljs-string">" + "</span>; }
            = self: { <span class="hljs-attr">foo</span> = <span class="hljs-string">"foo + "</span>; <span class="hljs-attr">bar</span> = <span class="hljs-string">"bar"</span>; <span class="hljs-attr">foobar</span> = self.foo + self.bar; }
</code></pre><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">f</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">rattrs</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">self</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/fixed-points.nix#L141" target="_top">lib/fixed-points.nix:141</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.fixedPoints.composeExtensions" class="title"><code class="literal">lib.fixedPoints.composeExtensions</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fixedPoints.composeExtensions" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Compose two extending functions of the type expected by ‘extends’
into one where changes made in the first are available in the
‘super’ of the second</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">f</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">g</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">final</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">prev</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/fixed-points.nix#L148" target="_top">lib/fixed-points.nix:148</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.fixedPoints.composeManyExtensions" class="title"><code class="literal">lib.fixedPoints.composeManyExtensions</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fixedPoints.composeManyExtensions" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Compose several extending functions of the type expected by ‘extends’ into
one where changes made in preceding functions are made available to
subsequent ones.</p><pre><code class="programlisting hljs language-undefined" data-highlighted="yes">composeManyExtensions : [packageSet -&gt; packageSet -&gt; packageSet] -&gt; packageSet -&gt; packageSet -&gt; packageSet
                          ^final        ^prev         ^overrides     ^final        ^prev         ^overrides
</code></pre><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/fixed-points.nix#L164" target="_top">lib/fixed-points.nix:164</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.fixedPoints.makeExtensible" class="title"><code class="literal">lib.fixedPoints.makeExtensible</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fixedPoints.makeExtensible" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Create an overridable, recursive attribute set. For example:</p><pre><code class="programlisting hljs language-nix" data-highlighted="yes">nix-repl&gt; <span class="hljs-attr">obj</span> = makeExtensible (self: { })

nix-repl&gt; obj
{ <span class="hljs-attr">__unfix__</span> = «lambda»; <span class="hljs-attr">extend</span> = «lambda»; }

nix-repl&gt; <span class="hljs-attr">obj</span> = obj.extend (self: super: { <span class="hljs-attr">foo</span> = <span class="hljs-string">"foo"</span>; })

nix-repl&gt; obj
{ <span class="hljs-attr">__unfix__</span> = «lambda»; <span class="hljs-attr">extend</span> = «lambda»; <span class="hljs-attr">foo</span> = <span class="hljs-string">"foo"</span>; }

nix-repl&gt; <span class="hljs-attr">obj</span> = obj.extend (self: super: { <span class="hljs-attr">foo</span> = super.foo + <span class="hljs-string">" + "</span>; <span class="hljs-attr">bar</span> = <span class="hljs-string">"bar"</span>; <span class="hljs-attr">foobar</span> = self.foo + self.bar; })

nix-repl&gt; obj
{ <span class="hljs-attr">__unfix__</span> = «lambda»; <span class="hljs-attr">bar</span> = <span class="hljs-string">"bar"</span>; <span class="hljs-attr">extend</span> = «lambda»; <span class="hljs-attr">foo</span> = <span class="hljs-string">"foo + "</span>; <span class="hljs-attr">foobar</span> = <span class="hljs-string">"foo + bar"</span>; }
</code></pre><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/fixed-points.nix#L187" target="_top">lib/fixed-points.nix:187</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.fixedPoints.makeExtensibleWithCustomName" class="title"><code class="literal">lib.fixedPoints.makeExtensibleWithCustomName</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fixedPoints.makeExtensibleWithCustomName" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Same as <code class="literal">makeExtensible</code> but the name of the extending attribute is
customized.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">extenderName</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">rattrs</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/fixed-points.nix#L193" target="_top">lib/fixed-points.nix:193</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-functions-library-lists" class="title">lib.lists: list manipulation functions   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-functions-library-lists" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>General list operations.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.lists.singleton" class="title"><code class="literal">lib.lists.singleton</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.singleton" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">singleton :: a -&gt; [a]</code></p><p>Create a list consisting of a single element.  <code class="literal">singleton x</code> is
sometimes more convenient with respect to indentation than <code class="literal">[x]</code>
when x spans multiple lines.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">x</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.lists.singleton"></span><p class="title"><strong>Example&nbsp;130.&nbsp;<code class="literal">lib.lists.singleton</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">singleton <span class="hljs-string">"foo"</span>
=&gt; [ <span class="hljs-string">"foo"</span> ]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/lists.nix#L23" target="_top">lib/lists.nix:23</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.lists.forEach" class="title"><code class="literal">lib.lists.forEach</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.forEach" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">forEach :: [a] -&gt; (a -&gt; b) -&gt; [b]</code></p><p>Apply the function to each element in the list. Same as <code class="literal">map</code>, but arguments
flipped.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">xs</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">f</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.lists.forEach"></span><p class="title"><strong>Example&nbsp;131.&nbsp;<code class="literal">lib.lists.forEach</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">forEach [ <span class="hljs-number">1</span> <span class="hljs-number">2</span> ] (x:
  <span class="hljs-built_in">toString</span> x
)
=&gt; [ <span class="hljs-string">"1"</span> <span class="hljs-string">"2"</span> ]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/lists.nix#L36" target="_top">lib/lists.nix:36</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.lists.foldr" class="title"><code class="literal">lib.lists.foldr</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.foldr" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">foldr :: (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b</code></p><p>“right fold” a binary function <code class="literal">op</code> between successive elements of
<code class="literal">list</code> with <code class="literal">nul</code> as the starting value, i.e.,
<code class="literal">foldr op nul [x_1 x_2 ... x_n] == op x_1 (op x_2 ... (op x_n nul))</code>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">op</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">nul</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">list</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.lists.foldr"></span><p class="title"><strong>Example&nbsp;132.&nbsp;<code class="literal">lib.lists.foldr</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">concat</span> = foldr (a: b: a + b) <span class="hljs-string">"z"</span>
concat [ <span class="hljs-string">"a"</span> <span class="hljs-string">"b"</span> <span class="hljs-string">"c"</span> ]
=&gt; <span class="hljs-string">"abcz"</span>
<span class="hljs-comment"># different types</span>
<span class="hljs-attr">strange</span> = foldr (int: str: <span class="hljs-built_in">toString</span> (int + <span class="hljs-number">1</span>) + str) <span class="hljs-string">"a"</span>
strange [ <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> ]
=&gt; <span class="hljs-string">"2345a"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/lists.nix#L53" target="_top">lib/lists.nix:53</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.lists.fold" class="title"><code class="literal">lib.lists.fold</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.fold" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><code class="literal">fold</code> is an alias of <code class="literal">foldr</code> for historic reasons</p><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/lists.nix#L64" target="_top">lib/lists.nix:64</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.lists.foldl" class="title"><code class="literal">lib.lists.foldl</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.foldl" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">foldl :: (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b</code></p><p>“left fold”, like <code class="literal">foldr</code>, but from the left:
<code class="literal">foldl op nul [x_1 x_2 ... x_n] == op (... (op (op nul x_1) x_2) ... x_n)</code>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">op</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">nul</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">list</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.lists.foldl"></span><p class="title"><strong>Example&nbsp;133.&nbsp;<code class="literal">lib.lists.foldl</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">lconcat</span> = foldl (a: b: a + b) <span class="hljs-string">"z"</span>
lconcat [ <span class="hljs-string">"a"</span> <span class="hljs-string">"b"</span> <span class="hljs-string">"c"</span> ]
=&gt; <span class="hljs-string">"zabc"</span>
<span class="hljs-comment"># different types</span>
<span class="hljs-attr">lstrange</span> = foldl (str: int: str + <span class="hljs-built_in">toString</span> (int + <span class="hljs-number">1</span>)) <span class="hljs-string">"a"</span>
lstrange [ <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> ]
=&gt; <span class="hljs-string">"a2345"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/lists.nix#L81" target="_top">lib/lists.nix:81</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.lists.foldl-prime" class="title"><code class="literal">lib.lists.foldl'</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.foldl-prime" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">foldl' :: (acc -&gt; x -&gt; acc) -&gt; acc -&gt; [x] -&gt; acc</code></p><p>Reduce a list by applying a binary operator from left to right,
starting with an initial accumulator.</p><p>Before each application of the operator, the accumulator value is evaluated.
This behavior makes this function stricter than <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.foldl" title="lib.lists.foldl"><code class="literal">foldl</code></a>.</p><p>Unlike <a class="link" href="https://nixos.org/manual/nix/unstable/language/builtins.html#builtins-foldl&#39;" target="_top"><code class="literal">builtins.foldl'</code></a>,
the initial accumulator argument is evaluated before the first iteration.</p><p>A call like</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">foldl' op acc₀ [ x₀ x₁ x₂ ... xₙ₋₁ xₙ ]
</code></pre><p>is (denotationally) equivalent to the following,
but with the added benefit that <code class="literal">foldl'</code> itself will never overflow the stack.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">let</span>
  acc₁   = <span class="hljs-built_in">builtins</span>.seq acc₀   (op acc₀   x₀  );
  acc₂   = <span class="hljs-built_in">builtins</span>.seq acc₁   (op acc₁   x₁  );
  acc₃   = <span class="hljs-built_in">builtins</span>.seq acc₂   (op acc₂   x₂  );
  ...
  accₙ   = <span class="hljs-built_in">builtins</span>.seq accₙ₋₁ (op accₙ₋₁ xₙ₋₁);
  accₙ₊₁ = <span class="hljs-built_in">builtins</span>.seq accₙ   (op accₙ   xₙ  );
<span class="hljs-keyword">in</span>
accₙ₊₁

<span class="hljs-comment"># Or ignoring builtins.seq</span>
op (op (... (op (op (op acc₀ x₀) x₁) x₂) ...) xₙ₋₁) xₙ
</code></pre><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">op</code></span></dt><dd><p>The binary operation to run, where the two arguments are:</p><div class="orderedlist"><ol class="orderedlist compact" type="1"><li class="listitem"><p><code class="literal">acc</code>: The current accumulator value: Either the initial one for the first iteration, or the result of the previous iteration</p></li><li class="listitem"><p><code class="literal">x</code>: The corresponding list element for this iteration</p></li></ol></div></dd><dt><span class="term"><code class="literal">acc</code></span></dt><dd><p>The initial accumulator value</p></dd><dt><span class="term"><code class="literal">list</code></span></dt><dd><p>The list to fold</p></dd></dl></div><div class="example"><span id="function-library-example-lib.lists.foldl-prime"></span><p class="title"><strong>Example&nbsp;134.&nbsp;<code class="literal">lib.lists.foldl'</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">foldl' (acc: x: acc + x) <span class="hljs-number">0</span> [<span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span>]
=&gt; <span class="hljs-number">6</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/lists.nix#L129" target="_top">lib/lists.nix:129</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.lists.imap0" class="title"><code class="literal">lib.lists.imap0</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.imap0" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">imap0 :: (int -&gt; a -&gt; b) -&gt; [a] -&gt; [b]</code></p><p>Map with index starting from 0</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">f</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">list</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.lists.imap0"></span><p class="title"><strong>Example&nbsp;135.&nbsp;<code class="literal">lib.lists.imap0</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">imap0 (i: v: <span class="hljs-string">"<span class="hljs-subst">${v}</span>-<span class="hljs-subst">${<span class="hljs-built_in">toString</span> i}</span>"</span>) [<span class="hljs-string">"a"</span> <span class="hljs-string">"b"</span>]
=&gt; [ <span class="hljs-string">"a-0"</span> <span class="hljs-string">"b-1"</span> ]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/lists.nix#L155" target="_top">lib/lists.nix:155</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.lists.imap1" class="title"><code class="literal">lib.lists.imap1</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.imap1" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">imap1 :: (int -&gt; a -&gt; b) -&gt; [a] -&gt; [b]</code></p><p>Map with index starting from 1</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">f</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">list</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.lists.imap1"></span><p class="title"><strong>Example&nbsp;136.&nbsp;<code class="literal">lib.lists.imap1</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">imap1 (i: v: <span class="hljs-string">"<span class="hljs-subst">${v}</span>-<span class="hljs-subst">${<span class="hljs-built_in">toString</span> i}</span>"</span>) [<span class="hljs-string">"a"</span> <span class="hljs-string">"b"</span>]
=&gt; [ <span class="hljs-string">"a-1"</span> <span class="hljs-string">"b-2"</span> ]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/lists.nix#L165" target="_top">lib/lists.nix:165</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.lists.concatMap" class="title"><code class="literal">lib.lists.concatMap</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.concatMap" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">concatMap :: (a -&gt; [b]) -&gt; [a] -&gt; [b]</code></p><p>Map and concatenate the result.</p><div class="example"><span id="function-library-example-lib.lists.concatMap"></span><p class="title"><strong>Example&nbsp;137.&nbsp;<code class="literal">lib.lists.concatMap</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">concatMap (x: [x] ++ [<span class="hljs-string">"z"</span>]) [<span class="hljs-string">"a"</span> <span class="hljs-string">"b"</span>]
=&gt; [ <span class="hljs-string">"a"</span> <span class="hljs-string">"z"</span> <span class="hljs-string">"b"</span> <span class="hljs-string">"z"</span> ]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/lists.nix#L175" target="_top">lib/lists.nix:175</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.lists.flatten" class="title"><code class="literal">lib.lists.flatten</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.flatten" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Flatten the argument into a single list; that is, nested lists are
spliced into the top-level lists.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">x</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.lists.flatten"></span><p class="title"><strong>Example&nbsp;138.&nbsp;<code class="literal">lib.lists.flatten</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">flatten [<span class="hljs-number">1</span> [<span class="hljs-number">2</span> [<span class="hljs-number">3</span>] <span class="hljs-number">4</span>] <span class="hljs-number">5</span>]
=&gt; [<span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span>]
flatten <span class="hljs-number">1</span>
=&gt; [<span class="hljs-number">1</span>]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/lists.nix#L186" target="_top">lib/lists.nix:186</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.lists.remove" class="title"><code class="literal">lib.lists.remove</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.remove" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">remove :: a -&gt; [a] -&gt; [a]</code></p><p>Remove elements equal to ‘e’ from a list.  Useful for buildInputs.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">e</code></span></dt><dd><p>Element to remove from the list</p></dd></dl></div><div class="example"><span id="function-library-example-lib.lists.remove"></span><p class="title"><strong>Example&nbsp;139.&nbsp;<code class="literal">lib.lists.remove</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">remove <span class="hljs-number">3</span> [ <span class="hljs-number">1</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">3</span> ]
=&gt; [ <span class="hljs-number">1</span> <span class="hljs-number">4</span> ]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/lists.nix#L199" target="_top">lib/lists.nix:199</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.lists.findSingle" class="title"><code class="literal">lib.lists.findSingle</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.findSingle" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">findSingle :: (a -&gt; bool) -&gt; a -&gt; a -&gt; [a] -&gt; a</code></p><p>Find the sole element in the list matching the specified
predicate, returns <code class="literal">default</code> if no such element exists, or
<code class="literal">multiple</code> if there are multiple matching elements.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">pred</code></span></dt><dd><p>Predicate</p></dd><dt><span class="term"><code class="literal">default</code></span></dt><dd><p>Default value to return if element was not found.</p></dd><dt><span class="term"><code class="literal">multiple</code></span></dt><dd><p>Default value to return if more than one element was found</p></dd><dt><span class="term"><code class="literal">list</code></span></dt><dd><p>Input list</p></dd></dl></div><div class="example"><span id="function-library-example-lib.lists.findSingle"></span><p class="title"><strong>Example&nbsp;140.&nbsp;<code class="literal">lib.lists.findSingle</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">findSingle (x: <span class="hljs-attr">x</span> == <span class="hljs-number">3</span>) <span class="hljs-string">"none"</span> <span class="hljs-string">"multiple"</span> [ <span class="hljs-number">1</span> <span class="hljs-number">3</span> <span class="hljs-number">3</span> ]
=&gt; <span class="hljs-string">"multiple"</span>
findSingle (x: <span class="hljs-attr">x</span> == <span class="hljs-number">3</span>) <span class="hljs-string">"none"</span> <span class="hljs-string">"multiple"</span> [ <span class="hljs-number">1</span> <span class="hljs-number">3</span> ]
=&gt; <span class="hljs-number">3</span>
findSingle (x: <span class="hljs-attr">x</span> == <span class="hljs-number">3</span>) <span class="hljs-string">"none"</span> <span class="hljs-string">"multiple"</span> [ <span class="hljs-number">1</span> <span class="hljs-number">9</span> ]
=&gt; <span class="hljs-string">"none"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/lists.nix#L217" target="_top">lib/lists.nix:217</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.lists.findFirstIndex" class="title"><code class="literal">lib.lists.findFirstIndex</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.findFirstIndex" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">findFirstIndex :: (a -&gt; Bool) -&gt; b -&gt; [a] -&gt; (Int | b)</code></p><p>Find the first index in the list matching the specified
predicate or return <code class="literal">default</code> if no such element exists.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">pred</code></span></dt><dd><p>Predicate</p></dd><dt><span class="term"><code class="literal">default</code></span></dt><dd><p>Default value to return</p></dd><dt><span class="term"><code class="literal">list</code></span></dt><dd><p>Input list</p></dd></dl></div><div class="example"><span id="function-library-example-lib.lists.findFirstIndex"></span><p class="title"><strong>Example&nbsp;141.&nbsp;<code class="literal">lib.lists.findFirstIndex</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">findFirstIndex (x: x &gt; <span class="hljs-number">3</span>) <span class="hljs-literal">null</span> [ <span class="hljs-number">0</span> <span class="hljs-number">6</span> <span class="hljs-number">4</span> ]
=&gt; <span class="hljs-number">1</span>
findFirstIndex (x: x &gt; <span class="hljs-number">9</span>) <span class="hljs-literal">null</span> [ <span class="hljs-number">0</span> <span class="hljs-number">6</span> <span class="hljs-number">4</span> ]
=&gt; <span class="hljs-literal">null</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/lists.nix#L242" target="_top">lib/lists.nix:242</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.lists.findFirst" class="title"><code class="literal">lib.lists.findFirst</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.findFirst" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">findFirst :: (a -&gt; bool) -&gt; a -&gt; [a] -&gt; a</code></p><p>Find the first element in the list matching the specified
predicate or return <code class="literal">default</code> if no such element exists.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">pred</code></span></dt><dd><p>Predicate</p></dd><dt><span class="term"><code class="literal">default</code></span></dt><dd><p>Default value to return</p></dd><dt><span class="term"><code class="literal">list</code></span></dt><dd><p>Input list</p></dd></dl></div><div class="example"><span id="function-library-example-lib.lists.findFirst"></span><p class="title"><strong>Example&nbsp;142.&nbsp;<code class="literal">lib.lists.findFirst</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">findFirst (x: x &gt; <span class="hljs-number">3</span>) <span class="hljs-number">7</span> [ <span class="hljs-number">1</span> <span class="hljs-number">6</span> <span class="hljs-number">4</span> ]
=&gt; <span class="hljs-number">6</span>
findFirst (x: x &gt; <span class="hljs-number">9</span>) <span class="hljs-number">7</span> [ <span class="hljs-number">1</span> <span class="hljs-number">6</span> <span class="hljs-number">4</span> ]
=&gt; <span class="hljs-number">7</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/lists.nix#L293" target="_top">lib/lists.nix:293</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.lists.any" class="title"><code class="literal">lib.lists.any</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.any" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">any :: (a -&gt; bool) -&gt; [a] -&gt; bool</code></p><p>Return true if function <code class="literal">pred</code> returns true for at least one
element of <code class="literal">list</code>.</p><div class="example"><span id="function-library-example-lib.lists.any"></span><p class="title"><strong>Example&nbsp;143.&nbsp;<code class="literal">lib.lists.any</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">any isString [ <span class="hljs-number">1</span> <span class="hljs-string">"a"</span> { } ]
=&gt; <span class="hljs-literal">true</span>
any isString [ <span class="hljs-number">1</span> { } ]
=&gt; <span class="hljs-literal">false</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/lists.nix#L319" target="_top">lib/lists.nix:319</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.lists.all" class="title"><code class="literal">lib.lists.all</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.all" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">all :: (a -&gt; bool) -&gt; [a] -&gt; bool</code></p><p>Return true if function <code class="literal">pred</code> returns true for all elements of
<code class="literal">list</code>.</p><div class="example"><span id="function-library-example-lib.lists.all"></span><p class="title"><strong>Example&nbsp;144.&nbsp;<code class="literal">lib.lists.all</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">all (x: x &lt; <span class="hljs-number">3</span>) [ <span class="hljs-number">1</span> <span class="hljs-number">2</span> ]
=&gt; <span class="hljs-literal">true</span>
all (x: x &lt; <span class="hljs-number">3</span>) [ <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> ]
=&gt; <span class="hljs-literal">false</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/lists.nix#L332" target="_top">lib/lists.nix:332</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.lists.count" class="title"><code class="literal">lib.lists.count</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.count" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">count :: (a -&gt; bool) -&gt; [a] -&gt; int</code></p><p>Count how many elements of <code class="literal">list</code> match the supplied predicate
function.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">pred</code></span></dt><dd><p>Predicate</p></dd></dl></div><div class="example"><span id="function-library-example-lib.lists.count"></span><p class="title"><strong>Example&nbsp;145.&nbsp;<code class="literal">lib.lists.count</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">count (x: <span class="hljs-attr">x</span> == <span class="hljs-number">3</span>) [ <span class="hljs-number">3</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">6</span> ]
=&gt; <span class="hljs-number">2</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/lists.nix#L343" target="_top">lib/lists.nix:343</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.lists.optional" class="title"><code class="literal">lib.lists.optional</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.optional" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">optional :: bool -&gt; a -&gt; [a]</code></p><p>Return a singleton list or an empty list, depending on a boolean
value.  Useful when building lists with optional elements
(e.g. <code class="literal">++ optional (system == "i686-linux") firefox</code>).</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">cond</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">elem</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.lists.optional"></span><p class="title"><strong>Example&nbsp;146.&nbsp;<code class="literal">lib.lists.optional</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">optional <span class="hljs-literal">true</span> <span class="hljs-string">"foo"</span>
=&gt; [ <span class="hljs-string">"foo"</span> ]
optional <span class="hljs-literal">false</span> <span class="hljs-string">"foo"</span>
=&gt; [ ]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/lists.nix#L359" target="_top">lib/lists.nix:359</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.lists.optionals" class="title"><code class="literal">lib.lists.optionals</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.optionals" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">optionals :: bool -&gt; [a] -&gt; [a]</code></p><p>Return a list or an empty list, depending on a boolean value.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">cond</code></span></dt><dd><p>Condition</p></dd><dt><span class="term"><code class="literal">elems</code></span></dt><dd><p>List to return if condition is true</p></dd></dl></div><div class="example"><span id="function-library-example-lib.lists.optionals"></span><p class="title"><strong>Example&nbsp;147.&nbsp;<code class="literal">lib.lists.optionals</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">optionals <span class="hljs-literal">true</span> [ <span class="hljs-number">2</span> <span class="hljs-number">3</span> ]
=&gt; [ <span class="hljs-number">2</span> <span class="hljs-number">3</span> ]
optionals <span class="hljs-literal">false</span> [ <span class="hljs-number">2</span> <span class="hljs-number">3</span> ]
=&gt; [ ]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/lists.nix#L371" target="_top">lib/lists.nix:371</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.lists.toList" class="title"><code class="literal">lib.lists.toList</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.toList" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>If argument is a list, return it; else, wrap it in a singleton
list.  If you’re using this, you should almost certainly
reconsider if there isn’t a more “well-typed” approach.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">x</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.lists.toList"></span><p class="title"><strong>Example&nbsp;148.&nbsp;<code class="literal">lib.lists.toList</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">toList [ <span class="hljs-number">1</span> <span class="hljs-number">2</span> ]
=&gt; [ <span class="hljs-number">1</span> <span class="hljs-number">2</span> ]
toList <span class="hljs-string">"hi"</span>
=&gt; [ <span class="hljs-string">"hi "</span>]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/lists.nix#L388" target="_top">lib/lists.nix:388</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.lists.range" class="title"><code class="literal">lib.lists.range</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.range" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">range :: int -&gt; int -&gt; [int]</code></p><p>Return a list of integers from <code class="literal">first</code> up to and including <code class="literal">last</code>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">first</code></span></dt><dd><p>First integer in the range</p></dd><dt><span class="term"><code class="literal">last</code></span></dt><dd><p>Last integer in the range</p></dd></dl></div><div class="example"><span id="function-library-example-lib.lists.range"></span><p class="title"><strong>Example&nbsp;149.&nbsp;<code class="literal">lib.lists.range</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">range <span class="hljs-number">2</span> <span class="hljs-number">4</span>
=&gt; [ <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> ]
range <span class="hljs-number">3</span> <span class="hljs-number">2</span>
=&gt; [ ]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/lists.nix#L400" target="_top">lib/lists.nix:400</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.lists.replicate" class="title"><code class="literal">lib.lists.replicate</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.replicate" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">replicate :: int -&gt; a -&gt; [a]</code></p><p>Return a list with <code class="literal">n</code> copies of an element.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">n</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">elem</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.lists.replicate"></span><p class="title"><strong>Example&nbsp;150.&nbsp;<code class="literal">lib.lists.replicate</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">replicate <span class="hljs-number">3</span> <span class="hljs-string">"a"</span>
=&gt; [ <span class="hljs-string">"a"</span> <span class="hljs-string">"a"</span> <span class="hljs-string">"a"</span> ]
replicate <span class="hljs-number">2</span> <span class="hljs-attr">true</span>
=&gt; [ <span class="hljs-literal">true</span> <span class="hljs-literal">true</span> ]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/lists.nix#L420" target="_top">lib/lists.nix:420</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.lists.partition" class="title"><code class="literal">lib.lists.partition</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.partition" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">(a -&gt; bool) -&gt; [a] -&gt; { right :: [a]; wrong :: [a]; }</code></p><p>Splits the elements of a list in two lists, <code class="literal">right</code> and
<code class="literal">wrong</code>, depending on the evaluation of a predicate.</p><div class="example"><span id="function-library-example-lib.lists.partition"></span><p class="title"><strong>Example&nbsp;151.&nbsp;<code class="literal">lib.lists.partition</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">partition (x: x &gt; <span class="hljs-number">2</span>) [ <span class="hljs-number">5</span> <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> ]
=&gt; { <span class="hljs-attr">right</span> = [ <span class="hljs-number">5</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> ]; <span class="hljs-attr">wrong</span> = [ <span class="hljs-number">1</span> <span class="hljs-number">2</span> ]; }
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/lists.nix#L431" target="_top">lib/lists.nix:431</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.lists.groupBy-prime" class="title"><code class="literal">lib.lists.groupBy'</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.groupBy-prime" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Splits the elements of a list into many lists, using the return value of a predicate.
Predicate should return a string which becomes keys of attrset <code class="literal">groupBy</code> returns.</p><p><code class="literal">groupBy'</code> allows to customise the combining function and initial value</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">op</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">nul</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">pred</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">lst</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.lists.groupBy-prime"></span><p class="title"><strong>Example&nbsp;152.&nbsp;<code class="literal">lib.lists.groupBy'</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">groupBy (x: boolToString (x &gt; <span class="hljs-number">2</span>)) [ <span class="hljs-number">5</span> <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> ]
=&gt; { <span class="hljs-attr">true</span> = [ <span class="hljs-number">5</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> ]; <span class="hljs-attr">false</span> = [ <span class="hljs-number">1</span> <span class="hljs-number">2</span> ]; }
groupBy (x: x.name) [ {<span class="hljs-attr">name</span> = <span class="hljs-string">"icewm"</span>; <span class="hljs-attr">script</span> = <span class="hljs-string">"icewm &amp;"</span>;}
                      {<span class="hljs-attr">name</span> = <span class="hljs-string">"xfce"</span>;  <span class="hljs-attr">script</span> = <span class="hljs-string">"xfce4-session &amp;"</span>;}
                      {<span class="hljs-attr">name</span> = <span class="hljs-string">"icewm"</span>; <span class="hljs-attr">script</span> = <span class="hljs-string">"icewmbg &amp;"</span>;}
                      {<span class="hljs-attr">name</span> = <span class="hljs-string">"mate"</span>;  <span class="hljs-attr">script</span> = <span class="hljs-string">"gnome-session &amp;"</span>;}
                    ]
=&gt; { <span class="hljs-attr">icewm</span> = [ { <span class="hljs-attr">name</span> = <span class="hljs-string">"icewm"</span>; <span class="hljs-attr">script</span> = <span class="hljs-string">"icewm &amp;"</span>; }
               { <span class="hljs-attr">name</span> = <span class="hljs-string">"icewm"</span>; <span class="hljs-attr">script</span> = <span class="hljs-string">"icewmbg &amp;"</span>; } ];
     <span class="hljs-attr">mate</span>  = [ { <span class="hljs-attr">name</span> = <span class="hljs-string">"mate"</span>;  <span class="hljs-attr">script</span> = <span class="hljs-string">"gnome-session &amp;"</span>; } ];
     <span class="hljs-attr">xfce</span>  = [ { <span class="hljs-attr">name</span> = <span class="hljs-string">"xfce"</span>;  <span class="hljs-attr">script</span> = <span class="hljs-string">"xfce4-session &amp;"</span>; } ];
   }

groupBy' <span class="hljs-built_in">builtins</span>.add <span class="hljs-number">0</span> (x: boolToString (x &gt; <span class="hljs-number">2</span>)) [ <span class="hljs-number">5</span> <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> ]
=&gt; { <span class="hljs-attr">true</span> = <span class="hljs-number">12</span>; <span class="hljs-attr">false</span> = <span class="hljs-number">3</span>; }
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/lists.nix#L460" target="_top">lib/lists.nix:460</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.lists.zipListsWith" class="title"><code class="literal">lib.lists.zipListsWith</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.zipListsWith" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">zipListsWith :: (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]</code></p><p>Merges two lists of the same size together. If the sizes aren’t the same
the merging stops at the shortest. How both lists are merged is defined
by the first argument.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">f</code></span></dt><dd><p>Function to zip elements of both lists</p></dd><dt><span class="term"><code class="literal">fst</code></span></dt><dd><p>First list</p></dd><dt><span class="term"><code class="literal">snd</code></span></dt><dd><p>Second list</p></dd></dl></div><div class="example"><span id="function-library-example-lib.lists.zipListsWith"></span><p class="title"><strong>Example&nbsp;153.&nbsp;<code class="literal">lib.lists.zipListsWith</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">zipListsWith (a: b: a + b) [<span class="hljs-string">"h"</span> <span class="hljs-string">"l"</span>] [<span class="hljs-string">"e"</span> <span class="hljs-string">"o"</span>]
=&gt; [<span class="hljs-string">"he"</span> <span class="hljs-string">"lo"</span>]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/lists.nix#L480" target="_top">lib/lists.nix:480</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.lists.zipLists" class="title"><code class="literal">lib.lists.zipLists</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.zipLists" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">zipLists :: [a] -&gt; [b] -&gt; [{ fst :: a; snd :: b; }]</code></p><p>Merges two lists of the same size together. If the sizes aren’t the same
the merging stops at the shortest.</p><div class="example"><span id="function-library-example-lib.lists.zipLists"></span><p class="title"><strong>Example&nbsp;154.&nbsp;<code class="literal">lib.lists.zipLists</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">zipLists [ <span class="hljs-number">1</span> <span class="hljs-number">2</span> ] [ <span class="hljs-string">"a"</span> <span class="hljs-string">"b"</span> ]
=&gt; [ { <span class="hljs-attr">fst</span> = <span class="hljs-number">1</span>; <span class="hljs-attr">snd</span> = <span class="hljs-string">"a"</span>; } { <span class="hljs-attr">fst</span> = <span class="hljs-number">2</span>; <span class="hljs-attr">snd</span> = <span class="hljs-string">"b"</span>; } ]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/lists.nix#L499" target="_top">lib/lists.nix:499</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.lists.reverseList" class="title"><code class="literal">lib.lists.reverseList</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.reverseList" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">reverseList :: [a] -&gt; [a]</code></p><p>Reverse the order of the elements of a list.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">xs</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.lists.reverseList"></span><p class="title"><strong>Example&nbsp;155.&nbsp;<code class="literal">lib.lists.reverseList</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">reverseList [ <span class="hljs-string">"b"</span> <span class="hljs-string">"o"</span> <span class="hljs-string">"j"</span> ]
=&gt; [ <span class="hljs-string">"j"</span> <span class="hljs-string">"o"</span> <span class="hljs-string">"b"</span> ]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/lists.nix#L510" target="_top">lib/lists.nix:510</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.lists.listDfs" class="title"><code class="literal">lib.lists.listDfs</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.listDfs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Depth-First Search (DFS) for lists <code class="literal">list != []</code>.</p><p><code class="literal">before a b == true</code> means that <code class="literal">b</code> depends on <code class="literal">a</code> (there’s an
edge from <code class="literal">b</code> to <code class="literal">a</code>).</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">stopOnCycles</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">before</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">list</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.lists.listDfs"></span><p class="title"><strong>Example&nbsp;156.&nbsp;<code class="literal">lib.lists.listDfs</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">listDfs <span class="hljs-literal">true</span> hasPrefix [ <span class="hljs-string">"/home/user"</span> <span class="hljs-string">"other"</span> <span class="hljs-string">"/"</span> <span class="hljs-string">"/home"</span> ]
  == { <span class="hljs-attr">minimal</span> = <span class="hljs-string">"/"</span>;                  <span class="hljs-comment"># minimal element</span>
       <span class="hljs-attr">visited</span> = [ <span class="hljs-string">"/home/user"</span> ];     <span class="hljs-comment"># seen elements (in reverse order)</span>
       <span class="hljs-attr">rest</span>    = [ <span class="hljs-string">"/home"</span> <span class="hljs-string">"other"</span> ];  <span class="hljs-comment"># everything else</span>
     }

listDfs <span class="hljs-literal">true</span> hasPrefix [ <span class="hljs-string">"/home/user"</span> <span class="hljs-string">"other"</span> <span class="hljs-string">"/"</span> <span class="hljs-string">"/home"</span> <span class="hljs-string">"/"</span> ]
  == { <span class="hljs-attr">cycle</span>   = <span class="hljs-string">"/"</span>;                  <span class="hljs-comment"># cycle encountered at this element</span>
       <span class="hljs-attr">loops</span>   = [ <span class="hljs-string">"/"</span> ];              <span class="hljs-comment"># and continues to these elements</span>
       <span class="hljs-attr">visited</span> = [ <span class="hljs-string">"/"</span> <span class="hljs-string">"/home/user"</span> ]; <span class="hljs-comment"># elements leading to the cycle (in reverse order)</span>
       <span class="hljs-attr">rest</span>    = [ <span class="hljs-string">"/home"</span> <span class="hljs-string">"other"</span> ];  <span class="hljs-comment"># everything else</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/lists.nix#L532" target="_top">lib/lists.nix:532</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.lists.toposort" class="title"><code class="literal">lib.lists.toposort</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.toposort" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Sort a list based on a partial ordering using DFS. This
implementation is O(N^2), if your ordering is linear, use <code class="literal">sort</code>
instead.</p><p><code class="literal">before a b == true</code> means that <code class="literal">b</code> should be after <code class="literal">a</code>
in the result.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">before</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">list</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.lists.toposort"></span><p class="title"><strong>Example&nbsp;157.&nbsp;<code class="literal">lib.lists.toposort</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">toposort hasPrefix [ <span class="hljs-string">"/home/user"</span> <span class="hljs-string">"other"</span> <span class="hljs-string">"/"</span> <span class="hljs-string">"/home"</span> ]
  == { <span class="hljs-attr">result</span> = [ <span class="hljs-string">"/"</span> <span class="hljs-string">"/home"</span> <span class="hljs-string">"/home/user"</span> <span class="hljs-string">"other"</span> ]; }

toposort hasPrefix [ <span class="hljs-string">"/home/user"</span> <span class="hljs-string">"other"</span> <span class="hljs-string">"/"</span> <span class="hljs-string">"/home"</span> <span class="hljs-string">"/"</span> ]
  == { <span class="hljs-attr">cycle</span> = [ <span class="hljs-string">"/home/user"</span> <span class="hljs-string">"/"</span> <span class="hljs-string">"/"</span> ]; <span class="hljs-comment"># path leading to a cycle</span>
       <span class="hljs-attr">loops</span> = [ <span class="hljs-string">"/"</span> ]; }                <span class="hljs-comment"># loops back to these elements</span>

toposort hasPrefix [ <span class="hljs-string">"other"</span> <span class="hljs-string">"/home/user"</span> <span class="hljs-string">"/home"</span> <span class="hljs-string">"/"</span> ]
  == { <span class="hljs-attr">result</span> = [ <span class="hljs-string">"other"</span> <span class="hljs-string">"/"</span> <span class="hljs-string">"/home"</span> <span class="hljs-string">"/home/user"</span> ]; }

toposort (a: b: a &lt; b) [ <span class="hljs-number">3</span> <span class="hljs-number">2</span> <span class="hljs-number">1</span> ] == { <span class="hljs-attr">result</span> = [ <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> ]; }
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/lists.nix#L571" target="_top">lib/lists.nix:571</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.lists.sort" class="title"><code class="literal">lib.lists.sort</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.sort" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">sort :: (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [a]</code></p><p>Sort a list based on a comparator function which compares two
elements and returns true if the first argument is strictly below
the second argument.  The returned list is sorted in an increasing
order.  The implementation does a quick-sort.</p><p>See also <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.sortOn" title="lib.lists.sortOn"><code class="literal">sortOn</code></a>, which applies the
default comparison on a function-derived property, and may be more efficient.</p><div class="example"><span id="function-library-example-lib.lists.sort"></span><p class="title"><strong>Example&nbsp;158.&nbsp;<code class="literal">lib.lists.sort</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">sort (p: q: p &lt; q) [ <span class="hljs-number">5</span> <span class="hljs-number">3</span> <span class="hljs-number">7</span> ]
=&gt; [ <span class="hljs-number">3</span> <span class="hljs-number">5</span> <span class="hljs-number">7</span> ]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/lists.nix#L605" target="_top">lib/lists.nix:605</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.lists.sortOn" class="title"><code class="literal">lib.lists.sortOn</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.sortOn" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">sortOn :: (a -&gt; b) -&gt; [a] -&gt; [a], for comparable b</code></p><p>Sort a list based on the default comparison of a derived property <code class="literal">b</code>.</p><p>The items are returned in <code class="literal">b</code>-increasing order.</p><p><span class="strong"><strong>Performance</strong></span>:</p><p>The passed function <code class="literal">f</code> is only evaluated once per item,
unlike an unprepared <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.sort" title="lib.lists.sort"><code class="literal">sort</code></a> using
<code class="literal">f p &lt; f q</code>.</p><p><span class="strong"><strong>Laws</strong></span>:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">sortOn <span class="hljs-attr">f</span> == sort (p: q: f p &lt; f q)
</code></pre><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">f</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">list</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.lists.sortOn"></span><p class="title"><strong>Example&nbsp;159.&nbsp;<code class="literal">lib.lists.sortOn</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">sortOn stringLength [ <span class="hljs-string">"aa"</span> <span class="hljs-string">"b"</span> <span class="hljs-string">"cccc"</span> ]
=&gt; [ <span class="hljs-string">"b"</span> <span class="hljs-string">"aa"</span> <span class="hljs-string">"cccc"</span> ]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/lists.nix#L645" target="_top">lib/lists.nix:645</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.lists.compareLists" class="title"><code class="literal">lib.lists.compareLists</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.compareLists" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Compare two lists element-by-element.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">cmp</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">a</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">b</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.lists.compareLists"></span><p class="title"><strong>Example&nbsp;160.&nbsp;<code class="literal">lib.lists.compareLists</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">compareLists compare [] []
=&gt; <span class="hljs-number">0</span>
compareLists compare [] [ <span class="hljs-string">"a"</span> ]
=&gt; -<span class="hljs-number">1</span>
compareLists compare [ <span class="hljs-string">"a"</span> ] []
=&gt; <span class="hljs-number">1</span>
compareLists compare [ <span class="hljs-string">"a"</span> <span class="hljs-string">"b"</span> ] [ <span class="hljs-string">"a"</span> <span class="hljs-string">"c"</span> ]
=&gt; -<span class="hljs-number">1</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/lists.nix#L670" target="_top">lib/lists.nix:670</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.lists.naturalSort" class="title"><code class="literal">lib.lists.naturalSort</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.naturalSort" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Sort list using “Natural sorting”.
Numeric portions of strings are sorted in numeric order.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">lst</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.lists.naturalSort"></span><p class="title"><strong>Example&nbsp;161.&nbsp;<code class="literal">lib.lists.naturalSort</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">naturalSort [<span class="hljs-string">"disk11"</span> <span class="hljs-string">"disk8"</span> <span class="hljs-string">"disk100"</span> <span class="hljs-string">"disk9"</span>]
=&gt; [<span class="hljs-string">"disk8"</span> <span class="hljs-string">"disk9"</span> <span class="hljs-string">"disk11"</span> <span class="hljs-string">"disk100"</span>]
naturalSort [<span class="hljs-string">"10.46.133.149"</span> <span class="hljs-string">"10.5.16.62"</span> <span class="hljs-string">"10.54.16.25"</span>]
=&gt; [<span class="hljs-string">"10.5.16.62"</span> <span class="hljs-string">"10.46.133.149"</span> <span class="hljs-string">"10.54.16.25"</span>]
naturalSort [<span class="hljs-string">"v0.2"</span> <span class="hljs-string">"v0.15"</span> <span class="hljs-string">"v0.0.9"</span>]
=&gt; [ <span class="hljs-string">"v0.0.9"</span> <span class="hljs-string">"v0.2"</span> <span class="hljs-string">"v0.15"</span> ]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/lists.nix#L693" target="_top">lib/lists.nix:693</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.lists.take" class="title"><code class="literal">lib.lists.take</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.take" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">take :: int -&gt; [a] -&gt; [a]</code></p><p>Return the first (at most) N elements of a list.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">count</code></span></dt><dd><p>Number of elements to take</p></dd></dl></div><div class="example"><span id="function-library-example-lib.lists.take"></span><p class="title"><strong>Example&nbsp;162.&nbsp;<code class="literal">lib.lists.take</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">take <span class="hljs-number">2</span> [ <span class="hljs-string">"a"</span> <span class="hljs-string">"b"</span> <span class="hljs-string">"c"</span> <span class="hljs-string">"d"</span> ]
=&gt; [ <span class="hljs-string">"a"</span> <span class="hljs-string">"b"</span> ]
take <span class="hljs-number">2</span> [ ]
=&gt; [ ]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/lists.nix#L711" target="_top">lib/lists.nix:711</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.lists.drop" class="title"><code class="literal">lib.lists.drop</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.drop" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">drop :: int -&gt; [a] -&gt; [a]</code></p><p>Remove the first (at most) N elements of a list.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">count</code></span></dt><dd><p>Number of elements to drop</p></dd><dt><span class="term"><code class="literal">list</code></span></dt><dd><p>Input list</p></dd></dl></div><div class="example"><span id="function-library-example-lib.lists.drop"></span><p class="title"><strong>Example&nbsp;163.&nbsp;<code class="literal">lib.lists.drop</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">drop <span class="hljs-number">2</span> [ <span class="hljs-string">"a"</span> <span class="hljs-string">"b"</span> <span class="hljs-string">"c"</span> <span class="hljs-string">"d"</span> ]
=&gt; [ <span class="hljs-string">"c"</span> <span class="hljs-string">"d"</span> ]
drop <span class="hljs-number">2</span> [ ]
=&gt; [ ]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/lists.nix#L725" target="_top">lib/lists.nix:725</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.lists.hasPrefix" class="title"><code class="literal">lib.lists.hasPrefix</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.hasPrefix" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">hasPrefix :: [a] -&gt; [a] -&gt; bool</code></p><p>Whether the first list is a prefix of the second list.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">list1</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">list2</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.lists.hasPrefix"></span><p class="title"><strong>Example&nbsp;164.&nbsp;<code class="literal">lib.lists.hasPrefix</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">hasPrefix [ <span class="hljs-number">1</span> <span class="hljs-number">2</span> ] [ <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> ]
=&gt; <span class="hljs-literal">true</span>
hasPrefix [ <span class="hljs-number">0</span> <span class="hljs-number">1</span> ] [ <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> ]
=&gt; <span class="hljs-literal">false</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/lists.nix#L741" target="_top">lib/lists.nix:741</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.lists.removePrefix" class="title"><code class="literal">lib.lists.removePrefix</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.removePrefix" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">removePrefix :: [a] -&gt; [a] -&gt; [a]</code></p><p>Remove the first list as a prefix from the second list.
Error if the first list isn’t a prefix of the second list.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">list1</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">list2</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.lists.removePrefix"></span><p class="title"><strong>Example&nbsp;165.&nbsp;<code class="literal">lib.lists.removePrefix</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">removePrefix [ <span class="hljs-number">1</span> <span class="hljs-number">2</span> ] [ <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> ]
=&gt; [ <span class="hljs-number">3</span> <span class="hljs-number">4</span> ]
removePrefix [ <span class="hljs-number">0</span> <span class="hljs-number">1</span> ] [ <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> ]
=&gt; &lt;error&gt;
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/lists.nix#L757" target="_top">lib/lists.nix:757</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.lists.sublist" class="title"><code class="literal">lib.lists.sublist</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.sublist" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">sublist :: int -&gt; int -&gt; [a] -&gt; [a]</code></p><p>Return a list consisting of at most <code class="literal">count</code> elements of <code class="literal">list</code>,
starting at index <code class="literal">start</code>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">start</code></span></dt><dd><p>Index at which to start the sublist</p></dd><dt><span class="term"><code class="literal">count</code></span></dt><dd><p>Number of elements to take</p></dd><dt><span class="term"><code class="literal">list</code></span></dt><dd><p>Input list</p></dd></dl></div><div class="example"><span id="function-library-example-lib.lists.sublist"></span><p class="title"><strong>Example&nbsp;166.&nbsp;<code class="literal">lib.lists.sublist</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">sublist <span class="hljs-number">1</span> <span class="hljs-number">3</span> [ <span class="hljs-string">"a"</span> <span class="hljs-string">"b"</span> <span class="hljs-string">"c"</span> <span class="hljs-string">"d"</span> <span class="hljs-string">"e"</span> ]
=&gt; [ <span class="hljs-string">"b"</span> <span class="hljs-string">"c"</span> <span class="hljs-string">"d"</span> ]
sublist <span class="hljs-number">1</span> <span class="hljs-number">3</span> [ ]
=&gt; [ ]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/lists.nix#L776" target="_top">lib/lists.nix:776</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.lists.commonPrefix" class="title"><code class="literal">lib.lists.commonPrefix</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.commonPrefix" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">commonPrefix :: [a] -&gt; [a] -&gt; [a]</code></p><p>The common prefix of two lists.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">list1</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">list2</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.lists.commonPrefix"></span><p class="title"><strong>Example&nbsp;167.&nbsp;<code class="literal">lib.lists.commonPrefix</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">commonPrefix [ <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> ] [ <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">4</span> <span class="hljs-number">8</span> ]
=&gt; [ <span class="hljs-number">1</span> <span class="hljs-number">2</span> ]
commonPrefix [ <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> ] [ <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> ]
=&gt; [ <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> ]
commonPrefix [ <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> ] [ <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> ]
=&gt; [ ]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/lists.nix#L802" target="_top">lib/lists.nix:802</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.lists.last" class="title"><code class="literal">lib.lists.last</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.last" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">last :: [a] -&gt; a</code></p><p>Return the last element of a list.</p><p>This function throws an error if the list is empty.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">list</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.lists.last"></span><p class="title"><strong>Example&nbsp;168.&nbsp;<code class="literal">lib.lists.last</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">last [ <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> ]
=&gt; <span class="hljs-number">3</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/lists.nix#L826" target="_top">lib/lists.nix:826</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.lists.init" class="title"><code class="literal">lib.lists.init</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.init" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">init :: [a] -&gt; [a]</code></p><p>Return all elements but the last.</p><p>This function throws an error if the list is empty.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">list</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.lists.init"></span><p class="title"><strong>Example&nbsp;169.&nbsp;<code class="literal">lib.lists.init</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">init [ <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> ]
=&gt; [ <span class="hljs-number">1</span> <span class="hljs-number">2</span> ]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/lists.nix#L840" target="_top">lib/lists.nix:840</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.lists.crossLists" class="title"><code class="literal">lib.lists.crossLists</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.crossLists" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Return the image of the cross product of some lists by a function.</p><div class="example"><span id="function-library-example-lib.lists.crossLists"></span><p class="title"><strong>Example&nbsp;170.&nbsp;<code class="literal">lib.lists.crossLists</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">crossLists (x:y: <span class="hljs-string">"<span class="hljs-subst">${<span class="hljs-built_in">toString</span> x}</span><span class="hljs-subst">${<span class="hljs-built_in">toString</span> y}</span>"</span>) [[<span class="hljs-number">1</span> <span class="hljs-number">2</span>] [<span class="hljs-number">3</span> <span class="hljs-number">4</span>]]
=&gt; [ <span class="hljs-string">"13"</span> <span class="hljs-string">"14"</span> <span class="hljs-string">"23"</span> <span class="hljs-string">"24"</span> ]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/lists.nix#L851" target="_top">lib/lists.nix:851</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.lists.unique" class="title"><code class="literal">lib.lists.unique</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.unique" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">unique :: [a] -&gt; [a]</code></p><p>Remove duplicate elements from the list. O(n^2) complexity.</p><div class="example"><span id="function-library-example-lib.lists.unique"></span><p class="title"><strong>Example&nbsp;171.&nbsp;<code class="literal">lib.lists.unique</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">unique [ <span class="hljs-number">3</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> ]
=&gt; [ <span class="hljs-number">3</span> <span class="hljs-number">2</span> <span class="hljs-number">4</span> ]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/lists.nix#L864" target="_top">lib/lists.nix:864</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.lists.allUnique" class="title"><code class="literal">lib.lists.allUnique</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.allUnique" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">allUnique :: [a] -&gt; bool</code></p><p>Check if list contains only unique elements. O(n^2) complexity.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">list</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.lists.allUnique"></span><p class="title"><strong>Example&nbsp;172.&nbsp;<code class="literal">lib.lists.allUnique</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">allUnique [ <span class="hljs-number">3</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> ]
=&gt; <span class="hljs-literal">false</span>
allUnique [ <span class="hljs-number">3</span> <span class="hljs-number">2</span> <span class="hljs-number">4</span> <span class="hljs-number">1</span> ]
=&gt; <span class="hljs-literal">true</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/lists.nix#L876" target="_top">lib/lists.nix:876</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.lists.intersectLists" class="title"><code class="literal">lib.lists.intersectLists</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.intersectLists" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Intersects list ‘e’ and another list. O(nm) complexity.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">e</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.lists.intersectLists"></span><p class="title"><strong>Example&nbsp;173.&nbsp;<code class="literal">lib.lists.intersectLists</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">intersectLists [ <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> ] [ <span class="hljs-number">6</span> <span class="hljs-number">3</span> <span class="hljs-number">2</span> ]
=&gt; [ <span class="hljs-number">3</span> <span class="hljs-number">2</span> ]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/lists.nix#L885" target="_top">lib/lists.nix:885</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.lists.subtractLists" class="title"><code class="literal">lib.lists.subtractLists</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.subtractLists" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Subtracts list ‘e’ from another list. O(nm) complexity.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">e</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.lists.subtractLists"></span><p class="title"><strong>Example&nbsp;174.&nbsp;<code class="literal">lib.lists.subtractLists</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">subtractLists [ <span class="hljs-number">3</span> <span class="hljs-number">2</span> ] [ <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">3</span> ]
=&gt; [ <span class="hljs-number">1</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> ]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/lists.nix#L893" target="_top">lib/lists.nix:893</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.lists.mutuallyExclusive" class="title"><code class="literal">lib.lists.mutuallyExclusive</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.lists.mutuallyExclusive" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Test if two lists have no common element.
It should be slightly more efficient than (intersectLists a b == [])</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">a</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">b</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/lists.nix#L898" target="_top">lib/lists.nix:898</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-functions-library-debug" class="title">lib.debug: debugging functions   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-functions-library-debug" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Collection of functions useful for debugging
broken nix expressions.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">trace</code>-like functions take two values, print
the first to stderr and return the second.</p></li><li class="listitem"><p><code class="literal">traceVal</code>-like functions take one argument
which both printed and returned.</p></li><li class="listitem"><p><code class="literal">traceSeq</code>-like functions fully evaluate their
traced value before printing (not just to “weak
head normal form” like trace does by default).</p></li><li class="listitem"><p>Functions that end in <code class="literal">-Fn</code> take an additional
function as their first argument, which is applied
to the traced value before it is printed.</p></li></ul></div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.debug.traceIf" class="title"><code class="literal">lib.debug.traceIf</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.debug.traceIf" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">traceIf :: bool -&gt; string -&gt; a -&gt; a</code></p><p>Conditionally trace the supplied message, based on a predicate.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">pred</code></span></dt><dd><p>Predicate to check</p></dd><dt><span class="term"><code class="literal">msg</code></span></dt><dd><p>Message that should be traced</p></dd><dt><span class="term"><code class="literal">x</code></span></dt><dd><p>Value to return</p></dd></dl></div><div class="example"><span id="function-library-example-lib.debug.traceIf"></span><p class="title"><strong>Example&nbsp;175.&nbsp;<code class="literal">lib.debug.traceIf</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">traceIf <span class="hljs-literal">true</span> <span class="hljs-string">"hello"</span> <span class="hljs-number">3</span>
trace: <span class="hljs-attr">hello</span>
=&gt; <span class="hljs-number">3</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/debug.nix#L44" target="_top">lib/debug.nix:44</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.debug.traceValFn" class="title"><code class="literal">lib.debug.traceValFn</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.debug.traceValFn" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">traceValFn :: (a -&gt; b) -&gt; a -&gt; a</code></p><p>Trace the supplied value after applying a function to it, and
return the original value.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">f</code></span></dt><dd><p>Function to apply</p></dd><dt><span class="term"><code class="literal">x</code></span></dt><dd><p>Value to trace and return</p></dd></dl></div><div class="example"><span id="function-library-example-lib.debug.traceValFn"></span><p class="title"><strong>Example&nbsp;176.&nbsp;<code class="literal">lib.debug.traceValFn</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">traceValFn (v: <span class="hljs-string">"mystring <span class="hljs-subst">${v}</span>"</span>) <span class="hljs-string">"foo"</span>
trace: mystring <span class="hljs-attr">foo</span>
=&gt; <span class="hljs-string">"foo"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/debug.nix#L62" target="_top">lib/debug.nix:62</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.debug.traceVal" class="title"><code class="literal">lib.debug.traceVal</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.debug.traceVal" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">traceVal :: a -&gt; a</code></p><p>Trace the supplied value and return it.</p><div class="example"><span id="function-library-example-lib.debug.traceVal"></span><p class="title"><strong>Example&nbsp;177.&nbsp;<code class="literal">lib.debug.traceVal</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">traceVal <span class="hljs-number">42</span>
<span class="hljs-comment"># trace: 42</span>
=&gt; <span class="hljs-number">42</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/debug.nix#L77" target="_top">lib/debug.nix:77</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.debug.traceSeq" class="title"><code class="literal">lib.debug.traceSeq</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.debug.traceSeq" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">traceSeq :: a -&gt; b -&gt; b</code></p><p><code class="literal">builtins.trace</code>, but the value is <code class="literal">builtins.deepSeq</code>ed first.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">x</code></span></dt><dd><p>The value to trace</p></dd><dt><span class="term"><code class="literal">y</code></span></dt><dd><p>The value to return</p></dd></dl></div><div class="example"><span id="function-library-example-lib.debug.traceSeq"></span><p class="title"><strong>Example&nbsp;178.&nbsp;<code class="literal">lib.debug.traceSeq</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">trace { a.b.<span class="hljs-attr">c</span> = <span class="hljs-number">3</span>; } <span class="hljs-literal">null</span>
trace: { <span class="hljs-attr">a</span> = &lt;CODE&gt;; }
=&gt; <span class="hljs-literal">null</span>
traceSeq { a.b.<span class="hljs-attr">c</span> = <span class="hljs-number">3</span>; } <span class="hljs-literal">null</span>
trace: { <span class="hljs-attr">a</span> = { <span class="hljs-attr">b</span> = { <span class="hljs-attr">c</span> = <span class="hljs-number">3</span>; }; }; }
=&gt; <span class="hljs-literal">null</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/debug.nix#L91" target="_top">lib/debug.nix:91</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.debug.traceSeqN" class="title"><code class="literal">lib.debug.traceSeqN</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.debug.traceSeqN" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">traceSeqN :: Int -&gt; a -&gt; b -&gt; b</code></p><p>Like <code class="literal">traceSeq</code>, but only evaluate down to depth n.
This is very useful because lots of <code class="literal">traceSeq</code> usages
lead to an infinite recursion.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">depth</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">x</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">y</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.debug.traceSeqN"></span><p class="title"><strong>Example&nbsp;179.&nbsp;<code class="literal">lib.debug.traceSeqN</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">traceSeqN <span class="hljs-number">2</span> { a.b.<span class="hljs-attr">c</span> = <span class="hljs-number">3</span>; } <span class="hljs-literal">null</span>
trace: { <span class="hljs-attr">a</span> = { <span class="hljs-attr">b</span> = {…}; }; }
=&gt; <span class="hljs-literal">null</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/debug.nix#L108" target="_top">lib/debug.nix:108</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.debug.traceValSeqFn" class="title"><code class="literal">lib.debug.traceValSeqFn</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.debug.traceValSeqFn" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>A combination of <code class="literal">traceVal</code> and <code class="literal">traceSeq</code> that applies a
provided function to the value to be traced after <code class="literal">deepSeq</code>ing
it.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">f</code></span></dt><dd><p>Function to apply</p></dd><dt><span class="term"><code class="literal">v</code></span></dt><dd><p>Value to trace</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/debug.nix#L125" target="_top">lib/debug.nix:125</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.debug.traceValSeq" class="title"><code class="literal">lib.debug.traceValSeq</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.debug.traceValSeq" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>A combination of <code class="literal">traceVal</code> and <code class="literal">traceSeq</code>.</p><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/debug.nix#L132" target="_top">lib/debug.nix:132</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.debug.traceValSeqNFn" class="title"><code class="literal">lib.debug.traceValSeqNFn</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.debug.traceValSeqNFn" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>A combination of <code class="literal">traceVal</code> and <code class="literal">traceSeqN</code> that applies a
provided function to the value to be traced.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">f</code></span></dt><dd><p>Function to apply</p></dd><dt><span class="term"><code class="literal">depth</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">v</code></span></dt><dd><p>Value to trace</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/debug.nix#L136" target="_top">lib/debug.nix:136</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.debug.traceValSeqN" class="title"><code class="literal">lib.debug.traceValSeqN</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.debug.traceValSeqN" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>A combination of <code class="literal">traceVal</code> and <code class="literal">traceSeqN</code>.</p><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/debug.nix#L144" target="_top">lib/debug.nix:144</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.debug.traceFnSeqN" class="title"><code class="literal">lib.debug.traceFnSeqN</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.debug.traceFnSeqN" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Trace the input and output of a function <code class="literal">f</code> named <code class="literal">name</code>,
both down to <code class="literal">depth</code>.</p><p>This is useful for adding around a function call,
to see the before/after of values as they are transformed.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">depth</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">name</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">f</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">v</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.debug.traceFnSeqN"></span><p class="title"><strong>Example&nbsp;180.&nbsp;<code class="literal">lib.debug.traceFnSeqN</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">traceFnSeqN <span class="hljs-number">2</span> <span class="hljs-string">"id"</span> (x: x) { a.b.<span class="hljs-attr">c</span> = <span class="hljs-number">3</span>; }
trace: { <span class="hljs-attr">fn</span> = <span class="hljs-string">"id"</span>; <span class="hljs-attr">from</span> = { a.<span class="hljs-attr">b</span> = {…}; }; <span class="hljs-attr">to</span> = { a.<span class="hljs-attr">b</span> = {…}; }; }
=&gt; { a.b.<span class="hljs-attr">c</span> = <span class="hljs-number">3</span>; }
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/debug.nix#L157" target="_top">lib/debug.nix:157</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.debug.runTests" class="title"><code class="literal">lib.debug.runTests</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.debug.runTests" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>:</p><pre><code class="programlisting hljs language-bash" data-highlighted="yes">runTests :: {
  tests = [ String ];
  <span class="hljs-variable">${testName}</span> :: {
    <span class="hljs-built_in">expr</span> :: a;
    expected :: a;
  };
}
-&gt;
[
  {
    name :: String;
    expected :: a;
    result :: a;
  }
]
</code></pre><p>Evaluates a set of tests.</p><p>A test is an attribute set <code class="literal">{expr, expected}</code>,
denoting an expression and its expected result.</p><p>The result is a <code class="literal">list</code> of <span class="strong"><strong>failed tests</strong></span>, each represented as
<code class="literal">{name, expected, result}</code>,</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>expected</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>What was passed as <code class="literal">expected</code></p></li></ul></div></li><li class="listitem"><p>result</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>The actual <code class="literal">result</code> of the test</p></li></ul></div></li></ul></div><p>Used for regression testing of the functions in lib; see
tests.nix for more examples.</p><p>Important: Only attributes that start with <code class="literal">test</code> are executed.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>If you want to run only a subset of the tests add the attribute <code class="literal">tests = ["testName"];</code></p></li></ul></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">tests</code></span></dt><dd><p>Tests to run</p></dd></dl></div><div class="example"><span id="function-library-example-lib.debug.runTests"></span><p class="title"><strong>Example&nbsp;181.&nbsp;<code class="literal">lib.debug.runTests</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">runTests {
  <span class="hljs-attr">testAndOk</span> = {
    <span class="hljs-attr">expr</span> = lib.<span class="hljs-literal">and</span> <span class="hljs-literal">true</span> <span class="hljs-literal">false</span>;
    <span class="hljs-attr">expected</span> = <span class="hljs-literal">false</span>;
  };
  <span class="hljs-attr">testAndFail</span> = {
    <span class="hljs-attr">expr</span> = lib.<span class="hljs-literal">and</span> <span class="hljs-literal">true</span> <span class="hljs-literal">false</span>;
    <span class="hljs-attr">expected</span> = <span class="hljs-literal">true</span>;
  };
}
-&gt;
[
  {
    <span class="hljs-attr">name</span> = <span class="hljs-string">"testAndFail"</span>;
    <span class="hljs-attr">expected</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-attr">result</span> = <span class="hljs-literal">false</span>;
  }
]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/debug.nix#L229" target="_top">lib/debug.nix:229</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.debug.testAllTrue" class="title"><code class="literal">lib.debug.testAllTrue</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.debug.testAllTrue" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Create a test assuming that list elements are <code class="literal">true</code>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">expr</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.debug.testAllTrue"></span><p class="title"><strong>Example&nbsp;182.&nbsp;<code class="literal">lib.debug.testAllTrue</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ <span class="hljs-attr">testX</span> = allTrue [ <span class="hljs-literal">true</span> ]; }
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/debug.nix#L245" target="_top">lib/debug.nix:245</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-functions-library-options" class="title">lib.options: NixOS / nixpkgs option handling   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-functions-library-options" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Nixpkgs/NixOS option handling.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.options.isOption" class="title"><code class="literal">lib.options.isOption</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.options.isOption" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">isOption :: a -&gt; bool</code></p><p>Returns true when the given argument is an option</p><div class="example"><span id="function-library-example-lib.options.isOption"></span><p class="title"><strong>Example&nbsp;183.&nbsp;<code class="literal">lib.options.isOption</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">isOption <span class="hljs-number">1</span>             // =&gt; <span class="hljs-literal">false</span>
isOption (mkOption {}) // =&gt; <span class="hljs-literal">true</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/options.nix#L56" target="_top">lib/options.nix:56</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.options.mkOption" class="title"><code class="literal">lib.options.mkOption</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.options.mkOption" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Creates an Option attribute set. mkOption accepts an attribute set with the following keys:</p><p>All keys default to <code class="literal">null</code> when not given.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">structured function argument</span></dt><dd><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">default</code></span></dt><dd><p>Default value used when no definition is given in the configuration.</p></dd><dt><span class="term"><code class="literal">defaultText</code></span></dt><dd><p>Textual representation of the default, for the manual.</p></dd><dt><span class="term"><code class="literal">example</code></span></dt><dd><p>Example value used in the manual.</p></dd><dt><span class="term"><code class="literal">description</code></span></dt><dd><p>String describing the option.</p></dd><dt><span class="term"><code class="literal">relatedPackages</code></span></dt><dd><p>Related packages used in the manual (see <code class="literal">genRelatedPackages</code> in …/nixos/lib/make-options-doc/default.nix).</p></dd><dt><span class="term"><code class="literal">type</code></span></dt><dd><p>Option type, providing type-checking and value merging.</p></dd><dt><span class="term"><code class="literal">apply</code></span></dt><dd><p>Function that converts the option value to something else.</p></dd><dt><span class="term"><code class="literal">internal</code></span></dt><dd><p>Whether the option is for NixOS developers only.</p></dd><dt><span class="term"><code class="literal">visible</code></span></dt><dd><p>Whether the option shows up in the manual. Default: true. Use false to hide the option and any sub-options from submodules. Use “shallow” to hide only sub-options.</p></dd><dt><span class="term"><code class="literal">readOnly</code></span></dt><dd><p>Whether the option can be set only once</p></dd></dl></div></dd></dl></div><div class="example"><span id="function-library-example-lib.options.mkOption"></span><p class="title"><strong>Example&nbsp;184.&nbsp;<code class="literal">lib.options.mkOption</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">mkOption { }  // =&gt; { <span class="hljs-attr">_type</span> = <span class="hljs-string">"option"</span>; }
mkOption { <span class="hljs-attr">default</span> = <span class="hljs-string">"foo"</span>; } // =&gt; { <span class="hljs-attr">_type</span> = <span class="hljs-string">"option"</span>; <span class="hljs-attr">default</span> = <span class="hljs-string">"foo"</span>; }
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/options.nix#L66" target="_top">lib/options.nix:66</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.options.mkEnableOption" class="title"><code class="literal">lib.options.mkEnableOption</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.options.mkEnableOption" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Creates an Option attribute set for a boolean value option i.e an
option to be toggled on or off:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">name</code></span></dt><dd><p>Name for the created option</p></dd></dl></div><div class="example"><span id="function-library-example-lib.options.mkEnableOption"></span><p class="title"><strong>Example&nbsp;185.&nbsp;<code class="literal">lib.options.mkEnableOption</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">mkEnableOption <span class="hljs-string">"foo"</span>
=&gt; { <span class="hljs-attr">_type</span> = <span class="hljs-string">"option"</span>; <span class="hljs-attr">default</span> = <span class="hljs-literal">false</span>; <span class="hljs-attr">description</span> = <span class="hljs-string">"Whether to enable foo."</span>; <span class="hljs-attr">example</span> = <span class="hljs-literal">true</span>; <span class="hljs-attr">type</span> = { ... }; }
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/options.nix#L98" target="_top">lib/options.nix:98</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.options.mkPackageOption" class="title"><code class="literal">lib.options.mkPackageOption</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.options.mkPackageOption" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">mkPackageOption :: pkgs -&gt; (string|[string]) -&gt; { nullable? :: bool, default? :: string|[string], example? :: null|string|[string], extraDescription? :: string, pkgsText? :: string } -&gt; option</code></p><p>Creates an Option attribute set for an option that specifies the
package a module should use for some purpose.</p><p>The package is specified in the third argument under <code class="literal">default</code> as a list of strings
representing its attribute path in nixpkgs (or another package set).
Because of this, you need to pass nixpkgs itself (usually <code class="literal">pkgs</code> in a module;
alternatively to nixpkgs itself, another package set) as the first argument.</p><p>If you pass another package set you should set the <code class="literal">pkgsText</code> option.
This option is used to display the expression for the package set. It is <code class="literal">"pkgs"</code> by default.
If your expression is complex you should parenthesize it, as the <code class="literal">pkgsText</code> argument
is usually immediately followed by an attribute lookup (<code class="literal">.</code>).</p><p>The second argument may be either a string or a list of strings.
It provides the display name of the package in the description of the generated option
(using only the last element if the passed value is a list)
and serves as the fallback value for the <code class="literal">default</code> argument.</p><p>To include extra information in the description, pass <code class="literal">extraDescription</code> to
append arbitrary text to the generated description.</p><p>You can also pass an <code class="literal">example</code> value, either a literal string or an attribute path.</p><p>The <code class="literal">default</code> argument can be omitted if the provided name is
an attribute of pkgs (if <code class="literal">name</code> is a string) or a valid attribute path in pkgs (if <code class="literal">name</code> is a list).
You can also set <code class="literal">default</code> to just a string in which case it is interpreted as an attribute name
(a singleton attribute path, if you will).</p><p>If you wish to explicitly provide no default, pass <code class="literal">null</code> as <code class="literal">default</code>.</p><p>If you want users to be able to set no package, pass <code class="literal">nullable = true</code>.
In this mode a <code class="literal">default = null</code> will not be interpreted as no default and is interpreted literally.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">pkgs</code></span></dt><dd><p>Package set (an instantiation of nixpkgs such as pkgs in modules or another package set)</p></dd><dt><span class="term"><code class="literal">name</code></span></dt><dd><p>Name for the package, shown in option description</p></dd><dt><span class="term">structured function argument</span></dt><dd><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">nullable</code></span></dt><dd><p>Whether the package can be null, for example to disable installing a package altogether (defaults to false)</p></dd><dt><span class="term"><code class="literal">default</code></span></dt><dd><p>The attribute path where the default package is located (may be omitted, in which case it is copied from <code class="literal">name</code>)</p></dd><dt><span class="term"><code class="literal">example</code></span></dt><dd><p>A string or an attribute path to use as an example (may be omitted)</p></dd><dt><span class="term"><code class="literal">extraDescription</code></span></dt><dd><p>Additional text to include in the option description (may be omitted)</p></dd><dt><span class="term"><code class="literal">pkgsText</code></span></dt><dd><p>Representation of the package set passed as pkgs (defaults to <code class="literal">"pkgs"</code>)</p></dd></dl></div></dd></dl></div><div class="example"><span id="function-library-example-lib.options.mkPackageOption"></span><p class="title"><strong>Example&nbsp;186.&nbsp;<code class="literal">lib.options.mkPackageOption</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">mkPackageOption pkgs <span class="hljs-string">"hello"</span> { }
=&gt; { ...; <span class="hljs-attr">default</span> = pkgs.hello; <span class="hljs-attr">defaultText</span> = literalExpression <span class="hljs-string">"pkgs.hello"</span>; <span class="hljs-attr">description</span> = <span class="hljs-string">"The hello package to use."</span>; <span class="hljs-attr">type</span> = package; }


mkPackageOption pkgs <span class="hljs-string">"GHC"</span> {
  <span class="hljs-attr">default</span> = [ <span class="hljs-string">"ghc"</span> ];
  <span class="hljs-attr">example</span> = <span class="hljs-string">"pkgs.haskell.packages.ghc92.ghc.withPackages (hkgs: [ hkgs.primes ])"</span>;
}
=&gt; { ...; <span class="hljs-attr">default</span> = pkgs.ghc; <span class="hljs-attr">defaultText</span> = literalExpression <span class="hljs-string">"pkgs.ghc"</span>; <span class="hljs-attr">description</span> = <span class="hljs-string">"The GHC package to use."</span>; <span class="hljs-attr">example</span> = literalExpression <span class="hljs-string">"pkgs.haskell.packages.ghc92.ghc.withPackages (hkgs: [ hkgs.primes ])"</span>; <span class="hljs-attr">type</span> = package; }


mkPackageOption pkgs [ <span class="hljs-string">"python3Packages"</span> <span class="hljs-string">"pytorch"</span> ] {
  <span class="hljs-attr">extraDescription</span> = <span class="hljs-string">"This is an example and doesn't actually do anything."</span>;
}
=&gt; { ...; <span class="hljs-attr">default</span> = pkgs.python3Packages.pytorch; <span class="hljs-attr">defaultText</span> = literalExpression <span class="hljs-string">"pkgs.python3Packages.pytorch"</span>; <span class="hljs-attr">description</span> = <span class="hljs-string">"The pytorch package to use. This is an example and doesn't actually do anything."</span>; <span class="hljs-attr">type</span> = package; }


mkPackageOption pkgs <span class="hljs-string">"nushell"</span> {
  <span class="hljs-attr">nullable</span> = <span class="hljs-literal">true</span>;
}
=&gt; { ...; <span class="hljs-attr">default</span> = pkgs.nushell; <span class="hljs-attr">defaultText</span> = literalExpression <span class="hljs-string">"pkgs.nushell"</span>; <span class="hljs-attr">description</span> = <span class="hljs-string">"The nushell package to use."</span>; <span class="hljs-attr">type</span> = nullOr package; }


mkPackageOption pkgs <span class="hljs-string">"coreutils"</span> {
  <span class="hljs-attr">default</span> = <span class="hljs-literal">null</span>;
}
=&gt; { ...; <span class="hljs-attr">description</span> = <span class="hljs-string">"The coreutils package to use."</span>; <span class="hljs-attr">type</span> = package; }


mkPackageOption pkgs <span class="hljs-string">"dbus"</span> {
  <span class="hljs-attr">nullable</span> = <span class="hljs-literal">true</span>;
  <span class="hljs-attr">default</span> = <span class="hljs-literal">null</span>;
}
=&gt; { ...; <span class="hljs-attr">default</span> = <span class="hljs-literal">null</span>; <span class="hljs-attr">description</span> = <span class="hljs-string">"The dbus package to use."</span>; <span class="hljs-attr">type</span> = nullOr package; }


mkPackageOption pkgs.javaPackages <span class="hljs-string">"OpenJFX"</span> {
  <span class="hljs-attr">default</span> = <span class="hljs-string">"openjfx20"</span>;
  <span class="hljs-attr">pkgsText</span> = <span class="hljs-string">"pkgs.javaPackages"</span>;
}
=&gt; { ...; <span class="hljs-attr">default</span> = pkgs.javaPackages.openjfx20; <span class="hljs-attr">defaultText</span> = literalExpression <span class="hljs-string">"pkgs.javaPackages.openjfx20"</span>; <span class="hljs-attr">description</span> = <span class="hljs-string">"The OpenJFX package to use."</span>; <span class="hljs-attr">type</span> = package; }
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/options.nix#L185" target="_top">lib/options.nix:185</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.options.mkPackageOptionMD" class="title"><code class="literal">lib.options.mkPackageOptionMD</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.options.mkPackageOptionMD" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Alias of mkPackageOption. Previously used to create options with markdown
documentation, which is no longer required.</p><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/options.nix#L226" target="_top">lib/options.nix:226</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.options.mkSinkUndeclaredOptions" class="title"><code class="literal">lib.options.mkSinkUndeclaredOptions</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.options.mkSinkUndeclaredOptions" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>This option accepts anything, but it does not produce any result.</p><p>This is useful for sharing a module across different module sets
without having to implement similar features as long as the
values of the options are not accessed.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">attrs</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/options.nix#L233" target="_top">lib/options.nix:233</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.options.mergeEqualOption" class="title"><code class="literal">lib.options.mergeEqualOption</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.options.mergeEqualOption" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>“Merge” option definitions by checking that they all have the same value.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">loc</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">defs</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/options.nix#L266" target="_top">lib/options.nix:266</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.options.getValues" class="title"><code class="literal">lib.options.getValues</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.options.getValues" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">getValues :: [ { value :: a; } ] -&gt; [a]</code></p><p>Extracts values of all “value” keys of the given list.</p><div class="example"><span id="function-library-example-lib.options.getValues"></span><p class="title"><strong>Example&nbsp;187.&nbsp;<code class="literal">lib.options.getValues</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">getValues [ { <span class="hljs-attr">value</span> = <span class="hljs-number">1</span>; } { <span class="hljs-attr">value</span> = <span class="hljs-number">2</span>; } ] // =&gt; [ <span class="hljs-number">1</span> <span class="hljs-number">2</span> ]
getValues [ ]                               // =&gt; [ ]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/options.nix#L286" target="_top">lib/options.nix:286</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.options.getFiles" class="title"><code class="literal">lib.options.getFiles</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.options.getFiles" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">getFiles :: [ { file :: a; } ] -&gt; [a]</code></p><p>Extracts values of all “file” keys of the given list</p><div class="example"><span id="function-library-example-lib.options.getFiles"></span><p class="title"><strong>Example&nbsp;188.&nbsp;<code class="literal">lib.options.getFiles</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">getFiles [ { <span class="hljs-attr">file</span> = <span class="hljs-string">"file1"</span>; } { <span class="hljs-attr">file</span> = <span class="hljs-string">"file2"</span>; } ] // =&gt; [ <span class="hljs-string">"file1"</span> <span class="hljs-string">"file2"</span> ]
getFiles [ ]                                         // =&gt; [ ]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/options.nix#L296" target="_top">lib/options.nix:296</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.options.scrubOptionValue" class="title"><code class="literal">lib.options.scrubOptionValue</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.options.scrubOptionValue" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>This function recursively removes all derivation attributes from
<code class="literal">x</code> except for the <code class="literal">name</code> attribute.</p><p>This is to make the generation of <code class="literal">options.xml</code> much more
efficient: the XML representation of derivations is very large
(on the order of megabytes) and is not actually used by the
manual generator.</p><p>This function was made obsolete by renderOptionValue and is kept for
compatibility with out-of-tree code.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">x</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/options.nix#L354" target="_top">lib/options.nix:354</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.options.renderOptionValue" class="title"><code class="literal">lib.options.renderOptionValue</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.options.renderOptionValue" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Ensures that the given option value (default or example) is a <code class="literal">_type</code>d string
by rendering Nix values to <code class="literal">literalExpression</code>s.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">v</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/options.nix#L365" target="_top">lib/options.nix:365</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.options.literalExpression" class="title"><code class="literal">lib.options.literalExpression</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.options.literalExpression" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>For use in the <code class="literal">defaultText</code> and <code class="literal">example</code> option attributes. Causes the
given string to be rendered verbatim in the documentation as Nix code. This
is necessary for complex values, e.g. functions, or values that depend on
other values or packages.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">text</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/options.nix#L378" target="_top">lib/options.nix:378</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.options.mdDoc" class="title"><code class="literal">lib.options.mdDoc</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.options.mdDoc" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Transition marker for documentation that’s already migrated to markdown
syntax. This is a no-op and no longer needed.</p><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/options.nix#L387" target="_top">lib/options.nix:387</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.options.literalMD" class="title"><code class="literal">lib.options.literalMD</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.options.literalMD" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>For use in the <code class="literal">defaultText</code> and <code class="literal">example</code> option attributes. Causes the
given MD text to be inserted verbatim in the documentation, for when
a <code class="literal">literalExpression</code> would be too hard to read.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">text</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/options.nix#L393" target="_top">lib/options.nix:393</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.options.showOption" class="title"><code class="literal">lib.options.showOption</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.options.showOption" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Convert an option, described as a list of the option parts to a
human-readable version.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">parts</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.options.showOption"></span><p class="title"><strong>Example&nbsp;189.&nbsp;<code class="literal">lib.options.showOption</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">(showOption [<span class="hljs-string">"foo"</span> <span class="hljs-string">"bar"</span> <span class="hljs-string">"baz"</span>]) == <span class="hljs-string">"foo.bar.baz"</span>
  (showOption [<span class="hljs-string">"foo"</span> <span class="hljs-string">"bar.baz"</span> <span class="hljs-string">"tux"</span>]) == <span class="hljs-string">"foo.\"</span>bar.baz\<span class="hljs-string">".tux"</span>
  (showOption [<span class="hljs-string">"windowManager"</span> <span class="hljs-string">"2bwm"</span> <span class="hljs-string">"enable"</span>]) == <span class="hljs-string">"windowManager.\"</span><span class="hljs-number">2</span>bwm\<span class="hljs-string">".enable"</span>

Placeholders will not be quoted as they are not actual values:
  (showOption [<span class="hljs-string">"foo"</span> <span class="hljs-string">"*"</span> <span class="hljs-string">"bar"</span>]) == <span class="hljs-string">"foo.*.bar"</span>
  (showOption [<span class="hljs-string">"foo"</span> <span class="hljs-string">"&lt;name&gt;"</span> <span class="hljs-string">"bar"</span>]) == <span class="hljs-string">"foo.&lt;name&gt;.bar"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/options.nix#L411" target="_top">lib/options.nix:411</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-functions-library-path" class="title">lib.path: path functions   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-functions-library-path" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Functions for working with path values.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.path.append" class="title"><code class="literal">lib.path.append</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.path.append" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">append :: Path -&gt; String -&gt; Path</code></p><p>Append a subpath string to a path.</p><p>Like <code class="literal">path + ("/" + string)</code> but safer, because it errors instead of returning potentially surprising results.
More specifically, it checks that the first argument is a <a class="link" href="https://nixos.org/manual/nix/stable/language/values#type-path%22" target="_top">path value type</a>,
and that the second argument is a <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.path.subpath.isValid" title="lib.path.subpath.isValid">valid subpath string</a>.</p><p>Laws:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>Not influenced by subpath <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.path.subpath.normalise" title="lib.path.subpath.normalise">normalisation</a>:</p><pre><code class="programlisting hljs language-nix" data-highlighted="yes">append p <span class="hljs-attr">s</span> == append p (subpath.normalise s)
</code></pre></li></ul></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">path</code></span></dt><dd><p>The absolute path to append to</p></dd><dt><span class="term"><code class="literal">subpath</code></span></dt><dd><p>The subpath string to append</p></dd></dl></div><div class="example"><span id="function-library-example-lib.path.append"></span><p class="title"><strong>Example&nbsp;190.&nbsp;<code class="literal">lib.path.append</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">append /foo <span class="hljs-string">"bar/baz"</span>
=&gt; /foo/bar/baz

<span class="hljs-comment"># subpaths don't need to be normalised</span>
append /foo <span class="hljs-string">"./bar//baz/./"</span>
=&gt; /foo/bar/baz

<span class="hljs-comment"># can append to root directory</span>
append /. <span class="hljs-string">"foo/bar"</span>
=&gt; /foo/bar

<span class="hljs-comment"># first argument needs to be a path value type</span>
append <span class="hljs-string">"/foo"</span> <span class="hljs-string">"bar"</span>
=&gt; &lt;error&gt;

<span class="hljs-comment"># second argument needs to be a valid subpath string</span>
append /foo /<span class="hljs-attr">bar</span>
=&gt; &lt;error&gt;
append /foo <span class="hljs-string">""</span>
=&gt; &lt;error&gt;
append /foo <span class="hljs-string">"/bar"</span>
=&gt; &lt;error&gt;
append /foo <span class="hljs-string">"../bar"</span>
=&gt; &lt;error&gt;
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/path/default.nix#L192" target="_top">lib/path/default.nix:192</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.path.hasPrefix" class="title"><code class="literal">lib.path.hasPrefix</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.path.hasPrefix" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">hasPrefix :: Path -&gt; Path -&gt; Bool</code></p><p>Whether the first path is a component-wise prefix of the second path.</p><p>Laws:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><code class="literal">hasPrefix p q</code> is only true if <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.path.append" title="lib.path.append"><code class="literal">q == append p s</code></a> for some <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.path.subpath.isValid" title="lib.path.subpath.isValid">subpath</a> <code class="literal">s</code>.</p></li><li class="listitem"><p><code class="literal">hasPrefix</code> is a <a class="link" href="https://en.wikipedia.org/wiki/Partially_ordered_set#Non-strict_partial_order" target="_top">non-strict partial order</a> over the set of all path values.</p></li></ul></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">path1</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.path.hasPrefix"></span><p class="title"><strong>Example&nbsp;191.&nbsp;<code class="literal">lib.path.hasPrefix</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">hasPrefix /foo /foo/<span class="hljs-attr">bar</span>
=&gt; <span class="hljs-literal">true</span>
hasPrefix /foo /<span class="hljs-attr">foo</span>
=&gt; <span class="hljs-literal">true</span>
hasPrefix /foo/bar /<span class="hljs-attr">foo</span>
=&gt; <span class="hljs-literal">false</span>
hasPrefix /. /<span class="hljs-attr">foo</span>
=&gt; <span class="hljs-literal">true</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/path/default.nix#L226" target="_top">lib/path/default.nix:226</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.path.removePrefix" class="title"><code class="literal">lib.path.removePrefix</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.path.removePrefix" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">removePrefix :: Path -&gt; Path -&gt; String</code></p><p>Remove the first path as a component-wise prefix from the second path.
The result is a <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.path.subpath.normalise" title="lib.path.subpath.normalise">normalised subpath string</a>.</p><p>Laws:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>Inverts <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.path.append" title="lib.path.append"><code class="literal">append</code></a> for <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.path.subpath.normalise" title="lib.path.subpath.normalise">normalised subpath string</a>:</p><pre><code class="programlisting hljs language-undefined" data-highlighted="yes">removePrefix p (append p s) == subpath.normalise s
</code></pre></li></ul></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">path1</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.path.removePrefix"></span><p class="title"><strong>Example&nbsp;192.&nbsp;<code class="literal">lib.path.removePrefix</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">removePrefix /foo /foo/bar/<span class="hljs-attr">baz</span>
=&gt; <span class="hljs-string">"./bar/baz"</span>
removePrefix /foo /<span class="hljs-attr">foo</span>
=&gt; <span class="hljs-string">"./."</span>
removePrefix /foo/bar /<span class="hljs-attr">foo</span>
=&gt; &lt;error&gt;
removePrefix /. /<span class="hljs-attr">foo</span>
=&gt; <span class="hljs-string">"./foo"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/path/default.nix#L271" target="_top">lib/path/default.nix:271</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.path.splitRoot" class="title"><code class="literal">lib.path.splitRoot</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.path.splitRoot" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">splitRoot :: Path -&gt; { root :: Path, subpath :: String }</code></p><p>Split the filesystem root from a <a class="link" href="https://nixos.org/manual/nix/stable/language/values#type-path" target="_top">path</a>.
The result is an attribute set with these attributes:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">root</code>: The filesystem root of the path, meaning that this directory has no parent directory.</p></li><li class="listitem"><p><code class="literal">subpath</code>: The <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.path.subpath.normalise" title="lib.path.subpath.normalise">normalised subpath string</a> that when <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.path.append" title="lib.path.append">appended</a> to <code class="literal">root</code> returns the original path.</p></li></ul></div><p>Laws:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.path.append" title="lib.path.append">Appending</a> the <code class="literal">root</code> and <code class="literal">subpath</code> gives the original path:</p><pre><code class="programlisting hljs language-nix" data-highlighted="yes"><span class="hljs-attr">p</span> ==
  append
    (splitRoot p).root
    (splitRoot p).subpath
</code></pre></li><li class="listitem"><p>Trying to get the parent directory of <code class="literal">root</code> using <a class="link" href="https://nixos.org/manual/nix/stable/language/builtins#builtins-readDir" target="_top"><code class="literal">readDir</code></a> returns <code class="literal">root</code> itself:</p><pre><code class="programlisting hljs language-nix" data-highlighted="yes"><span class="hljs-built_in">dirOf</span> (splitRoot p).<span class="hljs-attr">root</span> == (splitRoot p).root
</code></pre></li></ul></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">path</code></span></dt><dd><p>The path to split the root off of</p></dd></dl></div><div class="example"><span id="function-library-example-lib.path.splitRoot"></span><p class="title"><strong>Example&nbsp;193.&nbsp;<code class="literal">lib.path.splitRoot</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">splitRoot /foo/<span class="hljs-attr">bar</span>
=&gt; { <span class="hljs-attr">root</span> = /.; <span class="hljs-attr">subpath</span> = <span class="hljs-string">"./foo/bar"</span>; }

splitRoot /.
=&gt; { <span class="hljs-attr">root</span> = /.; <span class="hljs-attr">subpath</span> = <span class="hljs-string">"./."</span>; }

<span class="hljs-comment"># Nix neutralises `..` path components for all path values automatically</span>
splitRoot /foo/../<span class="hljs-attr">bar</span>
=&gt; { <span class="hljs-attr">root</span> = /.; <span class="hljs-attr">subpath</span> = <span class="hljs-string">"./bar"</span>; }

splitRoot <span class="hljs-string">"/foo/bar"</span>
=&gt; &lt;error&gt;
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/path/default.nix#L336" target="_top">lib/path/default.nix:336</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.path.hasStorePathPrefix" class="title"><code class="literal">lib.path.hasStorePathPrefix</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.path.hasStorePathPrefix" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">hasStorePathPrefix :: Path -&gt; Bool</code></p><p>Whether a <a class="link" href="https://nixos.org/manual/nix/stable/language/values#type-path" target="_top">path</a>
has a <a class="link" href="https://nixos.org/manual/nix/stable/store/store-path#store-path" target="_top">store path</a>
as a prefix.</p><div class="note"><h3 class="title">Note</h3><p>As with all functions of this <code class="literal">lib.path</code> library, it does not work on paths in strings,
which is how you’d typically get store paths.</p><p>Instead, this function only handles path values themselves,
which occur when Nix files in the store use relative path expressions.</p></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">path</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.path.hasStorePathPrefix"></span><p class="title"><strong>Example&nbsp;194.&nbsp;<code class="literal">lib.path.hasStorePathPrefix</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-comment"># Subpaths of derivation outputs have a store path as a prefix</span>
hasStorePathPrefix /nix/store/nvl9ic0pj1fpyln3zaqrf4cclbqdfn1j-foo/bar/<span class="hljs-attr">baz</span>
=&gt; <span class="hljs-literal">true</span>

<span class="hljs-comment"># The store directory itself is not a store path</span>
hasStorePathPrefix /nix/<span class="hljs-attr">store</span>
=&gt; <span class="hljs-literal">false</span>

<span class="hljs-comment"># Derivation outputs are store paths themselves</span>
hasStorePathPrefix /nix/store/<span class="hljs-attr">nvl9ic0pj1fpyln3zaqrf4cclbqdfn1j-foo</span>
=&gt; <span class="hljs-literal">true</span>

<span class="hljs-comment"># Paths outside the Nix store don't have a store path prefix</span>
hasStorePathPrefix /home/<span class="hljs-attr">user</span>
=&gt; <span class="hljs-literal">false</span>

<span class="hljs-comment"># Not all paths under the Nix store are store paths</span>
hasStorePathPrefix /nix/store/.links/<span class="hljs-number">10</span><span class="hljs-attr">gg8k3rmbw8p7gszarbk7qyd9jwxhcfq9i6s5i0qikx8alkk4hq</span>
=&gt; <span class="hljs-literal">false</span>

<span class="hljs-comment"># Store derivations are also store paths themselves</span>
hasStorePathPrefix /nix/store/nvl9ic0pj1fpyln3zaqrf4cclbqdfn1j-foo.<span class="hljs-attr">drv</span>
=&gt; <span class="hljs-literal">true</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/path/default.nix#L390" target="_top">lib/path/default.nix:390</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.path.subpath.isValid" class="title"><code class="literal">lib.path.subpath.isValid</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.path.subpath.isValid" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">subpath.isValid :: String -&gt; Bool</code></p><p>Whether a value is a valid subpath string.</p><p>A subpath string points to a specific file or directory within an absolute base directory.
It is a stricter form of a relative path that excludes <code class="literal">..</code> components, since those could escape the base directory.</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>The value is a string.</p></li><li class="listitem"><p>The string is not empty.</p></li><li class="listitem"><p>The string doesn’t start with a <code class="literal">/</code>.</p></li><li class="listitem"><p>The string doesn’t contain any <code class="literal">..</code> path components.</p></li></ul></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">value</code></span></dt><dd><p>The value to check</p></dd></dl></div><div class="example"><span id="function-library-example-lib.path.subpath.isValid"></span><p class="title"><strong>Example&nbsp;195.&nbsp;<code class="literal">lib.path.subpath.isValid</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-comment"># Not a string</span>
subpath.isValid <span class="hljs-attr">null</span>
=&gt; <span class="hljs-literal">false</span>

<span class="hljs-comment"># Empty string</span>
subpath.isValid <span class="hljs-string">""</span>
=&gt; <span class="hljs-literal">false</span>

<span class="hljs-comment"># Absolute path</span>
subpath.isValid <span class="hljs-string">"/foo"</span>
=&gt; <span class="hljs-literal">false</span>

<span class="hljs-comment"># Contains a `..` path component</span>
subpath.isValid <span class="hljs-string">"../foo"</span>
=&gt; <span class="hljs-literal">false</span>

<span class="hljs-comment"># Valid subpath</span>
subpath.isValid <span class="hljs-string">"foo/bar"</span>
=&gt; <span class="hljs-literal">true</span>

<span class="hljs-comment"># Doesn't need to be normalised</span>
subpath.isValid <span class="hljs-string">"./foo//bar/"</span>
=&gt; <span class="hljs-literal">true</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/path/default.nix#L447" target="_top">lib/path/default.nix:447</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.path.subpath.join" class="title"><code class="literal">lib.path.subpath.join</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.path.subpath.join" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">subpath.join :: [ String ] -&gt; String</code></p><p>Join subpath strings together using <code class="literal">/</code>, returning a normalised subpath string.</p><p>Like <code class="literal">concatStringsSep "/"</code> but safer, specifically:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>All elements must be <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.path.subpath.isValid" title="lib.path.subpath.isValid">valid subpath strings</a>.</p></li><li class="listitem"><p>The result gets <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.path.subpath.normalise" title="lib.path.subpath.normalise">normalised</a>.</p></li><li class="listitem"><p>The edge case of an empty list gets properly handled by returning the neutral subpath <code class="literal">"./."</code>.</p></li></ul></div><p>Laws:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>Associativity:</p><pre><code class="programlisting hljs language-undefined" data-highlighted="yes">subpath.join [ x (subpath.join [ y z ]) ] == subpath.join [ (subpath.join [ x y ]) z ]
</code></pre></li><li class="listitem"><p>Identity - <code class="literal">"./."</code> is the neutral element for normalised paths:</p><pre><code class="programlisting hljs language-bash" data-highlighted="yes">subpath.join [ ] == <span class="hljs-string">"./."</span>
subpath.join [ (subpath.normalise p) <span class="hljs-string">"./."</span> ] == subpath.normalise p
subpath.join [ <span class="hljs-string">"./."</span> (subpath.normalise p) ] == subpath.normalise p
</code></pre></li><li class="listitem"><p>Normalisation - the result is <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.path.subpath.normalise" title="lib.path.subpath.normalise">normalised</a>:</p><pre><code class="programlisting hljs language-nix" data-highlighted="yes">subpath.join <span class="hljs-attr">ps</span> == subpath.normalise (subpath.join ps)
</code></pre></li><li class="listitem"><p>For non-empty lists, the implementation is equivalent to <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.path.subpath.normalise" title="lib.path.subpath.normalise">normalising</a> the result of <code class="literal">concatStringsSep "/"</code>.
Note that the above laws can be derived from this one:</p><pre><code class="programlisting hljs language-nix" data-highlighted="yes">ps != [] -&gt; subpath.join <span class="hljs-attr">ps</span> == subpath.normalise (concatStringsSep <span class="hljs-string">"/"</span> ps)
</code></pre></li></ul></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">subpaths</code></span></dt><dd><p>The list of subpaths to join together</p></dd></dl></div><div class="example"><span id="function-library-example-lib.path.subpath.join"></span><p class="title"><strong>Example&nbsp;196.&nbsp;<code class="literal">lib.path.subpath.join</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">subpath.join [ <span class="hljs-string">"foo"</span> <span class="hljs-string">"bar/baz"</span> ]
=&gt; <span class="hljs-string">"./foo/bar/baz"</span>

<span class="hljs-comment"># normalise the result</span>
subpath.join [ <span class="hljs-string">"./foo"</span> <span class="hljs-string">"."</span> <span class="hljs-string">"bar//./baz/"</span> ]
=&gt; <span class="hljs-string">"./foo/bar/baz"</span>

<span class="hljs-comment"># passing an empty list results in the current directory</span>
subpath.join [ ]
=&gt; <span class="hljs-string">"./."</span>

<span class="hljs-comment"># elements must be valid subpath strings</span>
subpath.join [ /foo ]
=&gt; &lt;error&gt;
subpath.join [ <span class="hljs-string">""</span> ]
=&gt; &lt;error&gt;
subpath.join [ <span class="hljs-string">"/foo"</span> ]
=&gt; &lt;error&gt;
subpath.join [ <span class="hljs-string">"../foo"</span> ]
=&gt; &lt;error&gt;
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/path/default.nix#L510" target="_top">lib/path/default.nix:510</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.path.subpath.components" class="title"><code class="literal">lib.path.subpath.components</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.path.subpath.components" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">subpath.components :: String -&gt; [ String ]</code></p><p>Split <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.path.subpath.isValid" title="lib.path.subpath.isValid">a subpath</a> into its path component strings.
Throw an error if the subpath isn’t valid.
Note that the returned path components are also <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.path.subpath.isValid" title="lib.path.subpath.isValid">valid subpath strings</a>, though they are intentionally not <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.path.subpath.normalise" title="lib.path.subpath.normalise">normalised</a>.</p><p>Laws:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>Splitting a subpath into components and <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.path.subpath.join" title="lib.path.subpath.join">joining</a> the components gives the same subpath but <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.path.subpath.normalise" title="lib.path.subpath.normalise">normalised</a>:</p><pre><code class="programlisting hljs language-undefined" data-highlighted="yes">subpath.join (subpath.components s) == subpath.normalise s
</code></pre></li></ul></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">subpath</code></span></dt><dd><p>The subpath string to split into components</p></dd></dl></div><div class="example"><span id="function-library-example-lib.path.subpath.components"></span><p class="title"><strong>Example&nbsp;197.&nbsp;<code class="literal">lib.path.subpath.components</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">subpath.components <span class="hljs-string">"."</span>
=&gt; [ ]

subpath.components <span class="hljs-string">"./foo//bar/./baz/"</span>
=&gt; [ <span class="hljs-string">"foo"</span> <span class="hljs-string">"bar"</span> <span class="hljs-string">"baz"</span> ]

subpath.components <span class="hljs-string">"/foo"</span>
=&gt; &lt;error&gt;
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/path/default.nix#L552" target="_top">lib/path/default.nix:552</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.path.subpath.normalise" class="title"><code class="literal">lib.path.subpath.normalise</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.path.subpath.normalise" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">subpath.normalise :: String -&gt; String</code></p><p>Normalise a subpath. Throw an error if the subpath isn’t <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.path.subpath.isValid" title="lib.path.subpath.isValid">valid</a>.</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>Limit repeating <code class="literal">/</code> to a single one.</p></li><li class="listitem"><p>Remove redundant <code class="literal">.</code> components.</p></li><li class="listitem"><p>Remove trailing <code class="literal">/</code> and <code class="literal">/.</code>.</p></li><li class="listitem"><p>Add leading <code class="literal">./</code>.</p></li></ul></div><p>Laws:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>Idempotency - normalising multiple times gives the same result:</p><pre><code class="programlisting hljs language-undefined" data-highlighted="yes">subpath.normalise (subpath.normalise p) == subpath.normalise p
</code></pre></li><li class="listitem"><p>Uniqueness - there’s only a single normalisation for the paths that lead to the same file system node:</p><pre><code class="programlisting hljs language-bash" data-highlighted="yes">subpath.normalise p != subpath.normalise q -&gt; $(<span class="hljs-built_in">realpath</span> <span class="hljs-variable">${p}</span>) != $(<span class="hljs-built_in">realpath</span> <span class="hljs-variable">${q}</span>)
</code></pre></li><li class="listitem"><p>Don’t change the result when <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.path.append" title="lib.path.append">appended</a> to a Nix path value:</p><pre><code class="programlisting hljs language-nix" data-highlighted="yes">append base <span class="hljs-attr">p</span> == append base (subpath.normalise p)
</code></pre></li><li class="listitem"><p>Don’t change the path according to <code class="literal">realpath</code>:</p><pre><code class="programlisting hljs language-shell" data-highlighted="yes"><span class="hljs-meta prompt_">$</span><span class="language-bash">(<span class="hljs-built_in">realpath</span> <span class="hljs-variable">${p}</span>) == $(<span class="hljs-built_in">realpath</span> <span class="hljs-variable">${subpath.normalise p}</span>)</span>
</code></pre></li><li class="listitem"><p>Only error on <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.path.subpath.isValid" title="lib.path.subpath.isValid">invalid subpaths</a>:</p><pre><code class="programlisting hljs language-nix" data-highlighted="yes"><span class="hljs-built_in">builtins</span>.tryEval (subpath.normalise p)).<span class="hljs-attr">success</span> == subpath.isValid p
</code></pre></li></ul></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">subpath</code></span></dt><dd><p>The subpath string to normalise</p></dd></dl></div><div class="example"><span id="function-library-example-lib.path.subpath.normalise"></span><p class="title"><strong>Example&nbsp;198.&nbsp;<code class="literal">lib.path.subpath.normalise</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-comment"># limit repeating `/` to a single one</span>
subpath.normalise <span class="hljs-string">"foo//bar"</span>
=&gt; <span class="hljs-string">"./foo/bar"</span>

<span class="hljs-comment"># remove redundant `.` components</span>
subpath.normalise <span class="hljs-string">"foo/./bar"</span>
=&gt; <span class="hljs-string">"./foo/bar"</span>

<span class="hljs-comment"># add leading `./`</span>
subpath.normalise <span class="hljs-string">"foo/bar"</span>
=&gt; <span class="hljs-string">"./foo/bar"</span>

<span class="hljs-comment"># remove trailing `/`</span>
subpath.normalise <span class="hljs-string">"foo/bar/"</span>
=&gt; <span class="hljs-string">"./foo/bar"</span>

<span class="hljs-comment"># remove trailing `/.`</span>
subpath.normalise <span class="hljs-string">"foo/bar/."</span>
=&gt; <span class="hljs-string">"./foo/bar"</span>

<span class="hljs-comment"># Return the current directory as `./.`</span>
subpath.normalise <span class="hljs-string">"."</span>
=&gt; <span class="hljs-string">"./."</span>

<span class="hljs-comment"># error on `..` path components</span>
subpath.normalise <span class="hljs-string">"foo/../bar"</span>
=&gt; &lt;error&gt;

<span class="hljs-comment"># error on empty string</span>
subpath.normalise <span class="hljs-string">""</span>
=&gt; &lt;error&gt;

<span class="hljs-comment"># error on absolute path</span>
subpath.normalise <span class="hljs-string">"/foo"</span>
=&gt; &lt;error&gt;
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/path/default.nix#L633" target="_top">lib/path/default.nix:633</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-functions-library-filesystem" class="title">lib.filesystem: filesystem functions   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-functions-library-filesystem" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Functions for querying information about the filesystem
without copying any files to the Nix store.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.filesystem.pathType" class="title"><code class="literal">lib.filesystem.pathType</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.filesystem.pathType" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">pathType :: Path -&gt; String</code></p><p>The type of a path. The path needs to exist and be accessible.
The result is either “directory” for a directory, “regular” for a regular file, “symlink” for a symlink, or “unknown” for anything else.</p><div class="example"><span id="function-library-example-lib.filesystem.pathType"></span><p class="title"><strong>Example&nbsp;199.&nbsp;<code class="literal">lib.filesystem.pathType</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">pathType /.
=&gt; <span class="hljs-string">"directory"</span>

pathType /some/file.<span class="hljs-attr">nix</span>
=&gt; <span class="hljs-string">"regular"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/filesystem.nix#L35" target="_top">lib/filesystem.nix:35</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.filesystem.pathIsDirectory" class="title"><code class="literal">lib.filesystem.pathIsDirectory</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.filesystem.pathIsDirectory" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">pathIsDirectory :: Path -&gt; Bool</code></p><p>Whether a path exists and is a directory.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">path</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.filesystem.pathIsDirectory"></span><p class="title"><strong>Example&nbsp;200.&nbsp;<code class="literal">lib.filesystem.pathIsDirectory</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">pathIsDirectory /.
=&gt; <span class="hljs-literal">true</span>

pathIsDirectory /this/does/not/<span class="hljs-attr">exist</span>
=&gt; <span class="hljs-literal">false</span>

pathIsDirectory /some/file.<span class="hljs-attr">nix</span>
=&gt; <span class="hljs-literal">false</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/filesystem.nix#L67" target="_top">lib/filesystem.nix:67</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.filesystem.pathIsRegularFile" class="title"><code class="literal">lib.filesystem.pathIsRegularFile</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.filesystem.pathIsRegularFile" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">pathIsRegularFile :: Path -&gt; Bool</code></p><p>Whether a path exists and is a regular file, meaning not a symlink or any other special file type.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">path</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.filesystem.pathIsRegularFile"></span><p class="title"><strong>Example&nbsp;201.&nbsp;<code class="literal">lib.filesystem.pathIsRegularFile</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">pathIsRegularFile /.
=&gt; <span class="hljs-literal">false</span>

pathIsRegularFile /this/does/not/<span class="hljs-attr">exist</span>
=&gt; <span class="hljs-literal">false</span>

pathIsRegularFile /some/file.<span class="hljs-attr">nix</span>
=&gt; <span class="hljs-literal">true</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/filesystem.nix#L86" target="_top">lib/filesystem.nix:86</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.filesystem.haskellPathsInDir" class="title"><code class="literal">lib.filesystem.haskellPathsInDir</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.filesystem.haskellPathsInDir" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">Path -&gt; Map String Path</code></p><p>A map of all haskell packages defined in the given path,
identified by having a cabal file with the same name as the
directory itself.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">root</code></span></dt><dd><p>The directory within to search</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/filesystem.nix#L96" target="_top">lib/filesystem.nix:96</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.filesystem.locateDominatingFile" class="title"><code class="literal">lib.filesystem.locateDominatingFile</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.filesystem.locateDominatingFile" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">RegExp -&gt; Path -&gt; Nullable { path : Path; matches : [ MatchResults ]; }</code></p><p>Find the first directory containing a file matching ‘pattern’
upward from a given ‘file’.
Returns ‘null’ if no directories contain a file matching ‘pattern’.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">pattern</code></span></dt><dd><p>The pattern to search for</p></dd><dt><span class="term"><code class="literal">file</code></span></dt><dd><p>The file to start searching upward from</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/filesystem.nix#L119" target="_top">lib/filesystem.nix:119</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.filesystem.listFilesRecursive" class="title"><code class="literal">lib.filesystem.listFilesRecursive</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.filesystem.listFilesRecursive" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">Path -&gt; [ Path ]</code></p><p>Given a directory, return a flattened list of all files within it recursively.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">dir</code></span></dt><dd><p>The path to recursively list</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/filesystem.nix#L147" target="_top">lib/filesystem.nix:147</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-functions-library-fileset" class="title">lib.fileset: file set functions   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-functions-library-fileset" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p><span id="sec-fileset"></span></p><p>The <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#sec-functions-library-fileset" title="lib.fileset: file set functions"><code class="literal">lib.fileset</code></a> library allows you to work with <span class="emphasis"><em>file sets</em></span>.
A file set is a (mathematical) set of local files that can be added to the Nix store for use in Nix derivations.
File sets are easy and safe to use, providing obvious and composable semantics with good error messages to prevent mistakes.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="sec-fileset-overview" class="title">Overview   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-fileset-overview" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Basics:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/stable/#sec-fileset-path-coercion" title="Implicit coercion from paths to file sets">Implicit coercion from paths to file sets</a></p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fileset.maybeMissing" title="lib.fileset.maybeMissing"><code class="literal">lib.fileset.maybeMissing</code></a>:</p><p>Create a file set from a path that may be missing.</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fileset.trace" title="lib.fileset.trace"><code class="literal">lib.fileset.trace</code></a>/<a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fileset.trace" title="lib.fileset.trace"><code class="literal">lib.fileset.traceVal</code></a>:</p><p>Pretty-print file sets for debugging.</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fileset.toSource" title="lib.fileset.toSource"><code class="literal">lib.fileset.toSource</code></a>:</p><p>Add files in file sets to the store to use as derivation sources.</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fileset.toList" title="lib.fileset.toList"><code class="literal">lib.fileset.toList</code></a>:</p><p>The list of files contained in a file set.</p></li></ul></div><p>Combinators:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fileset.union" title="lib.fileset.union"><code class="literal">lib.fileset.union</code></a>/<a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fileset.unions" title="lib.fileset.unions"><code class="literal">lib.fileset.unions</code></a>:</p><p>Create a larger file set from all the files in multiple file sets.</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fileset.intersection" title="lib.fileset.intersection"><code class="literal">lib.fileset.intersection</code></a>:</p><p>Create a smaller file set from only the files in both file sets.</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fileset.difference" title="lib.fileset.difference"><code class="literal">lib.fileset.difference</code></a>:</p><p>Create a smaller file set containing all files that are in one file set, but not another one.</p></li></ul></div><p>Filtering:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fileset.fileFilter" title="lib.fileset.fileFilter"><code class="literal">lib.fileset.fileFilter</code></a>:</p><p>Create a file set from all files that satisisfy a predicate in a directory.</p></li></ul></div><p>Utilities:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fileset.fromSource" title="lib.fileset.fromSource"><code class="literal">lib.fileset.fromSource</code></a>:</p><p>Create a file set from a <code class="literal">lib.sources</code>-based value.</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fileset.gitTracked" title="lib.fileset.gitTracked"><code class="literal">lib.fileset.gitTracked</code></a>/<a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fileset.gitTrackedWith" title="lib.fileset.gitTrackedWith"><code class="literal">lib.fileset.gitTrackedWith</code></a>:</p><p>Create a file set from all tracked files in a local Git repository.</p></li></ul></div><p>If you need more file set functions,
see <a class="link" href="https://github.com/NixOS/nixpkgs/issues/266356" target="_top">this issue</a> to request it.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="sec-fileset-path-coercion" class="title">Implicit coercion from paths to file sets   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-fileset-path-coercion" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>All functions accepting file sets as arguments can also accept <a class="link" href="https://nixos.org/manual/nix/stable/language/values#type-path" target="_top">paths</a> as arguments.
Such path arguments are implicitly coerced to file sets containing all files under that path:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>A path to a file turns into a file set containing that single file.</p></li><li class="listitem"><p>A path to a directory turns into a file set containing all files <span class="emphasis"><em>recursively</em></span> in that directory.</p></li></ul></div><p>If the path points to a non-existent location, an error is thrown.</p><div class="note"><h3 class="title">Note</h3><p>Just like in Git, file sets cannot represent empty directories.
Because of this, a path to a directory that contains no files (recursively) will turn into a file set containing no files.</p></div><div class="note"><h3 class="title">Note</h3><p>File set coercion does <span class="emphasis"><em>not</em></span> add any of the files under the coerced paths to the store.
Only the <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fileset.toSource" title="lib.fileset.toSource"><code class="literal">toSource</code></a> function adds files to the Nix store, and only those files contained in the <code class="literal">fileset</code> argument.
This is in contrast to using <a class="link" href="https://nixos.org/manual/nix/stable/language/values#type-path" target="_top">paths in string interpolation</a>, which does add the entire referenced path to the store.</p></div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="sec-fileset-path-coercion-example" class="title">Example   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-fileset-path-coercion-example" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Assume we are in a local directory with a file hierarchy like this:</p><pre><code class="programlisting hljs language-undefined" data-highlighted="yes">├─ a/
│  ├─ x (file)
│  └─ b/
│   &nbsp; └─ y (file)
└─ c/
 &nbsp;&nbsp;└─ d/
</code></pre><p>Here’s a listing of which files get included when different path expressions get coerced to file sets:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">./.</code> as a file set contains both <code class="literal">a/x</code> and <code class="literal">a/b/y</code> (<code class="literal">c/</code> does not contain any files and is therefore omitted).</p></li><li class="listitem"><p><code class="literal">./a</code> as a file set contains both <code class="literal">a/x</code> and <code class="literal">a/b/y</code>.</p></li><li class="listitem"><p><code class="literal">./a/x</code> as a file set contains only <code class="literal">a/x</code>.</p></li><li class="listitem"><p><code class="literal">./a/b</code> as a file set contains only <code class="literal">a/b/y</code>.</p></li><li class="listitem"><p><code class="literal">./c</code> as a file set is empty, since neither <code class="literal">c</code> nor <code class="literal">c/d</code> contain any files.</p></li></ul></div>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.fileset.maybeMissing" class="title"><code class="literal">lib.fileset.maybeMissing</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fileset.maybeMissing" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">maybeMissing :: Path -&gt; FileSet</code></p><p>Create a file set from a path that may or may not exist:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>If the path does exist, the path is <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#sec-fileset-path-coercion" title="Implicit coercion from paths to file sets">coerced to a file set</a>.</p></li><li class="listitem"><p>If the path does not exist, a file set containing no files is returned.</p></li></ul></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">path</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.fileset.maybeMissing"></span><p class="title"><strong>Example&nbsp;202.&nbsp;<code class="literal">lib.fileset.maybeMissing</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-comment"># All files in the current directory, but excluding main.o if it exists</span>
difference ./. (maybeMissing ./main.o)
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/fileset/default.nix#L172" target="_top">lib/fileset/default.nix:172</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.fileset.trace" class="title"><code class="literal">lib.fileset.trace</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fileset.trace" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">trace :: FileSet -&gt; Any -&gt; Any</code></p><p>Incrementally evaluate and trace a file set in a pretty way.
This function is only intended for debugging purposes.
The exact tracing format is unspecified and may change.</p><p>This function takes a final argument to return.
In comparison, <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fileset.traceVal" title="lib.fileset.traceVal"><code class="literal">traceVal</code></a> returns
the given file set argument.</p><p>This variant is useful for tracing file sets in the Nix repl.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">fileset</code></span></dt><dd><p>The file set to trace.</p><p>This argument can also be a path,
which gets <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#sec-fileset-path-coercion" title="Implicit coercion from paths to file sets">implicitly coerced to a file set</a>.</p></dd></dl></div><div class="example"><span id="function-library-example-lib.fileset.trace"></span><p class="title"><strong>Example&nbsp;203.&nbsp;<code class="literal">lib.fileset.trace</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">trace (unions [ ./Makefile ./src ./tests/run.sh ]) <span class="hljs-attr">null</span>
=&gt;
trace: /home/user/src/myProject
trace: - Makefile (regular)
trace: - src (all files <span class="hljs-keyword">in</span> directory)
trace: - tests
trace:   - run.sh (regular)
<span class="hljs-literal">null</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/fileset/default.nix#L210" target="_top">lib/fileset/default.nix:210</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.fileset.traceVal" class="title"><code class="literal">lib.fileset.traceVal</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fileset.traceVal" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">traceVal :: FileSet -&gt; FileSet</code></p><p>Incrementally evaluate and trace a file set in a pretty way.
This function is only intended for debugging purposes.
The exact tracing format is unspecified and may change.</p><p>This function returns the given file set.
In comparison, <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fileset.trace" title="lib.fileset.trace"><code class="literal">trace</code></a> takes another argument to return.</p><p>This variant is useful for tracing file sets passed as arguments to other functions.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">fileset</code></span></dt><dd><p>The file set to trace and return.</p><p>This argument can also be a path,
which gets <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#sec-fileset-path-coercion" title="Implicit coercion from paths to file sets">implicitly coerced to a file set</a>.</p></dd></dl></div><div class="example"><span id="function-library-example-lib.fileset.traceVal"></span><p class="title"><strong>Example&nbsp;204.&nbsp;<code class="literal">lib.fileset.traceVal</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">toSource {
  <span class="hljs-attr">root</span> = ./.;
  <span class="hljs-attr">fileset</span> = traceVal (unions [
    ./Makefile
    ./src
    ./tests/run.sh
  ]);
}
=&gt;
trace: /home/user/src/myProject
trace: - Makefile (regular)
trace: - src (all files <span class="hljs-keyword">in</span> directory)
trace: - tests
trace:   - run.sh (regular)
<span class="hljs-string">"/nix/store/...-source"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/fileset/default.nix#L257" target="_top">lib/fileset/default.nix:257</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.fileset.toSource" class="title"><code class="literal">lib.fileset.toSource</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fileset.toSource" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>:</p><pre><code class="programlisting hljs language-undefined" data-highlighted="yes">toSource :: {
  root :: Path,
  fileset :: FileSet,
} -&gt; SourceLike
</code></pre><p>Add the local files contained in <code class="literal">fileset</code> to the store as a single <a class="link" href="https://nixos.org/manual/nix/stable/glossary#gloss-store-path" target="_top">store path</a> rooted at <code class="literal">root</code>.</p><p>The result is the store path as a string-like value, making it usable e.g. as the <code class="literal">src</code> of a derivation, or in string interpolation:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">stdenv.mkDerivation {
  <span class="hljs-attr">src</span> = lib.fileset.toSource { ... };
  <span class="hljs-comment"># ...</span>
}
</code></pre><p>The name of the store path is always <code class="literal">source</code>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">structured function argument</span></dt><dd><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">root</code></span></dt><dd><p>(required) The local directory <a class="link" href="https://nixos.org/manual/nix/stable/language/values#type-path" target="_top">path</a> that will correspond to the root of the resulting store path.
Paths in <a class="link" href="https://nixos.org/manual/nix/stable/language/values#type-string" target="_top">strings</a>, including Nix store paths, cannot be passed as <code class="literal">root</code>.
<code class="literal">root</code> has to be a directory.</p><div class="note"><h3 class="title">Note</h3><p>Changing <code class="literal">root</code> only affects the directory structure of the resulting store path, it does not change which files are added to the store.
The only way to change which files get added to the store is by changing the <code class="literal">fileset</code> attribute.</p></div></dd><dt><span class="term"><code class="literal">fileset</code></span></dt><dd><p>(required) The file set whose files to import into the store.
File sets can be created using other functions in this library.
This argument can also be a path,
which gets <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#sec-fileset-path-coercion" title="Implicit coercion from paths to file sets">implicitly coerced to a file set</a>.</p><div class="note"><h3 class="title">Note</h3><p>If a directory does not recursively contain any file, it is omitted from the store path contents.</p></div></dd></dl></div></dd></dl></div><div class="example"><span id="function-library-example-lib.fileset.toSource"></span><p class="title"><strong>Example&nbsp;205.&nbsp;<code class="literal">lib.fileset.toSource</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-comment"># Import the current directory into the store</span>
<span class="hljs-comment"># but only include files under ./src</span>
toSource {
  <span class="hljs-attr">root</span> = ./.;
  <span class="hljs-attr">fileset</span> = ./src;
}
=&gt; <span class="hljs-string">"/nix/store/...-source"</span>

<span class="hljs-comment"># Import the current directory into the store</span>
<span class="hljs-comment"># but only include ./Makefile and all files under ./src</span>
toSource {
  <span class="hljs-attr">root</span> = ./.;
  <span class="hljs-attr">fileset</span> = union
    ./Makefile
    ./src;
}
=&gt; <span class="hljs-string">"/nix/store/...-source"</span>

<span class="hljs-comment"># Trying to include a file outside the root will fail</span>
toSource {
  <span class="hljs-attr">root</span> = ./.;
  <span class="hljs-attr">fileset</span> = unions [
    ./Makefile
    ./src
    ../LICENSE
  ];
}
=&gt; &lt;error&gt;

<span class="hljs-comment"># The root needs to point to a directory that contains all the files</span>
toSource {
  <span class="hljs-attr">root</span> = ../.;
  <span class="hljs-attr">fileset</span> = unions [
    ./Makefile
    ./src
    ../LICENSE
  ];
}
=&gt; <span class="hljs-string">"/nix/store/...-source"</span>

<span class="hljs-comment"># The root has to be a local filesystem path</span>
toSource {
  <span class="hljs-attr">root</span> = <span class="hljs-string">"/nix/store/...-source"</span>;
  <span class="hljs-attr">fileset</span> = ./.;
}
=&gt; &lt;error&gt;
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/fileset/default.nix#L343" target="_top">lib/fileset/default.nix:343</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.fileset.toList" class="title"><code class="literal">lib.fileset.toList</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fileset.toList" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">toList :: FileSet -&gt; [ Path ]</code></p><p>The list of file paths contained in the given file set.</p><div class="note"><h3 class="title">Note</h3><p>This function is strict in the entire file set.
This is in contrast with combinators <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fileset.union" title="lib.fileset.union"><code class="literal">lib.fileset.union</code></a>,
<a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fileset.intersection" title="lib.fileset.intersection"><code class="literal">lib.fileset.intersection</code></a> and <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fileset.difference" title="lib.fileset.difference"><code class="literal">lib.fileset.difference</code></a>.</p><p>Thus it is recommended to call <code class="literal">toList</code> on file sets created using the combinators,
instead of doing list processing on the result of <code class="literal">toList</code>.</p></div><p>The resulting list of files can be turned back into a file set using <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fileset.unions" title="lib.fileset.unions"><code class="literal">lib.fileset.unions</code></a>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">fileset</code></span></dt><dd><p>The file set whose file paths to return. This argument can also be a path, which gets <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#sec-fileset-path-coercion" title="Implicit coercion from paths to file sets">implicitly coerced to a file set</a>.</p></dd></dl></div><div class="example"><span id="function-library-example-lib.fileset.toList"></span><p class="title"><strong>Example&nbsp;206.&nbsp;<code class="literal">lib.fileset.toList</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">toList ./.
[ ./README.md ./Makefile ./src/main.c ./src/main.h ]

toList (difference ./. ./src)
[ ./README.md ./Makefile ]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/fileset/default.nix#L445" target="_top">lib/fileset/default.nix:445</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.fileset.union" class="title"><code class="literal">lib.fileset.union</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fileset.union" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">union :: FileSet -&gt; FileSet -&gt; FileSet</code></p><p>The file set containing all files that are in either of two given file sets.
This is the same as <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fileset.unions" title="lib.fileset.unions"><code class="literal">unions</code></a>,
but takes just two file sets instead of a list.
See also <a class="link" href="https://en.wikipedia.org/wiki/Union_(set_theory)" target="_top">Union (set theory)</a>.</p><p>The given file sets are evaluated as lazily as possible,
with the first argument being evaluated first if needed.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">fileset1</code></span></dt><dd><p>The first file set. This argument can also be a path, which gets <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#sec-fileset-path-coercion" title="Implicit coercion from paths to file sets">implicitly coerced to a file set</a>.</p></dd><dt><span class="term"><code class="literal">fileset2</code></span></dt><dd><p>The second file set. This argument can also be a path, which gets <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#sec-fileset-path-coercion" title="Implicit coercion from paths to file sets">implicitly coerced to a file set</a>.</p></dd></dl></div><div class="example"><span id="function-library-example-lib.fileset.union"></span><p class="title"><strong>Example&nbsp;207.&nbsp;<code class="literal">lib.fileset.union</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-comment"># Create a file set containing the file `Makefile`</span>
<span class="hljs-comment"># and all files recursively in the `src` directory</span>
union ./Makefile ./src

<span class="hljs-comment"># Create a file set containing the file `Makefile`</span>
<span class="hljs-comment"># and the LICENSE file from the parent directory</span>
union ./Makefile ../LICENSE
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/fileset/default.nix#L473" target="_top">lib/fileset/default.nix:473</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.fileset.unions" class="title"><code class="literal">lib.fileset.unions</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fileset.unions" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">unions :: [ FileSet ] -&gt; FileSet</code></p><p>The file set containing all files that are in any of the given file sets.
This is the same as <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fileset.unions" title="lib.fileset.unions"><code class="literal">union</code></a>,
but takes a list of file sets instead of just two.
See also <a class="link" href="https://en.wikipedia.org/wiki/Union_(set_theory)" target="_top">Union (set theory)</a>.</p><p>The given file sets are evaluated as lazily as possible,
with earlier elements being evaluated first if needed.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">filesets</code></span></dt><dd><p>A list of file sets. The elements can also be paths, which get <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#sec-fileset-path-coercion" title="Implicit coercion from paths to file sets">implicitly coerced to file sets</a>.</p></dd></dl></div><div class="example"><span id="function-library-example-lib.fileset.unions"></span><p class="title"><strong>Example&nbsp;208.&nbsp;<code class="literal">lib.fileset.unions</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-comment"># Create a file set containing selected files</span>
unions [
  <span class="hljs-comment"># Include the single file `Makefile` in the current directory</span>
  <span class="hljs-comment"># This errors if the file doesn't exist</span>
  ./Makefile

  <span class="hljs-comment"># Recursively include all files in the `src/code` directory</span>
  <span class="hljs-comment"># If this directory is empty this has no effect</span>
  ./src/code

  <span class="hljs-comment"># Include the files `run.sh` and `unit.c` from the `tests` directory</span>
  ./tests/run.sh
  ./tests/unit.c

  <span class="hljs-comment"># Include the `LICENSE` file from the parent directory</span>
  ../LICENSE
]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/fileset/default.nix#L525" target="_top">lib/fileset/default.nix:525</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.fileset.intersection" class="title"><code class="literal">lib.fileset.intersection</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fileset.intersection" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">intersection :: FileSet -&gt; FileSet -&gt; FileSet</code></p><p>The file set containing all files that are in both of two given file sets.
See also <a class="link" href="https://en.wikipedia.org/wiki/Intersection_(set_theory)" target="_top">Intersection (set theory)</a>.</p><p>The given file sets are evaluated as lazily as possible,
with the first argument being evaluated first if needed.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">fileset1</code></span></dt><dd><p>The first file set. This argument can also be a path, which gets <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#sec-fileset-path-coercion" title="Implicit coercion from paths to file sets">implicitly coerced to a file set</a>.</p></dd><dt><span class="term"><code class="literal">fileset2</code></span></dt><dd><p>The second file set. This argument can also be a path, which gets <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#sec-fileset-path-coercion" title="Implicit coercion from paths to file sets">implicitly coerced to a file set</a>.</p></dd></dl></div><div class="example"><span id="function-library-example-lib.fileset.intersection"></span><p class="title"><strong>Example&nbsp;209.&nbsp;<code class="literal">lib.fileset.intersection</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-comment"># Limit the selected files to the ones in ./., so only ./src and ./Makefile</span>
intersection ./. (unions [ ../LICENSE ./src ./Makefile ])
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/fileset/default.nix#L558" target="_top">lib/fileset/default.nix:558</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.fileset.difference" class="title"><code class="literal">lib.fileset.difference</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fileset.difference" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">union :: FileSet -&gt; FileSet -&gt; FileSet</code></p><p>The file set containing all files from the first file set that are not in the second file set.
See also <a class="link" href="https://en.wikipedia.org/wiki/Complement_(set_theory)#Relative_complement" target="_top">Difference (set theory)</a>.</p><p>The given file sets are evaluated as lazily as possible,
with the first argument being evaluated first if needed.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">positive</code></span></dt><dd><p>The positive file set. The result can only contain files that are also in this file set.  This argument can also be a path, which gets <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#sec-fileset-path-coercion" title="Implicit coercion from paths to file sets">implicitly coerced to a file set</a>.</p></dd><dt><span class="term"><code class="literal">negative</code></span></dt><dd><p>The negative file set. The result will never contain files that are also in this file set.  This argument can also be a path, which gets <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#sec-fileset-path-coercion" title="Implicit coercion from paths to file sets">implicitly coerced to a file set</a>.</p></dd></dl></div><div class="example"><span id="function-library-example-lib.fileset.difference"></span><p class="title"><strong>Example&nbsp;210.&nbsp;<code class="literal">lib.fileset.difference</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-comment"># Create a file set containing all files from the current directory,</span>
<span class="hljs-comment"># except ones under ./tests</span>
difference ./. ./tests

<span class="hljs-keyword">let</span>
  <span class="hljs-comment"># A set of Nix-related files</span>
  <span class="hljs-attr">nixFiles</span> = unions [ ./default.nix ./nix ./tests/default.nix ];
<span class="hljs-keyword">in</span>
<span class="hljs-comment"># Create a file set containing all files under ./tests, except ones in `nixFiles`,</span>
<span class="hljs-comment"># meaning only without ./tests/default.nix</span>
difference ./tests nixFiles
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/fileset/default.nix#L606" target="_top">lib/fileset/default.nix:606</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.fileset.fileFilter" class="title"><code class="literal">lib.fileset.fileFilter</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fileset.fileFilter" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>:</p><pre><code class="programlisting hljs language-shell" data-highlighted="yes">fileFilter ::
  ({
    name :: String,
    type :: String,
    hasExt :: String -&gt; Bool,
    ...
  } -&gt; Bool)
<span class="hljs-meta prompt_">  -&gt; </span><span class="language-bash">Path</span>
<span class="hljs-meta prompt_">  -&gt; </span><span class="language-bash">FileSet</span>
</code></pre><p>Filter a file set to only contain files matching some predicate.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">predicate</code></span></dt><dd><p>The predicate function to call on all files contained in given file set.
A file is included in the resulting file set if this function returns true for it.</p><p>This function is called with an attribute set containing these attributes:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><code class="literal">name</code> (String): The name of the file</p></li><li class="listitem"><p><code class="literal">type</code> (String, one of <code class="literal">"regular"</code>, <code class="literal">"symlink"</code> or <code class="literal">"unknown"</code>): The type of the file.
This matches result of calling <a class="link" href="https://nixos.org/manual/nix/stable/language/builtins#builtins-readFileType" target="_top"><code class="literal">builtins.readFileType</code></a> on the file’s path.</p></li><li class="listitem"><p><code class="literal">hasExt</code> (String -&gt; Bool): Whether the file has a certain file extension.
<code class="literal">hasExt ext</code> is true only if <code class="literal">hasSuffix ".${ext}" name</code>.</p><p>This also means that e.g. for a file with name <code class="literal">.gitignore</code>,
<code class="literal">hasExt "gitignore"</code> is true.</p></li></ul></div><p>Other attributes may be added in the future.</p></dd><dt><span class="term"><code class="literal">path</code></span></dt><dd><p>The path whose files to filter</p></dd></dl></div><div class="example"><span id="function-library-example-lib.fileset.fileFilter"></span><p class="title"><strong>Example&nbsp;211.&nbsp;<code class="literal">lib.fileset.fileFilter</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-comment"># Include all regular `default.nix` files in the current directory</span>
fileFilter (file: file.<span class="hljs-attr">name</span> == <span class="hljs-string">"default.nix"</span>) ./.

<span class="hljs-comment"># Include all non-Nix files from the current directory</span>
fileFilter (file: ! file.hasExt <span class="hljs-string">"nix"</span>) ./.

<span class="hljs-comment"># Include all files that start with a "." in the current directory</span>
fileFilter (file: hasPrefix <span class="hljs-string">"."</span> file.name) ./.

<span class="hljs-comment"># Include all regular files (not symlinks or others) in the current directory</span>
fileFilter (file: file.<span class="hljs-attr">type</span> == <span class="hljs-string">"regular"</span>) ./.
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/fileset/default.nix#L662" target="_top">lib/fileset/default.nix:662</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.fileset.fromSource" class="title"><code class="literal">lib.fileset.fromSource</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fileset.fromSource" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">fromSource :: SourceLike -&gt; FileSet</code></p><p>Create a file set with the same files as a <code class="literal">lib.sources</code>-based value.
This does not import any of the files into the store.</p><p>This can be used to gradually migrate from <code class="literal">lib.sources</code>-based filtering to <code class="literal">lib.fileset</code>.</p><p>A file set can be turned back into a source using <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fileset.toSource" title="lib.fileset.toSource"><code class="literal">toSource</code></a>.</p><div class="note"><h3 class="title">Note</h3><p>File sets cannot represent empty directories.
Turning the result of this function back into a source using <code class="literal">toSource</code> will therefore not preserve empty directories.</p></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">source</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.fileset.fromSource"></span><p class="title"><strong>Example&nbsp;212.&nbsp;<code class="literal">lib.fileset.fromSource</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-comment"># There's no cleanSource-like function for file sets yet,</span>
<span class="hljs-comment"># but we can just convert cleanSource to a file set and use it that way</span>
toSource {
  <span class="hljs-attr">root</span> = ./.;
  <span class="hljs-attr">fileset</span> = fromSource (lib.sources.cleanSource ./.);
}

<span class="hljs-comment"># Keeping a previous sourceByRegex (which could be migrated to `lib.fileset.unions`),</span>
<span class="hljs-comment"># but removing a subdirectory using file set functions</span>
difference
  (fromSource (lib.sources.sourceByRegex ./. [
    <span class="hljs-string">"^README\.md$"</span>
    <span class="hljs-comment"># This regex includes everything in ./doc</span>
    <span class="hljs-string">"^doc(/.*)?$"</span>
  ])
  ./doc/generated

<span class="hljs-comment"># Use cleanSource, but limit it to only include ./Makefile and files under ./src</span>
intersection
  (fromSource (lib.sources.cleanSource ./.))
  (unions [
    ./Makefile
    ./src
  ]);
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/fileset/default.nix#L744" target="_top">lib/fileset/default.nix:744</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.fileset.gitTracked" class="title"><code class="literal">lib.fileset.gitTracked</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fileset.gitTracked" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">gitTracked :: Path -&gt; FileSet</code></p><p>Create a file set containing all <a class="link" href="https://git-scm.com/book/en/v2/Git-Basics-Recording-Changes-to-the-Repository" target="_top">Git-tracked files</a> in a repository.</p><p>This function behaves like <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fileset.gitTrackedWith" title="lib.fileset.gitTrackedWith"><code class="literal">gitTrackedWith { }</code></a> - using the defaults.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">path</code></span></dt><dd><p>The <a class="link" href="https://nixos.org/manual/nix/stable/language/values#type-path" target="_top">path</a> to the working directory of a local Git repository.
This directory must contain a <code class="literal">.git</code> file or subdirectory.</p></dd></dl></div><div class="example"><span id="function-library-example-lib.fileset.gitTracked"></span><p class="title"><strong>Example&nbsp;213.&nbsp;<code class="literal">lib.fileset.gitTracked</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-comment"># Include all files tracked by the Git repository in the current directory</span>
gitTracked ./.

<span class="hljs-comment"># Include only files tracked by the Git repository in the parent directory</span>
<span class="hljs-comment"># that are also in the current directory</span>
intersection ./. (gitTracked ../.)
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/fileset/default.nix#L787" target="_top">lib/fileset/default.nix:787</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.fileset.gitTrackedWith" class="title"><code class="literal">lib.fileset.gitTrackedWith</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fileset.gitTrackedWith" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">gitTrackedWith :: { recurseSubmodules :: Bool ? false } -&gt; Path -&gt; FileSet</code></p><p>Create a file set containing all <a class="link" href="https://git-scm.com/book/en/v2/Git-Basics-Recording-Changes-to-the-Repository" target="_top">Git-tracked files</a> in a repository.
The first argument allows configuration with an attribute set,
while the second argument is the path to the Git working tree.</p><p><code class="literal">gitTrackedWith</code> does not perform any filtering when the path is a <a class="link" href="https://nixos.org/manual/nix/stable/store/store-path#store-path" target="_top">Nix store path</a> and not a repository.
In this way, it accommodates the use case where the expression that makes the <code class="literal">gitTracked</code> call does not reside in an actual git repository anymore,
and has presumably already been fetched in a way that excludes untracked files.
Fetchers with such equivalent behavior include <code class="literal">builtins.fetchGit</code>, <code class="literal">builtins.fetchTree</code> (experimental), and <code class="literal">pkgs.fetchgit</code> when used without <code class="literal">leaveDotGit</code>.</p><p>If you don’t need the configuration,
you can use <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fileset.gitTracked" title="lib.fileset.gitTracked"><code class="literal">gitTracked</code></a> instead.</p><p>This is equivalent to the result of <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fileset.unions" title="lib.fileset.unions"><code class="literal">unions</code></a> on all files returned by <a class="link" href="https://git-scm.com/docs/git-ls-files" target="_top"><code class="literal">git ls-files</code></a>
(which uses <a class="link" href="https://git-scm.com/docs/git-ls-files#Documentation/git-ls-files.txt--c" target="_top"><code class="literal">--cached</code></a> by default).</p><div class="warning"><h3 class="title">Warning</h3><p>Currently this function is based on <a class="link" href="https://nixos.org/manual/nix/stable/language/builtins#builtins-fetchGit" target="_top"><code class="literal">builtins.fetchGit</code></a>
As such, this function causes all Git-tracked files to be unnecessarily added to the Nix store,
without being re-usable by <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.fileset.toSource" title="lib.fileset.toSource"><code class="literal">toSource</code></a>.</p><p>This may change in the future.</p></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">structured function argument</span></dt><dd><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">recurseSubmodules</code></span></dt><dd><p>(optional, default: <code class="literal">false</code>) Whether to recurse into <a class="link" href="https://git-scm.com/book/en/v2/Git-Tools-Submodules" target="_top">Git submodules</a> to also include their tracked files.</p><p>If <code class="literal">true</code>, this is equivalent to passing the <a class="link" href="https://git-scm.com/docs/git-ls-files#Documentation/git-ls-files.txt---recurse-submodules" target="_top">–recurse-submodules</a> flag to <code class="literal">git ls-files</code>.</p></dd></dl></div></dd><dt><span class="term"><code class="literal">path</code></span></dt><dd><p>The <a class="link" href="https://nixos.org/manual/nix/stable/language/values#type-path" target="_top">path</a> to the working directory of a local Git repository.
This directory must contain a <code class="literal">.git</code> file or subdirectory.</p></dd></dl></div><div class="example"><span id="function-library-example-lib.fileset.gitTrackedWith"></span><p class="title"><strong>Example&nbsp;214.&nbsp;<code class="literal">lib.fileset.gitTrackedWith</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-comment"># Include all files tracked by the Git repository in the current directory</span>
<span class="hljs-comment"># and any submodules under it</span>
gitTracked { <span class="hljs-attr">recurseSubmodules</span> = <span class="hljs-literal">true</span>; } ./.
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/fileset/default.nix#L831" target="_top">lib/fileset/default.nix:831</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-functions-library-sources" class="title">lib.sources: source filtering functions   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-functions-library-sources" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Functions for copying sources to the Nix store.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.sources.commitIdFromGitRepo" class="title"><code class="literal">lib.sources.commitIdFromGitRepo</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.sources.commitIdFromGitRepo" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Get the commit id of a git repo.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">path</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.sources.commitIdFromGitRepo"></span><p class="title"><strong>Example&nbsp;215.&nbsp;<code class="literal">lib.sources.commitIdFromGitRepo</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">commitIdFromGitRepo &lt;nixpkgs/.git&gt;
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/sources.nix#L271" target="_top">lib/sources.nix:271</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.sources.cleanSource" class="title"><code class="literal">lib.sources.cleanSource</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.sources.cleanSource" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Filters a source tree removing version control files and directories using cleanSourceFilter.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">src</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.sources.cleanSource"></span><p class="title"><strong>Example&nbsp;216.&nbsp;<code class="literal">lib.sources.cleanSource</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">cleanSource ./.
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/sources.nix#L271" target="_top">lib/sources.nix:271</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.sources.cleanSourceWith" class="title"><code class="literal">lib.sources.cleanSourceWith</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.sources.cleanSourceWith" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Like <code class="literal">builtins.filterSource</code>, except it will compose with itself,
allowing you to chain multiple calls together without any
intermediate copies being put in the nix store.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">structured function argument</span></dt><dd><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">src</code></span></dt><dd><p>A path or cleanSourceWith result to filter and/or rename.</p></dd><dt><span class="term"><code class="literal">filter</code></span></dt><dd><p>Optional with default value: constant true (include everything) The function will be combined with the &amp;&amp; operator such that src.filter is called lazily. For implementing a filter, see https://nixos.org/nix/manual/#builtin-filterSource Type: A function (path -&gt; type -&gt; bool)</p></dd><dt><span class="term"><code class="literal">name</code></span></dt><dd><p>Optional name to use as part of the store path. This defaults to <code class="literal">src.name</code> or otherwise <code class="literal">"source"</code>.</p></dd></dl></div></dd></dl></div><div class="example"><span id="function-library-example-lib.sources.cleanSourceWith"></span><p class="title"><strong>Example&nbsp;217.&nbsp;<code class="literal">lib.sources.cleanSourceWith</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">lib.cleanSourceWith {
  <span class="hljs-attr">filter</span> = f;
  <span class="hljs-attr">src</span> = lib.cleanSourceWith {
    <span class="hljs-attr">filter</span> = g;
    <span class="hljs-attr">src</span> = ./.;
  };
}
<span class="hljs-comment"># Succeeds!</span>

<span class="hljs-built_in">builtins</span>.filterSource f (<span class="hljs-built_in">builtins</span>.filterSource g ./.)
<span class="hljs-comment"># Fails!</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/sources.nix#L271" target="_top">lib/sources.nix:271</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.sources.cleanSourceFilter" class="title"><code class="literal">lib.sources.cleanSourceFilter</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.sources.cleanSourceFilter" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>A basic filter for <code class="literal">cleanSourceWith</code> that removes
directories of version control system, backup files (*~)
and some generated files.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">name</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">type</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/sources.nix#L271" target="_top">lib/sources.nix:271</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.sources.sourceByRegex" class="title"><code class="literal">lib.sources.sourceByRegex</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.sources.sourceByRegex" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Filter sources by a list of regular expressions.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">src</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">regexes</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.sources.sourceByRegex"></span><p class="title"><strong>Example&nbsp;218.&nbsp;<code class="literal">lib.sources.sourceByRegex</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">src</span> = sourceByRegex ./my-subproject [<span class="hljs-string">".*\.py$"</span> <span class="hljs-string">"^database.sql$"</span>]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/sources.nix#L271" target="_top">lib/sources.nix:271</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.sources.sourceFilesBySuffices" class="title"><code class="literal">lib.sources.sourceFilesBySuffices</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.sources.sourceFilesBySuffices" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">sourceLike -&gt; [String] -&gt; Source</code></p><p>Get all files ending with the specified suffices from the given
source directory or its descendants, omitting files that do not match
any suffix. The result of the example below will include files like
<code class="literal">./dir/module.c</code> and <code class="literal">./dir/subdir/doc.xml</code> if present.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">src</code></span></dt><dd><p>Path or source containing the files to be returned</p></dd><dt><span class="term"><code class="literal">exts</code></span></dt><dd><p>A list of file suffix strings</p></dd></dl></div><div class="example"><span id="function-library-example-lib.sources.sourceFilesBySuffices"></span><p class="title"><strong>Example&nbsp;219.&nbsp;<code class="literal">lib.sources.sourceFilesBySuffices</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">sourceFilesBySuffices ./. [ <span class="hljs-string">".xml"</span> <span class="hljs-string">".c"</span> ]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/sources.nix#L271" target="_top">lib/sources.nix:271</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.sources.trace" class="title"><code class="literal">lib.sources.trace</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.sources.trace" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">sources.trace :: sourceLike -&gt; Source</code></p><p>Add logging to a source, for troubleshooting the filtering behavior.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">src</code></span></dt><dd><p>Source to debug. The returned source will behave like this source, but also log its filter invocations.</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/sources.nix#L271" target="_top">lib/sources.nix:271</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-functions-library-cli" class="title">lib.cli: command-line serialization functions   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-functions-library-cli" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.cli.toGNUCommandLineShell" class="title"><code class="literal">lib.cli.toGNUCommandLineShell</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.cli.toGNUCommandLineShell" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Automatically convert an attribute set to command-line options.</p><p>This helps protect against malformed command lines and also to reduce
boilerplate related to command-line construction for simple use cases.</p><p><code class="literal">toGNUCommandLine</code> returns a list of nix strings.
<code class="literal">toGNUCommandLineShell</code> returns an escaped shell string.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">options</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">attrs</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.cli.toGNUCommandLineShell"></span><p class="title"><strong>Example&nbsp;220.&nbsp;<code class="literal">lib.cli.toGNUCommandLineShell</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">cli.toGNUCommandLine {} {
  <span class="hljs-attr">data</span> = <span class="hljs-built_in">builtins</span>.toJSON { <span class="hljs-attr">id</span> = <span class="hljs-number">0</span>; };
  <span class="hljs-attr">X</span> = <span class="hljs-string">"PUT"</span>;
  <span class="hljs-attr">retry</span> = <span class="hljs-number">3</span>;
  <span class="hljs-attr">retry-delay</span> = <span class="hljs-literal">null</span>;
  <span class="hljs-attr">url</span> = [ <span class="hljs-string">"https://example.com/foo"</span> <span class="hljs-string">"https://example.com/bar"</span> ];
  <span class="hljs-attr">silent</span> = <span class="hljs-literal">false</span>;
  <span class="hljs-attr">verbose</span> = <span class="hljs-literal">true</span>;
}
=&gt; [
  <span class="hljs-string">"-X"</span> <span class="hljs-string">"PUT"</span>
  <span class="hljs-string">"--data"</span> <span class="hljs-string">"{\"</span>id\<span class="hljs-string">":0}"</span>
  <span class="hljs-string">"--retry"</span> <span class="hljs-string">"3"</span>
  <span class="hljs-string">"--url"</span> <span class="hljs-string">"https://example.com/foo"</span>
  <span class="hljs-string">"--url"</span> <span class="hljs-string">"https://example.com/bar"</span>
  <span class="hljs-string">"--verbose"</span>
]

cli.toGNUCommandLineShell {} {
  <span class="hljs-attr">data</span> = <span class="hljs-built_in">builtins</span>.toJSON { <span class="hljs-attr">id</span> = <span class="hljs-number">0</span>; };
  <span class="hljs-attr">X</span> = <span class="hljs-string">"PUT"</span>;
  <span class="hljs-attr">retry</span> = <span class="hljs-number">3</span>;
  <span class="hljs-attr">retry-delay</span> = <span class="hljs-literal">null</span>;
  <span class="hljs-attr">url</span> = [ <span class="hljs-string">"https://example.com/foo"</span> <span class="hljs-string">"https://example.com/bar"</span> ];
  <span class="hljs-attr">silent</span> = <span class="hljs-literal">false</span>;
  <span class="hljs-attr">verbose</span> = <span class="hljs-literal">true</span>;
}
=&gt; <span class="hljs-string">"'-X' 'PUT' '--data' '{\"</span>id\<span class="hljs-string">":0}' '--retry' '3' '--url' 'https://example.com/foo' '--url' 'https://example.com/bar' '--verbose'"</span>;
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/cli.nix#L42" target="_top">lib/cli.nix:42</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-functions-library-gvariant" class="title">lib.gvariant: GVariant formatted string serialization functions   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-functions-library-gvariant" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>A partial and basic implementation of GVariant formatted strings.
See <a class="link" href="https://docs.gtk.org/glib/gvariant-format-strings.html" target="_top">GVariant Format Strings</a> for details.</p><div class="warning"><h3 class="title">Warning</h3><p>This API is not considered fully stable and it might therefore
change in backwards incompatible ways without prior notice.</p></div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.gvariant.isGVariant" class="title"><code class="literal">lib.gvariant.isGVariant</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.gvariant.isGVariant" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">isGVariant :: Any -&gt; Bool</code></p><p>Check if a value is a GVariant value</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">v</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/gvariant.nix#L54" target="_top">lib/gvariant.nix:54</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.gvariant.mkValue" class="title"><code class="literal">lib.gvariant.mkValue</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.gvariant.mkValue" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">mkValue :: Any -&gt; gvariant</code></p><p>Returns the GVariant value that most closely matches the given Nix value.
If no GVariant value can be found unambiguously then error is thrown.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">v</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/gvariant.nix#L62" target="_top">lib/gvariant.nix:62</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.gvariant.mkArray" class="title"><code class="literal">lib.gvariant.mkArray</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.gvariant.mkArray" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">mkArray :: [Any] -&gt; gvariant</code></p><p>Returns the GVariant array from the given type of the elements and a Nix list.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">elems</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.gvariant.mkArray"></span><p class="title"><strong>Example&nbsp;221.&nbsp;<code class="literal">lib.gvariant.mkArray</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-comment"># Creating a string array</span>
lib.gvariant.mkArray [ <span class="hljs-string">"a"</span> <span class="hljs-string">"b"</span> <span class="hljs-string">"c"</span> ]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/gvariant.nix#L85" target="_top">lib/gvariant.nix:85</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.gvariant.mkEmptyArray" class="title"><code class="literal">lib.gvariant.mkEmptyArray</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.gvariant.mkEmptyArray" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">mkEmptyArray :: gvariant.type -&gt; gvariant</code></p><p>Returns the GVariant array from the given empty Nix list.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">elemType</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.gvariant.mkEmptyArray"></span><p class="title"><strong>Example&nbsp;222.&nbsp;<code class="literal">lib.gvariant.mkEmptyArray</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-comment"># Creating an empty string array</span>
lib.gvariant.mkEmptyArray (lib.gvariant.type.string)
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/gvariant.nix#L106" target="_top">lib/gvariant.nix:106</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.gvariant.mkVariant" class="title"><code class="literal">lib.gvariant.mkVariant</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.gvariant.mkVariant" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">mkVariant :: Any -&gt; gvariant</code></p><p>Returns the GVariant variant from the given Nix value. Variants are containers
of different GVariant type.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">elem</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.gvariant.mkVariant"></span><p class="title"><strong>Example&nbsp;223.&nbsp;<code class="literal">lib.gvariant.mkVariant</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">lib.gvariant.mkArray [
  (lib.gvariant.mkVariant <span class="hljs-string">"a string"</span>)
  (lib.gvariant.mkVariant (lib.gvariant.mkInt32 <span class="hljs-number">1</span>))
]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/gvariant.nix#L123" target="_top">lib/gvariant.nix:123</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.gvariant.mkDictionaryEntry" class="title"><code class="literal">lib.gvariant.mkDictionaryEntry</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.gvariant.mkDictionaryEntry" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">mkDictionaryEntry :: String -&gt; Any -&gt; gvariant</code></p><p>Returns the GVariant dictionary entry from the given key and value.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">name</code></span></dt><dd><p>The key of the entry</p></dd><dt><span class="term"><code class="literal">value</code></span></dt><dd><p>The value of the entry</p></dd></dl></div><div class="example"><span id="function-library-example-lib.gvariant.mkDictionaryEntry"></span><p class="title"><strong>Example&nbsp;224.&nbsp;<code class="literal">lib.gvariant.mkDictionaryEntry</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-comment"># A dictionary describing an Epiphany’s search provider</span>
[
  (lib.gvariant.mkDictionaryEntry <span class="hljs-string">"url"</span> (lib.gvariant.mkVariant <span class="hljs-string">"https://duckduckgo.com/?q=%s&amp;t=epiphany"</span>))
  (lib.gvariant.mkDictionaryEntry <span class="hljs-string">"bang"</span> (lib.gvariant.mkVariant <span class="hljs-string">"!d"</span>))
  (lib.gvariant.mkDictionaryEntry <span class="hljs-string">"name"</span> (lib.gvariant.mkVariant <span class="hljs-string">"DuckDuckGo"</span>))
]
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/gvariant.nix#L142" target="_top">lib/gvariant.nix:142</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.gvariant.mkMaybe" class="title"><code class="literal">lib.gvariant.mkMaybe</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.gvariant.mkMaybe" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">mkMaybe :: gvariant.type -&gt; Any -&gt; gvariant</code></p><p>Returns the GVariant maybe from the given element type.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">elemType</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">elem</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/gvariant.nix#L161" target="_top">lib/gvariant.nix:161</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.gvariant.mkNothing" class="title"><code class="literal">lib.gvariant.mkNothing</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.gvariant.mkNothing" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">mkNothing :: gvariant.type -&gt; gvariant</code></p><p>Returns the GVariant nothing from the given element type.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">elemType</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/gvariant.nix#L175" target="_top">lib/gvariant.nix:175</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.gvariant.mkJust" class="title"><code class="literal">lib.gvariant.mkJust</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.gvariant.mkJust" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">mkJust :: Any -&gt; gvariant</code></p><p>Returns the GVariant just from the given Nix value.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">elem</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/gvariant.nix#L182" target="_top">lib/gvariant.nix:182</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.gvariant.mkTuple" class="title"><code class="literal">lib.gvariant.mkTuple</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.gvariant.mkTuple" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">mkTuple :: [Any] -&gt; gvariant</code></p><p>Returns the GVariant tuple from the given Nix list.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">elems</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/gvariant.nix#L189" target="_top">lib/gvariant.nix:189</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.gvariant.mkBoolean" class="title"><code class="literal">lib.gvariant.mkBoolean</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.gvariant.mkBoolean" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">mkBoolean :: Bool -&gt; gvariant</code></p><p>Returns the GVariant boolean from the given Nix bool value.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">v</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/gvariant.nix#L204" target="_top">lib/gvariant.nix:204</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.gvariant.mkString" class="title"><code class="literal">lib.gvariant.mkString</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.gvariant.mkString" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">mkString :: String -&gt; gvariant</code></p><p>Returns the GVariant string from the given Nix string value.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">v</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/gvariant.nix#L214" target="_top">lib/gvariant.nix:214</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.gvariant.mkObjectpath" class="title"><code class="literal">lib.gvariant.mkObjectpath</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.gvariant.mkObjectpath" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">mkObjectpath :: String -&gt; gvariant</code></p><p>Returns the GVariant object path from the given Nix string value.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">v</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/gvariant.nix#L225" target="_top">lib/gvariant.nix:225</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.gvariant.mkUchar" class="title"><code class="literal">lib.gvariant.mkUchar</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.gvariant.mkUchar" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">mkUchar :: Int -&gt; gvariant</code></p><p>Returns the GVariant uchar from the given Nix int value.</p><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/gvariant.nix#L235" target="_top">lib/gvariant.nix:235</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.gvariant.mkInt16" class="title"><code class="literal">lib.gvariant.mkInt16</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.gvariant.mkInt16" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">mkInt16 :: Int -&gt; gvariant</code></p><p>Returns the GVariant int16 from the given Nix int value.</p><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/gvariant.nix#L242" target="_top">lib/gvariant.nix:242</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.gvariant.mkUint16" class="title"><code class="literal">lib.gvariant.mkUint16</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.gvariant.mkUint16" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">mkUint16 :: Int -&gt; gvariant</code></p><p>Returns the GVariant uint16 from the given Nix int value.</p><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/gvariant.nix#L249" target="_top">lib/gvariant.nix:249</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.gvariant.mkInt32" class="title"><code class="literal">lib.gvariant.mkInt32</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.gvariant.mkInt32" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">mkInt32 :: Int -&gt; gvariant</code></p><p>Returns the GVariant int32 from the given Nix int value.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">v</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/gvariant.nix#L256" target="_top">lib/gvariant.nix:256</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.gvariant.mkUint32" class="title"><code class="literal">lib.gvariant.mkUint32</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.gvariant.mkUint32" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">mkUint32 :: Int -&gt; gvariant</code></p><p>Returns the GVariant uint32 from the given Nix int value.</p><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/gvariant.nix#L266" target="_top">lib/gvariant.nix:266</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.gvariant.mkInt64" class="title"><code class="literal">lib.gvariant.mkInt64</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.gvariant.mkInt64" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">mkInt64 :: Int -&gt; gvariant</code></p><p>Returns the GVariant int64 from the given Nix int value.</p><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/gvariant.nix#L273" target="_top">lib/gvariant.nix:273</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.gvariant.mkUint64" class="title"><code class="literal">lib.gvariant.mkUint64</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.gvariant.mkUint64" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">mkUint64 :: Int -&gt; gvariant</code></p><p>Returns the GVariant uint64 from the given Nix int value.</p><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/gvariant.nix#L280" target="_top">lib/gvariant.nix:280</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.gvariant.mkDouble" class="title"><code class="literal">lib.gvariant.mkDouble</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.gvariant.mkDouble" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">mkDouble :: Float -&gt; gvariant</code></p><p>Returns the GVariant double from the given Nix float value.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">v</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/gvariant.nix#L287" target="_top">lib/gvariant.nix:287</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-functions-library-customisation" class="title">lib.customisation: Functions to customise (derivation-related) functions, derivatons, or attribute sets   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-functions-library-customisation" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.customisation.overrideDerivation" class="title"><code class="literal">lib.customisation.overrideDerivation</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.customisation.overrideDerivation" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">overrideDerivation :: Derivation -&gt; ( Derivation -&gt; AttrSet ) -&gt; Derivation</code></p><p><code class="literal">overrideDerivation drv f</code> takes a derivation (i.e., the result
of a call to the builtin function <code class="literal">derivation</code>) and returns a new
derivation in which the attributes of the original are overridden
according to the function <code class="literal">f</code>.  The function <code class="literal">f</code> is called with
the original derivation attributes.</p><p><code class="literal">overrideDerivation</code> allows certain “ad-hoc” customisation
scenarios (e.g. in ~/.config/nixpkgs/config.nix).  For instance,
if you want to “patch” the derivation returned by a package
function in Nixpkgs to build another version than what the
function itself provides.</p><p>For another application, see build-support/vm, where this
function is used to build arbitrary derivations inside a QEMU
virtual machine.</p><p>Note that in order to preserve evaluation errors, the new derivation’s
outPath depends on the old one’s, which means that this function cannot
be used in circular situations when the old derivation also depends on the
new one.</p><p>You should in general prefer <code class="literal">drv.overrideAttrs</code> over this function;
see the nixpkgs manual for more information on overriding.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">drv</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">f</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.customisation.overrideDerivation"></span><p class="title"><strong>Example&nbsp;225.&nbsp;<code class="literal">lib.customisation.overrideDerivation</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">mySed</span> = overrideDerivation pkgs.gnused (oldAttrs: {
  <span class="hljs-attr">name</span> = <span class="hljs-string">"sed-4.2.2-pre"</span>;
  <span class="hljs-attr">src</span> = fetchurl {
    <span class="hljs-attr">url</span> = ftp://alpha.gnu.org/gnu/sed/sed-<span class="hljs-number">4.2</span>.<span class="hljs-number">2</span>-pre.tar.bz2;
    <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-MxBJRcM2rYzQYwJ5XKxhXTQByvSg5jZc5cSHEZoB2IY="</span>;
  };
  <span class="hljs-attr">patches</span> = [];
});
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/customisation.nix#L43" target="_top">lib/customisation.nix:43</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.customisation.makeOverridable" class="title"><code class="literal">lib.customisation.makeOverridable</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.customisation.makeOverridable" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">makeOverridable :: (AttrSet -&gt; a) -&gt; AttrSet -&gt; a</code></p><p><code class="literal">makeOverridable</code> takes a function from attribute set to attribute set and
injects <code class="literal">override</code> attribute which can be used to override arguments of
the function.</p><p>Please refer to  documentation on <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#sec-pkg-overrideDerivation" title="&lt;pkg&gt;.overrideDerivation"><code class="literal">&lt;pkg&gt;.overrideDerivation</code></a> to learn about <code class="literal">overrideDerivation</code> and caveats
related to its use.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">f</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.customisation.makeOverridable"></span><p class="title"><strong>Example&nbsp;226.&nbsp;<code class="literal">lib.customisation.makeOverridable</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">nix-repl&gt; <span class="hljs-attr">x</span> = {a, b}: { <span class="hljs-attr">result</span> = a + b; }

nix-repl&gt; <span class="hljs-attr">y</span> = lib.makeOverridable x { <span class="hljs-attr">a</span> = <span class="hljs-number">1</span>; <span class="hljs-attr">b</span> = <span class="hljs-number">2</span>; }

nix-repl&gt; y
{ <span class="hljs-attr">override</span> = «lambda»; <span class="hljs-attr">overrideDerivation</span> = «lambda»; <span class="hljs-attr">result</span> = <span class="hljs-number">3</span>; }

nix-repl&gt; y.override { <span class="hljs-attr">a</span> = <span class="hljs-number">10</span>; }
{ <span class="hljs-attr">override</span> = «lambda»; <span class="hljs-attr">overrideDerivation</span> = «lambda»; <span class="hljs-attr">result</span> = <span class="hljs-number">12</span>; }
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/customisation.nix#L79" target="_top">lib/customisation.nix:79</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.customisation.callPackageWith" class="title"><code class="literal">lib.customisation.callPackageWith</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.customisation.callPackageWith" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">callPackageWith :: AttrSet -&gt; ((AttrSet -&gt; a) | Path) -&gt; AttrSet -&gt; a</code></p><p>Call the package function in the file <code class="literal">fn</code> with the required
arguments automatically.  The function is called with the
arguments <code class="literal">args</code>, but any missing arguments are obtained from
<code class="literal">autoArgs</code>.  This function is intended to be partially
parameterised, e.g.,</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">callPackage</span> = callPackageWith pkgs;
<span class="hljs-attr">pkgs</span> = {
  <span class="hljs-attr">libfoo</span> = callPackage ./foo.nix { };
  <span class="hljs-attr">libbar</span> = callPackage ./bar.nix { };
};
</code></pre><p>If the <code class="literal">libbar</code> function expects an argument named <code class="literal">libfoo</code>, it is
automatically passed as an argument.  Overrides or missing
arguments can be supplied in <code class="literal">args</code>, e.g.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">libbar</span> = callPackage ./bar.nix {
  <span class="hljs-attr">libfoo</span> = <span class="hljs-literal">null</span>;
  <span class="hljs-attr">enableX11</span> = <span class="hljs-literal">true</span>;
};
</code></pre><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">autoArgs</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">fn</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">args</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/customisation.nix#L141" target="_top">lib/customisation.nix:141</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.customisation.callPackagesWith" class="title"><code class="literal">lib.customisation.callPackagesWith</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.customisation.callPackagesWith" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">callPackagesWith :: AttrSet -&gt; ((AttrSet -&gt; AttrSet) | Path) -&gt; AttrSet -&gt; AttrSet</code></p><p>Like callPackage, but for a function that returns an attribute
set of derivations. The override function is added to the
individual attributes.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">autoArgs</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">fn</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">args</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/customisation.nix#L202" target="_top">lib/customisation.nix:202</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.customisation.extendDerivation" class="title"><code class="literal">lib.customisation.extendDerivation</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.customisation.extendDerivation" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">extendDerivation :: Bool -&gt; Any -&gt; Derivation -&gt; Derivation</code></p><p>Add attributes to each output of a derivation without changing
the derivation itself and check a given condition when evaluating.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">condition</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">passthru</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">drv</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/customisation.nix#L223" target="_top">lib/customisation.nix:223</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.customisation.hydraJob" class="title"><code class="literal">lib.customisation.hydraJob</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.customisation.hydraJob" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">hydraJob :: (Derivation | Null) -&gt; (Derivation | Null)</code></p><p>Strip a derivation of all non-essential attributes, returning
only those needed by hydra-eval-jobs. Also strictly evaluate the
result to ensure that there are no thunks kept alive to prevent
garbage collection.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">drv</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/customisation.nix#L261" target="_top">lib/customisation.nix:261</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.customisation.makeScope" class="title"><code class="literal">lib.customisation.makeScope</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.customisation.makeScope" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">makeScope :: (AttrSet -&gt; ((AttrSet -&gt; a) | Path) -&gt; AttrSet -&gt; a) -&gt; (AttrSet -&gt; AttrSet) -&gt; AttrSet</code></p><p>Make a set of packages with a common scope. All packages called
with the provided <code class="literal">callPackage</code> will be evaluated with the same
arguments. Any package in the set may depend on any other. The
<code class="literal">overrideScope'</code> function allows subsequent modification of the package
set in a consistent way, i.e. all packages in the set will be
called with the overridden packages. The package sets may be
hierarchical: the packages in the set are called with the scope
provided by <code class="literal">newScope</code> and the set provides a <code class="literal">newScope</code> attribute
which can form the parent scope for later package sets.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">newScope</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">f</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/customisation.nix#L303" target="_top">lib/customisation.nix:303</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.customisation.makeScopeWithSplicing" class="title"><code class="literal">lib.customisation.makeScopeWithSplicing</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.customisation.makeScopeWithSplicing" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>backward compatibility with old uncurried form; deprecated</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">splicePackages</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">newScope</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">otherSplices</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">keep</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">extra</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">f</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/customisation.nix#L317" target="_top">lib/customisation.nix:317</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.customisation.makeScopeWithSplicing-prime" class="title"><code class="literal">lib.customisation.makeScopeWithSplicing'</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.customisation.makeScopeWithSplicing-prime" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>:</p><pre><code class="programlisting hljs language-shell" data-highlighted="yes">makeScopeWithSplicing' ::
  { splicePackages :: Splice -&gt; AttrSet
  , newScope :: AttrSet -&gt; ((AttrSet -&gt; a) | Path) -&gt; AttrSet -&gt; a
  }
<span class="hljs-meta prompt_">  -&gt; </span><span class="language-bash">{ otherSplices :: Splice, keep :: AttrSet -&gt; AttrSet, extra :: AttrSet -&gt; AttrSet }</span>
<span class="hljs-meta prompt_">  -&gt; </span><span class="language-bash">AttrSet</span>

Splice ::
  { pkgsBuildBuild :: AttrSet
  , pkgsBuildHost :: AttrSet
  , pkgsBuildTarget :: AttrSet
  , pkgsHostHost :: AttrSet
  , pkgsHostTarget :: AttrSet
  , pkgsTargetTarget :: AttrSet
  }
</code></pre><p>Like makeScope, but aims to support cross compilation. It’s still ugly, but
hopefully it helps a little bit.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">structured function argument</span></dt><dd><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">splicePackages</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">newScope</code></span></dt><dd><p>Function argument</p></dd></dl></div></dd><dt><span class="term">structured function argument</span></dt><dd><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">otherSplices</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">keep</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">extra</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">f</code></span></dt><dd><p>Function argument</p></dd></dl></div></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/customisation.nix#L343" target="_top">lib/customisation.nix:343</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-functions-library-meta" class="title">lib.meta: functions for derivation metadata   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-functions-library-meta" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Some functions for manipulating meta attributes, as well as the
name attribute.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.meta.addMetaAttrs" class="title"><code class="literal">lib.meta.addMetaAttrs</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.meta.addMetaAttrs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Add to or override the meta attributes of the given
derivation.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">newAttrs</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">drv</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.meta.addMetaAttrs"></span><p class="title"><strong>Example&nbsp;227.&nbsp;<code class="literal">lib.meta.addMetaAttrs</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">addMetaAttrs {<span class="hljs-attr">description</span> = <span class="hljs-string">"Bla blah"</span>;} somePkg
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/meta.nix#L20" target="_top">lib/meta.nix:20</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.meta.dontDistribute" class="title"><code class="literal">lib.meta.dontDistribute</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.meta.dontDistribute" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Disable Hydra builds of given derivation.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">drv</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/meta.nix#L26" target="_top">lib/meta.nix:26</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.meta.setName" class="title"><code class="literal">lib.meta.setName</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.meta.setName" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Change the symbolic name of a package for presentation purposes
(i.e., so that nix-env users can tell them apart).</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">name</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">drv</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/meta.nix#L32" target="_top">lib/meta.nix:32</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.meta.updateName" class="title"><code class="literal">lib.meta.updateName</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.meta.updateName" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Like <code class="literal">setName</code>, but takes the previous name as an argument.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">updater</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">drv</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.meta.updateName"></span><p class="title"><strong>Example&nbsp;228.&nbsp;<code class="literal">lib.meta.updateName</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">updateName (oldName: oldName + <span class="hljs-string">"-experimental"</span>) somePkg
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/meta.nix#L40" target="_top">lib/meta.nix:40</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.meta.appendToName" class="title"><code class="literal">lib.meta.appendToName</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.meta.appendToName" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Append a suffix to the name of a package (before the version
part).</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">suffix</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/meta.nix#L45" target="_top">lib/meta.nix:45</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.meta.mapDerivationAttrset" class="title"><code class="literal">lib.meta.mapDerivationAttrset</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.meta.mapDerivationAttrset" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Apply a function to each derivation and only to derivations in an attrset.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">f</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">set</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/meta.nix#L51" target="_top">lib/meta.nix:51</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.meta.setPrio" class="title"><code class="literal">lib.meta.setPrio</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.meta.setPrio" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Set the nix-env priority of the package.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">priority</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/meta.nix#L55" target="_top">lib/meta.nix:55</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.meta.lowPrio" class="title"><code class="literal">lib.meta.lowPrio</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.meta.lowPrio" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Decrease the nix-env priority of the package, i.e., other
versions/variants of the package will be preferred.</p><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/meta.nix#L60" target="_top">lib/meta.nix:60</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.meta.lowPrioSet" class="title"><code class="literal">lib.meta.lowPrioSet</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.meta.lowPrioSet" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Apply lowPrio to an attrset with derivations</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">set</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/meta.nix#L64" target="_top">lib/meta.nix:64</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.meta.hiPrio" class="title"><code class="literal">lib.meta.hiPrio</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.meta.hiPrio" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Increase the nix-env priority of the package, i.e., this
version/variant of the package will be preferred.</p><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/meta.nix#L70" target="_top">lib/meta.nix:70</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.meta.hiPrioSet" class="title"><code class="literal">lib.meta.hiPrioSet</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.meta.hiPrioSet" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Apply hiPrio to an attrset with derivations</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">set</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/meta.nix#L74" target="_top">lib/meta.nix:74</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.meta.platformMatch" class="title"><code class="literal">lib.meta.platformMatch</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.meta.platformMatch" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Check to see if a platform is matched by the given <code class="literal">meta.platforms</code>
element.</p><p>A <code class="literal">meta.platform</code> pattern is either</p><div class="orderedlist"><ol class="orderedlist " type="1"><li class="listitem"><p>(legacy) a system string.</p></li><li class="listitem"><p>(modern) a pattern for the entire platform structure (see <code class="literal">lib.systems.inspect.platformPatterns</code>).</p></li><li class="listitem"><p>(modern) a pattern for the platform <code class="literal">parsed</code> field (see <code class="literal">lib.systems.inspect.patterns</code>).</p></li></ol></div><p>We can inject these into a pattern for the whole of a structured platform,
and then match that.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">platform</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">elem</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/meta.nix#L91" target="_top">lib/meta.nix:91</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.meta.availableOn" class="title"><code class="literal">lib.meta.availableOn</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.meta.availableOn" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Check if a package is available on a given platform.</p><p>A package is available on a platform if both</p><div class="orderedlist"><ol class="orderedlist " type="1"><li class="listitem"><p>One of <code class="literal">meta.platforms</code> pattern matches the given
platform, or <code class="literal">meta.platforms</code> is not present.</p></li><li class="listitem"><p>None of <code class="literal">meta.badPlatforms</code> pattern matches the given platform.</p></li></ol></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">platform</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">pkg</code></span></dt><dd><p>Function argument</p></dd></dl></div><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/meta.nix#L116" target="_top">lib/meta.nix:116</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.meta.getLicenseFromSpdxId" class="title"><code class="literal">lib.meta.getLicenseFromSpdxId</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.meta.getLicenseFromSpdxId" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">getLicenseFromSpdxId :: str -&gt; AttrSet</code></p><p>Get the corresponding attribute in lib.licenses
from the SPDX ID.
For SPDX IDs, see
https://spdx.org/licenses</p><div class="example"><span id="function-library-example-lib.meta.getLicenseFromSpdxId"></span><p class="title"><strong>Example&nbsp;229.&nbsp;<code class="literal">lib.meta.getLicenseFromSpdxId</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">lib.getLicenseFromSpdxId <span class="hljs-string">"MIT"</span> == lib.licenses.<span class="hljs-attr">mit</span>
=&gt; <span class="hljs-literal">true</span>
lib.getLicenseFromSpdxId <span class="hljs-string">"mIt"</span> == lib.licenses.<span class="hljs-attr">mit</span>
=&gt; <span class="hljs-literal">true</span>
lib.getLicenseFromSpdxId <span class="hljs-string">"MY LICENSE"</span>
=&gt; trace: warning: getLicenseFromSpdxId: No license matches the given SPDX ID: MY <span class="hljs-attr">LICENSE</span>
=&gt; { <span class="hljs-attr">shortName</span> = <span class="hljs-string">"MY LICENSE"</span>; }
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/meta.nix#L137" target="_top">lib/meta.nix:137</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.meta.getExe" class="title"><code class="literal">lib.meta.getExe</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.meta.getExe" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">getExe :: package -&gt; string</code></p><p>Get the path to the main program of a package based on meta.mainProgram</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">x</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.meta.getExe"></span><p class="title"><strong>Example&nbsp;230.&nbsp;<code class="literal">lib.meta.getExe</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">getExe pkgs.<span class="hljs-attr">hello</span>
=&gt; <span class="hljs-string">"/nix/store/g124820p9hlv4lj8qplzxw1c44dxaw1k-hello-2.12/bin/hello"</span>
getExe pkgs.<span class="hljs-attr">mustache-go</span>
=&gt; <span class="hljs-string">"/nix/store/am9ml4f4ywvivxnkiaqwr0hyxka1xjsf-mustache-go-1.3.0/bin/mustache"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/meta.nix#L157" target="_top">lib/meta.nix:157</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="function-library-lib.meta.getExe-prime" class="title"><code class="literal">lib.meta.getExe'</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.meta.getExe-prime" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><span class="strong"><strong>Type</strong></span>: <code class="literal">getExe' :: derivation -&gt; string -&gt; string</code></p><p>Get the path of a program of a derivation.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">x</code></span></dt><dd><p>Function argument</p></dd><dt><span class="term"><code class="literal">y</code></span></dt><dd><p>Function argument</p></dd></dl></div><div class="example"><span id="function-library-example-lib.meta.getExe-prime"></span><p class="title"><strong>Example&nbsp;231.&nbsp;<code class="literal">lib.meta.getExe'</code> usage example</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">getExe' pkgs.hello <span class="hljs-string">"hello"</span>
=&gt; <span class="hljs-string">"/nix/store/g124820p9hlv4lj8qplzxw1c44dxaw1k-hello-2.12/bin/hello"</span>
getExe' pkgs.imagemagick <span class="hljs-string">"convert"</span>
=&gt; <span class="hljs-string">"/nix/store/5rs48jamq7k6sal98ymj9l4k2bnwq515-imagemagick-7.1.1-15/bin/convert"</span>
</code></pre></div></div><br class="example-break"><p>Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/219951b495fc2eac67b1456824cc1ec1fd2ee659/lib/meta.nix#L177" target="_top">lib/meta.nix:177</a> in <code class="literal">&lt;nixpkgs&gt;</code>.</p>
</div>

</div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-generators" class="title" style="clear: both">Generators   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-generators" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>Generators are functions that create file formats from nix data structures, e. g. for configuration files. There are generators available for: <code class="literal">INI</code>, <code class="literal">JSON</code> and <code class="literal">YAML</code></p><p>All generators follow a similar call interface: <code class="literal">generatorName configFunctions data</code>, where <code class="literal">configFunctions</code> is an attrset of user-defined functions that format nested parts of the content. They each have common defaults, so often they do not need to be set manually. An example is <code class="literal">mkSectionName ? (name: libStr.escape [ "[" "]" ] name)</code> from the <code class="literal">INI</code> generator. It receives the name of a section and sanitizes it. The default <code class="literal">mkSectionName</code> escapes <code class="literal">[</code> and <code class="literal">]</code> with a backslash.</p><p>Generators can be fine-tuned to produce exactly the file format required by your application/service. One example is an INI-file format which uses <code class="literal">: </code> as separator, the strings <code class="literal">"yes"</code>/<code class="literal">"no"</code> as boolean values and requires all string values to be quoted:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">with</span> lib;
<span class="hljs-keyword">let</span>
  <span class="hljs-attr">customToINI</span> = generators.toINI {
    <span class="hljs-comment"># specifies how to format a key/value pair</span>
    <span class="hljs-attr">mkKeyValue</span> = generators.mkKeyValueDefault {
      <span class="hljs-comment"># specifies the generated string for a subset of nix values</span>
      <span class="hljs-attr">mkValueString</span> = v:
             <span class="hljs-keyword">if</span> <span class="hljs-attr">v</span> == <span class="hljs-literal">true</span> <span class="hljs-keyword">then</span> <span class="hljs-string">''"yes"''</span>
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> <span class="hljs-attr">v</span> == <span class="hljs-literal">false</span> <span class="hljs-keyword">then</span> <span class="hljs-string">''"no"''</span>
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> isString v <span class="hljs-keyword">then</span> <span class="hljs-string">''"<span class="hljs-subst">${v}</span>"''</span>
        <span class="hljs-comment"># and delegates all other values to the default generator</span>
        <span class="hljs-keyword">else</span> generators.mkValueStringDefault {} v;
    } <span class="hljs-string">":"</span>;
  };

<span class="hljs-comment"># the INI file can now be given as plain old nix values</span>
<span class="hljs-keyword">in</span> customToINI {
  <span class="hljs-attr">main</span> = {
    <span class="hljs-attr">pushinfo</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-attr">autopush</span> = <span class="hljs-literal">false</span>;
    <span class="hljs-attr">host</span> = <span class="hljs-string">"localhost"</span>;
    <span class="hljs-attr">port</span> = <span class="hljs-number">42</span>;
  };
  <span class="hljs-attr">mergetool</span> = {
    <span class="hljs-attr">merge</span> = <span class="hljs-string">"diff3"</span>;
  };
}
</code></pre><p>This will produce the following INI file as nix string:</p><pre><code class="programlisting INI hljs language-bash" data-highlighted="yes">[main]
autopush:<span class="hljs-string">"no"</span>
host:<span class="hljs-string">"localhost"</span>
port:42
pushinfo:<span class="hljs-string">"yes"</span>
str\:ange:<span class="hljs-string">"very::strange"</span>

[mergetool]
merge:<span class="hljs-string">"diff3"</span>
</code></pre><div class="note"><h3 class="title">Note</h3><p>Nix store paths can be converted to strings by enclosing a derivation attribute like so: <code class="literal">"${drv}"</code>.</p></div><p>Detailed documentation for each generator can be found in <code class="literal">lib/generators.nix</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-debug" class="title" style="clear: both">Debugging Nix Expressions   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-debug" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>Nix is a unityped, dynamic language, this means every value can potentially appear anywhere. Since it is also non-strict, evaluation order and what ultimately is evaluated might surprise you. Therefore it is important to be able to debug nix expressions.</p><p>In the <code class="literal">lib/debug.nix</code> file you will find a number of functions that help (pretty-)printing values while evaluation is running. You can even specify how deep these values should be printed recursively, and transform them on the fly. Please consult the docstrings in <code class="literal">lib/debug.nix</code> for usage information.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-prefer-remote-fetch" class="title" style="clear: both">prefer-remote-fetch overlay   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-prefer-remote-fetch" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p><code class="literal">prefer-remote-fetch</code> is an overlay that download sources on remote builder. This is useful when the evaluating machine has a slow upload while the builder can fetch faster directly from the source. To use it, put the following snippet as a new overlay:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">self: super:
  (super.prefer-remote-fetch self super)
</code></pre><p>A full configuration example for that sets the overlay up for your own account, could look like this</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">mkdir</span> ~/.config/nixpkgs/overlays/</span>
<span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cat</span> &gt; ~/.config/nixpkgs/overlays/prefer-remote-fetch.nix &lt;&lt;<span class="hljs-string">EOF</span></span>
  self: super: super.prefer-remote-fetch self super
EOF
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-pkgs-nix-gitignore" class="title" style="clear: both">pkgs.nix-gitignore   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-nix-gitignore" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-nix-gitignore-usage">Usage</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-nix-gitignore-usage-recursive">gitignore files in subdirectories</a> </span></dt> </dl></div><p><code class="literal">pkgs.nix-gitignore</code> is a function that acts similarly to <code class="literal">builtins.filterSource</code> but also allows filtering with the help of the gitignore format.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-pkgs-nix-gitignore-usage" class="title">Usage   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-nix-gitignore-usage" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p><code class="literal">pkgs.nix-gitignore</code> exports a number of functions, but you’ll most likely need either <code class="literal">gitignoreSource</code> or <code class="literal">gitignoreSourcePure</code>. As their first argument, they both accept either 1. a file with gitignore lines or 2. a string with gitignore lines, or 3. a list of either of the two. They will be concatenated into a single big string.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ pkgs ? <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {} }:

 nix-gitignore.gitignoreSource [] ./source
     <span class="hljs-comment"># Simplest version</span>

 nix-gitignore.gitignoreSource <span class="hljs-string">"supplemental-ignores\n"</span> ./source
     <span class="hljs-comment"># This one reads the ./source/.gitignore and concats the auxiliary ignores</span>

 nix-gitignore.gitignoreSourcePure <span class="hljs-string">"ignore-this\nignore-that\n"</span> ./source
     <span class="hljs-comment"># Use this string as gitignore, don't read ./source/.gitignore.</span>

 nix-gitignore.gitignoreSourcePure [<span class="hljs-string">"ignore-this\nignore-that\n"</span>, ~/.gitignore] ./source
     <span class="hljs-comment"># It also accepts a list (of strings and paths) that will be concatenated</span>
     <span class="hljs-comment"># once the paths are turned to strings via readFile.</span>
</code></pre><p>These functions are derived from the <code class="literal">Filter</code> functions by setting the first filter argument to <code class="literal">(_: _: true)</code>:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">gitignoreSourcePure</span> = gitignoreFilterSourcePure (_: _: <span class="hljs-literal">true</span>);
<span class="hljs-attr">gitignoreSource</span> = gitignoreFilterSource (_: _: <span class="hljs-literal">true</span>);
</code></pre><p>Those filter functions accept the same arguments the <code class="literal">builtins.filterSource</code> function would pass to its filters, thus <code class="literal">fn: gitignoreFilterSourcePure fn ""</code> should be extensionally equivalent to <code class="literal">filterSource</code>. The file is blacklisted if it’s blacklisted by either your filter or the gitignoreFilter.</p><p>If you want to make your own filter from scratch, you may use</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">gitignoreFilter</span> = ign: root: filterPattern (gitignoreToPatterns ign) root;
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-pkgs-nix-gitignore-usage-recursive" class="title">gitignore files in subdirectories   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-nix-gitignore-usage-recursive" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>If you wish to use a filter that would search for .gitignore files in subdirectories, just like git does by default, use this function:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">gitignoreFilterRecursiveSource</span> = filter: patterns: root:
<span class="hljs-comment"># OR</span>
<span class="hljs-attr">gitignoreRecursiveSource</span> = gitignoreFilterSourcePure (_: _: <span class="hljs-literal">true</span>);
</code></pre>
</div>

</div>
</div><div class="chapter"> <div class="titlepage">  <div>   <div>    <h2 id="module-system" class="title">Module System   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#module-system" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <p><strong>Table of Contents</strong></p> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#module-system-introduction">Introduction</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#module-system-lib-evalModules"><code class="literal">lib.evalModules</code></a> </span></dt> </dl></div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="module-system-introduction" class="title" style="clear: both">Introduction   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#module-system-introduction" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>The module system is a language for handling configuration, implemented as a Nix library.</p><p>Compared to plain Nix, it adds documentation, type checking and composition or extensibility.</p><div class="note"><h3 class="title">Note</h3><p>This chapter is new and not complete yet. For a gentle introduction to the module system, in the context of NixOS, see <a class="link" href="https://nixos.org/manual/nixos/unstable/#sec-writing-modules" target="_top">Writing NixOS Modules</a> in the NixOS manual.</p></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="module-system-lib-evalModules" class="title" style="clear: both"><code class="literal">lib.evalModules</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#module-system-lib-evalModules" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#module-system-lib-evalModules-parameters">Parameters</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#module-system-lib-evalModules-return-value">Return value</a> </span></dt> </dl></div><p>Evaluate a set of modules. This function is typically only used once per application (e.g. once in NixOS, once in Home Manager, …).</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="module-system-lib-evalModules-parameters" class="title">Parameters   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#module-system-lib-evalModules-parameters" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="module-system-lib-evalModules-param-modules" class="title"><code class="literal">modules</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#module-system-lib-evalModules-param-modules" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>A list of modules. These are merged together to form the final configuration.
</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="module-system-lib-evalModules-param-specialArgs" class="title"><code class="literal">specialArgs</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#module-system-lib-evalModules-param-specialArgs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>An attribute set of module arguments that can be used in <code class="literal">imports</code>.</p><p>This is in contrast to <code class="literal">config._module.args</code>, which is only available after all <code class="literal">imports</code> have been resolved.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="module-system-lib-evalModules-param-class" class="title"><code class="literal">class</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#module-system-lib-evalModules-param-class" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>If the <code class="literal">class</code> attribute is set and non-<code class="literal">null</code>, the module system will reject <code class="literal">imports</code> with a different <code class="literal">_class</code> declaration.</p><p>The <code class="literal">class</code> value should be a string in lower <a class="link" href="https://en.wikipedia.org/wiki/Camel_case" target="_top">camel case</a>.</p><p>If applicable, the <code class="literal">class</code> should match the “prefix” of the attributes used in (experimental) <a class="link" href="https://nixos.org/manual/nix/stable/command-ref/new-cli/nix3-flake#description" target="_top">flakes</a>. Some examples are:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">nixos</code> as in <code class="literal">flake.nixosModules</code></p></li><li class="listitem"><p><code class="literal">nixosTest</code>: modules that constitute a <a class="link" href="https://nixos.org/manual/nixos/stable/#sec-nixos-tests" target="_top">NixOS VM test</a>
</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="module-system-lib-evalModules-param-prefix" class="title"><code class="literal">prefix</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#module-system-lib-evalModules-param-prefix" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>A list of strings representing the location at or below which all options are evaluated. This is used by <code class="literal">types.submodule</code> to improve error reporting and find the implicit <code class="literal">name</code> module argument.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="module-system-lib-evalModules-return-value" class="title">Return value   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#module-system-lib-evalModules-return-value" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The result is an attribute set with the following attributes:</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="module-system-lib-evalModules-return-value-options" class="title"><code class="literal">options</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#module-system-lib-evalModules-return-value-options" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>The nested attribute set of all option declarations.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="module-system-lib-evalModules-return-value-config" class="title"><code class="literal">config</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#module-system-lib-evalModules-return-value-config" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>The nested attribute set of all option values.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="module-system-lib-evalModules-return-value-type" class="title"><code class="literal">type</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#module-system-lib-evalModules-return-value-type" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>A module system type. This type is an instance of <code class="literal">types.submoduleWith</code> containing the current <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#module-system-lib-evalModules-param-modules" title="modules"><code class="literal">modules</code></a>.</p><p>The option definitions that are typed with this type will extend the current set of modules, like <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#module-system-lib-evalModules-return-value-extendModules" title="extendModules"><code class="literal">extendModules</code></a>.</p><p>However, the value returned from the type is just the <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#module-system-lib-evalModules-return-value-config" title="config"><code class="literal">config</code></a>, like any submodule.</p><p>If you’re familiar with prototype inheritance, you can think of this <code class="literal">evalModules</code> invocation as the prototype, and usages of this type as the instances.</p><p>This type is also available to the <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#module-system-lib-evalModules-param-modules" title="modules"><code class="literal">modules</code></a> as the module argument <code class="literal">moduleType</code>.
</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="module-system-lib-evalModules-return-value-extendModules" class="title"><code class="literal">extendModules</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#module-system-lib-evalModules-return-value-extendModules" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>A function similar to <code class="literal">evalModules</code> but building on top of the already passed <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#module-system-lib-evalModules-param-modules" title="modules"><code class="literal">modules</code></a>. Its arguments, <code class="literal">modules</code> and <code class="literal">specialArgs</code> are added to the existing values.</p><p>If you’re familiar with prototype inheritance, you can think of the current, actual <code class="literal">evalModules</code> invocation as the prototype, and the return value of <code class="literal">extendModules</code> as the instance.</p><p>This functionality is also available to modules as the <code class="literal">extendModules</code> module argument.</p><div class="note"><h3 class="title">Note</h3><p><span class="strong"><strong>Evaluation Performance</strong></span></p><p><code class="literal">extendModules</code> returns a configuration that shares very little with the original <code class="literal">evalModules</code> invocation, because the module arguments may be different.</p><p>So if you have a configuration that has been (or will be) largely evaluated, almost none of the computation is shared with the configuration returned by <code class="literal">extendModules</code>.</p><p>The real work of module evaluation happens while computing the values in <code class="literal">config</code> and <code class="literal">options</code>, so multiple invocations of <code class="literal">extendModules</code> have a particularly small cost, as long as only the final <code class="literal">config</code> and <code class="literal">options</code> are evaluated.</p><p>If you do reference multiple <code class="literal">config</code> (or <code class="literal">options</code>) from before and after <code class="literal">extendModules</code>, evaluation performance is the same as with multiple <code class="literal">evalModules</code> invocations, because the new modules’ ability to override existing configuration fundamentally requires constructing a new <code class="literal">config</code> and <code class="literal">options</code> fixpoint.</p></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="module-system-lib-evalModules-return-value-_module" class="title"><code class="literal">_module</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#module-system-lib-evalModules-return-value-_module" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>A portion of the configuration tree which is elided from <code class="literal">config</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="module-system-lib-evalModules-return-value-_type" class="title"><code class="literal">_type</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#module-system-lib-evalModules-return-value-_type" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>A nominal type marker, always <code class="literal">"configuration"</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="module-system-lib-evalModules-return-value-_configurationClass" class="title"><code class="literal">class</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#module-system-lib-evalModules-return-value-_configurationClass" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>The <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#module-system-lib-evalModules-param-class" title="class"><code class="literal">class</code> argument</a>.</p>
</div>

</div>

</div>

</div>
</div><div class="part"> <div class="titlepage">  <div>   <div>    <h1 id="part-stdenv" class="title">Standard environment   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#part-stdenv" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h1>  </div> </div></div><div class="partintro"><div class="toc"> <p><strong>Table of Contents</strong></p> <dl class="toc">  <dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-stdenv">The Standard Environment</a> </span></dt><dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-meta">Meta-attributes</a> </span></dt><dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-multiple-output">Multiple-output packages</a> </span></dt><dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-cross">Cross-compilation</a> </span></dt><dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-platform-notes">Platform Notes</a> </span></dt> </dl></div></div><div class="chapter"> <div class="titlepage">  <div>   <div>    <h2 id="chap-stdenv" class="title">The Standard Environment   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#chap-stdenv" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <p><strong>Table of Contents</strong></p> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-using-stdenv">Using <code class="literal">stdenv</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-tools-of-stdenv">Tools provided by <code class="literal">stdenv</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-stdenv-dependencies">Specifying dependencies</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-stdenv-attributes">Attributes</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-stdenv-phases">Phases</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-stdenv-functions">Shell functions and utilities</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-setup-hooks">Package setup hooks</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-purity-in-nixpkgs">Purity in Nixpkgs</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-hardening-in-nixpkgs">Hardening in Nixpkgs</a> </span></dt> </dl></div><p>The standard build environment in the Nix Packages collection provides an environment for building Unix packages that does a lot of common build tasks automatically. In fact, for Unix packages that use the standard <code class="literal">./configure; make; make install</code> build interface, you don’t need to write a build script at all; the standard environment does everything automatically. If <code class="literal">stdenv</code> doesn’t do what you need automatically, you can easily customise or override the various build phases.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-using-stdenv" class="title" style="clear: both">Using <code class="literal">stdenv</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-using-stdenv" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-building-stdenv-package-in-nix-shell">Building a <code class="literal">stdenv</code> package in <code class="literal">nix-shell</code></a> </span></dt> </dl></div><p>To build a package with the standard environment, you use the function <code class="literal">stdenv.mkDerivation</code>, instead of the primitive built-in function <code class="literal">derivation</code>, e.g.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">stdenv.mkDerivation {
  <span class="hljs-attr">name</span> = <span class="hljs-string">"libfoo-1.2.3"</span>;
  <span class="hljs-attr">src</span> = fetchurl {
    <span class="hljs-attr">url</span> = <span class="hljs-string">"http://example.org/libfoo-1.2.3.tar.bz2"</span>;
    <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-tWxU/LANbQE32my+9AXyt3nCT7NBVfJ45CX757EMT3Q="</span>;
  };
}
</code></pre><p>(<code class="literal">stdenv</code> needs to be in scope, so if you write this in a separate Nix expression from <code class="literal">pkgs/all-packages.nix</code>, you need to pass it as a function argument.) Specifying a <code class="literal">name</code> and a <code class="literal">src</code> is the absolute minimum Nix requires. For convenience, you can also use <code class="literal">pname</code> and <code class="literal">version</code> attributes and <code class="literal">mkDerivation</code> will automatically set <code class="literal">name</code> to <code class="literal">"${pname}-${version}"</code> by default.
<span class="strong"><strong>Since <a class="link" href="https://github.com/NixOS/rfcs/pull/35" target="_top">RFC 0035</a>, this is preferred for packages in Nixpkgs</strong></span>, as it allows us to reuse the version easily:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">stdenv.mkDerivation <span class="hljs-keyword">rec</span> {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"libfoo"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"1.2.3"</span>;
  <span class="hljs-attr">src</span> = fetchurl {
    <span class="hljs-attr">url</span> = <span class="hljs-string">"http://example.org/libfoo-source-<span class="hljs-subst">${version}</span>.tar.bz2"</span>;
    <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-tWxU/LANbQE32my+9AXyt3nCT7NBVfJ45CX757EMT3Q="</span>;
  };
}
</code></pre><p>Many packages have dependencies that are not provided in the standard environment. It’s usually sufficient to specify those dependencies in the <code class="literal">buildInputs</code> attribute:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">stdenv.mkDerivation {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"libfoo"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"1.2.3"</span>;
  ...
  <span class="hljs-attr">buildInputs</span> = [libbar perl ncurses];
}
</code></pre><p>This attribute ensures that the <code class="literal">bin</code> subdirectories of these packages appear in the <code class="literal">PATH</code> environment variable during the build, that their <code class="literal">include</code> subdirectories are searched by the C compiler, and so on. (See <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#ssec-setup-hooks" title="Package setup hooks">the section called “Package setup hooks”</a> for details.)</p><p>Often it is necessary to override or modify some aspect of the build. To make this easier, the standard environment breaks the package build into a number of <span class="emphasis"><em>phases</em></span>, all of which can be overridden or modified individually: unpacking the sources, applying patches, configuring, building, and installing. (There are some others; see <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#sec-stdenv-phases" title="Phases">the section called “Phases”</a>.) For instance, a package that doesn’t supply a makefile but instead has to be compiled “manually” could be handled like this:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">stdenv.mkDerivation {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"fnord"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"4.5"</span>;
  ...
  <span class="hljs-attr">buildPhase</span> = <span class="hljs-string">''
    gcc foo.c -o foo
  ''</span>;
  <span class="hljs-attr">installPhase</span> = <span class="hljs-string">''
    mkdir -p $out/bin
    cp foo $out/bin
  ''</span>;
}
</code></pre><p>(Note the use of <code class="literal">''</code>-style string literals, which are very convenient for large multi-line script fragments because they don’t need escaping of <code class="literal">"</code> and <code class="literal">\</code>, and because indentation is intelligently removed.)</p><p>There are many other attributes to customise the build. These are listed in <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#ssec-stdenv-attributes" title="Attributes">the section called “Attributes”</a>.</p><p>While the standard environment provides a generic builder, you can still supply your own build script:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">stdenv.mkDerivation {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"libfoo"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"1.2.3"</span>;
  ...
  <span class="hljs-attr">builder</span> = ./builder.sh;
}
</code></pre><p>where the builder can do anything it wants, but typically starts with</p><pre><code class="programlisting bash hljs language-bash" data-highlighted="yes"><span class="hljs-built_in">source</span> <span class="hljs-variable">$stdenv</span>/setup
</code></pre><p>to let <code class="literal">stdenv</code> set up the environment (e.g. by resetting <code class="literal">PATH</code> and populating it from build inputs). If you want, you can still use <code class="literal">stdenv</code>’s generic builder:</p><pre><code class="programlisting bash hljs language-bash" data-highlighted="yes"><span class="hljs-built_in">source</span> <span class="hljs-variable">$stdenv</span>/setup

<span class="hljs-function"><span class="hljs-title">buildPhase</span></span>() {
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"... this is my custom build phase ..."</span>
  gcc foo.c -o foo
}

<span class="hljs-function"><span class="hljs-title">installPhase</span></span>() {
  <span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$out</span>/bin
  <span class="hljs-built_in">cp</span> foo <span class="hljs-variable">$out</span>/bin
}

genericBuild
</code></pre><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-building-stdenv-package-in-nix-shell" class="title">Building a <code class="literal">stdenv</code> package in <code class="literal">nix-shell</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-building-stdenv-package-in-nix-shell" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>To build a <code class="literal">stdenv</code> package in a <a class="link" href="https://nixos.org/manual/nix/unstable/command-ref/nix-shell" target="_top"><code class="literal">nix-shell</code></a>, enter a shell, find the <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#sec-stdenv-phases" title="Phases">phases</a> you wish to build, then invoke <code class="literal">genericBuild</code> manually:</p><p>Go to an empty directory, invoke <code class="literal">nix-shell</code> with the desired package, and from inside the shell, set the output variables to a writable directory:</p><pre><code class="programlisting bash hljs language-bash" data-highlighted="yes"><span class="hljs-built_in">cd</span> <span class="hljs-string">"<span class="hljs-subst">$(mktemp -d)</span>"</span>
nix-shell <span class="hljs-string">'&lt;nixpkgs&gt;'</span> -A some_package
<span class="hljs-built_in">export</span> out=$(<span class="hljs-built_in">pwd</span>)/out
</code></pre><p>Next, invoke the desired parts of the build.
First, run the phases that generate a working copy of the sources, which will change directory to the sources for you:</p><pre><code class="programlisting bash hljs language-bash" data-highlighted="yes">phases=<span class="hljs-string">"<span class="hljs-variable">${prePhases[*]:-}</span> unpackPhase patchPhase"</span> genericBuild
</code></pre><p>Then, run more phases up until the failure is reached.
If the failure is in the build or check phase, the following phases would be required:</p><pre><code class="programlisting bash hljs language-bash" data-highlighted="yes">phases=<span class="hljs-string">"<span class="hljs-variable">${preConfigurePhases[*]:-}</span> configurePhase <span class="hljs-variable">${preBuildPhases[*]:-}</span> buildPhase checkPhase"</span> genericBuild
</code></pre><p>Use this command to run all install phases:</p><pre><code class="programlisting bash hljs language-bash" data-highlighted="yes">phases=<span class="hljs-string">"<span class="hljs-variable">${preInstallPhases[*]:-}</span> installPhase <span class="hljs-variable">${preFixupPhases[*]:-}</span> fixupPhase installCheckPhase"</span> genericBuild
</code></pre><p>Single phase can be re-run as many times as necessary to examine the failure like so:</p><pre><code class="programlisting bash hljs language-bash" data-highlighted="yes">phases=<span class="hljs-string">"buildPhase"</span> genericBuild
</code></pre><p>To modify a <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#sec-stdenv-phases" title="Phases">phase</a>, first print it with</p><pre><code class="programlisting bash hljs language-bash" data-highlighted="yes"><span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$buildPhase</span>"</span>
</code></pre><p>Or, if that is empty, for instance, if it is using a function:</p><pre><code class="programlisting bash hljs language-bash" data-highlighted="yes"><span class="hljs-built_in">type</span> buildPhase
</code></pre><p>then change it in a text editor, and paste it back to the terminal.</p><div class="note"><h3 class="title">Note</h3><p>This method may have some inconsistencies in environment variables and behaviour compared to a normal build within the <a class="link" href="https://nixos.org/manual/nix/unstable/language/derivations#builder-execution" target="_top">Nix build sandbox</a>.
The following is a non-exhaustive list of such differences:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">TMP</code>, <code class="literal">TMPDIR</code>, and similar variables likely point to non-empty directories that the build might conflict with files in.</p></li><li class="listitem"><p>Output store paths are not writable, so the variables for outputs need to be overridden to writable paths.</p></li><li class="listitem"><p>Other environment variables may be inconsistent with a <code class="literal">nix-build</code> either due to <code class="literal">nix-shell</code>’s initialization script or due to the use of <code class="literal">nix-shell</code> without the <code class="literal">--pure</code> option.</p></li></ul></div><p>If the build fails differently inside the shell than in the sandbox, consider using <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#breakpointhook" title="breakpointHook"><code class="literal">breakpointHook</code></a> and invoking <code class="literal">nix-build</code> instead.
The <a class="link" href="https://nixos.org/manual/nix/unstable/command-ref/conf-file#opt--keep-failed" target="_top"><code class="literal">--keep-failed</code></a> option for <code class="literal">nix-build</code> may also be useful to examine the build directory of a failed build.</p></div>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-tools-of-stdenv" class="title" style="clear: both">Tools provided by <code class="literal">stdenv</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-tools-of-stdenv" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>The standard environment provides the following packages:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>The GNU C Compiler, configured with C and C++ support.</p></li><li class="listitem"><p>GNU coreutils (contains a few dozen standard Unix commands).</p></li><li class="listitem"><p>GNU findutils (contains <code class="literal">find</code>).</p></li><li class="listitem"><p>GNU diffutils (contains <code class="literal">diff</code>, <code class="literal">cmp</code>).</p></li><li class="listitem"><p>GNU <code class="literal">sed</code>.</p></li><li class="listitem"><p>GNU <code class="literal">grep</code>.</p></li><li class="listitem"><p>GNU <code class="literal">awk</code>.</p></li><li class="listitem"><p>GNU <code class="literal">tar</code>.</p></li><li class="listitem"><p><code class="literal">gzip</code>, <code class="literal">bzip2</code> and <code class="literal">xz</code>.</p></li><li class="listitem"><p>GNU Make.</p></li><li class="listitem"><p>Bash. This is the shell used for all builders in the Nix Packages collection. Not using <code class="literal">/bin/sh</code> removes a large source of portability problems.</p></li><li class="listitem"><p>The <code class="literal">patch</code> command.</p></li></ul></div><p>On Linux, <code class="literal">stdenv</code> also includes the <code class="literal">patchelf</code> utility.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="ssec-stdenv-dependencies" class="title" style="clear: both">Specifying dependencies   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-stdenv-dependencies" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-stdenv-dependencies-overview">Overview</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-stdenv-dependencies-reference">Reference</a> </span></dt> </dl></div><p>Build systems often require more dependencies than just what <code class="literal">stdenv</code> provides. This section describes attributes accepted by <code class="literal">stdenv.mkDerivation</code> that can be used to make these dependencies available to the build system.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-stdenv-dependencies-overview" class="title">Overview   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-stdenv-dependencies-overview" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>A full reference of the different kinds of dependencies is provided in <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#ssec-stdenv-dependencies-reference" title="Reference">the section called “Reference”</a>, but here is an overview of the most common ones.
It should cover most use cases.</p><p>Add dependencies to <code class="literal">nativeBuildInputs</code> if they are executed during the build:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>those which are needed on <code class="literal">$PATH</code> during the build, for example <code class="literal">cmake</code> and <code class="literal">pkg-config</code></p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ssec-setup-hooks" title="Package setup hooks">setup hooks</a>, for example <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#fun-makeWrapper" title="makeWrapper &lt;executable&gt; &lt;wrapperfile&gt; &lt;args&gt;"><code class="literal">makeWrapper</code></a></p></li><li class="listitem"><p>interpreters needed by <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#patch-shebangs.sh" title="patch-shebangs.sh"><code class="literal">patchShebangs</code></a> for build scripts (with the <code class="literal">--build</code> flag), which can be the case for e.g. <code class="literal">perl</code></p></li></ul></div><p>Add dependencies to <code class="literal">buildInputs</code> if they will end up copied or linked into the final output or otherwise used at runtime:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>libraries used by compilers, for example <code class="literal">zlib</code>,</p></li><li class="listitem"><p>interpreters needed by <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#patch-shebangs.sh" title="patch-shebangs.sh"><code class="literal">patchShebangs</code></a> for scripts which are installed, which can be the case for e.g. <code class="literal">perl</code></p></li></ul></div><div class="note"><h3 class="title">Note</h3><p>These criteria are independent.</p><p>For example, software using Wayland usually needs the <code class="literal">wayland</code> library at runtime, so <code class="literal">wayland</code> should be added to <code class="literal">buildInputs</code>.
But it also executes the <code class="literal">wayland-scanner</code> program as part of the build to generate code, so <code class="literal">wayland</code> should also be added to <code class="literal">nativeBuildInputs</code>.</p></div><p>Dependencies needed only to run tests are similarly classified between native (executed during build) and non-native (executed at runtime):</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">nativeCheckInputs</code> for test tools needed on <code class="literal">$PATH</code> (such as <code class="literal">ctest</code>) and <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ssec-setup-hooks" title="Package setup hooks">setup hooks</a> (for example <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#python" title="Python"><code class="literal">pytestCheckHook</code></a>)</p></li><li class="listitem"><p><code class="literal">checkInputs</code> for libraries linked into test executables (for example the <code class="literal">qcheck</code> OCaml package)</p></li></ul></div><p>These dependencies are only injected when <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-doCheck" title="doCheck"><code class="literal">doCheck</code></a> is set to <code class="literal">true</code>.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="ssec-stdenv-dependencies-overview-example" class="title">Example   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-stdenv-dependencies-overview-example" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Consider for example this simplified derivation for <code class="literal">solo5</code>, a sandboxing tool:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">stdenv.mkDerivation <span class="hljs-keyword">rec</span> {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"solo5"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"0.7.5"</span>;

  <span class="hljs-attr">src</span> = fetchurl {
    <span class="hljs-attr">url</span> = <span class="hljs-string">"https://github.com/Solo5/solo5/releases/download/v<span class="hljs-subst">${version}</span>/solo5-v<span class="hljs-subst">${version}</span>.tar.gz"</span>;
    <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-viwrS9lnaU8sTGuzK/+L/PlMM/xRRtgVuK5pixVeDEw="</span>;
  };

  <span class="hljs-attr">nativeBuildInputs</span> = [ makeWrapper pkg-config ];
  <span class="hljs-attr">buildInputs</span> = [ libseccomp ];

  <span class="hljs-attr">postInstall</span> = <span class="hljs-string">''
    substituteInPlace $out/bin/solo5-virtio-mkimage \
      --replace "/usr/lib/syslinux" "<span class="hljs-subst">${syslinux}</span>/share/syslinux" \
      --replace "/usr/share/syslinux" "<span class="hljs-subst">${syslinux}</span>/share/syslinux" \
      --replace "cp " "cp --no-preserve=mode "

    wrapProgram $out/bin/solo5-virtio-mkimage \
      --prefix PATH : <span class="hljs-subst">${lib.makeBinPath [ dosfstools mtools parted syslinux ]}</span>
  ''</span>;

  <span class="hljs-attr">doCheck</span> = <span class="hljs-literal">true</span>;
  <span class="hljs-attr">nativeCheckInputs</span> = [ util-linux qemu ];
  <span class="hljs-attr">checkPhase</span> = <span class="hljs-string">'' [elided] ''</span>;
}
</code></pre><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">makeWrapper</code> is a setup hook, i.e., a shell script sourced by the generic builder of <code class="literal">stdenv</code>.
It is thus executed during the build and must be added to <code class="literal">nativeBuildInputs</code>.</p></li><li class="listitem"><p><code class="literal">pkg-config</code> is a build tool which the configure script of <code class="literal">solo5</code> expects to be on <code class="literal">$PATH</code> during the build:
therefore, it must be added to <code class="literal">nativeBuildInputs</code>.</p></li><li class="listitem"><p><code class="literal">libseccomp</code> is a library linked into <code class="literal">$out/bin/solo5-elftool</code>.
As it is used at runtime, it must be added to <code class="literal">buildInputs</code>.</p></li><li class="listitem"><p>Tests need <code class="literal">qemu</code> and <code class="literal">getopt</code> (from <code class="literal">util-linux</code>) on <code class="literal">$PATH</code>, these must be added to <code class="literal">nativeCheckInputs</code>.</p></li><li class="listitem"><p>Some dependencies are injected directly in the shell code of phases: <code class="literal">syslinux</code>, <code class="literal">dosfstools</code>, <code class="literal">mtools</code>, and <code class="literal">parted</code>.
In this specific case, they will end up in the output of the derivation (<code class="literal">$out</code> here).
As Nix marks dependencies whose absolute path is present in the output as runtime dependencies, adding them to <code class="literal">buildInputs</code> is not required.</p></li></ul></div><p>For more complex cases, like libraries linked into an executable which is then executed as part of the build system, see <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#ssec-stdenv-dependencies-reference" title="Reference">the section called “Reference”</a>.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-stdenv-dependencies-reference" class="title">Reference   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-stdenv-dependencies-reference" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>As described in the Nix manual, almost any <code class="literal">*.drv</code> store path in a derivation’s attribute set will induce a dependency on that derivation. <code class="literal">mkDerivation</code>, however, takes a few attributes intended to include all the dependencies of a package. This is done both for structure and consistency, but also so that certain other setup can take place. For example, certain dependencies need their bin directories added to the <code class="literal">PATH</code>. That is built-in, but other setup is done via a pluggable mechanism that works in conjunction with these dependency attributes. See <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#ssec-setup-hooks" title="Package setup hooks">the section called “Package setup hooks”</a> for details.</p><p>Dependencies can be broken down along three axes: their host and target platforms relative to the new derivation’s, and whether they are propagated. The platform distinctions are motivated by cross compilation; see <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#chap-cross" title="Cross-compilation"><em>Cross-compilation</em></a> for exactly what each platform means. <a href="https://nixos.org/manual/nixpkgs/stable/#footnote-stdenv-ignored-build-platform" class="footnote" id="footnote-stdenv-ignored-build-platform.__back.0"><sup class="footnote">[1]</sup></a> But even if one is not cross compiling, the platforms imply whether or not the dependency is needed at run-time or build-time, a concept that makes perfect sense outside of cross compilation. By default, the run-time/build-time distinction is just a hint for mental clarity, but with <code class="literal">strictDeps</code> set it is mostly enforced even in the native case.</p><p>The extension of <code class="literal">PATH</code> with dependencies, alluded to above, proceeds according to the relative platforms alone. The process is carried out only for dependencies whose host platform matches the new derivation’s build platform i.e. dependencies which run on the platform where the new derivation will be built. <a href="https://nixos.org/manual/nixpkgs/stable/#footnote-stdenv-native-dependencies-in-path" class="footnote" id="footnote-stdenv-native-dependencies-in-path.__back.0"><sup class="footnote">[2]</sup></a> For each dependency &lt;dep&gt; of those dependencies, <code class="literal">dep/bin</code>, if present, is added to the <code class="literal">PATH</code> environment variable.</p><p>A dependency is said to be <span class="strong"><strong>propagated</strong></span> when some of its other-transitive (non-immediate) downstream dependencies also need it as an immediate dependency.
<a href="https://nixos.org/manual/nixpkgs/stable/#footnote-stdenv-propagated-dependencies" class="footnote" id="footnote-stdenv-propagated-dependencies.__back.0"><sup class="footnote">[3]</sup></a></p><p>It is important to note that dependencies are not necessarily propagated as the same sort of dependency that they were before, but rather as the corresponding sort so that the platform rules still line up. To determine the exact rules for dependency propagation, we start by assigning to each dependency a couple of ternary numbers (<code class="literal">-1</code> for <code class="literal">build</code>, <code class="literal">0</code> for <code class="literal">host</code>, and <code class="literal">1</code> for <code class="literal">target</code>) representing its <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#possible-dependency-types" title="Possible dependency types">dependency type</a>, which captures how its host and target platforms are each “offset” from the depending derivation’s host and target platforms. The following table summarize the different combinations that can be obtained:</p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col align="left"><col align="left"><col align="left"></colgroup><thead><tr><th align="left"><code class="literal">host → target</code></th><th align="left">attribute name</th><th align="left">offset</th></tr></thead><tbody><tr><td align="left"><code class="literal">build --&gt; build</code></td><td align="left"><code class="literal">depsBuildBuild</code></td><td align="left"><code class="literal">-1, -1</code></td></tr><tr><td align="left"><code class="literal">build --&gt; host</code></td><td align="left"><code class="literal">nativeBuildInputs</code></td><td align="left"><code class="literal">-1, 0</code></td></tr><tr><td align="left"><code class="literal">build --&gt; target</code></td><td align="left"><code class="literal">depsBuildTarget</code></td><td align="left"><code class="literal">-1, 1</code></td></tr><tr><td align="left"><code class="literal">host --&gt; host</code></td><td align="left"><code class="literal">depsHostHost</code></td><td align="left"><code class="literal">0, 0</code></td></tr><tr><td align="left"><code class="literal">host --&gt; target</code></td><td align="left"><code class="literal">buildInputs</code></td><td align="left"><code class="literal">0, 1</code></td></tr><tr><td align="left"><code class="literal">target --&gt; target</code></td><td align="left"><code class="literal">depsTargetTarget</code></td><td align="left"><code class="literal">1, 1</code></td></tr></tbody></table></div><p>Algorithmically, we traverse propagated inputs, accumulating every propagated dependency’s propagated dependencies and adjusting them to account for the “shift in perspective” described by the current dependency’s platform offsets. This results is sort of a transitive closure of the dependency relation, with the offsets being approximately summed when two dependency links are combined. We also prune transitive dependencies whose combined offsets go out-of-bounds, which can be viewed as a filter over that transitive closure removing dependencies that are blatantly absurd.</p><p>We can define the process precisely with <a class="link" href="https://en.wikipedia.org/wiki/Natural_deduction" target="_top">Natural Deduction</a> using the inference rules. This probably seems a bit obtuse, but so is the bash code that actually implements it! <a href="https://nixos.org/manual/nixpkgs/stable/#footnote-stdenv-find-inputs-location" class="footnote" id="footnote-stdenv-find-inputs-location.__back.0"><sup class="footnote">[4]</sup></a> They’re confusing in very different ways so… hopefully if something doesn’t make sense in one presentation, it will in the other!</p><pre><code class="programlisting hljs language-bash" data-highlighted="yes"><span class="hljs-built_in">let</span> mapOffset(h, t, i) = i + (<span class="hljs-keyword">if</span> i &lt;= 0 <span class="hljs-keyword">then</span> h <span class="hljs-keyword">else</span> t - 1)

propagated-dep(h0, t0, A, B)
propagated-dep(h1, t1, B, C)
h0 + h1 <span class="hljs-keyword">in</span> {-1, 0, 1}
h0 + t1 <span class="hljs-keyword">in</span> {-1, 0, 1}
-------------------------------------- Transitive property
propagated-dep(mapOffset(h0, t0, h1),
               mapOffset(h0, t0, t1),
               A, C)
</code></pre><pre><code class="programlisting hljs language-bash" data-highlighted="yes"><span class="hljs-built_in">let</span> mapOffset(h, t, i) = i + (<span class="hljs-keyword">if</span> i &lt;= 0 <span class="hljs-keyword">then</span> h <span class="hljs-keyword">else</span> t - 1)

dep(h0, t0, A, B)
propagated-dep(h1, t1, B, C)
h0 + h1 <span class="hljs-keyword">in</span> {-1, 0, 1}
h0 + t1 <span class="hljs-keyword">in</span> {-1, 0, -1}
----------------------------- Take immediate dependencies<span class="hljs-string">' propagated dependencies
propagated-dep(mapOffset(h0, t0, h1),
               mapOffset(h0, t0, t1),
               A, C)
</span></code></pre><pre><code class="programlisting hljs language-undefined" data-highlighted="yes">propagated-dep(h, t, A, B)
----------------------------- Propagated dependencies count as dependencies
dep(h, t, A, B)
</code></pre><p>Some explanation of this monstrosity is in order. In the common case, the target offset of a dependency is the successor to the target offset: <code class="literal">t = h + 1</code>. That means that:</p><pre><code class="programlisting hljs language-bash" data-highlighted="yes"><span class="hljs-built_in">let</span> f(h, t, i) = i + (<span class="hljs-keyword">if</span> i &lt;= 0 <span class="hljs-keyword">then</span> h <span class="hljs-keyword">else</span> t - 1)
<span class="hljs-built_in">let</span> f(h, h + 1, i) = i + (<span class="hljs-keyword">if</span> i &lt;= 0 <span class="hljs-keyword">then</span> h <span class="hljs-keyword">else</span> (h + 1) - 1)
<span class="hljs-built_in">let</span> f(h, h + 1, i) = i + (<span class="hljs-keyword">if</span> i &lt;= 0 <span class="hljs-keyword">then</span> h <span class="hljs-keyword">else</span> h)
<span class="hljs-built_in">let</span> f(h, h + 1, i) = i + h
</code></pre><p>This is where “sum-like” comes in from above: We can just sum all of the host offsets to get the host offset of the transitive dependency. The target offset is the transitive dependency is the host offset + 1, just as it was with the dependencies composed to make this transitive one; it can be ignored as it doesn’t add any new information.</p><p>Because of the bounds checks, the uncommon cases are <code class="literal">h = t</code> and <code class="literal">h + 2 = t</code>. In the former case, the motivation for <code class="literal">mapOffset</code> is that since its host and target platforms are the same, no transitive dependency of it should be able to “discover” an offset greater than its reduced target offsets. <code class="literal">mapOffset</code> effectively “squashes” all its transitive dependencies’ offsets so that none will ever be greater than the target offset of the original <code class="literal">h = t</code> package. In the other case, <code class="literal">h + 1</code> is skipped over between the host and target offsets. Instead of squashing the offsets, we need to “rip” them apart so no transitive dependencies’ offset is that one.</p><p>Overall, the unifying theme here is that propagation shouldn’t be introducing transitive dependencies involving platforms the depending package is unaware of. [One can imagine the depending package asking for dependencies with the platforms it knows about; other platforms it doesn’t know how to ask for. The platform description in that scenario is a kind of unforgeable capability.] The offset bounds checking and definition of <code class="literal">mapOffset</code> together ensure that this is the case. Discovering a new offset is discovering a new platform, and since those platforms weren’t in the derivation “spec” of the needing package, they cannot be relevant. From a capability perspective, we can imagine that the host and target platforms of a package are the capabilities a package requires, and the depending package must provide the capability to the dependency.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="variables-specifying-dependencies" class="title">Variables specifying dependencies   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#variables-specifying-dependencies" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-depsBuildBuild" class="title"><code class="literal">depsBuildBuild</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-depsBuildBuild" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>A list of dependencies whose host and target platforms are the new derivation’s build platform. These are programs and libraries used at build time that produce programs and libraries also used at build time. If the dependency doesn’t care about the target platform (i.e. isn’t a compiler or similar tool), put it in <code class="literal">nativeBuildInputs</code> instead. The most common use of this <code class="literal">buildPackages.stdenv.cc</code>, the default C compiler for this role. That example crops up more than one might think in old commonly used C libraries.</p><p>Since these packages are able to be run at build-time, they are always added to the <code class="literal">PATH</code>, as described above. But since these packages are only guaranteed to be able to run then, they shouldn’t persist as run-time dependencies. This isn’t currently enforced, but could be in the future.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-nativeBuildInputs" class="title"><code class="literal">nativeBuildInputs</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-nativeBuildInputs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>A list of dependencies whose host platform is the new derivation’s build platform, and target platform is the new derivation’s host platform. These are programs and libraries used at build-time that, if they are a compiler or similar tool, produce code to run at run-time—i.e. tools used to build the new derivation. If the dependency doesn’t care about the target platform (i.e. isn’t a compiler or similar tool), put it here, rather than in <code class="literal">depsBuildBuild</code> or <code class="literal">depsBuildTarget</code>. This could be called <code class="literal">depsBuildHost</code> but <code class="literal">nativeBuildInputs</code> is used for historical continuity.</p><p>Since these packages are able to be run at build-time, they are added to the <code class="literal">PATH</code>, as described above. But since these packages are only guaranteed to be able to run then, they shouldn’t persist as run-time dependencies. This isn’t currently enforced, but could be in the future.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-depsBuildTarget" class="title"><code class="literal">depsBuildTarget</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-depsBuildTarget" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>A list of dependencies whose host platform is the new derivation’s build platform, and target platform is the new derivation’s target platform. These are programs used at build time that produce code to run with code produced by the depending package. Most commonly, these are tools used to build the runtime or standard library that the currently-being-built compiler will inject into any code it compiles. In many cases, the currently-being-built-compiler is itself employed for that task, but when that compiler won’t run (i.e. its build and host platform differ) this is not possible. Other times, the compiler relies on some other tool, like binutils, that is always built separately so that the dependency is unconditional.</p><p>This is a somewhat confusing concept to wrap one’s head around, and for good reason. As the only dependency type where the platform offsets, <code class="literal">-1</code> and <code class="literal">1</code>, are not adjacent integers, it requires thinking of a bootstrapping stage <span class="emphasis"><em>two</em></span> away from the current one. It and its use-case go hand in hand and are both considered poor form: try to not need this sort of dependency, and try to avoid building standard libraries and runtimes in the same derivation as the compiler produces code using them. Instead strive to build those like a normal library, using the newly-built compiler just as a normal library would. In short, do not use this attribute unless you are packaging a compiler and are sure it is needed.</p><p>Since these packages are able to run at build time, they are added to the <code class="literal">PATH</code>, as described above. But since these packages are only guaranteed to be able to run then, they shouldn’t persist as run-time dependencies. This isn’t currently enforced, but could be in the future.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-depsHostHost" class="title"><code class="literal">depsHostHost</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-depsHostHost" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>A list of dependencies whose host and target platforms match the new derivation’s host platform. In practice, this would usually be tools used by compilers for macros or a metaprogramming system, or libraries used by the macros or metaprogramming code itself. It’s always preferable to use a <code class="literal">depsBuildBuild</code> dependency in the derivation being built over a <code class="literal">depsHostHost</code> on the tool doing the building for this purpose.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-buildInputs" class="title"><code class="literal">buildInputs</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-buildInputs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>A list of dependencies whose host platform and target platform match the new derivation’s. This would be called <code class="literal">depsHostTarget</code> but for historical continuity. If the dependency doesn’t care about the target platform (i.e. isn’t a compiler or similar tool), put it here, rather than in <code class="literal">depsBuildBuild</code>.</p><p>These are often programs and libraries used by the new derivation at <span class="emphasis"><em>run</em></span>-time, but that isn’t always the case. For example, the machine code in a statically-linked library is only used at run-time, but the derivation containing the library is only needed at build-time. Even in the dynamic case, the library may also be needed at build-time to appease the linker.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-depsTargetTarget" class="title"><code class="literal">depsTargetTarget</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-depsTargetTarget" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>A list of dependencies whose host platform matches the new derivation’s target platform. These are packages that run on the target platform, e.g. the standard library or run-time deps of standard library that a compiler insists on knowing about. It’s poor form in almost all cases for a package to depend on another from a future stage [future stage corresponding to positive offset]. Do not use this attribute unless you are packaging a compiler and are sure it is needed.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-depsBuildBuildPropagated" class="title"><code class="literal">depsBuildBuildPropagated</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-depsBuildBuildPropagated" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>The propagated equivalent of <code class="literal">depsBuildBuild</code>. This perhaps never ought to be used, but it is included for consistency [see below for the others].</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-propagatedNativeBuildInputs" class="title"><code class="literal">propagatedNativeBuildInputs</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-propagatedNativeBuildInputs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>The propagated equivalent of <code class="literal">nativeBuildInputs</code>. This would be called <code class="literal">depsBuildHostPropagated</code> but for historical continuity. For example, if package <code class="literal">Y</code> has <code class="literal">propagatedNativeBuildInputs = [X]</code>, and package <code class="literal">Z</code> has <code class="literal">buildInputs = [Y]</code>, then package <code class="literal">Z</code> will be built as if it included package <code class="literal">X</code> in its <code class="literal">nativeBuildInputs</code>. If instead, package <code class="literal">Z</code> has <code class="literal">nativeBuildInputs = [Y]</code>, then <code class="literal">Z</code> will be built as if it included <code class="literal">X</code> in the <code class="literal">depsBuildBuild</code> of package <code class="literal">Z</code>, because of the sum of the two <code class="literal">-1</code> host offsets.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-depsBuildTargetPropagated" class="title"><code class="literal">depsBuildTargetPropagated</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-depsBuildTargetPropagated" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>The propagated equivalent of <code class="literal">depsBuildTarget</code>. This is prefixed for the same reason of alerting potential users.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-depsHostHostPropagated" class="title"><code class="literal">depsHostHostPropagated</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-depsHostHostPropagated" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>The propagated equivalent of <code class="literal">depsHostHost</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-propagatedBuildInputs" class="title"><code class="literal">propagatedBuildInputs</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-propagatedBuildInputs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>The propagated equivalent of <code class="literal">buildInputs</code>. This would be called <code class="literal">depsHostTargetPropagated</code> but for historical continuity.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-depsTargetTargetPropagated" class="title"><code class="literal">depsTargetTargetPropagated</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-depsTargetTargetPropagated" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>The propagated equivalent of <code class="literal">depsTargetTarget</code>. This is prefixed for the same reason of alerting potential users.</p>
</div>

</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="ssec-stdenv-attributes" class="title" style="clear: both">Attributes   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-stdenv-attributes" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#variables-affecting-stdenv-initialisation">Variables affecting <code class="literal">stdenv</code> initialisation</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#attributes-affecting-build-properties">Attributes affecting build properties</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#special-variables">Special variables</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#mkderivation-recursive-attributes">Fixed-point arguments of <code class="literal">mkDerivation</code></a> </span></dt> </dl></div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="variables-affecting-stdenv-initialisation" class="title">Variables affecting <code class="literal">stdenv</code> initialisation   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#variables-affecting-stdenv-initialisation" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="var-stdenv-NIX_DEBUG" class="title"><code class="literal">NIX_DEBUG</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-NIX_DEBUG" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>A number between 0 and 7 indicating how much information to log. If set to 1 or higher, <code class="literal">stdenv</code> will print moderate debugging information during the build. In particular, the <code class="literal">gcc</code> and <code class="literal">ld</code> wrapper scripts will print out the complete command line passed to the wrapped tools. If set to 6 or higher, the <code class="literal">stdenv</code> setup script will be run with <code class="literal">set -x</code> tracing. If set to 7 or higher, the <code class="literal">gcc</code> and <code class="literal">ld</code> wrapper scripts will also be run with <code class="literal">set -x</code> tracing.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="attributes-affecting-build-properties" class="title">Attributes affecting build properties   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#attributes-affecting-build-properties" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="var-stdenv-enableParallelBuilding" class="title"><code class="literal">enableParallelBuilding</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-enableParallelBuilding" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>If set to <code class="literal">true</code>, <code class="literal">stdenv</code> will pass specific flags to <code class="literal">make</code> and other build tools to enable parallel building with up to <code class="literal">build-cores</code> workers.</p><p>Unless set to <code class="literal">false</code>, some build systems with good support for parallel building including <code class="literal">cmake</code>, <code class="literal">meson</code>, and <code class="literal">qmake</code> will set it to <code class="literal">true</code>.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="special-variables" class="title">Special variables   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#special-variables" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="var-stdenv-passthru" class="title"><code class="literal">passthru</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-passthru" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>This is an attribute set which can be filled with arbitrary values. For example:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">passthru</span> = {
  <span class="hljs-attr">foo</span> = <span class="hljs-string">"bar"</span>;
  <span class="hljs-attr">baz</span> = {
    <span class="hljs-attr">value1</span> = <span class="hljs-number">4</span>;
    <span class="hljs-attr">value2</span> = <span class="hljs-number">5</span>;
  };
}
</code></pre><p>Values inside it are not passed to the builder, so you can change them without triggering a rebuild. However, they can be accessed outside of a derivation directly, as if they were set inside a derivation itself, e.g. <code class="literal">hello.baz.value1</code>. We don’t specify any usage or schema of <code class="literal">passthru</code> - it is meant for values that would be useful outside the derivation in other parts of a Nix expression (e.g. in other derivations). An example would be to convey some specific dependency of your derivation which contains a program with plugins support. Later, others who make derivations with plugins can use passed-through dependency to ensure that their plugin would be binary-compatible with built program.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="var-passthru-updateScript" class="title"><code class="literal">passthru.updateScript</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-passthru-updateScript" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>A script to be run by <code class="literal">maintainers/scripts/update.nix</code> when the package is matched. The attribute can contain one of the following:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><span id="var-passthru-updateScript-command"></span> an executable file, either on the file system:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">passthru.<span class="hljs-attr">updateScript</span> = ./update.sh;
</code></pre><p>or inside the expression itself:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">passthru.<span class="hljs-attr">updateScript</span> = writeScript <span class="hljs-string">"update-zoom-us"</span> <span class="hljs-string">''
  #!/usr/bin/env nix-shell
  #!nix-shell -i bash -p curl pcre common-updater-scripts

  set -eu -o pipefail

  version="$(curl -sI https://zoom.us/client/latest/zoom_x86_64.tar.xz | grep -Fi 'Location:' | pcregrep -o1 '/(([0-9]\.?)+)/')"
  update-source-version zoom-us "$version"
''</span>;
</code></pre></li><li class="listitem"><p>a list, a script followed by arguments to be passed to it:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">passthru.<span class="hljs-attr">updateScript</span> = [ ../../update.sh pname <span class="hljs-string">"--requested-release=unstable"</span> ];
</code></pre></li><li class="listitem"><p>an attribute set containing:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p><span id="var-passthru-updateScript-set-command"></span><code class="literal">command</code> – a string or list in the <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#var-passthru-updateScript-command">format expected by <code class="literal">passthru.updateScript</code></a>.</p></li><li class="listitem"><p><span id="var-passthru-updateScript-set-attrPath"></span><code class="literal">attrPath</code> (optional) – a string containing the canonical attribute path for the package. If present, it will be passed to the update script instead of the attribute path on which the package was discovered during Nixpkgs traversal.</p></li><li class="listitem"><p><span id="var-passthru-updateScript-set-supportedFeatures"></span><code class="literal">supportedFeatures</code> (optional) – a list of the <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#var-passthru-updateScript-supported-features" title="Supported features">extra features</a> the script supports.</p></li></ul></div><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">passthru.<span class="hljs-attr">updateScript</span> = {
  <span class="hljs-attr">command</span> = [ ../../update.sh pname ];
  <span class="hljs-attr">attrPath</span> = pname;
  <span class="hljs-attr">supportedFeatures</span> = [ … ];
};
</code></pre></li></ul></div><div class="tip"><h3 class="title">Tip</h3><p>A common pattern is to use the <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/common-updater/nix-update.nix" target="_top"><code class="literal">nix-update-script</code></a> attribute provided in Nixpkgs, which runs <a class="link" href="https://github.com/Mic92/nix-update" target="_top"><code class="literal">nix-update</code></a>:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">passthru.<span class="hljs-attr">updateScript</span> = nix-update-script { };
</code></pre><p>For simple packages, this is often enough, and will ensure that the package is updated automatically by <a class="link" href="https://ryantm.github.io/nixpkgs-update" target="_top"><code class="literal">nixpkgs-update</code></a> when a new version is released. The <a class="link" href="https://nix-community.org/update-bot" target="_top">update bot</a> runs periodically to attempt to automatically update packages, and will run <code class="literal">passthru.updateScript</code> if set. While not strictly necessary if the project is listed on <a class="link" href="https://repology.org/" target="_top">Repology</a>, using <code class="literal">nix-update-script</code> allows the package to update via many more sources (e.g. GitHub releases).</p></div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-passthru-updateScript-execution" class="title">How update scripts are executed?   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-passthru-updateScript-execution" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Update scripts are to be invoked by <code class="literal">maintainers/scripts/update.nix</code> script. You can run <code class="literal">nix-shell maintainers/scripts/update.nix</code> in the root of Nixpkgs repository for information on how to use it. <code class="literal">update.nix</code> offers several modes for selecting packages to update (e.g. select by attribute path, traverse Nixpkgs and filter by maintainer, etc.), and it will execute update scripts for all matched packages that have an <code class="literal">updateScript</code> attribute.</p><p>Each update script will be passed the following environment variables:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><span id="var-passthru-updateScript-env-UPDATE_NIX_NAME"></span><code class="literal">UPDATE_NIX_NAME</code> – content of the <code class="literal">name</code> attribute of the updated package.</p></li><li class="listitem"><p><span id="var-passthru-updateScript-env-UPDATE_NIX_PNAME"></span><code class="literal">UPDATE_NIX_PNAME</code> – content of the <code class="literal">pname</code> attribute of the updated package.</p></li><li class="listitem"><p><span id="var-passthru-updateScript-env-UPDATE_NIX_OLD_VERSION"></span><code class="literal">UPDATE_NIX_OLD_VERSION</code> – content of the <code class="literal">version</code> attribute of the updated package.</p></li><li class="listitem"><p><span id="var-passthru-updateScript-env-UPDATE_NIX_ATTR_PATH"></span><code class="literal">UPDATE_NIX_ATTR_PATH</code> – attribute path the <code class="literal">update.nix</code> discovered the package on (or the <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#var-passthru-updateScript-set-attrPath">canonical <code class="literal">attrPath</code></a> when available). Example: <code class="literal">pantheon.elementary-terminal</code></p></li></ul></div><div class="note"><h3 class="title">Note</h3><p>An update script will be usually run from the root of the Nixpkgs repository but you should not rely on that. Also note that <code class="literal">update.nix</code> executes update scripts in parallel by default so you should avoid running <code class="literal">git commit</code> or any other commands that cannot handle that.</p></div><div class="tip"><h3 class="title">Tip</h3><p>While update scripts should not create commits themselves, <code class="literal">maintainers/scripts/update.nix</code> supports automatically creating commits when running it with <code class="literal">--argstr commit true</code>. If you need to customize commit message, you can have the update script implement <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#var-passthru-updateScript-commit" title="commit"><code class="literal">commit</code></a> feature.</p></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-passthru-updateScript-supported-features" class="title">Supported features   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-passthru-updateScript-supported-features" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h6 id="var-passthru-updateScript-commit" class="title"><code class="literal">commit</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-passthru-updateScript-commit" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h6>  </div> </div></div><p>This feature allows update scripts to <span class="emphasis"><em>ask</em></span> <code class="literal">update.nix</code> to create Git commits.</p><p>When support of this feature is declared, whenever the update script exits with <code class="literal">0</code> return status, it is expected to print a JSON list containing an object described below for each updated attribute to standard output.</p><p>When <code class="literal">update.nix</code> is run with <code class="literal">--argstr commit true</code> arguments, it will create a separate commit for each of the objects. An empty list can be returned when the script did not update any files, for example, when the package is already at the latest version.</p><p>The commit object contains the following values:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><span id="var-passthru-updateScript-commit-attrPath"></span><code class="literal">attrPath</code> – a string containing attribute path.</p></li><li class="listitem"><p><span id="var-passthru-updateScript-commit-oldVersion"></span><code class="literal">oldVersion</code> – a string containing old version.</p></li><li class="listitem"><p><span id="var-passthru-updateScript-commit-newVersion"></span><code class="literal">newVersion</code> – a string containing new version.</p></li><li class="listitem"><p><span id="var-passthru-updateScript-commit-files"></span><code class="literal">files</code> – a non-empty list of file paths (as strings) to add to the commit.</p></li><li class="listitem"><p><span id="var-passthru-updateScript-commit-commitBody"></span><code class="literal">commitBody</code> (optional) – a string with extra content to be appended to the default commit message (useful for adding changelog links).</p></li><li class="listitem"><p><span id="var-passthru-updateScript-commit-commitMessage"></span><code class="literal">commitMessage</code> (optional) – a string to use instead of the default commit message.</p></li></ul></div><p>If the returned array contains exactly one object (e.g. <code class="literal">[{}]</code>), all values are optional and will be determined automatically.</p><div class="example"><span id="var-passthru-updateScript-example-commit"></span><p class="title"><strong>Example&nbsp;232.&nbsp;Standard output of an update script using commit feature</strong></p><div class="example-contents"><pre><code class="programlisting json hljs language-bash" data-highlighted="yes">[
  {
    <span class="hljs-string">"attrPath"</span>: <span class="hljs-string">"volume_key"</span>,
    <span class="hljs-string">"oldVersion"</span>: <span class="hljs-string">"0.3.11"</span>,
    <span class="hljs-string">"newVersion"</span>: <span class="hljs-string">"0.3.12"</span>,
    <span class="hljs-string">"files"</span>: [
      <span class="hljs-string">"/path/to/nixpkgs/pkgs/development/libraries/volume-key/default.nix"</span>
    ]
  }
]
</code></pre></div></div><br class="example-break">
</div>

</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="mkderivation-recursive-attributes" class="title">Fixed-point arguments of <code class="literal">mkDerivation</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#mkderivation-recursive-attributes" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>If you pass a function to <code class="literal">mkDerivation</code>, it will receive as its argument the final arguments, including the overrides when reinvoked via <code class="literal">overrideAttrs</code>. For example:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">mkDerivation (finalAttrs: {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"hello"</span>;
  <span class="hljs-attr">withFeature</span> = <span class="hljs-literal">true</span>;
  <span class="hljs-attr">configureFlags</span> =
    lib.optionals finalAttrs.withFeature [<span class="hljs-string">"--with-feature"</span>];
})
</code></pre><p>Note that this does not use the <code class="literal">rec</code> keyword to reuse <code class="literal">withFeature</code> in <code class="literal">configureFlags</code>.
The <code class="literal">rec</code> keyword works at the syntax level and is unaware of overriding.</p><p>Instead, the definition references <code class="literal">finalAttrs</code>, allowing users to change <code class="literal">withFeature</code>
consistently with <code class="literal">overrideAttrs</code>.</p><p><code class="literal">finalAttrs</code> also contains the attribute <code class="literal">finalPackage</code>, which includes the output paths, etc.</p><p>Let’s look at a more elaborate example to understand the differences between
various bindings:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-comment"># `pkg` is the _original_ definition (for illustration purposes)</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">pkg</span> =
  mkDerivation (finalAttrs: {
    <span class="hljs-comment"># ...</span>

    <span class="hljs-comment"># An example attribute</span>
    <span class="hljs-attr">packages</span> = [];

    <span class="hljs-comment"># `passthru.tests` is a commonly defined attribute.</span>
    passthru.tests.<span class="hljs-attr">simple</span> = f finalAttrs.finalPackage;

    <span class="hljs-comment"># An example of an attribute containing a function</span>
    passthru.<span class="hljs-attr">appendPackages</span> = packages':
      finalAttrs.finalPackage.overrideAttrs (newSelf: super: {
        <span class="hljs-attr">packages</span> = super.packages ++ packages';
      });

    <span class="hljs-comment"># For illustration purposes; referenced as</span>
    <span class="hljs-comment"># `(pkg.overrideAttrs(x)).finalAttrs` etc in the text below.</span>
    passthru.<span class="hljs-attr">finalAttrs</span> = finalAttrs;
    passthru.<span class="hljs-attr">original</span> = pkg;
  });
<span class="hljs-keyword">in</span> pkg
</code></pre><p>Unlike the <code class="literal">pkg</code> binding in the above example, the <code class="literal">finalAttrs</code> parameter always references the final attributes. For instance <code class="literal">(pkg.overrideAttrs(x)).finalAttrs.finalPackage</code> is identical to <code class="literal">pkg.overrideAttrs(x)</code>, whereas <code class="literal">(pkg.overrideAttrs(x)).original</code> is the same as the original <code class="literal">pkg</code>.</p><p>See also the section about <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#var-meta-tests" title="tests"><code class="literal">passthru.tests</code></a>.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-stdenv-phases" class="title" style="clear: both">Phases   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-stdenv-phases" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-controlling-phases">Controlling phases</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-unpack-phase">The unpack phase</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-patch-phase">The patch phase</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-configure-phase">The configure phase</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#build-phase">The build phase</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-check-phase">The check phase</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-install-phase">The install phase</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-fixup-phase">The fixup phase</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-installCheck-phase">The installCheck phase</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-distribution-phase">The distribution phase</a> </span></dt> </dl></div><p><code class="literal">stdenv.mkDerivation</code> sets the Nix <a class="link" href="https://nixos.org/manual/nix/stable/expressions/derivations.html#derivations" target="_top">derivation</a>’s builder to a script that loads the stdenv <code class="literal">setup.sh</code> bash library and calls <code class="literal">genericBuild</code>. Most packaging functions rely on this default builder.</p><p>This generic command invokes a number of <span class="emphasis"><em>phases</em></span>. Package builds are split into phases to make it easier to override specific parts of the build (e.g., unpacking the sources or installing the binaries).</p><p>Each phase can be overridden in its entirety either by setting the environment variable <code class="literal">namePhase</code> to a string containing some shell commands to be executed, or by redefining the shell function <code class="literal">namePhase</code>. The former is convenient to override a phase from the derivation, while the latter is convenient from a build script. However, typically one only wants to <span class="emphasis"><em>add</em></span> some commands to a phase, e.g. by defining <code class="literal">postInstall</code> or <code class="literal">preFixup</code>, as skipping some of the default actions may have unexpected consequences. The default script for each phase is defined in the file <code class="literal">pkgs/stdenv/generic/setup.sh</code>.</p><p>When overriding a phase, for example <code class="literal">installPhase</code>, it is important to start with <code class="literal">runHook preInstall</code> and end it with <code class="literal">runHook postInstall</code>, otherwise <code class="literal">preInstall</code> and <code class="literal">postInstall</code> will not be run. Even if you don’t use them directly, it is good practice to do so anyways for downstream users who would want to add a <code class="literal">postInstall</code> by overriding your derivation.</p><p>While inside an interactive <code class="literal">nix-shell</code>, if you wanted to run all phases in the order they would be run in an actual build, you can invoke <code class="literal">genericBuild</code> yourself.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-controlling-phases" class="title">Controlling phases   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-controlling-phases" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>There are a number of variables that control what phases are executed and in what order:</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="variables-affecting-phase-control" class="title">Variables affecting phase control   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#variables-affecting-phase-control" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-phases" class="title"><code class="literal">phases</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-phases" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Specifies the phases. You can change the order in which phases are executed, or add new phases, by setting this variable. If it’s not set, the default value is used, which is <code class="literal">$prePhases unpackPhase patchPhase $preConfigurePhases configurePhase $preBuildPhases buildPhase checkPhase $preInstallPhases installPhase fixupPhase installCheckPhase $preDistPhases distPhase $postPhases</code>.</p><p>It is discouraged to set this variable, as it is easy to miss some important functionality hidden in some of the less obviously needed phases (like <code class="literal">fixupPhase</code> which patches the shebang of scripts).
Usually, if you just want to add a few phases, it’s more convenient to set one of the variables below (such as <code class="literal">preInstallPhases</code>).</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-prePhases" class="title"><code class="literal">prePhases</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-prePhases" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Additional phases executed before any of the default phases.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-preConfigurePhases" class="title"><code class="literal">preConfigurePhases</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-preConfigurePhases" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Additional phases executed just before the configure phase.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-preBuildPhases" class="title"><code class="literal">preBuildPhases</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-preBuildPhases" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Additional phases executed just before the build phase.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-preInstallPhases" class="title"><code class="literal">preInstallPhases</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-preInstallPhases" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Additional phases executed just before the install phase.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-preFixupPhases" class="title"><code class="literal">preFixupPhases</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-preFixupPhases" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Additional phases executed just before the fixup phase.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-preDistPhases" class="title"><code class="literal">preDistPhases</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-preDistPhases" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Additional phases executed just before the distribution phase.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-postPhases" class="title"><code class="literal">postPhases</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-postPhases" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Additional phases executed after any of the default phases.</p>
</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-unpack-phase" class="title">The unpack phase   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-unpack-phase" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The unpack phase is responsible for unpacking the source code of the package. The default implementation of <code class="literal">unpackPhase</code> unpacks the source files listed in the <code class="literal">src</code> environment variable to the current directory. It supports the following files by default:</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="tar-files" class="title">Tar files   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#tar-files" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>These can optionally be compressed using <code class="literal">gzip</code> (<code class="literal">.tar.gz</code>, <code class="literal">.tgz</code> or <code class="literal">.tar.Z</code>), <code class="literal">bzip2</code> (<code class="literal">.tar.bz2</code>, <code class="literal">.tbz2</code> or <code class="literal">.tbz</code>) or <code class="literal">xz</code> (<code class="literal">.tar.xz</code>, <code class="literal">.tar.lzma</code> or <code class="literal">.txz</code>).</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="zip-files" class="title">Zip files   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#zip-files" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Zip files are unpacked using <code class="literal">unzip</code>. However, <code class="literal">unzip</code> is not in the standard environment, so you should add it to <code class="literal">nativeBuildInputs</code> yourself.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="directories-in-the-nix-store" class="title">Directories in the Nix store   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#directories-in-the-nix-store" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>These are copied to the current directory. The hash part of the file name is stripped, e.g. <code class="literal">/nix/store/1wydxgby13cz...-my-sources</code> would be copied to <code class="literal">my-sources</code>.</p><p>Additional file types can be supported by setting the <code class="literal">unpackCmd</code> variable (see below).</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="variables-controlling-the-unpack-phase" class="title">Variables controlling the unpack phase   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#variables-controlling-the-unpack-phase" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-src" class="title"><code class="literal">srcs</code> / <code class="literal">src</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-src" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>The list of source files or directories to be unpacked or copied. One of these must be set. Note that if you use <code class="literal">srcs</code>, you should also set <code class="literal">sourceRoot</code> or <code class="literal">setSourceRoot</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-sourceRoot" class="title"><code class="literal">sourceRoot</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-sourceRoot" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>After unpacking all of <code class="literal">src</code> and <code class="literal">srcs</code>, if neither of <code class="literal">sourceRoot</code> and <code class="literal">setSourceRoot</code> are set, <code class="literal">unpackPhase</code> of the generic builder checks that the unpacking produced a single directory and moves the current working directory into it.</p><p>If <code class="literal">unpackPhase</code> produces multiple source directories, you should set <code class="literal">sourceRoot</code> to the name of the intended directory.
You can also set <code class="literal">sourceRoot = ".";</code> if you want to control it yourself in a later phase.</p><p>For example, if your want your build to start in a sub-directory inside your sources, and you are using <code class="literal">fetchzip</code>-derived <code class="literal">src</code> (like <code class="literal">fetchFromGitHub</code> or similar), you need to set <code class="literal">sourceRoot = "${src.name}/my-sub-directory"</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-setSourceRoot" class="title"><code class="literal">setSourceRoot</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-setSourceRoot" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Alternatively to setting <code class="literal">sourceRoot</code>, you can set <code class="literal">setSourceRoot</code> to a shell command to be evaluated by the unpack phase after the sources have been unpacked. This command must set <code class="literal">sourceRoot</code>.</p><p>For example, if you are using <code class="literal">fetchurl</code> on an archive file that gets unpacked into a single directory the name of which changes between package versions, and you want your build to start in its sub-directory, you need to set <code class="literal">setSourceRoot = "sourceRoot=$(echo */my-sub-directory)";</code>, or in the case of multiple sources, you could use something more specific, like <code class="literal">setSourceRoot = "sourceRoot=$(echo ${pname}-*/my-sub-directory)";</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-preUnpack" class="title"><code class="literal">preUnpack</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-preUnpack" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Hook executed at the start of the unpack phase.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-postUnpack" class="title"><code class="literal">postUnpack</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-postUnpack" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Hook executed at the end of the unpack phase.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-dontUnpack" class="title"><code class="literal">dontUnpack</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-dontUnpack" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Set to true to skip the unpack phase.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-dontMakeSourcesWritable" class="title"><code class="literal">dontMakeSourcesWritable</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-dontMakeSourcesWritable" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>If set to <code class="literal">1</code>, the unpacked sources are <span class="emphasis"><em>not</em></span> made writable. By default, they are made writable to prevent problems with read-only sources. For example, copied store directories would be read-only without this.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-unpackCmd" class="title"><code class="literal">unpackCmd</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-unpackCmd" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>The unpack phase evaluates the string <code class="literal">$unpackCmd</code> for any unrecognised file. The path to the current source file is contained in the <code class="literal">curSrc</code> variable.</p>
</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-patch-phase" class="title">The patch phase   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-patch-phase" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The patch phase applies the list of patches defined in the <code class="literal">patches</code> variable.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="variables-controlling-the-patch-phase" class="title">Variables controlling the patch phase   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#variables-controlling-the-patch-phase" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-dontPatch" class="title"><code class="literal">dontPatch</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-dontPatch" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Set to true to skip the patch phase.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-patches" class="title"><code class="literal">patches</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-patches" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>The list of patches. They must be in the format accepted by the <code class="literal">patch</code> command, and may optionally be compressed using <code class="literal">gzip</code> (<code class="literal">.gz</code>), <code class="literal">bzip2</code> (<code class="literal">.bz2</code>) or <code class="literal">xz</code> (<code class="literal">.xz</code>).</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-patchFlags" class="title"><code class="literal">patchFlags</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-patchFlags" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Flags to be passed to <code class="literal">patch</code>. If not set, the argument <code class="literal">-p1</code> is used, which causes the leading directory component to be stripped from the file names in each patch.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-prePatch" class="title"><code class="literal">prePatch</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-prePatch" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Hook executed at the start of the patch phase.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-postPatch" class="title"><code class="literal">postPatch</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-postPatch" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Hook executed at the end of the patch phase.</p>
</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-configure-phase" class="title">The configure phase   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-configure-phase" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The configure phase prepares the source tree for building. The default <code class="literal">configurePhase</code> runs <code class="literal">./configure</code> (typically an Autoconf-generated script) if it exists.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="variables-controlling-the-configure-phase" class="title">Variables controlling the configure phase   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#variables-controlling-the-configure-phase" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-configureScript" class="title"><code class="literal">configureScript</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-configureScript" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>The name of the configure script. It defaults to <code class="literal">./configure</code> if it exists; otherwise, the configure phase is skipped. This can actually be a command (like <code class="literal">perl ./Configure.pl</code>).</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-configureFlags" class="title"><code class="literal">configureFlags</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-configureFlags" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>A list of strings passed as additional arguments to the configure script.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-dontConfigure" class="title"><code class="literal">dontConfigure</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-dontConfigure" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Set to true to skip the configure phase.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-configureFlagsArray" class="title"><code class="literal">configureFlagsArray</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-configureFlagsArray" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>A shell array containing additional arguments passed to the configure script. You must use this instead of <code class="literal">configureFlags</code> if the arguments contain spaces.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-dontAddPrefix" class="title"><code class="literal">dontAddPrefix</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-dontAddPrefix" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>By default, the flag <code class="literal">--prefix=$prefix</code> is added to the configure flags. If this is undesirable, set this variable to true.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-prefix" class="title"><code class="literal">prefix</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-prefix" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>The prefix under which the package must be installed, passed via the <code class="literal">--prefix</code> option to the configure script. It defaults to <code class="literal">$out</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-prefixKey" class="title"><code class="literal">prefixKey</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-prefixKey" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>The key to use when specifying the prefix. By default, this is set to <code class="literal">--prefix=</code> as that is used by the majority of packages.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-dontAddStaticConfigureFlags" class="title"><code class="literal">dontAddStaticConfigureFlags</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-dontAddStaticConfigureFlags" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>By default, when building statically, stdenv will try to add build system appropriate configure flags to try to enable static builds.</p><p>If this is undesirable, set this variable to true.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-dontAddDisableDepTrack" class="title"><code class="literal">dontAddDisableDepTrack</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-dontAddDisableDepTrack" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>By default, the flag <code class="literal">--disable-dependency-tracking</code> is added to the configure flags to speed up Automake-based builds. If this is undesirable, set this variable to true.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-dontFixLibtool" class="title"><code class="literal">dontFixLibtool</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-dontFixLibtool" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>By default, the configure phase applies some special hackery to all files called <code class="literal">ltmain.sh</code> before running the configure script in order to improve the purity of Libtool-based packages <a href="https://nixos.org/manual/nixpkgs/stable/#footnote-stdenv-sys-lib-search-path" class="footnote" id="footnote-stdenv-sys-lib-search-path.__back.0"><sup class="footnote">[5]</sup></a> . If this is undesirable, set this variable to true.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-dontDisableStatic" class="title"><code class="literal">dontDisableStatic</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-dontDisableStatic" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>By default, when the configure script has <code class="literal">--enable-static</code>, the option <code class="literal">--disable-static</code> is added to the configure flags.</p><p>If this is undesirable, set this variable to true.  It is automatically set to true when building statically, for example through <code class="literal">pkgsStatic</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-configurePlatforms" class="title"><code class="literal">configurePlatforms</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-configurePlatforms" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>By default, when cross compiling, the configure script has <code class="literal">--build=...</code> and <code class="literal">--host=...</code> passed. Packages can instead pass <code class="literal">[ "build" "host" "target" ]</code> or a subset to control exactly which platform flags are passed. Compilers and other tools can use this to also pass the target platform. <a href="https://nixos.org/manual/nixpkgs/stable/#footnote-stdenv-build-time-guessing-impurity" class="footnote" id="footnote-stdenv-build-time-guessing-impurity.__back.0"><sup class="footnote">[6]</sup></a></p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-preConfigure" class="title"><code class="literal">preConfigure</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-preConfigure" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Hook executed at the start of the configure phase.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-postConfigure" class="title"><code class="literal">postConfigure</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-postConfigure" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Hook executed at the end of the configure phase.</p>
</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="build-phase" class="title">The build phase   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#build-phase" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The build phase is responsible for actually building the package (e.g. compiling it). The default <code class="literal">buildPhase</code> calls <code class="literal">make</code> if a file named <code class="literal">Makefile</code>, <code class="literal">makefile</code> or <code class="literal">GNUmakefile</code> exists in the current directory (or the <code class="literal">makefile</code> is explicitly set); otherwise it does nothing.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="variables-controlling-the-build-phase" class="title">Variables controlling the build phase   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#variables-controlling-the-build-phase" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-dontBuild" class="title"><code class="literal">dontBuild</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-dontBuild" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Set to true to skip the build phase.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-makefile" class="title"><code class="literal">makefile</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-makefile" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>The file name of the Makefile.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-makeFlags" class="title"><code class="literal">makeFlags</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-makeFlags" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>A list of strings passed as additional flags to <code class="literal">make</code>. These flags are also used by the default install and check phase. For setting make flags specific to the build phase, use <code class="literal">buildFlags</code> (see below).</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">makeFlags</span> = [ <span class="hljs-string">"PREFIX=$(out)"</span> ];
</code></pre><div class="note"><h3 class="title">Note</h3><p>The flags are quoted in bash, but environment variables can be specified by using the make syntax.</p></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-makeFlagsArray" class="title"><code class="literal">makeFlagsArray</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-makeFlagsArray" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>A shell array containing additional arguments passed to <code class="literal">make</code>. You must use this instead of <code class="literal">makeFlags</code> if the arguments contain spaces, e.g.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">preBuild</span> = <span class="hljs-string">''
  makeFlagsArray+=(CFLAGS="-O0 -g" LDFLAGS="-lfoo -lbar")
''</span>;
</code></pre><p>Note that shell arrays cannot be passed through environment variables, so you cannot set <code class="literal">makeFlagsArray</code> in a derivation attribute (because those are passed through environment variables): you have to define them in shell code.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-buildFlags" class="title"><code class="literal">buildFlags</code> / <code class="literal">buildFlagsArray</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-buildFlags" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>A list of strings passed as additional flags to <code class="literal">make</code>. Like <code class="literal">makeFlags</code> and <code class="literal">makeFlagsArray</code>, but only used by the build phase.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-preBuild" class="title"><code class="literal">preBuild</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-preBuild" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Hook executed at the start of the build phase.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-postBuild" class="title"><code class="literal">postBuild</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-postBuild" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Hook executed at the end of the build phase.</p><p>You can set flags for <code class="literal">make</code> through the <code class="literal">makeFlags</code> variable.</p><p>Before and after running <code class="literal">make</code>, the hooks <code class="literal">preBuild</code> and <code class="literal">postBuild</code> are called, respectively.</p>
</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-check-phase" class="title">The check phase   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-check-phase" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The check phase checks whether the package was built correctly by running its test suite. The default <code class="literal">checkPhase</code> calls <code class="literal">make $checkTarget</code>, but only if the <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-doCheck" title="doCheck"><code class="literal">doCheck</code> variable</a> is enabled.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="variables-controlling-the-check-phase" class="title">Variables controlling the check phase   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#variables-controlling-the-check-phase" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-doCheck" class="title"><code class="literal">doCheck</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-doCheck" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Controls whether the check phase is executed. By default it is skipped, but if <code class="literal">doCheck</code> is set to true, the check phase is usually executed. Thus you should set</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">doCheck</span> = <span class="hljs-literal">true</span>;
</code></pre><p>in the derivation to enable checks. The exception is cross compilation. Cross compiled builds never run tests, no matter how <code class="literal">doCheck</code> is set, as the newly-built program won’t run on the platform used to build it.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="makeflags-makeflagsarray-makefile" class="title"><code class="literal">makeFlags</code> / <code class="literal">makeFlagsArray</code> / <code class="literal">makefile</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#makeflags-makeflagsarray-makefile" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>See the <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-makeFlags" title="makeFlags">build phase</a> for details.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-checkTarget" class="title"><code class="literal">checkTarget</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-checkTarget" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>The <code class="literal">make</code> target that runs the tests.
If unset, use <code class="literal">check</code> if it exists, otherwise <code class="literal">test</code>; if neither is found, do nothing.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-checkFlags" class="title"><code class="literal">checkFlags</code> / <code class="literal">checkFlagsArray</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-checkFlags" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>A list of strings passed as additional flags to <code class="literal">make</code>. Like <code class="literal">makeFlags</code> and <code class="literal">makeFlagsArray</code>, but only used by the check phase.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-checkInputs" class="title"><code class="literal">checkInputs</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-checkInputs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>A list of host dependencies used by the phase, usually libraries linked into executables built during tests. This gets included in <code class="literal">buildInputs</code> when <code class="literal">doCheck</code> is set.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-nativeCheckInputs" class="title"><code class="literal">nativeCheckInputs</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-nativeCheckInputs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>A list of native dependencies used by the phase, notably tools needed on <code class="literal">$PATH</code>. This gets included in <code class="literal">nativeBuildInputs</code> when <code class="literal">doCheck</code> is set.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-preCheck" class="title"><code class="literal">preCheck</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-preCheck" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Hook executed at the start of the check phase.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-postCheck" class="title"><code class="literal">postCheck</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-postCheck" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Hook executed at the end of the check phase.</p>
</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-install-phase" class="title">The install phase   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-install-phase" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The install phase is responsible for installing the package in the Nix store under <code class="literal">out</code>. The default <code class="literal">installPhase</code> creates the directory <code class="literal">$out</code> and calls <code class="literal">make install</code>.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="variables-controlling-the-install-phase" class="title">Variables controlling the install phase   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#variables-controlling-the-install-phase" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-dontInstall" class="title"><code class="literal">dontInstall</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-dontInstall" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Set to true to skip the install phase.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="makeflags-makeflagsarray-makefile-1" class="title"><code class="literal">makeFlags</code> / <code class="literal">makeFlagsArray</code> / <code class="literal">makefile</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#makeflags-makeflagsarray-makefile-1" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>See the <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-makeFlags" title="makeFlags">build phase</a> for details.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-installTargets" class="title"><code class="literal">installTargets</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-installTargets" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>The make targets that perform the installation. Defaults to <code class="literal">install</code>. Example:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">installTargets</span> = <span class="hljs-string">"install-bin install-doc"</span>;
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-installFlags" class="title"><code class="literal">installFlags</code> / <code class="literal">installFlagsArray</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-installFlags" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>A list of strings passed as additional flags to <code class="literal">make</code>. Like <code class="literal">makeFlags</code> and <code class="literal">makeFlagsArray</code>, but only used by the install phase.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-preInstall" class="title"><code class="literal">preInstall</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-preInstall" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Hook executed at the start of the install phase.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-postInstall" class="title"><code class="literal">postInstall</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-postInstall" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Hook executed at the end of the install phase.</p>
</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-fixup-phase" class="title">The fixup phase   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-fixup-phase" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The fixup phase performs (Nix-specific) post-processing actions on the files installed under <code class="literal">$out</code> by the install phase. The default <code class="literal">fixupPhase</code> does the following:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>It moves the <code class="literal">man/</code>, <code class="literal">doc/</code> and <code class="literal">info/</code> subdirectories of <code class="literal">$out</code> to <code class="literal">share/</code>.</p></li><li class="listitem"><p>It strips libraries and executables of debug information.</p></li><li class="listitem"><p>On Linux, it applies the <code class="literal">patchelf</code> command to ELF executables and libraries to remove unused directories from the <code class="literal">RPATH</code> in order to prevent unnecessary runtime dependencies.</p></li><li class="listitem"><p>It rewrites the interpreter paths of shell scripts to paths found in <code class="literal">PATH</code>. E.g., <code class="literal">/usr/bin/perl</code> will be rewritten to <code class="literal">/nix/store/some-perl/bin/perl</code> found in <code class="literal">PATH</code>. See <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#patch-shebangs.sh" title="patch-shebangs.sh">the section called “<code class="literal">patch-shebangs.sh</code>”</a> for details.</p></li></ul></div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="variables-controlling-the-fixup-phase" class="title">Variables controlling the fixup phase   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#variables-controlling-the-fixup-phase" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-dontFixup" class="title"><code class="literal">dontFixup</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-dontFixup" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Set to true to skip the fixup phase.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-dontStrip" class="title"><code class="literal">dontStrip</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-dontStrip" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>If set, libraries and executables are not stripped. By default, they are.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-dontStripHost" class="title"><code class="literal">dontStripHost</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-dontStripHost" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Like <code class="literal">dontStrip</code>, but only affects the <code class="literal">strip</code> command targeting the package’s host platform. Useful when supporting cross compilation, but otherwise feel free to ignore.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-dontStripTarget" class="title"><code class="literal">dontStripTarget</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-dontStripTarget" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Like <code class="literal">dontStrip</code>, but only affects the <code class="literal">strip</code> command targeting the packages’ target platform. Useful when supporting cross compilation, but otherwise feel free to ignore.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-dontMoveSbin" class="title"><code class="literal">dontMoveSbin</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-dontMoveSbin" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>If set, files in <code class="literal">$out/sbin</code> are not moved to <code class="literal">$out/bin</code>. By default, they are.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-stripAllList" class="title"><code class="literal">stripAllList</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-stripAllList" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>List of directories to search for libraries and executables from which <span class="emphasis"><em>all</em></span> symbols should be stripped. By default, it’s empty. Stripping all symbols is risky, since it may remove not just debug symbols but also ELF information necessary for normal execution.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-stripAllListTarget" class="title"><code class="literal">stripAllListTarget</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-stripAllListTarget" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Like <code class="literal">stripAllList</code>, but only applies to packages’ target platform. By default, it’s empty. Useful when supporting cross compilation.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-stripAllFlags" class="title"><code class="literal">stripAllFlags</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-stripAllFlags" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Flags passed to the <code class="literal">strip</code> command applied to the files in the directories listed in <code class="literal">stripAllList</code>. Defaults to <code class="literal">-s</code> (i.e. <code class="literal">--strip-all</code>).</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-stripDebugList" class="title"><code class="literal">stripDebugList</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-stripDebugList" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>List of directories to search for libraries and executables from which only debugging-related symbols should be stripped. It defaults to <code class="literal">lib lib32 lib64 libexec bin sbin</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-stripDebugListTarget" class="title"><code class="literal">stripDebugListTarget</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-stripDebugListTarget" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Like <code class="literal">stripDebugList</code>, but only applies to packages’ target platform. By default, it’s empty. Useful when supporting cross compilation.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-stripDebugFlags" class="title"><code class="literal">stripDebugFlags</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-stripDebugFlags" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Flags passed to the <code class="literal">strip</code> command applied to the files in the directories listed in <code class="literal">stripDebugList</code>. Defaults to <code class="literal">-S</code> (i.e. <code class="literal">--strip-debug</code>).</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-stripExclude" class="title"><code class="literal">stripExclude</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-stripExclude" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>A list of filenames or path patterns to avoid stripping. A file is excluded if its name <span class="emphasis"><em>or</em></span> path (from the derivation root) matches.</p><p>This example prevents all <code class="literal">*.rlib</code> files from being stripped:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">stdenv.mkDerivation {
  <span class="hljs-comment"># ...</span>
  <span class="hljs-attr">stripExclude</span> = [ <span class="hljs-string">"*.rlib"</span> ]
}
</code></pre><p>This example prevents files within certain paths from being stripped:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">stdenv.mkDerivation {
  <span class="hljs-comment"># ...</span>
  <span class="hljs-attr">stripExclude</span> = [ <span class="hljs-string">"lib/modules/*/build/* ]
}
</span></code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-dontPatchELF" class="title"><code class="literal">dontPatchELF</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-dontPatchELF" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>If set, the <code class="literal">patchelf</code> command is not used to remove unnecessary <code class="literal">RPATH</code> entries. Only applies to Linux.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-dontPatchShebangs" class="title"><code class="literal">dontPatchShebangs</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-dontPatchShebangs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>If set, scripts starting with <code class="literal">#!</code> do not have their interpreter paths rewritten to paths in the Nix store. See <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#patch-shebangs.sh" title="patch-shebangs.sh">the section called “<code class="literal">patch-shebangs.sh</code>”</a> on how patching shebangs works.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-dontPruneLibtoolFiles" class="title"><code class="literal">dontPruneLibtoolFiles</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-dontPruneLibtoolFiles" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>If set, libtool <code class="literal">.la</code> files associated with shared libraries won’t have their <code class="literal">dependency_libs</code> field cleared.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-forceShare" class="title"><code class="literal">forceShare</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-forceShare" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>The list of directories that must be moved from <code class="literal">$out</code> to <code class="literal">$out/share</code>. Defaults to <code class="literal">man doc info</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-setupHook" class="title"><code class="literal">setupHook</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-setupHook" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>A package can export a <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ssec-setup-hooks" title="Package setup hooks">setup hook</a> by setting this variable. The setup hook, if defined, is copied to <code class="literal">$out/nix-support/setup-hook</code>. Environment variables are then substituted in it using <code class="literal">substituteAll</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-preFixup" class="title"><code class="literal">preFixup</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-preFixup" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Hook executed at the start of the fixup phase.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-postFixup" class="title"><code class="literal">postFixup</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-postFixup" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Hook executed at the end of the fixup phase.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="stdenv-separateDebugInfo" class="title"><code class="literal">separateDebugInfo</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#stdenv-separateDebugInfo" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>If set to <code class="literal">true</code>, the standard environment will enable debug information in C/C++ builds. After installation, the debug information will be separated from the executables and stored in the output named <code class="literal">debug</code>. (This output is enabled automatically; you don’t need to set the <code class="literal">outputs</code> attribute explicitly.) To be precise, the debug information is stored in <code class="literal">debug/lib/debug/.build-id/XX/YYYY…</code>, where &lt;XXYYYY…&gt; is the &lt;build ID&gt; of the binary — a SHA-1 hash of the contents of the binary. Debuggers like GDB use the build ID to look up the separated debug information.</p><div class="example"><span id="ex-gdb-debug-symbols-socat"></span><p class="title"><strong>Example&nbsp;233.&nbsp;Enable debug symbols for use with GDB</strong></p><div class="example-contents"><p>To make GDB find debug information for the <code class="literal">socat</code> package and its dependencies, you can use the following <code class="literal">shell.nix</code>:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">let</span>
  <span class="hljs-attr">pkgs</span> = <span class="hljs-built_in">import</span> ./. {
    <span class="hljs-attr">config</span> = {};
    <span class="hljs-attr">overlays</span> = [
      (final: prev: {
        <span class="hljs-attr">ncurses</span> = prev.ncurses.overrideAttrs { <span class="hljs-attr">separateDebugInfo</span> = <span class="hljs-literal">true</span>; };
        <span class="hljs-attr">readline</span> = prev.readline.overrideAttrs { <span class="hljs-attr">separateDebugInfo</span> = <span class="hljs-literal">true</span>; };
      })
    ];
  };

  <span class="hljs-attr">myDebugInfoDirs</span> = pkgs.symlinkJoin {
    <span class="hljs-attr">name</span> = <span class="hljs-string">"myDebugInfoDirs"</span>;
    <span class="hljs-attr">paths</span> = <span class="hljs-keyword">with</span> pkgs; [
      glibc.debug
      ncurses.debug
      openssl.debug
      readline.debug
    ];
  };
<span class="hljs-keyword">in</span>
  pkgs.mkShell {

    <span class="hljs-attr">NIX_DEBUG_INFO_DIRS</span> = <span class="hljs-string">"<span class="hljs-subst">${pkgs.lib.getLib myDebugInfoDirs}</span>/lib/debug"</span>;

    <span class="hljs-attr">packages</span> = [
      pkgs.gdb
      pkgs.socat
    ];

    <span class="hljs-attr">shellHook</span> = <span class="hljs-string">''
      <span class="hljs-subst">${pkgs.lib.getBin pkgs.gdb}</span>/bin/gdb <span class="hljs-subst">${pkgs.lib.getBin pkgs.socat}</span>/bin/socat
    ''</span>;
  }
</code></pre><p>This setup works as follows:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>Add <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#chap-overlays" title="Overlays"><code class="literal">overlays</code></a> to the package set, since debug symbols are disabled for <code class="literal">ncurses</code> and <code class="literal">readline</code> by default.</p></li><li class="listitem"><p>Create a derivation to combine all required debug symbols under one path with <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#trivial-builder-symlinkJoin" title="symlinkJoin"><code class="literal">symlinkJoin</code></a>.</p></li><li class="listitem"><p>Set the environment variable <code class="literal">NIX_DEBUG_INFO_DIRS</code> in the shell. Nixpkgs patches <code class="literal">gdb</code> to use it for looking up debug symbols.</p></li><li class="listitem"><p>Run <code class="literal">gdb</code> on the <code class="literal">socat</code> binary on shell startup in the <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-mkShell" title="pkgs.mkShell"><code class="literal">shellHook</code></a>. Here we use <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.getBin" title="lib.attrsets.getBin"><code class="literal">lib.getBin</code></a> to ensure that the correct derivation output is selected rather than the default one.</p></li></ul></div></div></div><br class="example-break">
</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-installCheck-phase" class="title">The installCheck phase   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-installCheck-phase" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The installCheck phase checks whether the package was installed correctly by running its test suite against the installed directories. The default <code class="literal">installCheck</code> calls <code class="literal">make installcheck</code>.</p><p>It is often better to add tests that are not part of the source distribution to <code class="literal">passthru.tests</code> (see
<a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#var-meta-tests" title="tests">the section called “<code class="literal">tests</code>”</a>). This avoids adding overhead to every build and enables us to run them independently.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="variables-controlling-the-installcheck-phase" class="title">Variables controlling the installCheck phase   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#variables-controlling-the-installcheck-phase" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-doInstallCheck" class="title"><code class="literal">doInstallCheck</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-doInstallCheck" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Controls whether the installCheck phase is executed. By default it is skipped, but if <code class="literal">doInstallCheck</code> is set to true, the installCheck phase is usually executed. Thus you should set</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">doInstallCheck</span> = <span class="hljs-literal">true</span>;
</code></pre><p>in the derivation to enable install checks. The exception is cross compilation. Cross compiled builds never run tests, no matter how <code class="literal">doInstallCheck</code> is set, as the newly-built program won’t run on the platform used to build it.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-installCheckTarget" class="title"><code class="literal">installCheckTarget</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-installCheckTarget" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>The make target that runs the install tests. Defaults to <code class="literal">installcheck</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-installCheckFlags" class="title"><code class="literal">installCheckFlags</code> / <code class="literal">installCheckFlagsArray</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-installCheckFlags" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>A list of strings passed as additional flags to <code class="literal">make</code>. Like <code class="literal">makeFlags</code> and <code class="literal">makeFlagsArray</code>, but only used by the installCheck phase.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-installCheckInputs" class="title"><code class="literal">installCheckInputs</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-installCheckInputs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>A list of host dependencies used by the phase, usually libraries linked into executables built during tests. This gets included in <code class="literal">buildInputs</code> when <code class="literal">doInstallCheck</code> is set.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-nativeInstallCheckInputs" class="title"><code class="literal">nativeInstallCheckInputs</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-nativeInstallCheckInputs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>A list of native dependencies used by the phase, notably tools needed on <code class="literal">$PATH</code>. This gets included in <code class="literal">nativeBuildInputs</code> when <code class="literal">doInstallCheck</code> is set.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-preInstallCheck" class="title"><code class="literal">preInstallCheck</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-preInstallCheck" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Hook executed at the start of the installCheck phase.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-postInstallCheck" class="title"><code class="literal">postInstallCheck</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-postInstallCheck" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Hook executed at the end of the installCheck phase.</p>
</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-distribution-phase" class="title">The distribution phase   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-distribution-phase" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The distribution phase is intended to produce a source distribution of the package. The default <code class="literal">distPhase</code> first calls <code class="literal">make dist</code>, then it copies the resulting source tarballs to <code class="literal">$out/tarballs/</code>. This phase is only executed if the attribute <code class="literal">doDist</code> is set.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="variables-controlling-the-distribution-phase" class="title">Variables controlling the distribution phase   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#variables-controlling-the-distribution-phase" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-doDist" class="title"><code class="literal">doDist</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-doDist" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>If set, the distribution phase is executed.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-distTarget" class="title"><code class="literal">distTarget</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-distTarget" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>The make target that produces the distribution. Defaults to <code class="literal">dist</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-distFlags" class="title"><code class="literal">distFlags</code> / <code class="literal">distFlagsArray</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-distFlags" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Additional flags passed to <code class="literal">make</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-tarballs" class="title"><code class="literal">tarballs</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-tarballs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>The names of the source distribution files to be copied to <code class="literal">$out/tarballs/</code>. It can contain shell wildcards. The default is <code class="literal">*.tar.gz</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-dontCopyDist" class="title"><code class="literal">dontCopyDist</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-dontCopyDist" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>If set, no files are copied to <code class="literal">$out/tarballs/</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-preDist" class="title"><code class="literal">preDist</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-preDist" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Hook executed at the start of the distribution phase.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="var-stdenv-postDist" class="title"><code class="literal">postDist</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-postDist" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Hook executed at the end of the distribution phase.</p>
</div>

</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="ssec-stdenv-functions" class="title" style="clear: both">Shell functions and utilities   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-stdenv-functions" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#fun-makeWrapper"><code class="literal">makeWrapper</code> &lt;executable&gt; &lt;wrapperfile&gt; &lt;args&gt;</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#fun-remove-references-to"><code class="literal">remove-references-to -t</code> &lt;storepath&gt; [ <code class="literal">-t</code> &lt;storepath&gt; … ] &lt;file&gt; …</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#fun-substitute"><code class="literal">substitute</code> &lt;infile&gt; &lt;outfile&gt; &lt;subs&gt;</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#fun-substituteInPlace"><code class="literal">substituteInPlace</code> &lt;multiple files&gt; &lt;subs&gt;</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#fun-substituteAll"><code class="literal">substituteAll</code> &lt;infile&gt; &lt;outfile&gt;</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#fun-substituteAllInPlace"><code class="literal">substituteAllInPlace</code> &lt;file&gt;</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#fun-stripHash"><code class="literal">stripHash</code> &lt;path&gt;</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#fun-wrapProgram"><code class="literal">wrapProgram</code> &lt;executable&gt; &lt;makeWrapperArgs&gt;</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#fun-prependToVar"><code class="literal">prependToVar</code> &lt;variableName&gt; &lt;elements…&gt;</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#fun-appendToVar"><code class="literal">appendToVar</code> &lt;variableName&gt; &lt;elements…&gt;</a> </span></dt> </dl></div><p>The standard environment provides a number of useful functions.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="fun-makeWrapper" class="title"><code class="literal">makeWrapper</code> &lt;executable&gt; &lt;wrapperfile&gt; &lt;args&gt;   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#fun-makeWrapper" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Constructs a wrapper for a program with various possible arguments. It is defined as part of 2 setup-hooks named <code class="literal">makeWrapper</code> and <code class="literal">makeBinaryWrapper</code> that implement the same bash functions. Hence, to use it you have to add <code class="literal">makeWrapper</code> to your <code class="literal">nativeBuildInputs</code>. Here’s an example usage:</p><pre><code class="programlisting bash hljs language-bash" data-highlighted="yes"><span class="hljs-comment"># adds `FOOBAR=baz` to `$out/bin/foo`’s environment</span>
makeWrapper <span class="hljs-variable">$out</span>/bin/foo <span class="hljs-variable">$wrapperfile</span> --<span class="hljs-built_in">set</span> FOOBAR baz

<span class="hljs-comment"># Prefixes the binary paths of `hello` and `git`</span>
<span class="hljs-comment"># and suffixes the binary path of `xdg-utils`.</span>
<span class="hljs-comment"># Be advised that paths often should be patched in directly</span>
<span class="hljs-comment"># (via string replacements or in `configurePhase`).</span>
makeWrapper <span class="hljs-variable">$out</span>/bin/foo <span class="hljs-variable">$wrapperfile</span> \
  --prefix PATH : <span class="hljs-variable">${lib.makeBinPath [ hello git ]}</span> \
  --suffix PATH : <span class="hljs-variable">${lib.makeBinPath [ xdg-utils ]}</span>
</code></pre><p>Packages may expect or require other utilities to be available at runtime.
<code class="literal">makeWrapper</code> can be used to add packages to a <code class="literal">PATH</code> environment variable local to a wrapper.</p><p>Use <code class="literal">--prefix</code> to explicitly set dependencies in <code class="literal">PATH</code>.</p><div class="note"><h3 class="title">Note</h3><p><code class="literal">--prefix</code> essentially hard-codes dependencies into the wrapper.
They cannot be overridden without rebuilding the package.</p></div><p>If dependencies should be resolved at runtime, use <code class="literal">--suffix</code> to append fallback values to <code class="literal">PATH</code>.</p><p>There’s many more kinds of arguments, they are documented in <code class="literal">nixpkgs/pkgs/build-support/setup-hooks/make-wrapper.sh</code> for the <code class="literal">makeWrapper</code> implementation and in <code class="literal">nixpkgs/pkgs/build-support/setup-hooks/make-binary-wrapper/make-binary-wrapper.sh</code> for the <code class="literal">makeBinaryWrapper</code> implementation.</p><p><code class="literal">wrapProgram</code> is a convenience function you probably want to use most of the time, implemented by both <code class="literal">makeWrapper</code> and <code class="literal">makeBinaryWrapper</code>.</p><p>Using the <code class="literal">makeBinaryWrapper</code> implementation is usually preferred, as it creates a tiny <span class="emphasis"><em>compiled</em></span> wrapper executable, that can be used as a shebang interpreter. This is needed mostly on Darwin, where shebangs cannot point to scripts, <a class="link" href="https://stackoverflow.com/questions/67100831/macos-shebang-with-absolute-path-not-working" target="_top">due to a limitation with the <code class="literal">execve</code>-syscall</a>. Compiled wrappers generated by <code class="literal">makeBinaryWrapper</code> can be inspected with <code class="literal">less &lt;path-to-wrapper&gt;</code> - by scrolling past the binary data you should be able to see the shell command that generated the executable and there see the environment variables that were injected into the wrapper.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="fun-remove-references-to" class="title"><code class="literal">remove-references-to -t</code> &lt;storepath&gt; [ <code class="literal">-t</code> &lt;storepath&gt; … ] &lt;file&gt; …   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#fun-remove-references-to" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Removes the references of the specified files to the specified store files. This is done without changing the size of the file by replacing the hash by <code class="literal">eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee</code>, and should work on compiled executables. This is meant to be used to remove the dependency of the output on inputs that are known to be unnecessary at runtime. Of course, reckless usage will break the patched programs.
To use this, add <code class="literal">removeReferencesTo</code> to <code class="literal">nativeBuildInputs</code>.</p><p>As <code class="literal">remove-references-to</code> is an actual executable and not a shell function, it can be used with <code class="literal">find</code>.
Example removing all references to the compiler in the output:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">postInstall</span> = <span class="hljs-string">''
  find "$out" -type f -exec remove-references-to -t <span class="hljs-subst">${stdenv.cc}</span> '{}' +
''</span>;
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="fun-substitute" class="title"><code class="literal">substitute</code> &lt;infile&gt; &lt;outfile&gt; &lt;subs&gt;   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#fun-substitute" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Performs string substitution on the contents of &lt;infile&gt;, writing the result to &lt;outfile&gt;. The substitutions in &lt;subs&gt; are of the following form:</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="fun-substitute-replace" class="title"><code class="literal">--replace</code> &lt;s1&gt; &lt;s2&gt;   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#fun-substitute-replace" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Replace every occurrence of the string &lt;s1&gt; by &lt;s2&gt;.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="fun-substitute-subst-var" class="title"><code class="literal">--subst-var</code> &lt;varName&gt;   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#fun-substitute-subst-var" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Replace every occurrence of <code class="literal">@varName@</code> by the contents of the environment variable &lt;varName&gt;. This is useful for generating files from templates, using <code class="literal">@...@</code> in the template as placeholders.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="fun-substitute-subst-var-by" class="title"><code class="literal">--subst-var-by</code> &lt;varName&gt; &lt;s&gt;   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#fun-substitute-subst-var-by" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Replace every occurrence of <code class="literal">@varName@</code> by the string &lt;s&gt;.</p><p>Example:</p><pre><code class="programlisting shell hljs language-shell" data-highlighted="yes">substitute ./foo.in ./foo.out \
    --replace /usr/bin/bar $bar/bin/bar \
    --replace "a string containing spaces" "some other text" \
    --subst-var someVar
</code></pre>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="fun-substituteInPlace" class="title"><code class="literal">substituteInPlace</code> &lt;multiple files&gt; &lt;subs&gt;   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#fun-substituteInPlace" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Like <code class="literal">substitute</code>, but performs the substitutions in place on the files passed.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="fun-substituteAll" class="title"><code class="literal">substituteAll</code> &lt;infile&gt; &lt;outfile&gt;   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#fun-substituteAll" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Replaces every occurrence of <code class="literal">@varName@</code>, where &lt;varName&gt; is any environment variable, in &lt;infile&gt;, writing the result to &lt;outfile&gt;. For instance, if &lt;infile&gt; has the contents</p><pre><code class="programlisting bash hljs language-bash" data-highlighted="yes"><span class="hljs-comment">#! @bash@/bin/sh</span>
PATH=@coreutils@/bin
<span class="hljs-built_in">echo</span> @foo@
</code></pre><p>and the environment contains <code class="literal">bash=/nix/store/bmwp0q28cf21...-bash-3.2-p39</code> and <code class="literal">coreutils=/nix/store/68afga4khv0w...-coreutils-6.12</code>, but does not contain the variable <code class="literal">foo</code>, then the output will be</p><pre><code class="programlisting bash hljs language-bash" data-highlighted="yes"><span class="hljs-meta">#! /nix/store/bmwp0q28cf21...-bash-3.2-p39/bin/sh</span>
PATH=/nix/store/68afga4khv0w...-coreutils-6.12/bin
<span class="hljs-built_in">echo</span> @foo@
</code></pre><p>That is, no substitution is performed for undefined variables.</p><p>Environment variables that start with an uppercase letter or an underscore are filtered out, to prevent global variables (like <code class="literal">HOME</code>) or private variables (like <code class="literal">__ETC_PROFILE_DONE</code>) from accidentally getting substituted. The variables also have to be valid bash “names”, as defined in the bash manpage (alphanumeric or <code class="literal">_</code>, must not start with a number).</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="fun-substituteAllInPlace" class="title"><code class="literal">substituteAllInPlace</code> &lt;file&gt;   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#fun-substituteAllInPlace" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Like <code class="literal">substituteAll</code>, but performs the substitutions in place on the file &lt;file&gt;.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="fun-stripHash" class="title"><code class="literal">stripHash</code> &lt;path&gt;   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#fun-stripHash" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Strips the directory and hash part of a store path, outputting the name part to <code class="literal">stdout</code>. For example:</p><pre><code class="programlisting bash hljs language-bash" data-highlighted="yes"><span class="hljs-comment"># prints coreutils-8.24</span>
stripHash <span class="hljs-string">"/nix/store/9s9r019176g7cvn2nvcw41gsp862y6b4-coreutils-8.24"</span>
</code></pre><p>If you wish to store the result in another variable, then the following idiom may be useful:</p><pre><code class="programlisting bash hljs language-bash" data-highlighted="yes">name=<span class="hljs-string">"/nix/store/9s9r019176g7cvn2nvcw41gsp862y6b4-coreutils-8.24"</span>
someVar=$(stripHash <span class="hljs-variable">$name</span>)
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="fun-wrapProgram" class="title"><code class="literal">wrapProgram</code> &lt;executable&gt; &lt;makeWrapperArgs&gt;   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#fun-wrapProgram" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Convenience function for <code class="literal">makeWrapper</code> that replaces <code class="literal">&lt;executable&gt;</code> with a wrapper that executes the original program. It takes all the same arguments as <code class="literal">makeWrapper</code>, except for <code class="literal">--inherit-argv0</code> (used by the <code class="literal">makeBinaryWrapper</code> implementation) and <code class="literal">--argv0</code> (used by both <code class="literal">makeWrapper</code> and <code class="literal">makeBinaryWrapper</code> wrapper implementations).</p><p>If you will apply it multiple times, it will overwrite the wrapper file and you will end up with double wrapping, which should be avoided.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="fun-prependToVar" class="title"><code class="literal">prependToVar</code> &lt;variableName&gt; &lt;elements…&gt;   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#fun-prependToVar" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Prepend elements to a variable.</p><p>Example:</p><pre><code class="programlisting shellSession hljs language-shellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">configureFlags=<span class="hljs-string">"--disable-static"</span></span>
<span class="hljs-meta prompt_">$ </span><span class="language-bash">prependToVar configureFlags --disable-dependency-tracking --enable-foo</span>
<span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">echo</span> <span class="hljs-variable">$configureFlags</span></span>
--disable-dependency-tracking --enable-foo --disable-static
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="fun-appendToVar" class="title"><code class="literal">appendToVar</code> &lt;variableName&gt; &lt;elements…&gt;   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#fun-appendToVar" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Append elements to a variable.</p><p>Example:</p><pre><code class="programlisting shellSession hljs language-shellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">configureFlags=<span class="hljs-string">"--disable-static"</span></span>
<span class="hljs-meta prompt_">$ </span><span class="language-bash">appendToVar configureFlags --disable-dependency-tracking --enable-foo</span>
<span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">echo</span> <span class="hljs-variable">$configureFlags</span></span>
--disable-static --disable-dependency-tracking --enable-foo
</code></pre>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="ssec-setup-hooks" class="title" style="clear: both">Package setup hooks   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-setup-hooks" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#move-docs.sh"><code class="literal">move-docs.sh</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#compress-man-pages.sh"><code class="literal">compress-man-pages.sh</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#strip.sh"><code class="literal">strip.sh</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#patch-shebangs.sh"><code class="literal">patch-shebangs.sh</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#audit-tmpdir.sh"><code class="literal">audit-tmpdir.sh</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#multiple-outputs.sh"><code class="literal">multiple-outputs.sh</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#move-sbin.sh"><code class="literal">move-sbin.sh</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#move-lib64.sh"><code class="literal">move-lib64.sh</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#move-systemd-user-units.sh"><code class="literal">move-systemd-user-units.sh</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#set-source-date-epoch-to-latest.sh"><code class="literal">set-source-date-epoch-to-latest.sh</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#bintools-wrapper">Bintools Wrapper and hook</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#cc-wrapper">CC Wrapper and hook</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#stdenv-other-hooks">Other hooks</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#compiler-linker-wrapper-hooks">Compiler and Linker wrapper hooks</a> </span></dt> </dl></div><p>Nix itself considers a build-time dependency as merely something that should previously be built and accessible at build time—packages themselves are on their own to perform any additional setup. In most cases, that is fine, and the downstream derivation can deal with its own dependencies. But for a few common tasks, that would result in almost every package doing the same sort of setup work—depending not on the package itself, but entirely on which dependencies were used.</p><p>In order to alleviate this burden, the setup hook mechanism was written, where any package can include a shell script that [by convention rather than enforcement by Nix], any downstream reverse-dependency will source as part of its build process. That allows the downstream dependency to merely specify its dependencies, and lets those dependencies effectively initialize themselves. No boilerplate mirroring the list of dependencies is needed.</p><p>The setup hook mechanism is a bit of a sledgehammer though: a powerful feature with a broad and indiscriminate area of effect. The combination of its power and implicit use may be expedient, but isn’t without costs. Nix itself is unchanged, but the spirit of added dependencies being effect-free is violated even if the latter isn’t. For example, if a derivation path is mentioned more than once, Nix itself doesn’t care and makes sure the dependency derivation is already built just the same—depending is just needing something to exist, and needing is idempotent. However, a dependency specified twice will have its setup hook run twice, and that could easily change the build environment (though a well-written setup hook will therefore strive to be idempotent so this is in fact not observable). More broadly, setup hooks are anti-modular in that multiple dependencies, whether the same or different, should not interfere and yet their setup hooks may well do so.</p><p>The most typical use of the setup hook is actually to add other hooks which are then run (i.e. after all the setup hooks) on each dependency. For example, the C compiler wrapper’s setup hook feeds itself flags for each dependency that contains relevant libraries and headers. This is done by defining a bash function, and appending its name to one of <code class="literal">envBuildBuildHooks</code>, <code class="literal">envBuildHostHooks</code>, <code class="literal">envBuildTargetHooks</code>, <code class="literal">envHostHostHooks</code>, <code class="literal">envHostTargetHooks</code>, or <code class="literal">envTargetTargetHooks</code>. These 6 bash variables correspond to the 6 sorts of dependencies by platform (there’s 12 total but we ignore the propagated/non-propagated axis).</p><p>Packages adding a hook should not hard code a specific hook, but rather choose a variable <span class="emphasis"><em>relative</em></span> to how they are included. Returning to the C compiler wrapper example, if the wrapper itself is an <code class="literal">n</code> dependency, then it only wants to accumulate flags from <code class="literal">n + 1</code> dependencies, as only those ones match the compiler’s target platform. The <code class="literal">hostOffset</code> variable is defined with the current dependency’s host offset <code class="literal">targetOffset</code> with its target offset, before its setup hook is sourced. Additionally, since most environment hooks don’t care about the target platform, that means the setup hook can append to the right bash array by doing something like</p><pre><code class="programlisting bash hljs language-bash" data-highlighted="yes">addEnvHooks <span class="hljs-string">"<span class="hljs-variable">$hostOffset</span>"</span> myBashFunction
</code></pre><p>The <span class="emphasis"><em>existence</em></span> of setups hooks has long been documented and packages inside Nixpkgs are free to use this mechanism. Other packages, however, should not rely on these mechanisms not changing between Nixpkgs versions. Because of the existing issues with this system, there’s little benefit from mandating it be stable for any period of time.</p><p>First, let’s cover some setup hooks that are part of Nixpkgs default <code class="literal">stdenv</code>. This means that they are run for every package built using <code class="literal">stdenv.mkDerivation</code> or when using a custom builder that has <code class="literal">source $stdenv/setup</code>. Some of these are platform specific, so they may run on Linux but not Darwin or vice-versa.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="move-docs.sh" class="title"><code class="literal">move-docs.sh</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#move-docs.sh" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>This setup hook moves any installed documentation to the <code class="literal">/share</code> subdirectory directory. This includes the man, doc and info directories. This is needed for legacy programs that do not know how to use the <code class="literal">share</code> subdirectory.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="compress-man-pages.sh" class="title"><code class="literal">compress-man-pages.sh</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#compress-man-pages.sh" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>This setup hook compresses any man pages that have been installed. The compression is done using the gzip program. This helps to reduce the installed size of packages.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="strip.sh" class="title"><code class="literal">strip.sh</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#strip.sh" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>This runs the strip command on installed binaries and libraries. This removes unnecessary information like debug symbols when they are not needed. This also helps to reduce the installed size of packages.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="patch-shebangs.sh" class="title"><code class="literal">patch-shebangs.sh</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#patch-shebangs.sh" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>This setup hook patches installed scripts to add Nix store paths to their shebang interpreter as found in the build environment. The <a class="link" href="https://en.wikipedia.org/wiki/Shebang_(Unix)" target="_top">shebang</a> line tells a Unix-like operating system which interpreter to use to execute the script’s contents.</p><div class="note"><h3 class="title">Note</h3><p>The <a class="link" href="https://github.com/NixOS/nixpkgs/blob/19d4f7dc485f74109bd66ef74231285ff797a823/pkgs/stdenv/generic/builder.sh" target="_top">generic builder</a> populates <code class="literal">PATH</code> from inputs of the derivation.</p></div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="patch-shebangs.sh-invocation" class="title">Invocation   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#patch-shebangs.sh-invocation" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Multiple paths can be specified.</p><pre><code class="programlisting hljs language-undefined" data-highlighted="yes">patchShebangs [--build | --host] PATH...
</code></pre><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="patch-shebangs.sh-invocation-flags" class="title">Flags   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#patch-shebangs.sh-invocation-flags" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">--build</code></span></dt><dd><p>Look up commands available at build time</p></dd><dt><span class="term"><code class="literal">--host</code></span></dt><dd><p>Look up commands available at run time</p></dd></dl></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="patch-shebangs.sh-invocation-examples" class="title">Examples   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#patch-shebangs.sh-invocation-examples" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><pre><code class="programlisting sh hljs language-bash" data-highlighted="yes">patchShebangs --host /nix/store/&lt;<span class="hljs-built_in">hash</span>&gt;-hello-1.0/bin
</code></pre><pre><code class="programlisting sh hljs language-bash" data-highlighted="yes">patchShebangs --build configure
</code></pre><p><code class="literal">#!/bin/sh</code> will be rewritten to <code class="literal">#!/nix/store/&lt;hash&gt;-some-bash/bin/sh</code>.</p><p><code class="literal">#!/usr/bin/env</code> gets special treatment: <code class="literal">#!/usr/bin/env python</code> is rewritten to <code class="literal">/nix/store/&lt;hash&gt;/bin/python</code>.</p><p>Interpreter paths that point to a valid Nix store location are not changed.</p><div class="note"><h3 class="title">Note</h3><p>A script file must be marked as executable, otherwise it will not be
considered.</p></div><p>This mechanism ensures that the interpreter for a given script is always found and is exactly the one specified by the build.</p><p>It can be disabled by setting <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-dontPatchShebangs" title="dontPatchShebangs"><code class="literal">dontPatchShebangs</code></a>:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">stdenv.mkDerivation {
  <span class="hljs-comment"># ...</span>
  <span class="hljs-attr">dontPatchShebangs</span> = <span class="hljs-literal">true</span>;
  <span class="hljs-comment"># ...</span>
}
</code></pre><p>The file <a class="link" href="https://github.com/NixOS/nixpkgs/blob/19d4f7dc485f74109bd66ef74231285ff797a823/pkgs/build-support/setup-hooks/patch-shebangs.sh" target="_top"><code class="literal">patch-shebangs.sh</code></a> defines the <a class="link" href="https://github.com/NixOS/nixpkgs/blob/19d4f7dc485f74109bd66ef74231285ff797a823/pkgs/build-support/setup-hooks/patch-shebangs.sh#L24-L105" target="_top"><code class="literal">patchShebangs</code></a> function. It is used to implement <a class="link" href="https://github.com/NixOS/nixpkgs/blob/19d4f7dc485f74109bd66ef74231285ff797a823/pkgs/build-support/setup-hooks/patch-shebangs.sh#L107-L119" target="_top"><code class="literal">patchShebangsAuto</code></a>, the <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ssec-setup-hooks" title="Package setup hooks">setup hook</a> that is registered to run during the <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ssec-fixup-phase" title="The fixup phase">fixup phase</a> by default.</p><p>If you need to run <code class="literal">patchShebangs</code> at build time, it must be called explicitly within <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#sec-stdenv-phases" title="Phases">one of the build phases</a>.</p>
</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="audit-tmpdir.sh" class="title"><code class="literal">audit-tmpdir.sh</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#audit-tmpdir.sh" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>This verifies that no references are left from the install binaries to the directory used to build those binaries. This ensures that the binaries do not need things outside the Nix store. This is currently supported in Linux only.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="multiple-outputs.sh" class="title"><code class="literal">multiple-outputs.sh</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#multiple-outputs.sh" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>This setup hook adds configure flags that tell packages to install files into any one of the proper outputs listed in <code class="literal">outputs</code>. This behavior can be turned off by setting <code class="literal">setOutputFlags</code> to false in the derivation environment. See <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#chap-multiple-output" title="Multiple-output packages"><em>Multiple-output packages</em></a> for more information.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="move-sbin.sh" class="title"><code class="literal">move-sbin.sh</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#move-sbin.sh" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>This setup hook moves any binaries installed in the <code class="literal">sbin/</code> subdirectory into <code class="literal">bin/</code>. In addition, a link is provided from <code class="literal">sbin/</code> to <code class="literal">bin/</code> for compatibility.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="move-lib64.sh" class="title"><code class="literal">move-lib64.sh</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#move-lib64.sh" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>This setup hook moves any libraries installed in the <code class="literal">lib64/</code> subdirectory into <code class="literal">lib/</code>. In addition, a link is provided from <code class="literal">lib64/</code> to <code class="literal">lib/</code> for compatibility.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="move-systemd-user-units.sh" class="title"><code class="literal">move-systemd-user-units.sh</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#move-systemd-user-units.sh" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>This setup hook moves any systemd user units installed in the <code class="literal">lib/</code> subdirectory into <code class="literal">share/</code>. In addition, a link is provided from <code class="literal">share/</code> to <code class="literal">lib/</code> for compatibility. This is needed for systemd to find user services when installed into the user profile.</p><p>This hook only runs when compiling for Linux.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="set-source-date-epoch-to-latest.sh" class="title"><code class="literal">set-source-date-epoch-to-latest.sh</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#set-source-date-epoch-to-latest.sh" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>This sets <code class="literal">SOURCE_DATE_EPOCH</code> to the modification time of the most recent file.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="bintools-wrapper" class="title">Bintools Wrapper and hook   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#bintools-wrapper" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The Bintools Wrapper wraps the binary utilities for a bunch of miscellaneous purposes. These are GNU Binutils when targeting Linux, and a mix of cctools and GNU binutils for Darwin. [The “Bintools” name is supposed to be a compromise between “Binutils” and “cctools” not denoting any specific implementation.] Specifically, the underlying bintools package, and a C standard library (glibc or Darwin’s libSystem, just for the dynamic loader) are all fed in, and dependency finding, hardening (see below), and purity checks for each are handled by the Bintools Wrapper. Packages typically depend on CC Wrapper, which in turn (at run time) depends on the Bintools Wrapper.</p><p>The Bintools Wrapper was only just recently split off from CC Wrapper, so the division of labor is still being worked out. For example, it shouldn’t care about the C standard library, but just take a derivation with the dynamic loader (which happens to be the glibc on linux). Dependency finding however is a task both wrappers will continue to need to share, and probably the most important to understand. It is currently accomplished by collecting directories of host-platform dependencies (i.e. <code class="literal">buildInputs</code> and <code class="literal">nativeBuildInputs</code>) in environment variables. The Bintools Wrapper’s setup hook causes any <code class="literal">lib</code> and <code class="literal">lib64</code> subdirectories to be added to <code class="literal">NIX_LDFLAGS</code>. Since the CC Wrapper and the Bintools Wrapper use the same strategy, most of the Bintools Wrapper code is sparsely commented and refers to the CC Wrapper. But the CC Wrapper’s code, by contrast, has quite lengthy comments. The Bintools Wrapper merely cites those, rather than repeating them, to avoid falling out of sync.</p><p>A final task of the setup hook is defining a number of standard environment variables to tell build systems which executables fulfill which purpose. They are defined to just be the base name of the tools, under the assumption that the Bintools Wrapper’s binaries will be on the path. Firstly, this helps poorly-written packages, e.g. ones that look for just <code class="literal">gcc</code> when <code class="literal">CC</code> isn’t defined yet <code class="literal">clang</code> is to be used. Secondly, this helps packages not get confused when cross-compiling, in which case multiple Bintools Wrappers may simultaneously be in use. <a href="https://nixos.org/manual/nixpkgs/stable/#footnote-stdenv-per-platform-wrapper" class="footnote" id="footnote-stdenv-per-platform-wrapper.__back.0"><sup class="footnote">[7]</sup></a> <code class="literal">BUILD_</code>- and <code class="literal">TARGET_</code>-prefixed versions of the normal environment variable are defined for additional Bintools Wrappers, properly disambiguating them.</p><p>A problem with this final task is that the Bintools Wrapper is honest and defines <code class="literal">LD</code> as <code class="literal">ld</code>. Most packages, however, firstly use the C compiler for linking, secondly use <code class="literal">LD</code> anyways, defining it as the C compiler, and thirdly, only so define <code class="literal">LD</code> when it is undefined as a fallback. This triple-threat means Bintools Wrapper will break those packages, as LD is already defined as the actual linker which the package won’t override yet doesn’t want to use. The workaround is to define, just for the problematic package, <code class="literal">LD</code> as the C compiler. A good way to do this would be <code class="literal">preConfigure = "LD=$CC"</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="cc-wrapper" class="title">CC Wrapper and hook   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#cc-wrapper" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The CC Wrapper wraps a C toolchain for a bunch of miscellaneous purposes. Specifically, a C compiler (GCC or Clang), wrapped binary tools, and a C standard library (glibc or Darwin’s libSystem, just for the dynamic loader) are all fed in, and dependency finding, hardening (see below), and purity checks for each are handled by the CC Wrapper. Packages typically depend on the CC Wrapper, which in turn (at run-time) depends on the Bintools Wrapper.</p><p>Dependency finding is undoubtedly the main task of the CC Wrapper. This works just like the Bintools Wrapper, except that any <code class="literal">include</code> subdirectory of any relevant dependency is added to <code class="literal">NIX_CFLAGS_COMPILE</code>. The setup hook itself contains elaborate comments describing the exact mechanism by which this is accomplished.</p><p>Similarly, the CC Wrapper follows the Bintools Wrapper in defining standard environment variables with the names of the tools it wraps, for the same reasons described above. Importantly, while it includes a <code class="literal">cc</code> symlink to the c compiler for portability, the <code class="literal">CC</code> will be defined using the compiler’s “real name” (i.e. <code class="literal">gcc</code> or <code class="literal">clang</code>). This helps lousy build systems that inspect on the name of the compiler rather than run it.</p><p>Here are some more packages that provide a setup hook. Since the list of hooks is extensible, this is not an exhaustive list. The mechanism is only to be used as a last resort, so it might cover most uses.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="stdenv-other-hooks" class="title">Other hooks   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#stdenv-other-hooks" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Many other packages provide hooks, that are not part of <code class="literal">stdenv</code>. You can find
these in the <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#chap-hooks" title="Hooks reference">Hooks Reference</a>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="compiler-linker-wrapper-hooks" class="title">Compiler and Linker wrapper hooks   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#compiler-linker-wrapper-hooks" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>If the file <code class="literal">${cc}/nix-support/cc-wrapper-hook</code> exists, it will be run at the end of the <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#cc-wrapper" title="CC Wrapper and hook">compiler wrapper</a>.
If the file <code class="literal">${binutils}/nix-support/post-link-hook</code> exists, it will be run at the end of the linker wrapper.
These hooks allow a user to inject code into the wrappers.
As an example, these hooks can be used to extract <code class="literal">extraBefore</code>, <code class="literal">params</code> and <code class="literal">extraAfter</code> which store all the command line arguments passed to the compiler and linker respectively.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-purity-in-nixpkgs" class="title" style="clear: both">Purity in Nixpkgs   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-purity-in-nixpkgs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p><span class="emphasis"><em>Measures taken to prevent dependencies on packages outside the store, and what you can do to prevent them.</em></span></p><p>GCC doesn’t search in locations such as <code class="literal">/usr/include</code>. In fact, attempts to add such directories through the <code class="literal">-I</code> flag are filtered out. Likewise, the linker (from GNU binutils) doesn’t search in standard locations such as <code class="literal">/usr/lib</code>. Programs built on Linux are linked against a GNU C Library that likewise doesn’t search in the default system locations.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-hardening-in-nixpkgs" class="title" style="clear: both">Hardening in Nixpkgs   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-hardening-in-nixpkgs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-hardening-flags-enabled-by-default">Hardening flags enabled by default</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-hardening-flags-disabled-by-default">Hardening flags disabled by default</a> </span></dt> </dl></div><p>There are flags available to harden packages at compile or link-time. These can be toggled using the <code class="literal">stdenv.mkDerivation</code> parameters <code class="literal">hardeningDisable</code> and <code class="literal">hardeningEnable</code>.</p><p>Both parameters take a list of flags as strings. The special <code class="literal">"all"</code> flag can be passed to <code class="literal">hardeningDisable</code> to turn off all hardening. These flags can also be used as environment variables for testing or development purposes.</p><p>For more in-depth information on these hardening flags and hardening in general, refer to the <a class="link" href="https://wiki.debian.org/Hardening" target="_top">Debian Wiki</a>, <a class="link" href="https://wiki.ubuntu.com/Security/Features" target="_top">Ubuntu Wiki</a>, <a class="link" href="https://wiki.gentoo.org/wiki/Project:Hardened" target="_top">Gentoo Wiki</a>, and the <a class="link" href="https://wiki.archlinux.org/title/Security" target="_top">Arch Wiki</a>.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-hardening-flags-enabled-by-default" class="title">Hardening flags enabled by default   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-hardening-flags-enabled-by-default" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The following flags are enabled by default and might require disabling with <code class="literal">hardeningDisable</code> if the program to package is incompatible.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="format" class="title"><code class="literal">format</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#format" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Adds the <code class="literal">-Wformat -Wformat-security -Werror=format-security</code> compiler options. At present, this warns about calls to <code class="literal">printf</code> and <code class="literal">scanf</code> functions where the format string is not a string literal and there are no format arguments, as in <code class="literal">printf(foo);</code>. This may be a security hole if the format string came from untrusted input and contains <code class="literal">%n</code>.</p><p>This needs to be turned off or fixed for errors similar to:</p><pre><code class="programlisting hljs language-bash" data-highlighted="yes">/tmp/nix-build-zynaddsubfx-2.5.2.drv-0/zynaddsubfx-2.5.2/src/UI/guimain.cpp:571:28: error: format not a string literal and no format arguments [-Werror=format-security]
         <span class="hljs-built_in">printf</span>(help_message);
                            ^
cc1plus: some warnings being treated as errors
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="stackprotector" class="title"><code class="literal">stackprotector</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#stackprotector" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Adds the <code class="literal">-fstack-protector-strong --param ssp-buffer-size=4</code> compiler options. This adds safety checks against stack overwrites rendering many potential code injection attacks into aborting situations. In the best case this turns code injection vulnerabilities into denial of service or into non-issues (depending on the application).</p><p>This needs to be turned off or fixed for errors similar to:</p><pre><code class="programlisting hljs language-bash" data-highlighted="yes">bin/blib.a(bios_console.o): In <span class="hljs-keyword">function</span> `bios_handle_cup<span class="hljs-string">':
/tmp/nix-build-ipxe-20141124-5cbdc41.drv-0/ipxe-5cbdc41/src/arch/i386/firmware/pcbios/bios_console.c:86: undefined reference to `__stack_chk_fail'</span>
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="fortify" class="title"><code class="literal">fortify</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#fortify" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Adds the <code class="literal">-O2 -D_FORTIFY_SOURCE=2</code> compiler options. During code generation the compiler knows a great deal of information about buffer sizes (where possible), and attempts to replace insecure unlimited length buffer function calls with length-limited ones. This is especially useful for old, crufty code. Additionally, format strings in writable memory that contain <code class="literal">%n</code> are blocked. If an application depends on such a format string, it will need to be worked around.</p><p>Additionally, some warnings are enabled which might trigger build failures if compiler warnings are treated as errors in the package build. In this case, set <code class="literal">env.NIX_CFLAGS_COMPILE</code> to <code class="literal">-Wno-error=warning-type</code>.</p><p>This needs to be turned off or fixed for errors similar to:</p><pre><code class="programlisting hljs language-bash" data-highlighted="yes">malloc.c:404:15: error: <span class="hljs-built_in">return</span> <span class="hljs-built_in">type</span> is an incomplete <span class="hljs-built_in">type</span>
malloc.c:410:19: error: storage size of <span class="hljs-string">'ms'</span> isn<span class="hljs-string">'t known

strdup.h:22:1: error: expected identifier or '</span>(<span class="hljs-string">' before '</span>__extension__<span class="hljs-string">'

strsep.c:65:23: error: register name not specified for '</span>delim<span class="hljs-string">'

installwatch.c:3751:5: error: conflicting types for '</span>__open_2<span class="hljs-string">'

fcntl2.h:50:4: error: call to '</span>__open_missing_mode<span class="hljs-string">' declared with attribute error: open with O_CREAT or O_TMPFILE in second argument needs 3 arguments
</span></code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="pic" class="title"><code class="literal">pic</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#pic" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Adds the <code class="literal">-fPIC</code> compiler options. This options adds support for position independent code in shared libraries and thus making ASLR possible.</p><p>Most notably, the Linux kernel, kernel modules and other code not running in an operating system environment like boot loaders won’t build with PIC enabled. The compiler will is most cases complain that PIC is not supported for a specific build.</p><p>This needs to be turned off or fixed for assembler errors similar to:</p><pre><code class="programlisting hljs language-undefined" data-highlighted="yes">ccbLfRgg.s: Assembler messages:
ccbLfRgg.s:33: Error: missing or invalid displacement expression `private_key_len@GOTOFF'
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="strictoverflow" class="title"><code class="literal">strictoverflow</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#strictoverflow" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Signed integer overflow is undefined behaviour according to the C standard. If it happens, it is an error in the program as it should check for overflow before it can happen, not afterwards. GCC provides built-in functions to perform arithmetic with overflow checking, which are correct and faster than any custom implementation. As a workaround, the option <code class="literal">-fno-strict-overflow</code> makes gcc behave as if signed integer overflows were defined.</p><p>This flag should not trigger any build or runtime errors.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="relro" class="title"><code class="literal">relro</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#relro" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Adds the <code class="literal">-z relro</code> linker option. During program load, several ELF memory sections need to be written to by the linker, but can be turned read-only before turning over control to the program. This prevents some GOT (and .dtors) overwrite attacks, but at least the part of the GOT used by the dynamic linker (.got.plt) is still vulnerable.</p><p>This flag can break dynamic shared object loading. For instance, the module systems of Xorg and OpenCV are incompatible with this flag. In almost all cases the <code class="literal">bindnow</code> flag must also be disabled and incompatible programs typically fail with similar errors at runtime.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="bindnow" class="title"><code class="literal">bindnow</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#bindnow" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Adds the <code class="literal">-z now</code> linker option. During program load, all dynamic symbols are resolved, allowing for the complete GOT to be marked read-only (due to <code class="literal">relro</code>). This prevents GOT overwrite attacks. For very large applications, this can incur some performance loss during initial load while symbols are resolved, but this shouldn’t be an issue for daemons.</p><p>This flag can break dynamic shared object loading. For instance, the module systems of Xorg and PHP are incompatible with this flag. Programs incompatible with this flag often fail at runtime due to missing symbols, like:</p><pre><code class="programlisting hljs language-undefined" data-highlighted="yes">intel_drv.so: undefined symbol: vgaHWFreeHWRec
</code></pre>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-hardening-flags-disabled-by-default" class="title">Hardening flags disabled by default   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-hardening-flags-disabled-by-default" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The following flags are disabled by default and should be enabled with <code class="literal">hardeningEnable</code> for packages that take untrusted input like network services.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="pie" class="title"><code class="literal">pie</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#pie" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>This flag is disabled by default for normal <code class="literal">glibc</code> based NixOS package builds, but enabled by default for <code class="literal">musl</code> based package builds.</p><p>Adds the <code class="literal">-fPIE</code> compiler and <code class="literal">-pie</code> linker options. Position Independent Executables are needed to take advantage of Address Space Layout Randomization, supported by modern kernel versions. While ASLR can already be enforced for data areas in the stack and heap (brk and mmap), the code areas must be compiled as position-independent. Shared libraries already do this with the <code class="literal">pic</code> flag, so they gain ASLR automatically, but binary .text regions need to be build with <code class="literal">pie</code> to gain ASLR. When this happens, ROP attacks are much harder since there are no static locations to bounce off of during a memory corruption attack.</p><p>Static libraries need to be compiled with <code class="literal">-fPIE</code> so that executables can link them in with the <code class="literal">-pie</code> linker option.
If the libraries lack <code class="literal">-fPIE</code>, you will get the error <code class="literal">recompile with -fPIE</code>.</p><div class="footnotes"><br><hr style="width:100; text-align:left;margin-left: 0"><div id="footnote-stdenv-ignored-build-platform" class="footnote"><p>The build platform is ignored because it is a mere implementation detail of the package satisfying the dependency: As a general programming principle, dependencies are always <span class="emphasis"><em>specified</em></span> as interfaces, not concrete implementation.<a href="https://nixos.org/manual/nixpkgs/stable/#footnote-stdenv-ignored-build-platform.__back.0" class="para"><sup class="para">[1]</sup></a></p></div><div id="footnote-stdenv-native-dependencies-in-path" class="footnote"><p>Currently, this means for native builds all dependencies are put on the <code class="literal">PATH</code>. But in the future that may not be the case for sake of matching cross: the platforms would be assumed to be unique for native and cross builds alike, so only the <code class="literal">depsBuild*</code> and <code class="literal">nativeBuildInputs</code> would be added to the <code class="literal">PATH</code>.<a href="https://nixos.org/manual/nixpkgs/stable/#footnote-stdenv-native-dependencies-in-path.__back.0" class="para"><sup class="para">[2]</sup></a></p></div><div id="footnote-stdenv-propagated-dependencies" class="footnote"><p>Nix itself already takes a package’s transitive dependencies into account, but this propagation ensures nixpkgs-specific infrastructure like <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ssec-setup-hooks" title="Package setup hooks">setup hooks</a> also are run as if it were a propagated dependency.<a href="https://nixos.org/manual/nixpkgs/stable/#footnote-stdenv-propagated-dependencies.__back.0" class="para"><sup class="para">[3]</sup></a></p></div><div id="footnote-stdenv-find-inputs-location" class="footnote"><p>The <code class="literal">findInputs</code> function, currently residing in <code class="literal">pkgs/stdenv/generic/setup.sh</code>, implements the propagation logic.<a href="https://nixos.org/manual/nixpkgs/stable/#footnote-stdenv-find-inputs-location.__back.0" class="para"><sup class="para">[4]</sup></a></p></div><div id="footnote-stdenv-sys-lib-search-path" class="footnote"><p>It clears the <code class="literal">sys_lib_*search_path</code> variables in the Libtool script to prevent Libtool from using libraries in <code class="literal">/usr/lib</code> and such.<a href="https://nixos.org/manual/nixpkgs/stable/#footnote-stdenv-sys-lib-search-path.__back.0" class="para"><sup class="para">[5]</sup></a></p></div><div id="footnote-stdenv-build-time-guessing-impurity" class="footnote"><p>Eventually these will be passed building natively as well, to improve determinism: build-time guessing, as is done today, is a risk of impurity.<a href="https://nixos.org/manual/nixpkgs/stable/#footnote-stdenv-build-time-guessing-impurity.__back.0" class="para"><sup class="para">[6]</sup></a></p></div><div id="footnote-stdenv-per-platform-wrapper" class="footnote"><p>Each wrapper targets a single platform, so if binaries for multiple platforms are needed, the underlying binaries must be wrapped multiple times. As this is a property of the wrapper itself, the multiple wrappings are needed whether or not the same underlying binaries can target multiple platforms.<a href="https://nixos.org/manual/nixpkgs/stable/#footnote-stdenv-per-platform-wrapper.__back.0" class="para"><sup class="para">[7]</sup></a></p></div></div>
</div>

</div>

</div>

</div><div class="chapter"> <div class="titlepage">  <div>   <div>    <h2 id="chap-meta" class="title">Meta-attributes   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#chap-meta" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <p><strong>Table of Contents</strong></p> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-standard-meta-attributes">Standard meta-attributes</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-meta-license">Licenses</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-meta-sourceProvenance">Source provenance</a> </span></dt> </dl></div><p>Nix packages can declare <span class="emphasis"><em>meta-attributes</em></span> that contain information about a package such as a description, its homepage, its license, and so on. For instance, the GNU Hello package has a <code class="literal">meta</code> declaration like this:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">meta</span> = <span class="hljs-keyword">with</span> lib; {
  <span class="hljs-attr">description</span> = <span class="hljs-string">"A program that produces a familiar, friendly greeting"</span>;
  <span class="hljs-attr">longDescription</span> = <span class="hljs-string">''
    GNU Hello is a program that prints "Hello, world!" when you run it.
    It is fully customizable.
  ''</span>;
  <span class="hljs-attr">homepage</span> = <span class="hljs-string">"https://www.gnu.org/software/hello/manual/"</span>;
  <span class="hljs-attr">license</span> = licenses.gpl3Plus;
  <span class="hljs-attr">maintainers</span> = <span class="hljs-keyword">with</span> maintainers; [ eelco ];
  <span class="hljs-attr">platforms</span> = platforms.all;
};
</code></pre><p>Meta-attributes are not passed to the builder of the package. Thus, a change to a meta-attribute doesn’t trigger a recompilation of the package.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-standard-meta-attributes" class="title" style="clear: both">Standard meta-attributes   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-standard-meta-attributes" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#var-meta-description"><code class="literal">description</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#var-meta-longDescription"><code class="literal">longDescription</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#var-meta-branch"><code class="literal">branch</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#var-meta-homepage"><code class="literal">homepage</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#var-meta-downloadPage"><code class="literal">downloadPage</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#var-meta-changelog"><code class="literal">changelog</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#var-meta-license"><code class="literal">license</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#var-meta-maintainers"><code class="literal">maintainers</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#var-meta-mainProgram"><code class="literal">mainProgram</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#var-meta-priority"><code class="literal">priority</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#var-meta-platforms"><code class="literal">platforms</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#var-meta-badPlatforms"><code class="literal">badPlatforms</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#var-meta-tests"><code class="literal">tests</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#var-meta-timeout"><code class="literal">timeout</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#var-meta-hydraPlatforms"><code class="literal">hydraPlatforms</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#var-meta-broken"><code class="literal">broken</code></a> </span></dt> </dl></div><p>It is expected that each meta-attribute is one of the following:</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="var-meta-description" class="title"><code class="literal">description</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-meta-description" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>A short (one-line) description of the package.
This is displayed on <a class="link" href="https://search.nixos.org/packages" target="_top">search.nixos.org</a>.</p><p>Don’t include a period at the end. Don’t include newline characters. Capitalise the first character. For brevity, don’t repeat the name of package — just describe what it does.</p><p>Wrong: <code class="literal">"libpng is a library that allows you to decode PNG images."</code></p><p>Right: <code class="literal">"A library for decoding PNG images"</code></p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="var-meta-longDescription" class="title"><code class="literal">longDescription</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-meta-longDescription" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>An arbitrarily long description of the package in <a class="link" href="https://commonmark.org/" target="_top">CommonMark</a> Markdown.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="var-meta-branch" class="title"><code class="literal">branch</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-meta-branch" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Release branch. Used to specify that a package is not going to receive updates that are not in this branch; for example, Linux kernel 3.0 is supposed to be updated to 3.0.X, not 3.1.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="var-meta-homepage" class="title"><code class="literal">homepage</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-meta-homepage" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The package’s homepage. Example: <code class="literal">https://www.gnu.org/software/hello/manual/</code></p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="var-meta-downloadPage" class="title"><code class="literal">downloadPage</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-meta-downloadPage" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The page where a link to the current version can be found. Example: <code class="literal">https://ftp.gnu.org/gnu/hello/</code></p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="var-meta-changelog" class="title"><code class="literal">changelog</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-meta-changelog" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>A link or a list of links to the location of Changelog for a package. A link may use expansion to refer to the correct changelog version. Example: <code class="literal">"https://git.savannah.gnu.org/cgit/hello.git/plain/NEWS?h=v${version}"</code></p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="var-meta-license" class="title"><code class="literal">license</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-meta-license" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The license, or licenses, for the package. One from the attribute set defined in <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/licenses.nix" target="_top"><code class="literal">nixpkgs/lib/licenses.nix</code></a>. At this moment using both a list of licenses and a single license is valid. If the license field is in the form of a list representation, then it means that parts of the package are licensed differently. Each license should preferably be referenced by their attribute. The non-list attribute value can also be a space delimited string representation of the contained attribute <code class="literal">shortNames</code> or <code class="literal">spdxIds</code>. The following are all valid examples:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>Single license referenced by attribute (preferred) <code class="literal">lib.licenses.gpl3Only</code>.</p></li><li class="listitem"><p>Single license referenced by its attribute shortName (frowned upon) <code class="literal">"gpl3Only"</code>.</p></li><li class="listitem"><p>Single license referenced by its attribute spdxId (frowned upon) <code class="literal">"GPL-3.0-only"</code>.</p></li><li class="listitem"><p>Multiple licenses referenced by attribute (preferred) <code class="literal">with lib.licenses; [ asl20 free ofl ]</code>.</p></li><li class="listitem"><p>Multiple licenses referenced as a space delimited string of attribute shortNames (frowned upon) <code class="literal">"asl20 free ofl"</code>.</p></li></ul></div><p>For details, see <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#sec-meta-license" title="Licenses">Licenses</a>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="var-meta-maintainers" class="title"><code class="literal">maintainers</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-meta-maintainers" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>A list of the maintainers of this Nix expression. Maintainers are defined in <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/maintainers/maintainer-list.nix" target="_top"><code class="literal">nixpkgs/maintainers/maintainer-list.nix</code></a>. There is no restriction to becoming a maintainer, just add yourself to that list in a separate commit titled “maintainers: add alice” in the same pull request, and reference maintainers with <code class="literal">maintainers = with lib.maintainers; [ alice bob ]</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="var-meta-mainProgram" class="title"><code class="literal">mainProgram</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-meta-mainProgram" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The name of the main binary for the package. This affects the binary <code class="literal">nix run</code> executes. Example: <code class="literal">"rg"</code></p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="var-meta-priority" class="title"><code class="literal">priority</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-meta-priority" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The <span class="emphasis"><em>priority</em></span> of the package, used by <code class="literal">nix-env</code> to resolve file name conflicts between packages. See the <a class="link" href="https://nixos.org/manual/nix/stable/command-ref/nix-env" target="_top">manual page for <code class="literal">nix-env</code></a> for details. Example: <code class="literal">"10"</code> (a low-priority package).</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="var-meta-platforms" class="title"><code class="literal">platforms</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-meta-platforms" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The list of Nix platform types on which the package is supported. Hydra builds packages according to the platform specified. If no platform is specified, the package does not have prebuilt binaries. An example is:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">meta.<span class="hljs-attr">platforms</span> = lib.platforms.linux;
</code></pre><p>Attribute Set <code class="literal">lib.platforms</code> defines <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/systems/doubles.nix" target="_top">various common lists</a> of platforms types.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="var-meta-badPlatforms" class="title"><code class="literal">badPlatforms</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-meta-badPlatforms" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The list of Nix <a class="link" href="https://github.com/NixOS/nixpkgs/blob/b03ac42b0734da3e7be9bf8d94433a5195734b19/lib/meta.nix#L75-L81" target="_top">platform types</a> on which the package is known not to be buildable.
Hydra will never create prebuilt binaries for these platform types, even if they are in <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#var-meta-platforms" title="platforms"><code class="literal">meta.platforms</code></a>.
In general it is preferable to set <code class="literal">meta.platforms = lib.platforms.all</code> and then exclude any platforms on which the package is known not to build.
For example, a package which requires dynamic linking and cannot be linked statically could use this:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">meta.<span class="hljs-attr">platforms</span> = lib.platforms.all;
meta.<span class="hljs-attr">badPlatforms</span> = [ lib.systems.inspect.patterns.isStatic ];
</code></pre><p>The <a class="link" href="https://github.com/NixOS/nixpkgs/blob/b03ac42b0734da3e7be9bf8d94433a5195734b19/lib/meta.nix#L95-L106" target="_top"><code class="literal">lib.meta.availableOn</code></a> function can be used to test whether or not a package is available (i.e. buildable) on a given platform.
Some packages use this to automatically detect the maximum set of features with which they can be built.
For example, <code class="literal">systemd</code> <a class="link" href="https://github.com/systemd/systemd/issues/20600#issuecomment-912338965" target="_top">requires dynamic linking</a>, and <a class="link" href="https://github.com/NixOS/nixpkgs/blob/b03ac42b0734da3e7be9bf8d94433a5195734b19/pkgs/os-specific/linux/systemd/default.nix#L752" target="_top">has a <code class="literal">meta.badPlatforms</code> setting</a> similar to the one above.
Packages which can be built with or without <code class="literal">systemd</code> support will use <code class="literal">lib.meta.availableOn</code> to detect whether or not <code class="literal">systemd</code> is available on the <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ssec-cross-platform-parameters" title="Platform parameters"><code class="literal">hostPlatform</code></a> for which they are being built; if it is not available (e.g. due to a statically-linked host platform like <code class="literal">pkgsStatic</code>) this support will be disabled by default.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="var-meta-tests" class="title"><code class="literal">tests</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-meta-tests" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><div class="warning"><h3 class="title">Warning</h3><p>This attribute is special in that it is not actually under the <code class="literal">meta</code> attribute set but rather under the <code class="literal">passthru</code> attribute set. This is due to how <code class="literal">meta</code> attributes work, and the fact that they are supposed to contain only metadata, not derivations.</p></div><p>An attribute set with tests as values. A test is a derivation that builds when the test passes and fails to build otherwise.</p><p>You can run these tests with:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cd</span> path/to/nixpkgs</span>
<span class="hljs-meta prompt_">$ </span><span class="language-bash">nix-build -A your-package.tests</span>
</code></pre><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="var-meta-tests-packages" class="title">Package tests   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-meta-tests-packages" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Tests that are part of the source package are often executed in the <code class="literal">installCheckPhase</code>.</p><p>Prefer <code class="literal">passthru.tests</code> for tests that are introduced in nixpkgs because:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">passthru.tests</code> tests the ‘real’ package, independently from the environment in which it was built</p></li><li class="listitem"><p>we can run <code class="literal">passthru.tests</code> independently</p></li><li class="listitem"><p><code class="literal">installCheckPhase</code> adds overhead to each build</p></li></ul></div><p>For more on how to write and run package tests, see <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#sec-package-tests" title="Package tests">the section called “Package tests”</a>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="var-meta-tests-nixos" class="title">NixOS tests   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-meta-tests-nixos" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>The NixOS tests are available as <code class="literal">nixosTests</code> in parameters of derivations. For instance, the OpenSMTPD derivation includes lines similar to:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ <span class="hljs-comment">/* ... */</span>, nixosTests }:
{
  <span class="hljs-comment"># ...</span>
  passthru.<span class="hljs-attr">tests</span> = {
    <span class="hljs-attr">basic-functionality-and-dovecot-integration</span> = nixosTests.opensmtpd;
  };
}
</code></pre><p>NixOS tests run in a VM, so they are slower than regular package tests. For more information see <a class="link" href="https://nixos.org/manual/nixos/stable/#sec-nixos-tests" target="_top">NixOS module tests</a>.</p><p>Alternatively, you can specify other derivations as tests. You can make use of
the optional parameter to inject the correct package without
relying on non-local definitions, even in the presence of <code class="literal">overrideAttrs</code>.
Here that’s <code class="literal">finalAttrs.finalPackage</code>, but you could choose a different name if
<code class="literal">finalAttrs</code> already exists in your scope.</p><p><code class="literal">(mypkg.overrideAttrs f).passthru.tests</code> will be as expected, as long as the
definition of <code class="literal">tests</code> does not rely on the original <code class="literal">mypkg</code> or overrides it in
all places.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-comment"># my-package/default.nix</span>
{ stdenv, callPackage }:
stdenv.mkDerivation (finalAttrs: {
  <span class="hljs-comment"># ...</span>
  passthru.tests.<span class="hljs-attr">example</span> = callPackage ./example.nix { <span class="hljs-attr">my-package</span> = finalAttrs.finalPackage; };
})
</code></pre><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-comment"># my-package/example.nix</span>
{ runCommand, lib, my-package, ... }:
runCommand <span class="hljs-string">"my-package-test"</span> {
  <span class="hljs-attr">nativeBuildInputs</span> = [ my-package ];
  <span class="hljs-attr">src</span> = lib.sources.sourcesByRegex ./. [ <span class="hljs-string">".*.in"</span> <span class="hljs-string">".*.expected"</span> ];
} <span class="hljs-string">''
  my-package --help
  my-package &lt;example.in &gt;example.actual
  diff -U3 --color=auto example.expected example.actual
  mkdir $out
''</span>
</code></pre>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="var-meta-timeout" class="title"><code class="literal">timeout</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-meta-timeout" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>A timeout (in seconds) for building the derivation. If the derivation takes longer than this time to build, Hydra will fail it due to breaking the timeout. However, all computers do not have the same computing power, hence some builders may decide to apply a multiplicative factor to this value. When filling this value in, try to keep it approximately consistent with other values already present in <code class="literal">nixpkgs</code>.</p><p><code class="literal">meta</code> attributes are not stored in the instantiated derivation.
Therefore, this setting may be lost when the package is used as a dependency.
To be effective, it must be presented directly to an evaluation process that handles the <code class="literal">meta.timeout</code> attribute.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="var-meta-hydraPlatforms" class="title"><code class="literal">hydraPlatforms</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-meta-hydraPlatforms" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The list of Nix platform types for which the <a class="link" href="https://github.com/nixos/hydra" target="_top">Hydra</a> <a class="link" href="https://nixos.org/hydra" target="_top">instance at <code class="literal">hydra.nixos.org</code></a> will build the package. (Hydra is the Nix-based continuous build system.) It defaults to the value of <code class="literal">meta.platforms</code>. Thus, the only reason to set <code class="literal">meta.hydraPlatforms</code> is if you want <code class="literal">hydra.nixos.org</code> to build the package on a subset of <code class="literal">meta.platforms</code>, or not at all, e.g.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">meta.<span class="hljs-attr">platforms</span> = lib.platforms.linux;
meta.<span class="hljs-attr">hydraPlatforms</span> = [];
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="var-meta-broken" class="title"><code class="literal">broken</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-meta-broken" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>If set to <code class="literal">true</code>, the package is marked as “broken”, meaning that it won’t show up in <a class="link" href="https://search.nixos.org/packages" target="_top">search.nixos.org</a>, and cannot be built or installed unless the environment variable <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#opt-allowBroken"><code class="literal">NIXPKGS_ALLOW_BROKEN</code></a> is set.
Such unconditionally-broken packages should be removed from Nixpkgs eventually unless they are fixed.</p><p>The value of this attribute can depend on a package’s arguments, including <code class="literal">stdenv</code>.
This means that <code class="literal">broken</code> can be used to express constraints, for example:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>Does not cross compile</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"> meta.<span class="hljs-attr">broken</span> = !(stdenv.buildPlatform.canExecute stdenv.hostPlatform)
</code></pre></li><li class="listitem"><p>Broken if all of a certain set of its dependencies are broken</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">meta.<span class="hljs-attr">broken</span> = lib.all (<span class="hljs-built_in">map</span> (p: p.meta.broken) [ glibc musl ])
</code></pre></li></ul></div><p>This makes <code class="literal">broken</code> strictly more powerful than <code class="literal">meta.badPlatforms</code>.
However <code class="literal">meta.availableOn</code> currently examines only <code class="literal">meta.platforms</code> and <code class="literal">meta.badPlatforms</code>, so <code class="literal">meta.broken</code> does not influence the default values for optional dependencies.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-meta-license" class="title" style="clear: both">Licenses   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-meta-license" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#lib.licenses.free-free"><code class="literal">lib.licenses.free</code>, <code class="literal">"free"</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#lib.licenses.unfreeredistributable-unfree-redistributable"><code class="literal">lib.licenses.unfreeRedistributable</code>, <code class="literal">"unfree-redistributable"</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#lib.licenses.unfree-unfree"><code class="literal">lib.licenses.unfree</code>, <code class="literal">"unfree"</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#lib.licenses.unfreeredistributablefirmware-unfree-redistributable-firmware"><code class="literal">lib.licenses.unfreeRedistributableFirmware</code>, <code class="literal">"unfree-redistributable-firmware"</code></a> </span></dt> </dl></div><p>The <code class="literal">meta.license</code> attribute should preferably contain a value from <code class="literal">lib.licenses</code> defined in <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/licenses.nix" target="_top"><code class="literal">nixpkgs/lib/licenses.nix</code></a>, or in-place license description of the same format if the license is unlikely to be useful in another expression.</p><p>Although it’s typically better to indicate the specific license, a few generic options are available:</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="lib.licenses.free-free" class="title"><code class="literal">lib.licenses.free</code>, <code class="literal">"free"</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#lib.licenses.free-free" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Catch-all for free software licenses not listed above.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="lib.licenses.unfreeredistributable-unfree-redistributable" class="title"><code class="literal">lib.licenses.unfreeRedistributable</code>, <code class="literal">"unfree-redistributable"</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#lib.licenses.unfreeredistributable-unfree-redistributable" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Unfree package that can be redistributed in binary form. That is, it’s legal to redistribute the <span class="emphasis"><em>output</em></span> of the derivation. This means that the package can be included in the Nixpkgs channel.</p><p>Sometimes proprietary software can only be redistributed unmodified. Make sure the builder doesn’t actually modify the original binaries; otherwise we’re breaking the license. For instance, the NVIDIA X11 drivers can be redistributed unmodified, but our builder applies <code class="literal">patchelf</code> to make them work. Thus, its license is <code class="literal">"unfree"</code> and it cannot be included in the Nixpkgs channel.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="lib.licenses.unfree-unfree" class="title"><code class="literal">lib.licenses.unfree</code>, <code class="literal">"unfree"</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#lib.licenses.unfree-unfree" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Unfree package that cannot be redistributed. You can build it yourself, but you cannot redistribute the output of the derivation. Thus it cannot be included in the Nixpkgs channel.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="lib.licenses.unfreeredistributablefirmware-unfree-redistributable-firmware" class="title"><code class="literal">lib.licenses.unfreeRedistributableFirmware</code>, <code class="literal">"unfree-redistributable-firmware"</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#lib.licenses.unfreeredistributablefirmware-unfree-redistributable-firmware" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>This package supplies unfree, redistributable firmware. This is a separate value from <code class="literal">unfree-redistributable</code> because not everybody cares whether firmware is free.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-meta-sourceProvenance" class="title" style="clear: both">Source provenance   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-meta-sourceProvenance" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#lib.sourceTypes.fromSource"><code class="literal">lib.sourceTypes.fromSource</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#lib.sourceTypes.binaryNativeCode"><code class="literal">lib.sourceTypes.binaryNativeCode</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#lib.sourceTypes.binaryFirmware"><code class="literal">lib.sourceTypes.binaryFirmware</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#lib.sourceTypes.binaryBytecode"><code class="literal">lib.sourceTypes.binaryBytecode</code></a> </span></dt> </dl></div><p>The value of a package’s <code class="literal">meta.sourceProvenance</code> attribute specifies the provenance of the package’s derivation outputs.</p><p>If a package contains elements that are not built from the original source by a nixpkgs derivation, the <code class="literal">meta.sourceProvenance</code> attribute should be a list containing one or more value from <code class="literal">lib.sourceTypes</code> defined in <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/source-types.nix" target="_top"><code class="literal">nixpkgs/lib/source-types.nix</code></a>.</p><p>Adding this information helps users who have needs related to build transparency and supply-chain security to gain some visibility into their installed software or set policy to allow or disallow installation based on source provenance.</p><p>The presence of a particular <code class="literal">sourceType</code> in a package’s <code class="literal">meta.sourceProvenance</code> list indicates that the package contains some components falling into that category, though the <span class="emphasis"><em>absence</em></span> of that <code class="literal">sourceType</code> does not <span class="emphasis"><em>guarantee</em></span> the absence of that category of <code class="literal">sourceType</code> in the package’s contents. A package with no <code class="literal">meta.sourceProvenance</code> set implies it has no <span class="emphasis"><em>known</em></span> <code class="literal">sourceType</code>s other than <code class="literal">fromSource</code>.</p><p>The meaning of the <code class="literal">meta.sourceProvenance</code> attribute does not depend on the value of the <code class="literal">meta.license</code> attribute.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="lib.sourceTypes.fromSource" class="title"><code class="literal">lib.sourceTypes.fromSource</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#lib.sourceTypes.fromSource" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Package elements which are produced by a nixpkgs derivation which builds them from source code.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="lib.sourceTypes.binaryNativeCode" class="title"><code class="literal">lib.sourceTypes.binaryNativeCode</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#lib.sourceTypes.binaryNativeCode" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Native code to be executed on the target system’s CPU, built by a third party. This includes packages which wrap a downloaded AppImage or Debian package.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="lib.sourceTypes.binaryFirmware" class="title"><code class="literal">lib.sourceTypes.binaryFirmware</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#lib.sourceTypes.binaryFirmware" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Code to be executed on a peripheral device or embedded controller, built by a third party.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="lib.sourceTypes.binaryBytecode" class="title"><code class="literal">lib.sourceTypes.binaryBytecode</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#lib.sourceTypes.binaryBytecode" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Code to run on a VM interpreter or JIT compiled into bytecode by a third party. This includes packages which download Java <code class="literal">.jar</code> files from another source.</p>
</div>

</div>

</div><div class="chapter"> <div class="titlepage">  <div>   <div>    <h2 id="chap-multiple-output" class="title">Multiple-output packages   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#chap-multiple-output" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <p><strong>Table of Contents</strong></p> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-multiple-outputs-using-split-packages">Using a split package</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-multiple-outputs-">Writing a split derivation</a> </span></dt> </dl></div><p>The Nix language allows a derivation to produce multiple outputs, which is similar to what is utilized by other Linux distribution packaging systems. The outputs reside in separate Nix store paths, so they can be mostly handled independently of each other, including passing to build inputs, garbage collection or binary substitution. The exception is that building from source always produces all the outputs.</p><p>The main motivation is to save disk space by reducing runtime closure sizes; consequently also sizes of substituted binaries get reduced. Splitting can be used to have more granular runtime dependencies, for example the typical reduction is to split away development-only files, as those are typically not needed during runtime. As a result, closure sizes of many packages can get reduced to a half or even much less.</p><div class="note"><h3 class="title">Note</h3><p>The reduction effects could be instead achieved by building the parts in completely separate derivations. That would often additionally reduce build-time closures, but it tends to be much harder to write such derivations, as build systems typically assume all parts are being built at once. This compromise approach of single source package producing multiple binary packages is also utilized often by rpm and deb.</p></div><p>A number of attributes can be used to work with a derivation with multiple outputs.
The attribute <code class="literal">outputs</code> is a list of strings, which are the names of the outputs.
For each of these names, an identically named attribute is created, corresponding to that output.</p><p>The attribute <code class="literal">meta.outputsToInstall</code> is used to determine the <a class="link" href="https://github.com/NixOS/nixpkgs/blob/08c3198f1c6fd89a09f8f0ea09b425028a34de3e/pkgs/stdenv/generic/check-meta.nix#L411-L426" target="_top">default set of outputs to install</a> when using the derivation name unqualified:
<code class="literal">bin</code>, or <code class="literal">out</code>, or the first specified output; as well as <code class="literal">man</code> if that is specified.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-multiple-outputs-using-split-packages" class="title" style="clear: both">Using a split package   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-multiple-outputs-using-split-packages" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>In the Nix language the individual outputs can be reached explicitly as attributes, e.g. <code class="literal">coreutils.info</code>, but the typical case is just using packages as build inputs.</p><p>When a multiple-output derivation gets into a build input of another derivation, the <code class="literal">dev</code> output is added if it exists, otherwise the first output is added. In addition to that, <code class="literal">propagatedBuildOutputs</code> of that package which by default contain <code class="literal">$outputBin</code> and <code class="literal">$outputLib</code> are also added. (See <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#multiple-output-file-type-groups" title="File type groups">the section called “File type groups”</a>.)</p><p>In some cases it may be desirable to combine different outputs under a single store path. A function <code class="literal">symlinkJoin</code> can be used to do this. (Note that it may negate some closure size benefits of using a multiple-output package.)</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-multiple-outputs-" class="title" style="clear: both">Writing a split derivation   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-multiple-outputs-" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#multiple-output-file-binaries-first-convention">“Binaries first”</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#multiple-output-file-type-groups">File type groups</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-multiple-outputs-caveats">Common caveats</a> </span></dt> </dl></div><p>Here you find how to write a derivation that produces multiple outputs.</p><p>In nixpkgs there is a framework supporting multiple-output derivations. It tries to cover most cases by default behavior. You can find the source separated in <code class="literal">&lt;nixpkgs/pkgs/build-support/setup-hooks/multiple-outputs.sh&gt;</code>; it’s relatively well-readable. The whole machinery is triggered by defining the <code class="literal">outputs</code> attribute to contain the list of desired output names (strings).</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">outputs</span> = [ <span class="hljs-string">"bin"</span> <span class="hljs-string">"dev"</span> <span class="hljs-string">"out"</span> <span class="hljs-string">"doc"</span> ];
</code></pre><p>Often such a single line is enough. For each output an equally named environment variable is passed to the builder and contains the path in nix store for that output. Typically you also want to have the main <code class="literal">out</code> output, as it catches any files that didn’t get elsewhere.</p><div class="note"><h3 class="title">Note</h3><p>There is a special handling of the <code class="literal">debug</code> output, described at <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#stdenv-separateDebugInfo" title="separateDebugInfo">the section called “<code class="literal">separateDebugInfo</code>”</a>.</p></div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="multiple-output-file-binaries-first-convention" class="title">“Binaries first”   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#multiple-output-file-binaries-first-convention" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>A commonly adopted convention in <code class="literal">nixpkgs</code> is that executables provided by the package are contained within its first output. This convention allows the dependent packages to reference the executables provided by packages in a uniform manner. For instance, provided with the knowledge that the <code class="literal">perl</code> package contains a <code class="literal">perl</code> executable it can be referenced as <code class="literal">${pkgs.perl}/bin/perl</code> within a Nix derivation that needs to execute a Perl script.</p><p>The <code class="literal">glibc</code> package is a deliberate single exception to the “binaries first” convention. The <code class="literal">glibc</code> has <code class="literal">libs</code> as its first output allowing the libraries provided by <code class="literal">glibc</code> to be referenced directly (e.g. <code class="literal">${glibc}/lib/ld-linux-x86-64.so.2</code>). The executables provided by <code class="literal">glibc</code> can be accessed via its <code class="literal">bin</code> attribute (e.g. <code class="literal">${lib.getBin stdenv.cc.libc}/bin/ldd</code>).</p><p>The reason for why <code class="literal">glibc</code> deviates from the convention is because referencing a library provided by <code class="literal">glibc</code> is a very common operation among Nix packages. For instance, third-party executables packaged by Nix are typically patched and relinked with the relevant version of <code class="literal">glibc</code> libraries from Nix packages (please see the documentation on <a class="link" href="https://github.com/NixOS/patchelf" target="_top">patchelf</a> for more details).</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="multiple-output-file-type-groups" class="title">File type groups   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#multiple-output-file-type-groups" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The support code currently recognizes some particular kinds of outputs and either instructs the build system of the package to put files into their desired outputs or it moves the files during the fixup phase. Each group of file types has an <code class="literal">outputFoo</code> variable specifying the output name where they should go. If that variable isn’t defined by the derivation writer, it is guessed – a default output name is defined, falling back to other possibilities if the output isn’t defined.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="outputdev" class="title"><code class="literal">$outputDev</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#outputdev" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>is for development-only files. These include C(++) headers (<code class="literal">include/</code>), pkg-config (<code class="literal">lib/pkgconfig/</code>), cmake (<code class="literal">lib/cmake/</code>) and aclocal files (<code class="literal">share/aclocal/</code>). They go to <code class="literal">dev</code> or <code class="literal">out</code> by default.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="outputbin" class="title"><code class="literal">$outputBin</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#outputbin" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>is meant for user-facing binaries, typically residing in <code class="literal">bin/</code>. They go to <code class="literal">bin</code> or <code class="literal">out</code> by default.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="outputlib" class="title"><code class="literal">$outputLib</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#outputlib" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>is meant for libraries, typically residing in <code class="literal">lib/</code> and <code class="literal">libexec/</code>. They go to <code class="literal">lib</code> or <code class="literal">out</code> by default.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="outputdoc" class="title"><code class="literal">$outputDoc</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#outputdoc" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>is for user documentation, typically residing in <code class="literal">share/doc/</code>. It goes to <code class="literal">doc</code> or <code class="literal">out</code> by default.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="outputdevdoc" class="title"><code class="literal">$outputDevdoc</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#outputdevdoc" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>is for <span class="emphasis"><em>developer</em></span> documentation. Currently we count gtk-doc and devhelp books, typically residing in <code class="literal">share/gtk-doc/</code> and <code class="literal">share/devhelp/</code>, in there. It goes to <code class="literal">devdoc</code> or is removed (!) by default. This is because e.g. gtk-doc tends to be rather large and completely unused by nixpkgs users.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="outputman" class="title"><code class="literal">$outputMan</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#outputman" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>is for man pages (except for section 3), typically residing in <code class="literal">share/man/man[0-9]/</code>. They go to <code class="literal">man</code> or <code class="literal">$outputBin</code> by default.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="outputdevman" class="title"><code class="literal">$outputDevman</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#outputdevman" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>is for section 3 man pages, typically residing in <code class="literal">share/man/man[0-9]/</code>. They go to <code class="literal">devman</code> or <code class="literal">$outputMan</code> by default.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="outputinfo" class="title"><code class="literal">$outputInfo</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#outputinfo" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>is for info pages, typically residing in <code class="literal">share/info/</code>. They go to <code class="literal">info</code> or <code class="literal">$outputBin</code> by default.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-multiple-outputs-caveats" class="title">Common caveats   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-multiple-outputs-caveats" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>Some configure scripts don’t like some of the parameters passed by default by the framework, e.g. <code class="literal">--docdir=/foo/bar</code>. You can disable this by setting <code class="literal">setOutputFlags = false;</code>.</p></li><li class="listitem"><p>The outputs of a single derivation can retain references to each other, but note that circular references are not allowed. (And each strongly-connected component would act as a single output anyway.)</p></li><li class="listitem"><p>Most of split packages contain their core functionality in libraries. These libraries tend to refer to various kind of data that typically gets into <code class="literal">out</code>, e.g. locale strings, so there is often no advantage in separating the libraries into <code class="literal">lib</code>, as keeping them in <code class="literal">out</code> is easier.</p></li><li class="listitem"><p>Some packages have hidden assumptions on install paths, which complicates splitting.</p></li></ul></div>
</div>

</div>

</div><div class="chapter"> <div class="titlepage">  <div>   <div>    <h2 id="chap-cross" class="title">Cross-compilation   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#chap-cross" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <p><strong>Table of Contents</strong></p> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-cross-intro">Introduction</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-cross-packaging">Packaging in a cross-friendly manner</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-cross-usage">Cross-building packages</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-cross-infra">Cross-compilation infrastructure</a> </span></dt> </dl></div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-cross-intro" class="title" style="clear: both">Introduction   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-cross-intro" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>“Cross-compilation” means compiling a program on one machine for another type of machine. For example, a typical use of cross-compilation is to compile programs for embedded devices. These devices often don’t have the computing power and memory to compile their own programs. One might think that cross-compilation is a fairly niche concern. However, there are significant advantages to rigorously distinguishing between build-time and run-time environments! Significant, because the benefits apply even when one is developing and deploying on the same machine. Nixpkgs is increasingly adopting the opinion that packages should be written with cross-compilation in mind, and Nixpkgs should evaluate in a similar way (by minimizing cross-compilation-specific special cases) whether or not one is cross-compiling.</p><p>This chapter will be organized in three parts. First, it will describe the basics of how to package software in a way that supports cross-compilation. Second, it will describe how to use Nixpkgs when cross-compiling. Third, it will describe the internal infrastructure supporting cross-compilation.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-cross-packaging" class="title" style="clear: both">Packaging in a cross-friendly manner   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-cross-packaging" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-cross-platform-parameters">Platform parameters</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-cross-dependency-categorization">Theory of dependency categorization</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-cross-cookbook">Cross packaging cookbook</a> </span></dt> </dl></div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-cross-platform-parameters" class="title">Platform parameters   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-cross-platform-parameters" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Nixpkgs follows the <a class="link" href="https://gcc.gnu.org/onlinedocs/gccint/Configure-Terms.html" target="_top">conventions of GNU autoconf</a>. We distinguish between 3 types of platforms when building a derivation: <span class="emphasis"><em>build</em></span>, <span class="emphasis"><em>host</em></span>, and <span class="emphasis"><em>target</em></span>. In summary, <span class="emphasis"><em>build</em></span> is the platform on which a package is being built, <span class="emphasis"><em>host</em></span> is the platform on which it will run. The third attribute, <span class="emphasis"><em>target</em></span>, is relevant only for certain specific compilers and build tools.</p><p>In Nixpkgs, these three platforms are defined as attribute sets under the names <code class="literal">buildPlatform</code>, <code class="literal">hostPlatform</code>, and <code class="literal">targetPlatform</code>. They are always defined as attributes in the standard environment. That means one can access them like:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ stdenv, fooDep, barDep, ... }: ...stdenv.buildPlatform...
</code></pre><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">buildPlatform</code></span></dt><dd><p>The “build platform” is the platform on which a package is built. Once someone has a built package, or pre-built binary package, the build platform should not matter and can be ignored.</p></dd><dt><span class="term"><code class="literal">hostPlatform</code></span></dt><dd><p>The “host platform” is the platform on which a package will be run. This is the simplest platform to understand, but also the one with the worst name.</p></dd><dt><span class="term"><code class="literal">targetPlatform</code></span></dt><dd><p>The “target platform” attribute is, unlike the other two attributes, not actually fundamental to the process of building software. Instead, it is only relevant for compatibility with building certain specific compilers and build tools. It can be safely ignored for all other packages.</p></dd><dd><p>The build process of certain compilers is written in such a way that the compiler resulting from a single build can itself only produce binaries for a single platform. The task of specifying this single “target platform” is thus pushed to build time of the compiler. The root cause of this is that the compiler (which will be run on the host) and the standard library/runtime (which will be run on the target) are built by a single build process.</p></dd><dd><p>There is no fundamental need to think about a single target ahead of time like this. If the tool supports modular or pluggable backends, both the need to specify the target at build time and the constraint of having only a single target disappear. An example of such a tool is LLVM.</p></dd><dd><p>Although the existence of a “target platform” is arguably a historical mistake, it is a common one: examples of tools that suffer from it are GCC, Binutils, GHC and Autoconf. Nixpkgs tries to avoid sharing in the mistake where possible. Still, because the concept of a target platform is so ingrained, it is best to support it as is.</p></dd></dl></div><p>The exact schema these fields follow is a bit ill-defined due to a long and convoluted evolution, but this is slowly being cleaned up. You can see examples of ones used in practice in <code class="literal">lib.systems.examples</code>; note how they are not all very consistent. For now, here are few fields can count on them containing:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">system</code></span></dt><dd><p>This is a two-component shorthand for the platform. Examples of this would be “x86_64-darwin” and “i686-linux”; see <code class="literal">lib.systems.doubles</code> for more. The first component corresponds to the CPU architecture of the platform and the second to the operating system of the platform (<code class="literal">[cpu]-[os]</code>). This format has built-in support in Nix, such as the <code class="literal">builtins.currentSystem</code> impure string.</p></dd><dt><span class="term"><code class="literal">config</code></span></dt><dd><p>This is a 3- or 4- component shorthand for the platform. Examples of this would be <code class="literal">x86_64-unknown-linux-gnu</code> and <code class="literal">aarch64-apple-darwin14</code>. This is a standard format called the “LLVM target triple”, as they are pioneered by LLVM. In the 4-part form, this corresponds to <code class="literal">[cpu]-[vendor]-[os]-[abi]</code>. This format is strictly more informative than the “Nix host double”, as the previous format could analogously be termed. This needs a better name than <code class="literal">config</code>!</p></dd><dt><span class="term"><code class="literal">parsed</code></span></dt><dd><p>This is a Nix representation of a parsed LLVM target triple with white-listed components. This can be specified directly, or actually parsed from the <code class="literal">config</code>. See <code class="literal">lib.systems.parse</code> for the exact representation.</p></dd><dt><span class="term"><code class="literal">libc</code></span></dt><dd><p>This is a string identifying the standard C library used. Valid identifiers include “glibc” for GNU libc, “libSystem” for Darwin’s Libsystem, and “uclibc” for µClibc. It should probably be refactored to use the module system, like <code class="literal">parse</code>.</p></dd><dt><span class="term"><code class="literal">is*</code></span></dt><dd><p>These predicates are defined in <code class="literal">lib.systems.inspect</code>, and slapped onto every platform. They are superior to the ones in <code class="literal">stdenv</code> as they force the user to be explicit about which platform they are inspecting. Please use these instead of those.</p></dd><dt><span class="term"><code class="literal">platform</code></span></dt><dd><p>This is, quite frankly, a dumping ground of ad-hoc settings (it’s an attribute set). See <code class="literal">lib.systems.platforms</code> for examples—there’s hopefully one in there that will work verbatim for each platform that is working. Please help us triage these flags and give them better homes!</p></dd></dl></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-cross-dependency-categorization" class="title">Theory of dependency categorization   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-cross-dependency-categorization" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><div class="note"><h3 class="title">Note</h3><p>This is a rather philosophical description that isn’t very Nixpkgs-specific. For an overview of all the relevant attributes given to <code class="literal">mkDerivation</code>, see <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#ssec-stdenv-dependencies" title="Specifying dependencies">the section called “Specifying dependencies”</a>. For a description of how everything is implemented, see <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#ssec-cross-dependency-implementation" title="Implementation of dependencies">the section called “Implementation of dependencies”</a>.</p></div><p>In this section we explore the relationship between both runtime and build-time dependencies and the 3 Autoconf platforms.</p><p>A run time dependency between two packages requires that their host platforms match. This is directly implied by the meaning of “host platform” and “runtime dependency”: The package dependency exists while both packages are running on a single host platform.</p><p>A build time dependency, however, has a shift in platforms between the depending package and the depended-on package. “build time dependency” means that to build the depending package we need to be able to run the depended-on’s package. The depending package’s build platform is therefore equal to the depended-on package’s host platform.</p><p>If both the dependency and depending packages aren’t compilers or other machine-code-producing tools, we’re done. And indeed <code class="literal">buildInputs</code> and <code class="literal">nativeBuildInputs</code> have covered these simpler cases for many years. But if the dependency does produce machine code, we might need to worry about its target platform too. In principle, that target platform might be any of the depending package’s build, host, or target platforms, but we prohibit dependencies from a “later” platform to an earlier platform to limit confusion because we’ve never seen a legitimate use for them.</p><p>Finally, if the depending package is a compiler or other machine-code-producing tool, it might need dependencies that run at “emit time”. This is for compilers that (regrettably) insist on being built together with their source languages’ standard libraries. Assuming build != host != target, a run-time dependency of the standard library cannot be run at the compiler’s build time or run time, but only at the run time of code emitted by the compiler.</p><p>Putting this all together, that means that we have dependency types of the form “X→ E”, which means that the dependency executes on X and emits code for E; each of X and E can be <code class="literal">build</code>, <code class="literal">host</code>, or <code class="literal">target</code>, and E can be <code class="literal">*</code> to indicate that the dependency is not a compiler-like package.</p><p>Dependency types describe the relationships that a package has with each of its transitive dependencies.  You could think of attaching one or more dependency types to each of the formal parameters at the top of a package’s <code class="literal">.nix</code> file, as well as to all of <span class="emphasis"><em>their</em></span> formal parameters, and so on.   Triples like <code class="literal">(foo, bar, baz)</code>, on the other hand, are a property of an instantiated derivation – you could would attach a triple <code class="literal">(mips-linux, mips-linux, sparc-solaris)</code> to a <code class="literal">.drv</code> file in <code class="literal">/nix/store</code>.</p><p>Only nine dependency types matter in practice:</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="possible-dependency-types" class="title">Possible dependency types   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#possible-dependency-types" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><div class="informaltable"><table class="informaltable" border="1"><colgroup><col align="left"><col align="left"><col align="left"></colgroup><thead><tr><th align="left">Dependency type</th><th align="left">Dependency’s host platform</th><th align="left">Dependency’s target platform</th></tr></thead><tbody><tr><td align="left">build → *</td><td align="left">build</td><td align="left">(none)</td></tr><tr><td align="left">build → build</td><td align="left">build</td><td align="left">build</td></tr><tr><td align="left">build → host</td><td align="left">build</td><td align="left">host</td></tr><tr><td align="left">build → target</td><td align="left">build</td><td align="left">target</td></tr><tr><td align="left">host → *</td><td align="left">host</td><td align="left">(none)</td></tr><tr><td align="left">host → host</td><td align="left">host</td><td align="left">host</td></tr><tr><td align="left">host → target</td><td align="left">host</td><td align="left">target</td></tr><tr><td align="left">target → *</td><td align="left">target</td><td align="left">(none)</td></tr><tr><td align="left">target → target</td><td align="left">target</td><td align="left">target</td></tr></tbody></table></div><p>Let’s use <code class="literal">g++</code> as an example to make this table clearer.  <code class="literal">g++</code> is a C++ compiler written in C.  Suppose we are building <code class="literal">g++</code> with a <code class="literal">(build, host, target)</code> platform triple of <code class="literal">(foo, bar, baz)</code>.  This means we are using a <code class="literal">foo</code>-machine to build a copy of <code class="literal">g++</code> which will run on a <code class="literal">bar</code>-machine and emit binaries for the <code class="literal">baz</code>-machine.</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><code class="literal">g++</code> links against the host platform’s <code class="literal">glibc</code> C library, which is a “host→ *” dependency with a triple of <code class="literal">(bar, bar, *)</code>.  Since it is a library, not a compiler, it has no “target”.</p></li><li class="listitem"><p>Since <code class="literal">g++</code> is written in C, the <code class="literal">gcc</code> compiler used to compile it is a “build→ host” dependency of <code class="literal">g++</code> with a triple of <code class="literal">(foo, foo, bar)</code>.  This compiler runs on the build platform and emits code for the host platform.</p></li><li class="listitem"><p><code class="literal">gcc</code> links against the build platform’s <code class="literal">glibc</code> C library, which is a “build→ *” dependency with a triple of <code class="literal">(foo, foo, *)</code>.  Since it is a library, not a compiler, it has no “target”.</p></li><li class="listitem"><p>This <code class="literal">gcc</code> is itself compiled by an <span class="emphasis"><em>earlier</em></span> copy of <code class="literal">gcc</code>.  This earlier copy of <code class="literal">gcc</code> is a “build→ build” dependency of <code class="literal">g++</code> with a triple of <code class="literal">(foo, foo, foo)</code>.  This “early <code class="literal">gcc</code>” runs on the build platform and emits code for the build platform.</p></li><li class="listitem"><p><code class="literal">g++</code> is bundled with <code class="literal">libgcc</code>, which includes a collection of target-machine routines for exception handling and
software floating point emulation.  <code class="literal">libgcc</code> would be a “target→ *” dependency with triple <code class="literal">(foo, baz, *)</code>, because it consists of machine code which gets linked against the output of the compiler that we are building.  It is a library, not a compiler, so it has no target of its own.</p></li><li class="listitem"><p><code class="literal">libgcc</code> is written in C and compiled with <code class="literal">gcc</code>.  The <code class="literal">gcc</code> that compiles it will be a “build→ target” dependency with triple <code class="literal">(foo, foo, baz)</code>.  It gets compiled <span class="emphasis"><em>and run</em></span> at <code class="literal">g++</code>-build-time (on platform <code class="literal">foo</code>), but must emit code for the <code class="literal">baz</code>-platform.</p></li><li class="listitem"><p><code class="literal">g++</code> allows inline assembler code, so it depends on access to a copy of the <code class="literal">gas</code> assembler.  This would be a “host→ target” dependency with triple <code class="literal">(foo, bar, baz)</code>.</p></li><li class="listitem"><p><code class="literal">g++</code> (and <code class="literal">gcc</code>) include a library <code class="literal">libgccjit.so</code>, which wrap the compiler in a library to create a just-in-time compiler.  In nixpkgs, this library is in the <code class="literal">libgccjit</code> package; if C++ required that programs have access to a JIT, <code class="literal">g++</code> would need to add a “target→ target” dependency for <code class="literal">libgccjit</code> with triple <code class="literal">(foo, baz, baz)</code>.  This would ensure that the compiler ships with a copy of <code class="literal">libgccjit</code> which both executes on and generates code for the <code class="literal">baz</code>-platform.</p></li><li class="listitem"><p>If <code class="literal">g++</code> itself linked against <code class="literal">libgccjit.so</code> (for example, to allow compile-time-evaluated C++ expressions), then the <code class="literal">libgccjit</code> package used to provide this functionality would be a “host→ host” dependency of <code class="literal">g++</code>: it is code which runs on the <code class="literal">host</code> and emits code for execution on the <code class="literal">host</code>.</p></li></ul></div>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-cross-cookbook" class="title">Cross packaging cookbook   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-cross-cookbook" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Some frequently encountered problems when packaging for cross-compilation should be answered here. Ideally, the information above is exhaustive, so this section cannot provide any new information, but it is ludicrous and cruel to expect everyone to spend effort working through the interaction of many features just to figure out the same answer to the same common problem. Feel free to add to this list!</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="cross-qa-fails-to-find-binutils" class="title">My package fails to find a binutils command (<code class="literal">cc</code>/<code class="literal">ar</code>/<code class="literal">ld</code> etc.)   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#cross-qa-fails-to-find-binutils" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Many packages assume that an unprefixed binutils (<code class="literal">cc</code>/<code class="literal">ar</code>/<code class="literal">ld</code> etc.) is available, but Nix doesn’t provide one. It only provides a prefixed one, just as it only does for all the other binutils programs. It may be necessary to patch the package to fix the build system to use a prefix. For instance, instead of <code class="literal">cc</code>, use <code class="literal">${stdenv.cc.targetPrefix}cc</code>.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">makeFlags</span> = [ <span class="hljs-string">"CC=<span class="hljs-subst">${stdenv.cc.targetPrefix}</span>cc"</span> ];
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="cross-qa-avoid-compiling-gcc-cross-compiler" class="title">How do I avoid compiling a GCC cross-compiler from source?   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#cross-qa-avoid-compiling-gcc-cross-compiler" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>On less powerful machines, it can be inconvenient to cross-compile a package only to find out that GCC has to be compiled from source, which could take up to several hours. Nixpkgs maintains a limited <a class="link" href="https://hydra.nixos.org/jobset/nixpkgs/cross-trunk" target="_top">cross-related jobset on Hydra</a>, which tests cross-compilation to various platforms from build platforms “x86_64-darwin”, “x86_64-linux”, and “aarch64-linux”.  See <code class="literal">pkgs/top-level/release-cross.nix</code> for the full list of target platforms and packages.  For instance, the following invocation fetches the pre-built cross-compiled GCC for <code class="literal">armv6l-unknown-linux-gnueabihf</code> and builds GNU Hello from source.</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">nix-build <span class="hljs-string">'&lt;nixpkgs&gt;'</span> -A pkgsCross.raspberryPi.hello</span>
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="cross-qa-build-c-program-in-build-environment" class="title">What if my package’s build system needs to build a C program to be run under the build environment?   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#cross-qa-build-c-program-in-build-environment" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Add the following to your <code class="literal">mkDerivation</code> invocation.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">depsBuildBuild</span> = [ buildPackages.stdenv.cc ];
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="cross-testsuite-runs-host-code" class="title">My package’s testsuite needs to run host platform code.   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#cross-testsuite-runs-host-code" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Add the following to your <code class="literal">mkDerivation</code> invocation.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">doCheck</span> = stdenv.buildPlatform.canExecute stdenv.hostPlatform;
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="cross-meson-runs-host-code" class="title">Package using Meson needs to run binaries for the host platform during build.   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#cross-meson-runs-host-code" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Add <code class="literal">mesonEmulatorHook</code> to <code class="literal">nativeBuildInputs</code> conditionally on if the target binaries can be executed.</p><p>e.g.</p><pre><code class="programlisting hljs language-nix" data-highlighted="yes"><span class="hljs-attr">nativeBuildInputs</span> = [
  meson
] ++ lib.optionals (!stdenv.buildPlatform.canExecute stdenv.hostPlatform) [
  mesonEmulatorHook
];
</code></pre><p>Example of an error which this fixes.</p><p><code class="literal">[Errno 8] Exec format error: './gdk3-scan'</code></p>
</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-cross-usage" class="title" style="clear: both">Cross-building packages   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-cross-usage" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>Nixpkgs can be instantiated with <code class="literal">localSystem</code> alone, in which case there is no cross-compiling and everything is built by and for that system, or also with <code class="literal">crossSystem</code>, in which case packages run on the latter, but all building happens on the former. Both parameters take the same schema as the 3 (build, host, and target) platforms defined in the previous section. As mentioned above, <code class="literal">lib.systems.examples</code> has some platforms which are used as arguments for these parameters in practice. You can use them programmatically, or on the command line:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">nix-build <span class="hljs-string">'&lt;nixpkgs&gt;'</span> --arg crossSystem <span class="hljs-string">'(import &lt;nixpkgs/lib&gt;).systems.examples.fooBarBaz'</span> -A whatever</span>
</code></pre><div class="note"><h3 class="title">Note</h3><p>Eventually we would like to make these platform examples an unnecessary convenience so that</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">nix-build <span class="hljs-string">'&lt;nixpkgs&gt;'</span> --arg crossSystem <span class="hljs-string">'{ config = "&lt;arch&gt;-&lt;os&gt;-&lt;vendor&gt;-&lt;abi&gt;"; }'</span> -A whatever</span>
</code></pre><p>works in the vast majority of cases. The problem today is dependencies on other sorts of configuration which aren’t given proper defaults. We rely on the examples to crudely to set those configuration parameters in some vaguely sane manner on the users behalf. Issue <a class="link" href="https://github.com/NixOS/nixpkgs/issues/34274" target="_top">#34274</a> tracks this inconvenience along with its root cause in crufty configuration options.</p></div><p>While one is free to pass both parameters in full, there’s a lot of logic to fill in missing fields. As discussed in the previous section, only one of <code class="literal">system</code>, <code class="literal">config</code>, and <code class="literal">parsed</code> is needed to infer the other two. Additionally, <code class="literal">libc</code> will be inferred from <code class="literal">parse</code>. Finally, <code class="literal">localSystem.system</code> is also <span class="emphasis"><em>impurely</em></span> inferred based on the platform evaluation occurs. This means it is often not necessary to pass <code class="literal">localSystem</code> at all, as in the command-line example in the previous paragraph.</p><div class="note"><h3 class="title">Note</h3><p>Many sources (manual, wiki, etc) probably mention passing <code class="literal">system</code>, <code class="literal">platform</code>, along with the optional <code class="literal">crossSystem</code> to Nixpkgs: <code class="literal">import &lt;nixpkgs&gt; { system = ..; platform = ..; crossSystem = ..; }</code>. Passing those two instead of <code class="literal">localSystem</code> is still supported for compatibility, but is discouraged. Indeed, much of the inference we do for these parameters is motivated by compatibility as much as convenience.</p></div><p>One would think that <code class="literal">localSystem</code> and <code class="literal">crossSystem</code> overlap horribly with the three <code class="literal">*Platforms</code> (<code class="literal">buildPlatform</code>, <code class="literal">hostPlatform,</code> and <code class="literal">targetPlatform</code>; see <code class="literal">stage.nix</code> or the manual). Actually, those identifiers are purposefully not used here to draw a subtle but important distinction: While the granularity of having 3 platforms is necessary to properly <span class="emphasis"><em>build</em></span> packages, it is overkill for specifying the user’s <span class="emphasis"><em>intent</em></span> when making a build plan or package set. A simple “build vs deploy” dichotomy is adequate: the sliding window principle described in the previous section shows how to interpolate between the these two “end points” to get the 3 platform triple for each bootstrapping stage. That means for any package a given package set, even those not bound on the top level but only reachable via dependencies or <code class="literal">buildPackages</code>, the three platforms will be defined as one of <code class="literal">localSystem</code> or <code class="literal">crossSystem</code>, with the former replacing the latter as one traverses build-time dependencies. A last simple difference is that <code class="literal">crossSystem</code> should be null when one doesn’t want to cross-compile, while the <code class="literal">*Platform</code>s are always non-null. <code class="literal">localSystem</code> is always non-null.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-cross-infra" class="title" style="clear: both">Cross-compilation infrastructure   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-cross-infra" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-cross-dependency-implementation">Implementation of dependencies</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-bootstrapping">Bootstrapping</a> </span></dt> </dl></div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-cross-dependency-implementation" class="title">Implementation of dependencies   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-cross-dependency-implementation" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The categories of dependencies developed in <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#ssec-cross-dependency-categorization" title="Theory of dependency categorization">the section called “Theory of dependency categorization”</a> are specified as lists of derivations given to <code class="literal">mkDerivation</code>, as documented in <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#ssec-stdenv-dependencies" title="Specifying dependencies">the section called “Specifying dependencies”</a>. In short, each list of dependencies for “host → target” is called <code class="literal">deps&lt;host&gt;&lt;target&gt;</code> (where <code class="literal">host</code>, and <code class="literal">target</code> values are either <code class="literal">build</code>, <code class="literal">host</code>, or <code class="literal">target</code>), with exceptions for backwards compatibility that <code class="literal">depsBuildHost</code> is instead called <code class="literal">nativeBuildInputs</code> and <code class="literal">depsHostTarget</code> is instead called <code class="literal">buildInputs</code>. Nixpkgs is now structured so that each <code class="literal">deps&lt;host&gt;&lt;target&gt;</code> is automatically taken from <code class="literal">pkgs&lt;host&gt;&lt;target&gt;</code>. (These <code class="literal">pkgs&lt;host&gt;&lt;target&gt;</code>s are quite new, so there is no special case for <code class="literal">nativeBuildInputs</code> and <code class="literal">buildInputs</code>.) For example, <code class="literal">pkgsBuildHost.gcc</code> should be used at build-time, while <code class="literal">pkgsHostTarget.gcc</code> should be used at run-time.</p><p>Now, for most of Nixpkgs’s history, there were no <code class="literal">pkgs&lt;host&gt;&lt;target&gt;</code> attributes, and most packages have not been refactored to use it explicitly. Prior to those, there were just <code class="literal">buildPackages</code>, <code class="literal">pkgs</code>, and <code class="literal">targetPackages</code>. Those are now redefined as aliases to <code class="literal">pkgsBuildHost</code>, <code class="literal">pkgsHostTarget</code>, and <code class="literal">pkgsTargetTarget</code>. It is acceptable, even recommended, to use them for libraries to show that the host platform is irrelevant.</p><p>But before that, there was just <code class="literal">pkgs</code>, even though both <code class="literal">buildInputs</code> and <code class="literal">nativeBuildInputs</code> existed. [Cross barely worked, and those were implemented with some hacks on <code class="literal">mkDerivation</code> to override dependencies.] What this means is the vast majority of packages do not use any explicit package set to populate their dependencies, just using whatever <code class="literal">callPackage</code> gives them even if they do correctly sort their dependencies into the multiple lists described above. And indeed, asking that users both sort their dependencies, <span class="emphasis"><em>and</em></span> take them from the right attribute set, is both too onerous and redundant, so the recommended approach (for now) is to continue just categorizing by list and not using an explicit package set.</p><p>To make this work, we “splice” together the six <code class="literal">pkgsFooBar</code> package sets and have <code class="literal">callPackage</code> actually take its arguments from that. This is currently implemented in <code class="literal">pkgs/top-level/splice.nix</code>. <code class="literal">mkDerivation</code> then, for each dependency attribute, pulls the right derivation out from the splice. This splicing can be skipped when not cross-compiling as the package sets are the same, but still is a bit slow for cross-compiling. We’d like to do something better, but haven’t come up with anything yet.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-bootstrapping" class="title">Bootstrapping   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-bootstrapping" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Each of the package sets described above come from a single bootstrapping stage. While <code class="literal">pkgs/top-level/default.nix</code>, coordinates the composition of stages at a high level, <code class="literal">pkgs/top-level/stage.nix</code> “ties the knot” (creates the fixed point) of each stage. The package sets are defined per-stage however, so they can be thought of as edges between stages (the nodes) in a graph. Compositions like <code class="literal">pkgsBuildTarget.targetPackages</code> can be thought of as paths to this graph.</p><p>While there are many package sets, and thus many edges, the stages can also be arranged in a linear chain. In other words, many of the edges are redundant as far as connectivity is concerned. This hinges on the type of bootstrapping we do. Currently for cross it is:</p><div class="orderedlist"><ol class="orderedlist " type="1"><li class="listitem"><p><code class="literal">(native, native, native)</code></p></li><li class="listitem"><p><code class="literal">(native, native, foreign)</code></p></li><li class="listitem"><p><code class="literal">(native, foreign, foreign)</code></p></li></ol></div><p>In each stage, <code class="literal">pkgsBuildHost</code> refers to the previous stage, <code class="literal">pkgsBuildBuild</code> refers to the one before that, and <code class="literal">pkgsHostTarget</code> refers to the current one, and <code class="literal">pkgsTargetTarget</code> refers to the next one. When there is no previous or next stage, they instead refer to the current stage. Note how all the invariants regarding the mapping between dependency and depending packages’ build host and target platforms are preserved. <code class="literal">pkgsBuildTarget</code> and <code class="literal">pkgsHostHost</code> are more complex in that the stage fitting the requirements isn’t always a fixed chain of “prevs” and “nexts” away (modulo the “saturating” self-references at the ends). We just special case each instead. All the primary edges are implemented is in <code class="literal">pkgs/stdenv/booter.nix</code>, and secondarily aliases in <code class="literal">pkgs/top-level/stage.nix</code>.</p><div class="note"><h3 class="title">Note</h3><p>The native stages are bootstrapped in legacy ways that predate the current cross implementation. This is why the bootstrapping stages leading up to the final stages are ignored in the previous paragraph.</p></div><p>If one looks at the 3 platform triples, one can see that they overlap such that one could put them together into a chain like:</p><pre><code class="programlisting hljs language-undefined" data-highlighted="yes">(native, native, native, foreign, foreign)
</code></pre><p>If one imagines the saturating self references at the end being replaced with infinite stages, and then overlays those platform triples, one ends up with the infinite tuple:</p><pre><code class="programlisting hljs language-undefined" data-highlighted="yes">(native..., native, native, native, foreign, foreign, foreign...)
</code></pre><p>One can then imagine any sequence of platforms such that there are bootstrap stages with their 3 platforms determined by “sliding a window” that is the 3 tuple through the sequence. This was the original model for bootstrapping. Without a target platform (assume a better world where all compilers are multi-target and all standard libraries are built in their own derivation), this is sufficient. Conversely if one wishes to cross compile “faster”, with a “Canadian Cross” bootstrapping stage where <code class="literal">build != host != target</code>, more bootstrapping stages are needed since no sliding window provides the pesky <code class="literal">pkgsBuildTarget</code> package set since it skips the Canadian cross stage’s “host”.</p><div class="note"><h3 class="title">Note</h3><p>It is much better to refer to <code class="literal">buildPackages</code> than <code class="literal">targetPackages</code>, or more broadly package sets that do not mention “target”. There are three reasons for this.</p><p>First, it is because bootstrapping stages do not have a unique <code class="literal">targetPackages</code>. For example a <code class="literal">(x86-linux, x86-linux, arm-linux)</code> and <code class="literal">(x86-linux, x86-linux, x86-windows)</code> package set both have a <code class="literal">(x86-linux, x86-linux, x86-linux)</code> package set. Because there is no canonical <code class="literal">targetPackages</code> for such a native (<code class="literal">build == host == target</code>) package set, we set their <code class="literal">targetPackages</code></p><p>Second, it is because this is a frequent source of hard-to-follow “infinite recursions” / cycles. When only package sets that don’t mention target are used, the package set forms a directed acyclic graph. This means that all cycles that exist are confined to one stage. This means they are a lot smaller, and easier to follow in the code or a backtrace. It also means they are present in native and cross builds alike, and so more likely to be caught by CI and other users.</p><p>Thirdly, it is because everything target-mentioning only exists to accommodate compilers with lousy build systems that insist on the compiler itself and standard library being built together. Of course that is bad because bigger derivations means longer rebuilds. It is also problematic because it tends to make the standard libraries less like other libraries than they could be, complicating code and build systems alike. Because of the other problems, and because of these innate disadvantages, compilers ought to be packaged another way where possible.</p></div><div class="note"><h3 class="title">Note</h3><p>If one explores Nixpkgs, they will see derivations with names like <code class="literal">gccCross</code>. Such <code class="literal">*Cross</code> derivations is a holdover from before we properly distinguished between the host and target platforms—the derivation with “Cross” in the name covered the <code class="literal">build = host != target</code> case, while the other covered the <code class="literal">host = target</code>, with build platform the same or not based on whether one was using its <code class="literal">.__spliced.buildHost</code> or <code class="literal">.__spliced.hostTarget</code>.</p></div>
</div>

</div>

</div><div class="chapter"> <div class="titlepage">  <div>   <div>    <h2 id="chap-platform-notes" class="title">Platform Notes   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#chap-platform-notes" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <p><strong>Table of Contents</strong></p> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-darwin">Darwin (macOS)</a> </span></dt> </dl></div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-darwin" class="title" style="clear: both">Darwin (macOS)   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-darwin" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>Some common issues when packaging software for Darwin:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>The Darwin <code class="literal">stdenv</code> uses clang instead of gcc. When referring to the compiler <code class="literal">$CC</code> or <code class="literal">cc</code> will work in both cases. Some builds hardcode gcc/g++ in their build scripts, that can usually be fixed with using something like <code class="literal">makeFlags = [ "CC=cc" ];</code> or by patching the build scripts.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">stdenv.mkDerivation {
  <span class="hljs-attr">name</span> = <span class="hljs-string">"libfoo-1.2.3"</span>;
  <span class="hljs-comment"># ...</span>
  <span class="hljs-attr">buildPhase</span> = <span class="hljs-string">''
    $CC -o hello hello.c
  ''</span>;
}
</code></pre></li><li class="listitem"><p>On Darwin, libraries are linked using absolute paths, libraries are resolved by their <code class="literal">install_name</code> at link time. Sometimes packages won’t set this correctly causing the library lookups to fail at runtime. This can be fixed by adding extra linker flags or by running <code class="literal">install_name_tool -id</code> during the <code class="literal">fixupPhase</code>.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">stdenv.mkDerivation {
  <span class="hljs-attr">name</span> = <span class="hljs-string">"libfoo-1.2.3"</span>;
  <span class="hljs-comment"># ...</span>
  <span class="hljs-attr">makeFlags</span> = lib.optional stdenv.isDarwin <span class="hljs-string">"LDFLAGS=-Wl,-install_name,$(out)/lib/libfoo.dylib"</span>;
}
</code></pre></li><li class="listitem"><p>Even if the libraries are linked using absolute paths and resolved via their <code class="literal">install_name</code> correctly, tests can sometimes fail to run binaries. This happens because the <code class="literal">checkPhase</code> runs before the libraries are installed.</p><p>This can usually be solved by running the tests after the <code class="literal">installPhase</code> or alternatively by using <code class="literal">DYLD_LIBRARY_PATH</code>. More information about this variable can be found in the <span class="emphasis"><em>dyld(1)</em></span> manpage.</p><pre><code class="programlisting hljs language-bash" data-highlighted="yes">dyld: Library not loaded: /nix/store/7hnmbscpayxzxrixrgxvvlifzlxdsdir-jq-1.5-lib/lib/libjq.1.dylib
Referenced from: /private/tmp/nix-build-jq-1.5.drv-0/jq-1.5/tests/../jq
Reason: image not found
./tests/jqtest: line 5: 75779 Abort <span class="hljs-built_in">trap</span>: 6
</code></pre><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">stdenv.mkDerivation {
  <span class="hljs-attr">name</span> = <span class="hljs-string">"libfoo-1.2.3"</span>;
  <span class="hljs-comment"># ...</span>
  <span class="hljs-attr">doInstallCheck</span> = <span class="hljs-literal">true</span>;
  <span class="hljs-attr">installCheckTarget</span> = <span class="hljs-string">"check"</span>;
}
</code></pre></li><li class="listitem"><p>Some packages assume xcode is available and use <code class="literal">xcrun</code> to resolve build tools like <code class="literal">clang</code>, etc. This causes errors like <code class="literal">xcode-select: error: no developer tools were found at '/Applications/Xcode.app'</code> while the build doesn’t actually depend on xcode.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">stdenv.mkDerivation {
  <span class="hljs-attr">name</span> = <span class="hljs-string">"libfoo-1.2.3"</span>;
  <span class="hljs-comment"># ...</span>
  <span class="hljs-attr">prePatch</span> = <span class="hljs-string">''
    substituteInPlace Makefile \
        --replace '/usr/bin/xcrun clang' clang
  ''</span>;
}
</code></pre><p>The package <code class="literal">xcbuild</code> can be used to build projects that really depend on Xcode. However, this replacement is not 100% compatible with Xcode and can occasionally cause issues.</p></li><li class="listitem"><p>x86_64-darwin uses the 10.12 SDK by default, but some software is not compatible with that version of the SDK. In that case,
the 11.0 SDK used by aarch64-darwin is available for use on x86_64-darwin. To use it, reference <code class="literal">apple_sdk_11_0</code> instead of
<code class="literal">apple_sdk</code> in your derivation and use <code class="literal">pkgs.darwin.apple_sdk_11_0.callPackage</code> instead of <code class="literal">pkgs.callPackage</code>. On Linux, this will
have the same effect as <code class="literal">pkgs.callPackage</code>, so you can use <code class="literal">pkgs.darwin.apple_sdk_11_0.callPackage</code> regardless of platform.</p></li></ul></div>
</div>

</div>
</div><div class="part"> <div class="titlepage">  <div>   <div>    <h1 id="part-builders" class="title">Build helpers   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#part-builders" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h1>  </div> </div></div><div class="partintro"><p>A build helper is a function that produces derivations.</p><div class="warning"><h3 class="title">Warning</h3><p>This is not to be confused with the <a class="link" href="https://nixos.org/manual/nix/unstable/language/derivations" target="_top"><code class="literal">builder</code> argument of the Nix <code class="literal">derivation</code> primitive</a>, which refers to the executable that produces the build result, or <a class="link" href="https://nixos.org/manual/nix/stable/advanced-topics/distributed-builds" target="_top">remote builder</a>, which refers to a remote  machine that could run such an executable.</p></div><p>Such a function is usually designed to abstract over a typical workflow for a given programming language or framework.
This allows declaring a build recipe by setting a limited number of options relevant to the particular use case instead of using the <code class="literal">derivation</code> function directly.</p><p><a class="link" href="https://nixos.org/manual/nixpkgs/stable/#part-stdenv" title="Standard environment"><code class="literal">stdenv.mkDerivation</code></a> is the most widely used build helper, and serves as a basis for many others.
In addition, it offers various options to customize parts of the builds.</p><p>There is no uniform interface for build helpers.
<a class="link" href="https://nixos.org/manual/nixpkgs/stable/#chap-trivial-builders" title="Trivial build helpers">Trivial build helpers</a> and <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#chap-pkgs-fetchers" title="Fetchers">fetchers</a> have various input types for convenience.
<a class="link" href="https://nixos.org/manual/nixpkgs/stable/#chap-language-support" title="Languages and frameworks">Language- or framework-specific build helpers</a> usually follow the style of <code class="literal">stdenv.mkDerivation</code>, which accepts an attribute set or a fixed-point function taking an attribute set.</p><div class="toc"> <p><strong>Table of Contents</strong></p> <dl class="toc">  <dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-pkgs-fetchers">Fetchers</a> </span></dt><dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-trivial-builders">Trivial build helpers</a> </span></dt><dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-testers">Testers</a> </span></dt><dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-special">Special build helpers</a> </span></dt><dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-images">Images</a> </span></dt><dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-hooks">Hooks reference</a> </span></dt><dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-language-support">Languages and frameworks</a> </span></dt><dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-packages">Packages</a> </span></dt> </dl></div></div><div class="chapter"> <div class="titlepage">  <div>   <div>    <h2 id="chap-pkgs-fetchers" class="title">Fetchers   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#chap-pkgs-fetchers" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <p><strong>Table of Contents</strong></p> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-pkgs-fetchers-caveats">Caveats</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#fetchurl"><code class="literal">fetchurl</code> and <code class="literal">fetchzip</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#fetchpatch"><code class="literal">fetchpatch</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#fetchdebianpatch"><code class="literal">fetchDebianPatch</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#fetchsvn"><code class="literal">fetchsvn</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#fetchgit"><code class="literal">fetchgit</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#fetchfossil"><code class="literal">fetchfossil</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#fetchcvs"><code class="literal">fetchcvs</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#fetchhg"><code class="literal">fetchhg</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#fetchfromgitea"><code class="literal">fetchFromGitea</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#fetchfromgithub"><code class="literal">fetchFromGitHub</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#fetchfromgitlab"><code class="literal">fetchFromGitLab</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#fetchfromgitiles"><code class="literal">fetchFromGitiles</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#fetchfrombitbucket"><code class="literal">fetchFromBitbucket</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#fetchfromsavannah"><code class="literal">fetchFromSavannah</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#fetchfromrepoorcz"><code class="literal">fetchFromRepoOrCz</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#fetchfromsourcehut"><code class="literal">fetchFromSourcehut</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#requirefile"><code class="literal">requireFile</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#fetchtorrent"><code class="literal">fetchtorrent</code></a> </span></dt> </dl></div><p>Building software with Nix often requires downloading source code and other files from the internet.
To this end, Nixpkgs provides <span class="emphasis"><em>fetchers</em></span>: functions to obtain remote sources via various protocols and services.</p><p>Nixpkgs fetchers differ from built-in fetchers such as <a class="link" href="https://nixos.org/manual/nix/stable/language/builtins#builtins-fetchTarball" target="_top"><code class="literal">builtins.fetchTarball</code></a>:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>A built-in fetcher will download and cache files at evaluation time and produce a <a class="link" href="https://nixos.org/manual/nix/stable/glossary#gloss-store-path" target="_top">store path</a>.
A Nixpkgs fetcher will create a (<a class="link" href="https://nixos.org/manual/nix/stable/glossary#gloss-fixed-output-derivation" target="_top">fixed-output</a>) <a class="link" href="https://nixos.org/manual/nix/stable/language/derivations" target="_top">derivation</a>, and files are downloaded at build time.</p></li><li class="listitem"><p>Built-in fetchers will invalidate their cache after <a class="link" href="https://nixos.org/manual/nix/stable/command-ref/conf-file#conf-tarball-ttl" target="_top"><code class="literal">tarball-ttl</code></a> expires, and will require network activity to check if the cache entry is up to date.
Nixpkgs fetchers only re-download if the specified hash changes or the store object is not otherwise available.</p></li><li class="listitem"><p>Built-in fetchers do not use <a class="link" href="https://nixos.org/manual/nix/stable/command-ref/conf-file#conf-substituters" target="_top">substituters</a>.
Derivations produced by Nixpkgs fetchers will use any configured binary cache transparently.</p></li></ul></div><p>This significantly reduces the time needed to evaluate the entirety of Nixpkgs, and allows <a class="link" href="https://nixos.org/hydra" target="_top">Hydra</a> to retain and re-distribute sources used by Nixpkgs in the <a class="link" href="https://cache.nixos.org/" target="_top">public binary cache</a>.
For these reasons, built-in fetchers are not allowed in Nixpkgs source code.</p><p>The following table shows an overview of the differences:</p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col align="left"><col align="left"><col align="left"><col align="left"><col align="left"></colgroup><thead><tr><th align="left">Fetchers</th><th align="left">Download</th><th align="left">Output</th><th align="left">Cache</th><th align="left">Re-download when</th></tr></thead><tbody><tr><td align="left"><code class="literal">builtins.fetch*</code></td><td align="left">evaluation time</td><td align="left">store path</td><td align="left"><code class="literal">/nix/store</code>, <code class="literal">~/.cache/nix</code></td><td align="left"><code class="literal">tarball-ttl</code> expires, cache miss in <code class="literal">~/.cache/nix</code>, output store object not in local store</td></tr><tr><td align="left"><code class="literal">pkgs.fetch*</code></td><td align="left">build time</td><td align="left">derivation</td><td align="left"><code class="literal">/nix/store</code>, substituters</td><td align="left">output store object not available</td></tr></tbody></table></div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="chap-pkgs-fetchers-caveats" class="title" style="clear: both">Caveats   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#chap-pkgs-fetchers-caveats" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>The fact that the hash belongs to the Nix derivation output and not the file itself can lead to confusion.
For example, consider the following fetcher:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">fetchurl {
  <span class="hljs-attr">url</span> = <span class="hljs-string">"http://www.example.org/hello-1.0.tar.gz"</span>;
  <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-lTeyxzJNQeMdu1IVdovNMtgn77jRIhSybLdMbTkf2Ww="</span>;
};
</code></pre><p>A common mistake is to update a fetcher’s URL, or a version parameter, without updating the hash.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">fetchurl {
  <span class="hljs-attr">url</span> = <span class="hljs-string">"http://www.example.org/hello-1.1.tar.gz"</span>;
  <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-lTeyxzJNQeMdu1IVdovNMtgn77jRIhSybLdMbTkf2Ww="</span>;
};
</code></pre><p><span class="strong"><strong>This will reuse the old contents</strong></span>.
Remember to invalidate the hash argument, in this case by setting the <code class="literal">hash</code> attribute to an empty string.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">fetchurl {
  <span class="hljs-attr">url</span> = <span class="hljs-string">"http://www.example.org/hello-1.1.tar.gz"</span>;
  <span class="hljs-attr">hash</span> = <span class="hljs-string">""</span>;
};
</code></pre><p>Use the resulting error message to determine the correct hash.</p><pre><code class="programlisting hljs language-bash" data-highlighted="yes">error: <span class="hljs-built_in">hash</span> mismatch <span class="hljs-keyword">in</span> fixed-output derivation <span class="hljs-string">'/path/to/my.drv'</span>:
         specified: sha256-AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=
            got:    sha256-lTeyxzJNQeMdu1IVdovNMtgn77jRIhSybLdMbTkf2Ww=
</code></pre><p>A similar problem arises while testing changes to a fetcher’s implementation. If the output of the derivation already exists in the Nix store, test failures can go undetected. The <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#tester-invalidateFetcherByDrvHash" title="invalidateFetcherByDrvHash"><code class="literal">invalidateFetcherByDrvHash</code></a> function helps prevent reusing cached derivations.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="fetchurl" class="title" style="clear: both"><code class="literal">fetchurl</code> and <code class="literal">fetchzip</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#fetchurl" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>Two basic fetchers are <code class="literal">fetchurl</code> and <code class="literal">fetchzip</code>. Both of these have two required arguments, a URL and a hash. The hash is typically <code class="literal">hash</code>, although many more hash algorithms are supported. Nixpkgs contributors are currently recommended to use <code class="literal">hash</code>. This hash will be used by Nix to identify your source. A typical usage of <code class="literal">fetchurl</code> is provided below.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ stdenv, fetchurl }:

stdenv.mkDerivation {
  <span class="hljs-attr">name</span> = <span class="hljs-string">"hello"</span>;
  <span class="hljs-attr">src</span> = fetchurl {
    <span class="hljs-attr">url</span> = <span class="hljs-string">"http://www.example.org/hello.tar.gz"</span>;
    <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB="</span>;
  };
}
</code></pre><p>The main difference between <code class="literal">fetchurl</code> and <code class="literal">fetchzip</code> is in how they store the contents. <code class="literal">fetchurl</code> will store the unaltered contents of the URL within the Nix store. <code class="literal">fetchzip</code> on the other hand, will decompress the archive for you, making files and directories directly accessible in the future. <code class="literal">fetchzip</code> can only be used with archives. Despite the name, <code class="literal">fetchzip</code> is not limited to .zip files and can also be used with any tarball.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="fetchpatch" class="title" style="clear: both"><code class="literal">fetchpatch</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#fetchpatch" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p><code class="literal">fetchpatch</code> works very similarly to <code class="literal">fetchurl</code> with the same arguments expected. It expects patch files as a source and performs normalization on them before computing the checksum. For example, it will remove comments or other unstable parts that are sometimes added by version control systems and can change over time.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">relative</code>: Similar to using <code class="literal">git-diff</code>’s <code class="literal">--relative</code> flag, only keep changes inside the specified directory, making paths relative to it.</p></li><li class="listitem"><p><code class="literal">stripLen</code>: Remove the first <code class="literal">stripLen</code> components of pathnames in the patch.</p></li><li class="listitem"><p><code class="literal">decode</code>: Pipe the downloaded data through this command before processing it as a patch.</p></li><li class="listitem"><p><code class="literal">extraPrefix</code>: Prefix pathnames by this string.</p></li><li class="listitem"><p><code class="literal">excludes</code>: Exclude files matching these patterns (applies after the above arguments).</p></li><li class="listitem"><p><code class="literal">includes</code>: Include only files matching these patterns (applies after the above arguments).</p></li><li class="listitem"><p><code class="literal">revert</code>: Revert the patch.</p></li></ul></div><p>Note that because the checksum is computed after applying these effects, using or modifying these arguments will have no effect unless the <code class="literal">hash</code> argument is changed as well.</p><p>Most other fetchers return a directory rather than a single file.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="fetchdebianpatch" class="title" style="clear: both"><code class="literal">fetchDebianPatch</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#fetchdebianpatch" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>A wrapper around <code class="literal">fetchpatch</code>, which takes:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">patch</code> and <code class="literal">hash</code>: the patch’s filename,
and its hash after normalization by <code class="literal">fetchpatch</code> ;</p></li><li class="listitem"><p><code class="literal">pname</code>: the Debian source package’s name ;</p></li><li class="listitem"><p><code class="literal">version</code>: the upstream version number ;</p></li><li class="listitem"><p><code class="literal">debianRevision</code>: the <a class="link" href="https://www.debian.org/doc/debian-policy/ch-controlfields.html#version" target="_top">Debian revision number</a> if applicable ;</p></li><li class="listitem"><p>the <code class="literal">area</code> of the Debian archive: <code class="literal">main</code> (default), <code class="literal">contrib</code>, or <code class="literal">non-free</code>.</p></li></ul></div><p>Here is an example of <code class="literal">fetchDebianPatch</code> in action:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ lib
, fetchDebianPatch
, buildPythonPackage
}:

buildPythonPackage <span class="hljs-keyword">rec</span> {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"pysimplesoap"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"1.16.2"</span>;
  <span class="hljs-attr">src</span> = ...;

  <span class="hljs-attr">patches</span> = [
    (fetchDebianPatch {
      <span class="hljs-keyword">inherit</span> pname version;
      <span class="hljs-attr">debianRevision</span> = <span class="hljs-string">"5"</span>;
      <span class="hljs-attr">name</span> = <span class="hljs-string">"Add-quotes-to-SOAPAction-header-in-SoapClient.patch"</span>;
      <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-xA8Wnrpr31H8wy3zHSNfezFNjUJt1HbSXn3qUMzeKc0="</span>;
    })
  ];

  ...
}
</code></pre><p>Patches are fetched from <code class="literal">sources.debian.org</code>, and so must come from a
package version that was uploaded to the Debian archive.  Packages may
be removed from there once that specific version isn’t in any suite
anymore (stable, testing, unstable, etc.), so maintainers should use
<code class="literal">copy-tarballs.pl</code> to archive the patch if it needs to be available
longer-term.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="fetchsvn" class="title" style="clear: both"><code class="literal">fetchsvn</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#fetchsvn" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>Used with Subversion. Expects <code class="literal">url</code> to a Subversion directory, <code class="literal">rev</code>, and <code class="literal">hash</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="fetchgit" class="title" style="clear: both"><code class="literal">fetchgit</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#fetchgit" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>Used with Git. Expects <code class="literal">url</code> to a Git repo, <code class="literal">rev</code>, and <code class="literal">hash</code>. <code class="literal">rev</code> in this case can be full the git commit id (SHA1 hash) or a tag name like <code class="literal">refs/tags/v1.0</code>.</p><p>Additionally, the following optional arguments can be given: <code class="literal">fetchSubmodules = true</code> makes <code class="literal">fetchgit</code> also fetch the submodules of a repository. If <code class="literal">deepClone</code> is set to true, the entire repository is cloned as opposing to just creating a shallow clone. <code class="literal">deepClone = true</code> also implies <code class="literal">leaveDotGit = true</code> which means that the <code class="literal">.git</code> directory of the clone won’t be removed after checkout.</p><p>If only parts of the repository are needed, <code class="literal">sparseCheckout</code> can be used. This will prevent git from fetching unnecessary blobs from server, see <a class="link" href="https://git-scm.com/docs/git-sparse-checkout" target="_top">git sparse-checkout</a> for more information:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ stdenv, fetchgit }:

stdenv.mkDerivation {
  <span class="hljs-attr">name</span> = <span class="hljs-string">"hello"</span>;
  <span class="hljs-attr">src</span> = fetchgit {
    <span class="hljs-attr">url</span> = <span class="hljs-string">"https://..."</span>;
    <span class="hljs-attr">sparseCheckout</span> = [
      <span class="hljs-string">"directory/to/be/included"</span>
      <span class="hljs-string">"another/directory"</span>
    ];
    <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA="</span>;
  };
}
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="fetchfossil" class="title" style="clear: both"><code class="literal">fetchfossil</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#fetchfossil" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>Used with Fossil. Expects <code class="literal">url</code> to a Fossil archive, <code class="literal">rev</code>, and <code class="literal">hash</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="fetchcvs" class="title" style="clear: both"><code class="literal">fetchcvs</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#fetchcvs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>Used with CVS. Expects <code class="literal">cvsRoot</code>, <code class="literal">tag</code>, and <code class="literal">hash</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="fetchhg" class="title" style="clear: both"><code class="literal">fetchhg</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#fetchhg" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>Used with Mercurial. Expects <code class="literal">url</code>, <code class="literal">rev</code>, and <code class="literal">hash</code>.</p><p>A number of fetcher functions wrap part of <code class="literal">fetchurl</code> and <code class="literal">fetchzip</code>. They are mainly convenience functions intended for commonly used destinations of source code in Nixpkgs. These wrapper fetchers are listed below.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="fetchfromgitea" class="title" style="clear: both"><code class="literal">fetchFromGitea</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#fetchfromgitea" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p><code class="literal">fetchFromGitea</code> expects five arguments. <code class="literal">domain</code> is the gitea server name. <code class="literal">owner</code> is a string corresponding to the Gitea user or organization that controls this repository. <code class="literal">repo</code> corresponds to the name of the software repository. These are located at the top of every Gitea HTML page as <code class="literal">owner</code>/<code class="literal">repo</code>. <code class="literal">rev</code> corresponds to the Git commit hash or tag (e.g <code class="literal">v1.0</code>) that will be downloaded from Git. Finally, <code class="literal">hash</code> corresponds to the hash of the extracted directory. Again, other hash algorithms are also available but <code class="literal">hash</code> is currently preferred.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="fetchfromgithub" class="title" style="clear: both"><code class="literal">fetchFromGitHub</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#fetchfromgithub" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p><code class="literal">fetchFromGitHub</code> expects four arguments. <code class="literal">owner</code> is a string corresponding to the GitHub user or organization that controls this repository. <code class="literal">repo</code> corresponds to the name of the software repository. These are located at the top of every GitHub HTML page as <code class="literal">owner</code>/<code class="literal">repo</code>. <code class="literal">rev</code> corresponds to the Git commit hash or tag (e.g <code class="literal">v1.0</code>) that will be downloaded from Git. Finally, <code class="literal">hash</code> corresponds to the hash of the extracted directory. Again, other hash algorithms are also available, but <code class="literal">hash</code> is currently preferred.</p><p>To use a different GitHub instance, use <code class="literal">githubBase</code> (defaults to <code class="literal">"github.com"</code>).</p><p><code class="literal">fetchFromGitHub</code> uses <code class="literal">fetchzip</code> to download the source archive generated by GitHub for the specified revision. If <code class="literal">leaveDotGit</code>, <code class="literal">deepClone</code> or <code class="literal">fetchSubmodules</code> are set to <code class="literal">true</code>, <code class="literal">fetchFromGitHub</code> will use <code class="literal">fetchgit</code> instead. Refer to its section for documentation of these options.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="fetchfromgitlab" class="title" style="clear: both"><code class="literal">fetchFromGitLab</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#fetchfromgitlab" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>This is used with GitLab repositories. It behaves similarly to <code class="literal">fetchFromGitHub</code>, and expects <code class="literal">owner</code>, <code class="literal">repo</code>, <code class="literal">rev</code>, and <code class="literal">hash</code>.</p><p>To use a specific GitLab instance, use <code class="literal">domain</code> (defaults to <code class="literal">"gitlab.com"</code>).</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="fetchfromgitiles" class="title" style="clear: both"><code class="literal">fetchFromGitiles</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#fetchfromgitiles" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>This is used with Gitiles repositories. The arguments expected are similar to <code class="literal">fetchgit</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="fetchfrombitbucket" class="title" style="clear: both"><code class="literal">fetchFromBitbucket</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#fetchfrombitbucket" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>This is used with BitBucket repositories. The arguments expected are very similar to <code class="literal">fetchFromGitHub</code> above.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="fetchfromsavannah" class="title" style="clear: both"><code class="literal">fetchFromSavannah</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#fetchfromsavannah" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>This is used with Savannah repositories. The arguments expected are very similar to <code class="literal">fetchFromGitHub</code> above.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="fetchfromrepoorcz" class="title" style="clear: both"><code class="literal">fetchFromRepoOrCz</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#fetchfromrepoorcz" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>This is used with repo.or.cz repositories. The arguments expected are very similar to <code class="literal">fetchFromGitHub</code> above.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="fetchfromsourcehut" class="title" style="clear: both"><code class="literal">fetchFromSourcehut</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#fetchfromsourcehut" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>This is used with sourcehut repositories. Similar to <code class="literal">fetchFromGitHub</code> above,
it expects <code class="literal">owner</code>, <code class="literal">repo</code>, <code class="literal">rev</code> and <code class="literal">hash</code>, but don’t forget the tilde (~)
in front of the username! Expected arguments also include <code class="literal">vc</code> (“git” (default)
or “hg”), <code class="literal">domain</code> and <code class="literal">fetchSubmodules</code>.</p><p>If <code class="literal">fetchSubmodules</code> is <code class="literal">true</code>, <code class="literal">fetchFromSourcehut</code> uses <code class="literal">fetchgit</code>
or <code class="literal">fetchhg</code> with <code class="literal">fetchSubmodules</code> or <code class="literal">fetchSubrepos</code> set to <code class="literal">true</code>,
respectively. Otherwise, the fetcher uses <code class="literal">fetchzip</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="requirefile" class="title" style="clear: both"><code class="literal">requireFile</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#requirefile" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p><code class="literal">requireFile</code> allows requesting files that cannot be fetched automatically, but whose content is known.
This is a useful last-resort workaround for license restrictions that prohibit redistribution, or for downloads that are only accessible after authenticating interactively in a browser.
If the requested file is present in the Nix store, the resulting derivation will not be built, because its expected output is already available.
Otherwise, the builder will run, but fail with a message explaining to the user how to provide the file. The following code, for example:</p><pre><code class="programlisting hljs language-bash" data-highlighted="yes">requireFile {
  name = <span class="hljs-string">"jdk-<span class="hljs-variable">${version}</span>_linux-x64_bin.tar.gz"</span>;
  url = <span class="hljs-string">"https://www.oracle.com/java/technologies/javase-jdk11-downloads.html"</span>;
  <span class="hljs-built_in">hash</span> = <span class="hljs-string">"sha256-lL00+F7jjT71nlKJ7HRQuUQ7kkxVYlZh//5msD8sjeI="</span>;
}
</code></pre><p>results in this error message:</p><pre><code class="programlisting hljs language-bash" data-highlighted="yes">***
Unfortunately, we cannot download file jdk-11.0.10_linux-x64_bin.tar.gz automatically.
Please go to https://www.oracle.com/java/technologies/javase-jdk11-downloads.html to download it yourself, and add it to the Nix store
using either
  nix-store --add-fixed sha256 jdk-11.0.10_linux-x64_bin.tar.gz
or
  nix-prefetch-url --<span class="hljs-built_in">type</span> sha256 file:///path/to/jdk-11.0.10_linux-x64_bin.tar.gz

***
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="fetchtorrent" class="title" style="clear: both"><code class="literal">fetchtorrent</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#fetchtorrent" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#fetchtorrent-parameters">Parameters</a> </span></dt> </dl></div><p><code class="literal">fetchtorrent</code> expects two arguments. <code class="literal">url</code> which can either be a Magnet URI (Magnet Link) such as <code class="literal">magnet:?xt=urn:btih:dd8255ecdc7ca55fb0bbf81323d87062db1f6d1c</code> or an HTTP URL pointing to a <code class="literal">.torrent</code> file. It can also take a <code class="literal">config</code> argument which will craft a <code class="literal">settings.json</code> configuration file and give it to <code class="literal">transmission</code>, the underlying program that is performing the fetch. The available config options for <code class="literal">transmission</code> can be found <a class="link" href="https://github.com/transmission/transmission/blob/main/docs/Editing-Configuration-Files.md#options" target="_top">here</a></p><pre><code class="programlisting hljs language-nix" data-highlighted="yes">{ fetchtorrent }:

fetchtorrent {
  <span class="hljs-attr">config</span> = { <span class="hljs-attr">peer-limit-global</span> = <span class="hljs-number">100</span>; };
  <span class="hljs-attr">url</span> = <span class="hljs-string">"magnet:?xt=urn:btih:dd8255ecdc7ca55fb0bbf81323d87062db1f6d1c"</span>;
  <span class="hljs-attr">sha256</span> = <span class="hljs-string">""</span>;
}
</code></pre><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="fetchtorrent-parameters" class="title">Parameters   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#fetchtorrent-parameters" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><code class="literal">url</code>: Magnet URI (Magnet Link) such as <code class="literal">magnet:?xt=urn:btih:dd8255ecdc7ca55fb0bbf81323d87062db1f6d1c</code> or an HTTP URL pointing to a <code class="literal">.torrent</code> file.</p></li><li class="listitem"><p><code class="literal">backend</code>: Which bittorrent program to use. Default: <code class="literal">"transmission"</code>. Valid values are <code class="literal">"rqbit"</code> or <code class="literal">"transmission"</code>. These are the two most suitable torrent clients for fetching in a fixed-output derivation at the time of writing, as they can be easily exited after usage. <code class="literal">rqbit</code> is written in Rust and has a smaller closure size than <code class="literal">transmission</code>, and the performance and peer discovery properties differs between these clients, requiring experimentation to decide upon which is the best.</p></li><li class="listitem"><p><code class="literal">config</code>: When using <code class="literal">transmission</code> as the <code class="literal">backend</code>, a json configuration can
be supplied to transmission. Refer to the <a class="link" href="https://github.com/transmission/transmission/blob/main/docs/Editing-Configuration-Files.md" target="_top">upstream documentation</a> for information on how to configure.</p></li></ul></div>
</div>

</div>

</div><div class="chapter"> <div class="titlepage">  <div>   <div>    <h2 id="chap-trivial-builders" class="title">Trivial build helpers   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#chap-trivial-builders" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <p><strong>Table of Contents</strong></p> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#trivial-builder-runCommand"><code class="literal">runCommand</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#trivial-builder-runCommandCC"><code class="literal">runCommandCC</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#trivial-builder-runCommandLocal"><code class="literal">runCommandLocal</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#trivial-builder-writeText"><code class="literal">writeTextFile</code>, <code class="literal">writeText</code>, <code class="literal">writeTextDir</code>, <code class="literal">writeScript</code>, <code class="literal">writeScriptBin</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#trivial-builder-concatText"><code class="literal">concatTextFile</code>, <code class="literal">concatText</code>, <code class="literal">concatScript</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#trivial-builder-writeShellApplication"><code class="literal">writeShellApplication</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#trivial-builder-symlinkJoin"><code class="literal">symlinkJoin</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#trivial-builder-writeReferencesToFile"><code class="literal">writeReferencesToFile</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#trivial-builder-writeDirectReferencesToFile"><code class="literal">writeDirectReferencesToFile</code></a> </span></dt> </dl></div><p>Nixpkgs provides a couple of functions that help with building derivations. The most important one, <code class="literal">stdenv.mkDerivation</code>, has already been documented above. The following functions wrap <code class="literal">stdenv.mkDerivation</code>, making it easier to use in certain cases.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="trivial-builder-runCommand" class="title" style="clear: both"><code class="literal">runCommand</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#trivial-builder-runCommand" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p><code class="literal">runCommand :: String -&gt; AttrSet -&gt; String -&gt; Derivation</code></p><p><code class="literal">runCommand name drvAttrs buildCommand</code> returns a derivation that is built by running the specified shell commands.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">name :: String</code></span></dt><dd><p>The name that Nix will append to the store path in the same way that <code class="literal">stdenv.mkDerivation</code> uses its <code class="literal">name</code> attribute.</p></dd><dt><span class="term"><code class="literal">drvAttr :: AttrSet</code></span></dt><dd><p>Attributes to pass to the underlying call to <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#chap-stdenv" title="The Standard Environment"><code class="literal">stdenv.mkDerivation</code></a>.</p></dd><dt><span class="term"><code class="literal">buildCommand :: String</code></span></dt><dd><p>Shell commands to run in the derivation builder.</p><div class="note"><h3 class="title">Note</h3><p>You have to create a file or directory <code class="literal">$out</code> for Nix to be able to run the builder successfully.</p></div></dd></dl></div><div class="example"><span id="ex-runcommand-simple"></span><p class="title"><strong>Example&nbsp;234.&nbsp;Invocation of <code class="literal">runCommand</code></strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">(<span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {}).runCommand <span class="hljs-string">"my-example"</span> {} <span class="hljs-string">''
  echo My example command is running

  mkdir $out

  echo I can write data to the Nix store &gt; $out/message

  echo I can also run basic commands like:

  echo ls
  ls

  echo whoami
  whoami

  echo date
  date
''</span>
</code></pre></div></div><br class="example-break">
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="trivial-builder-runCommandCC" class="title" style="clear: both"><code class="literal">runCommandCC</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#trivial-builder-runCommandCC" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>This works just like <code class="literal">runCommand</code>. The only difference is that it also provides a C compiler in <code class="literal">buildCommand</code>’s environment. To minimize your dependencies, you should only use this if you are sure you will need a C compiler as part of running your command.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="trivial-builder-runCommandLocal" class="title" style="clear: both"><code class="literal">runCommandLocal</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#trivial-builder-runCommandLocal" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>Variant of <code class="literal">runCommand</code> that forces the derivation to be built locally, it is not substituted. This is intended for very cheap commands (&lt;1s execution time). It saves on the network round-trip and can speed up a build.</p><div class="note"><h3 class="title">Note</h3><p>This sets <a class="link" href="https://nixos.org/nix/manual/#adv-attr-allowSubstitutes" target="_top"><code class="literal">allowSubstitutes</code> to <code class="literal">false</code></a>, so only use <code class="literal">runCommandLocal</code> if you are certain the user will always have a builder for the <code class="literal">system</code> of the derivation. This should be true for most trivial use cases (e.g., just copying some files to a different location or adding symlinks) because there the <code class="literal">system</code> is usually the same as <code class="literal">builtins.currentSystem</code>.</p></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="trivial-builder-writeText" class="title" style="clear: both"><code class="literal">writeTextFile</code>, <code class="literal">writeText</code>, <code class="literal">writeTextDir</code>, <code class="literal">writeScript</code>, <code class="literal">writeScriptBin</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#trivial-builder-writeText" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>These functions write <code class="literal">text</code> to the Nix store. This is useful for creating scripts from Nix expressions. <code class="literal">writeTextFile</code> takes an attribute set and expects two arguments, <code class="literal">name</code> and <code class="literal">text</code>. <code class="literal">name</code> corresponds to the name used in the Nix store path. <code class="literal">text</code> will be the contents of the file. You can also set <code class="literal">executable</code> to true to make this file have the executable bit set.</p><p>Many more commands wrap <code class="literal">writeTextFile</code> including <code class="literal">writeText</code>, <code class="literal">writeTextDir</code>, <code class="literal">writeScript</code>, and <code class="literal">writeScriptBin</code>. These are convenience functions over <code class="literal">writeTextFile</code>.</p><p>Here are a few examples:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-comment"># Writes my-file to /nix/store/&lt;store path&gt;</span>
writeTextFile {
  <span class="hljs-attr">name</span> = <span class="hljs-string">"my-file"</span>;
  <span class="hljs-attr">text</span> = <span class="hljs-string">''
    Contents of File
  ''</span>;
}
<span class="hljs-comment"># See also the `writeText` helper function below.</span>

<span class="hljs-comment"># Writes executable my-file to /nix/store/&lt;store path&gt;/bin/my-file</span>
writeTextFile {
  <span class="hljs-attr">name</span> = <span class="hljs-string">"my-file"</span>;
  <span class="hljs-attr">text</span> = <span class="hljs-string">''
    Contents of File
  ''</span>;
  <span class="hljs-attr">executable</span> = <span class="hljs-literal">true</span>;
  <span class="hljs-attr">destination</span> = <span class="hljs-string">"/bin/my-file"</span>;
}
<span class="hljs-comment"># Writes contents of file to /nix/store/&lt;store path&gt;</span>
writeText <span class="hljs-string">"my-file"</span>
  <span class="hljs-string">''
  Contents of File
  ''</span>;
<span class="hljs-comment"># Writes contents of file to /nix/store/&lt;store path&gt;/share/my-file</span>
writeTextDir <span class="hljs-string">"share/my-file"</span>
  <span class="hljs-string">''
  Contents of File
  ''</span>;
<span class="hljs-comment"># Writes my-file to /nix/store/&lt;store path&gt; and makes executable</span>
writeScript <span class="hljs-string">"my-file"</span>
  <span class="hljs-string">''
  Contents of File
  ''</span>;
<span class="hljs-comment"># Writes my-file to /nix/store/&lt;store path&gt;/bin/my-file and makes executable.</span>
writeScriptBin <span class="hljs-string">"my-file"</span>
  <span class="hljs-string">''
  Contents of File
  ''</span>;
<span class="hljs-comment"># Writes my-file to /nix/store/&lt;store path&gt; and makes executable.</span>
writeShellScript <span class="hljs-string">"my-file"</span>
  <span class="hljs-string">''
  Contents of File
  ''</span>;
<span class="hljs-comment"># Writes my-file to /nix/store/&lt;store path&gt;/bin/my-file and makes executable.</span>
writeShellScriptBin <span class="hljs-string">"my-file"</span>
  <span class="hljs-string">''
  Contents of File
  ''</span>;

</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="trivial-builder-concatText" class="title" style="clear: both"><code class="literal">concatTextFile</code>, <code class="literal">concatText</code>, <code class="literal">concatScript</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#trivial-builder-concatText" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>These functions concatenate <code class="literal">files</code> to the Nix store in a single file. This is useful for configuration files structured in lines of text. <code class="literal">concatTextFile</code> takes an attribute set and expects two arguments, <code class="literal">name</code> and <code class="literal">files</code>. <code class="literal">name</code> corresponds to the name used in the Nix store path. <code class="literal">files</code> will be the files to be concatenated. You can also set <code class="literal">executable</code> to true to make this file have the executable bit set.
<code class="literal">concatText</code> and<code class="literal">concatScript</code> are simple wrappers over <code class="literal">concatTextFile</code>.</p><p>Here are a few examples:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">
<span class="hljs-comment"># Writes my-file to /nix/store/&lt;store path&gt;</span>
concatTextFile {
  <span class="hljs-attr">name</span> = <span class="hljs-string">"my-file"</span>;
  <span class="hljs-attr">files</span> = [ drv1 <span class="hljs-string">"<span class="hljs-subst">${drv2}</span>/path/to/file"</span> ];
}
<span class="hljs-comment"># See also the `concatText` helper function below.</span>

<span class="hljs-comment"># Writes executable my-file to /nix/store/&lt;store path&gt;/bin/my-file</span>
concatTextFile {
  <span class="hljs-attr">name</span> = <span class="hljs-string">"my-file"</span>;
  <span class="hljs-attr">files</span> = [ drv1 <span class="hljs-string">"<span class="hljs-subst">${drv2}</span>/path/to/file"</span> ];
  <span class="hljs-attr">executable</span> = <span class="hljs-literal">true</span>;
  <span class="hljs-attr">destination</span> = <span class="hljs-string">"/bin/my-file"</span>;
}
<span class="hljs-comment"># Writes contents of files to /nix/store/&lt;store path&gt;</span>
concatText <span class="hljs-string">"my-file"</span> [ file1 file2 ]

<span class="hljs-comment"># Writes contents of files to /nix/store/&lt;store path&gt;</span>
concatScript <span class="hljs-string">"my-file"</span> [ file1 file2 ]
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="trivial-builder-writeShellApplication" class="title" style="clear: both"><code class="literal">writeShellApplication</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#trivial-builder-writeShellApplication" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>This can be used to easily produce a shell script that has some dependencies (<code class="literal">runtimeInputs</code>). It automatically sets the <code class="literal">PATH</code> of the script to contain all of the listed inputs, sets some sanity shellopts (<code class="literal">errexit</code>, <code class="literal">nounset</code>, <code class="literal">pipefail</code>), and checks the resulting script with <a class="link" href="https://github.com/koalaman/shellcheck" target="_top"><code class="literal">shellcheck</code></a>.</p><p>For example, look at the following code:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">writeShellApplication {
  <span class="hljs-attr">name</span> = <span class="hljs-string">"show-nixos-org"</span>;

  <span class="hljs-attr">runtimeInputs</span> = [ curl w3m ];

  <span class="hljs-attr">text</span> = <span class="hljs-string">''
    curl -s 'https://nixos.org' | w3m -dump -T text/html
  ''</span>;
}
</code></pre><p>Unlike with normal <code class="literal">writeShellScriptBin</code>, there is no need to manually write out <code class="literal">${curl}/bin/curl</code>, setting the PATH
was handled by <code class="literal">writeShellApplication</code>. Moreover, the script is being checked with <code class="literal">shellcheck</code> for more strict
validation.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="trivial-builder-symlinkJoin" class="title" style="clear: both"><code class="literal">symlinkJoin</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#trivial-builder-symlinkJoin" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>This can be used to put many derivations into the same directory structure. It works by creating a new derivation and adding symlinks to each of the paths listed. It expects two arguments, <code class="literal">name</code>, and <code class="literal">paths</code>. <code class="literal">name</code> is the name used in the Nix store path for the created derivation. <code class="literal">paths</code> is a list of paths that will be symlinked. These paths can be to Nix store derivations or any other subdirectory contained within.
Here is an example:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-comment"># adds symlinks of hello and stack to current build and prints "links added"</span>
symlinkJoin { <span class="hljs-attr">name</span> = <span class="hljs-string">"myexample"</span>; <span class="hljs-attr">paths</span> = [ pkgs.hello pkgs.stack ]; <span class="hljs-attr">postBuild</span> = <span class="hljs-string">"echo links added"</span>; }
</code></pre><p>This creates a derivation with a directory structure like the following:</p><pre><code class="programlisting hljs language-bash" data-highlighted="yes">/nix/store/sglsr5g079a5235hy29da3mq3hv8sjmm-myexample
|-- bin
|   |-- hello -&gt; /nix/store/qy93dp4a3rqyn2mz63fbxjg228hffwyw-hello-2.10/bin/hello
|   `-- stack -&gt; /nix/store/6lzdpxshx78281vy056lbk553ijsdr44-stack-2.1.3.1/bin/stack
`-- share
    |-- bash-completion
    |   `-- completions
    |       `-- stack -&gt; /nix/store/6lzdpxshx78281vy056lbk553ijsdr44-stack-2.1.3.1/share/bash-completion/completions/stack
    |-- fish
    |   `-- vendor_completions.d
    |       `-- stack.fish -&gt; /nix/store/6lzdpxshx78281vy056lbk553ijsdr44-stack-2.1.3.1/share/fish/vendor_completions.d/stack.fish
...
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="trivial-builder-writeReferencesToFile" class="title" style="clear: both"><code class="literal">writeReferencesToFile</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#trivial-builder-writeReferencesToFile" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>Writes the closure of transitive dependencies to a file.</p><p>This produces the equivalent of <code class="literal">nix-store -q --requisites</code>.</p><p>For example,</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">writeReferencesToFile (writeScriptBin <span class="hljs-string">"hi"</span> <span class="hljs-string">''<span class="hljs-subst">${hello}</span>/bin/hello''</span>)
</code></pre><p>produces an output path <code class="literal">/nix/store/&lt;hash&gt;-runtime-deps</code> containing</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">/nix/store/&lt;hash&gt;-hello-<span class="hljs-number">2.10</span>
/nix/store/&lt;hash&gt;-hi
/nix/store/&lt;hash&gt;-libidn2-<span class="hljs-number">2.3</span>.<span class="hljs-number">0</span>
/nix/store/&lt;hash&gt;-libunistring-<span class="hljs-number">0.9</span>.<span class="hljs-number">10</span>
/nix/store/&lt;hash&gt;-glibc-<span class="hljs-number">2.32</span>-<span class="hljs-number">40</span>
</code></pre><p>You can see that this includes <code class="literal">hi</code>, the original input path,
<code class="literal">hello</code>, which is a direct reference, but also
the other paths that are indirectly required to run <code class="literal">hello</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="trivial-builder-writeDirectReferencesToFile" class="title" style="clear: both"><code class="literal">writeDirectReferencesToFile</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#trivial-builder-writeDirectReferencesToFile" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>Writes the set of references to the output file, that is, their immediate dependencies.</p><p>This produces the equivalent of <code class="literal">nix-store -q --references</code>.</p><p>For example,</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">writeDirectReferencesToFile (writeScriptBin <span class="hljs-string">"hi"</span> <span class="hljs-string">''<span class="hljs-subst">${hello}</span>/bin/hello''</span>)
</code></pre><p>produces an output path <code class="literal">/nix/store/&lt;hash&gt;-runtime-references</code> containing</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">/nix/store/&lt;hash&gt;-hello-<span class="hljs-number">2.10</span>
</code></pre><p>but none of <code class="literal">hello</code>’s dependencies because those are not referenced directly
by <code class="literal">hi</code>’s output.</p>
</div>

</div><div class="chapter"> <div class="titlepage">  <div>   <div>    <h2 id="chap-testers" class="title">Testers   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#chap-testers" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <p><strong>Table of Contents</strong></p> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#tester-hasPkgConfigModules"><code class="literal">hasPkgConfigModules</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#tester-testVersion"><code class="literal">testVersion</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#tester-testBuildFailure"><code class="literal">testBuildFailure</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#tester-equalContents"><code class="literal">testEqualContents</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#tester-testEqualDerivation"><code class="literal">testEqualDerivation</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#tester-invalidateFetcherByDrvHash"><code class="literal">invalidateFetcherByDrvHash</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#tester-runNixOSTest"><code class="literal">runNixOSTest</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#tester-nixosTest"><code class="literal">nixosTest</code></a> </span></dt> </dl></div><p>This chapter describes several testing builders which are available in the <code class="literal">testers</code> namespace.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="tester-hasPkgConfigModules" class="title" style="clear: both"><code class="literal">hasPkgConfigModules</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#tester-hasPkgConfigModules" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p><span id="tester-hasPkgConfigModule"></span>
Checks whether a package exposes a given list of <code class="literal">pkg-config</code> modules.
If the <code class="literal">moduleNames</code> argument is omitted, <code class="literal">hasPkgConfigModules</code> will
use <code class="literal">meta.pkgConfigModules</code>.</p><p>Example:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">passthru.tests.<span class="hljs-attr">pkg-config</span> = testers.hasPkgConfigModules {
  <span class="hljs-attr">package</span> = finalAttrs.finalPackage;
  <span class="hljs-attr">moduleNames</span> = [ <span class="hljs-string">"libfoo"</span> ];
};
</code></pre><p>If the package in question has <code class="literal">meta.pkgConfigModules</code> set, it is even simpler:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">passthru.tests.<span class="hljs-attr">pkg-config</span> = testers.hasPkgConfigModules {
  <span class="hljs-attr">package</span> = finalAttrs.finalPackage;
};

meta.<span class="hljs-attr">pkgConfigModules</span> = [ <span class="hljs-string">"libfoo"</span> ];
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="tester-testVersion" class="title" style="clear: both"><code class="literal">testVersion</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#tester-testVersion" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>Checks the command output contains the specified version</p><p>Although simplistic, this test assures that the main program
can run. While there’s no substitute for a real test case,
it does catch dynamic linking errors and such. It also provides
some protection against accidentally building the wrong version,
for example when using an ‘old’ hash in a fixed-output derivation.</p><p>Examples:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">passthru.tests.<span class="hljs-attr">version</span> = testers.testVersion { <span class="hljs-attr">package</span> = hello; };

passthru.tests.<span class="hljs-attr">version</span> = testers.testVersion {
  <span class="hljs-attr">package</span> = seaweedfs;
  <span class="hljs-attr">command</span> = <span class="hljs-string">"weed version"</span>;
};

passthru.tests.<span class="hljs-attr">version</span> = testers.testVersion {
  <span class="hljs-attr">package</span> = key;
  <span class="hljs-attr">command</span> = <span class="hljs-string">"KeY --help"</span>;
  <span class="hljs-comment"># Wrong '2.5' version in the code. Drop on next version.</span>
  <span class="hljs-attr">version</span> = <span class="hljs-string">"2.5"</span>;
};

passthru.tests.<span class="hljs-attr">version</span> = testers.testVersion {
  <span class="hljs-attr">package</span> = ghr;
  <span class="hljs-comment"># The output needs to contain the 'version' string without any prefix or suffix.</span>
  <span class="hljs-attr">version</span> = <span class="hljs-string">"v<span class="hljs-subst">${version}</span>"</span>;
};
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="tester-testBuildFailure" class="title" style="clear: both"><code class="literal">testBuildFailure</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#tester-testBuildFailure" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>Make sure that a build does not succeed. This is useful for testing testers.</p><p>This returns a derivation with an override on the builder, with the following effects:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>Fail the build when the original builder succeeds</p></li><li class="listitem"><p>Move <code class="literal">$out</code> to <code class="literal">$out/result</code>, if it exists (assuming <code class="literal">out</code> is the default output)</p></li><li class="listitem"><p>Save the build log to <code class="literal">$out/testBuildFailure.log</code> (same)</p></li></ul></div><p>Example:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">runCommand <span class="hljs-string">"example"</span> {
  <span class="hljs-attr">failed</span> = testers.testBuildFailure (runCommand <span class="hljs-string">"fail"</span> {} <span class="hljs-string">''
    echo ok-ish &gt;$out
    echo failing though
    exit 3
  ''</span>);
} <span class="hljs-string">''
  grep -F 'ok-ish' $failed/result
  grep -F 'failing though' $failed/testBuildFailure.log
  [[ 3 = $(cat $failed/testBuildFailure.exit) ]]
  touch $out
''</span>;
</code></pre><p>While <code class="literal">testBuildFailure</code> is designed to keep changes to the original builder’s
environment to a minimum, some small changes are inevitable.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>The file <code class="literal">$TMPDIR/testBuildFailure.log</code> is present. It should not be deleted.</p></li><li class="listitem"><p><code class="literal">stdout</code> and <code class="literal">stderr</code> are a pipe instead of a tty. This could be improved.</p></li><li class="listitem"><p>One or two extra processes are present in the sandbox during the original
builder’s execution.</p></li><li class="listitem"><p>The derivation and output hashes are different, but not unusual.</p></li><li class="listitem"><p>The derivation includes a dependency on <code class="literal">buildPackages.bash</code> and
<code class="literal">expect-failure.sh</code>, which is built to include a transitive dependency on
<code class="literal">buildPackages.coreutils</code> and possibly more. These are not added to <code class="literal">PATH</code>
or any other environment variable, so they should be hard to observe.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="tester-equalContents" class="title" style="clear: both"><code class="literal">testEqualContents</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#tester-equalContents" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>Check that two paths have the same contents.</p><p>Example:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">testers.testEqualContents {
  <span class="hljs-attr">assertion</span> = <span class="hljs-string">"sed -e performs replacement"</span>;
  <span class="hljs-attr">expected</span> = writeText <span class="hljs-string">"expected"</span> <span class="hljs-string">''
    foo baz baz
  ''</span>;
  <span class="hljs-attr">actual</span> = runCommand <span class="hljs-string">"actual"</span> {
    <span class="hljs-comment"># not really necessary for a package that's in stdenv</span>
    <span class="hljs-attr">nativeBuildInputs</span> = [ gnused ];
    <span class="hljs-attr">base</span> = writeText <span class="hljs-string">"base"</span> <span class="hljs-string">''
      foo bar baz
    ''</span>;
  } <span class="hljs-string">''
    sed -e 's/bar/baz/g' $base &gt;$out
  ''</span>;
}
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="tester-testEqualDerivation" class="title" style="clear: both"><code class="literal">testEqualDerivation</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#tester-testEqualDerivation" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>Checks that two packages produce the exact same build instructions.</p><p>This can be used to make sure that a certain difference of configuration,
such as the presence of an overlay does not cause a cache miss.</p><p>When the derivations are equal, the return value is an empty file.
Otherwise, the build log explains the difference via <code class="literal">nix-diff</code>.</p><p>Example:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">testers.testEqualDerivation
  <span class="hljs-string">"The hello package must stay the same when enabling checks."</span>
  hello
  (hello.overrideAttrs(o: { <span class="hljs-attr">doCheck</span> = <span class="hljs-literal">true</span>; }))
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="tester-invalidateFetcherByDrvHash" class="title" style="clear: both"><code class="literal">invalidateFetcherByDrvHash</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#tester-invalidateFetcherByDrvHash" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>Use the derivation hash to invalidate the output via name, for testing.</p><p>Type: <code class="literal">(a@{ name, ... } -&gt; Derivation) -&gt; a -&gt; Derivation</code></p><p>Normally, fixed output derivations can and should be cached by their output
hash only, but for testing we want to re-fetch everytime the fetcher changes.</p><p>Changes to the fetcher become apparent in the drvPath, which is a hash of
how to fetch, rather than a fixed store path.
By inserting this hash into the name, we can make sure to re-run the fetcher
every time the fetcher changes.</p><p>This relies on the assumption that Nix isn’t clever enough to reuse its
database of local store contents to optimize fetching.</p><p>You might notice that the “salted” name derives from the normal invocation,
not the final derivation. <code class="literal">invalidateFetcherByDrvHash</code> has to invoke the fetcher
function twice: once to get a derivation hash, and again to produce the final
fixed output derivation.</p><p>Example:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">tests.<span class="hljs-attr">fetchgit</span> = testers.invalidateFetcherByDrvHash fetchgit {
  <span class="hljs-attr">name</span> = <span class="hljs-string">"nix-source"</span>;
  <span class="hljs-attr">url</span> = <span class="hljs-string">"https://github.com/NixOS/nix"</span>;
  <span class="hljs-attr">rev</span> = <span class="hljs-string">"9d9dbe6ed05854e03811c361a3380e09183f4f4a"</span>;
  <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-7DszvbCNTjpzGRmpIVAWXk20P0/XTrWZ79KSOGLrUWY="</span>;
};
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="tester-runNixOSTest" class="title" style="clear: both"><code class="literal">runNixOSTest</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#tester-runNixOSTest" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>A helper function that behaves exactly like the NixOS <code class="literal">runTest</code>, except it also assigns this Nixpkgs package set as the <code class="literal">pkgs</code> of the test and makes the <code class="literal">nixpkgs.*</code> options read-only.</p><p>If your test is part of the Nixpkgs repository, or if you need a more general entrypoint, see <a class="link" href="https://nixos.org/manual/nixos/stable/#sec-calling-nixos-tests" target="_top">“Calling a test” in the NixOS manual</a>.</p><p>Example:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">pkgs.testers.runNixOSTest ({ lib, ... }: {
  <span class="hljs-attr">name</span> = <span class="hljs-string">"hello"</span>;
  nodes.<span class="hljs-attr">machine</span> = { pkgs, ... }: {
    environment.<span class="hljs-attr">systemPackages</span> = [ pkgs.hello ];
  };
  <span class="hljs-attr">testScript</span> = <span class="hljs-string">''
    machine.succeed("hello")
  ''</span>;
})
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="tester-nixosTest" class="title" style="clear: both"><code class="literal">nixosTest</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#tester-nixosTest" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#tester-nixosTest-parameter">Parameter</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#tester-nixosTest-result">Result</a> </span></dt> </dl></div><p>Run a NixOS VM network test using this evaluation of Nixpkgs.</p><p>NOTE: This function is primarily for external use. NixOS itself uses <code class="literal">make-test-python.nix</code> directly. Packages defined in Nixpkgs <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ssec-nixos-tests-linking" title="Linking NixOS module tests to a package">reuse NixOS tests via <code class="literal">nixosTests</code>, plural</a>.</p><p>It is mostly equivalent to the function <code class="literal">import ./make-test-python.nix</code> from the
<a class="link" href="https://nixos.org/nixos/manual/index.html#sec-nixos-tests" target="_top">NixOS manual</a>,
except that the current application of Nixpkgs (<code class="literal">pkgs</code>) will be used, instead of
letting NixOS invoke Nixpkgs anew.</p><p>If a test machine needs to set NixOS options under <code class="literal">nixpkgs</code>, it must set only the
<code class="literal">nixpkgs.pkgs</code> option.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="tester-nixosTest-parameter" class="title">Parameter   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#tester-nixosTest-parameter" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>A <a class="link" href="https://nixos.org/nixos/manual/index.html#sec-nixos-tests" target="_top">NixOS VM test network</a>, or path to it. Example:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{
  <span class="hljs-attr">name</span> = <span class="hljs-string">"my-test"</span>;
  <span class="hljs-attr">nodes</span> = {
    <span class="hljs-attr">machine1</span> = { lib, pkgs, nodes, ... }: {
      environment.<span class="hljs-attr">systemPackages</span> = [ pkgs.hello ];
      services.foo.<span class="hljs-attr">enable</span> = <span class="hljs-literal">true</span>;
    };
    <span class="hljs-comment"># machine2 = ...;</span>
  };
  <span class="hljs-attr">testScript</span> = <span class="hljs-string">''
    start_all()
    machine1.wait_for_unit("foo.service")
    machine1.succeed("hello | foo-send")
  ''</span>;
}
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="tester-nixosTest-result" class="title">Result   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#tester-nixosTest-result" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>A derivation that runs the VM test.</p><p>Notable attributes:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><code class="literal">nodes</code>: the evaluated NixOS configurations. Useful for debugging and exploring the configuration.</p></li><li class="listitem"><p><code class="literal">driverInteractive</code>: a script that launches an interactive Python session in the context of the <code class="literal">testScript</code>.</p></li></ul></div>
</div>

</div>

</div><div class="chapter"> <div class="titlepage">  <div>   <div>    <h2 id="chap-special" class="title">Special build helpers   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#chap-special" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <p><strong>Table of Contents</strong></p> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-fhs-environments">buildFHSEnv</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs.makeSetupHook">pkgs.makeSetupHook</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-mkShell">pkgs.mkShell</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-vm-tools">vmTools</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-checkpoint-build">pkgs.checkpointBuildTools</a> </span></dt> </dl></div><p>This chapter describes several special build helpers.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-fhs-environments" class="title" style="clear: both">buildFHSEnv   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-fhs-environments" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p><code class="literal">buildFHSEnv</code> provides a way to build and run FHS-compatible lightweight sandboxes. It creates an isolated root filesystem with the host’s <code class="literal">/nix/store</code>, so its footprint in terms of disk space is quite small. This allows you to run software which is hard or unfeasible to patch for NixOS; 3rd-party source trees with FHS assumptions, games distributed as tarballs, software with integrity checking and/or external self-updated binaries for instance.
It uses Linux’ namespaces feature to create temporary lightweight environments which are destroyed after all child processes exit, without requiring elevated privileges. It works similar to containerisation technology such as Docker or FlatPak but provides no security-relevant separation from the host system.</p><p>Accepted arguments are:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">name</code>
The name of the environment and the wrapper executable.</p></li><li class="listitem"><p><code class="literal">targetPkgs</code>
Packages to be installed for the main host’s architecture (i.e. x86_64 on x86_64 installations). Along with libraries binaries are also installed.</p></li><li class="listitem"><p><code class="literal">multiPkgs</code>
Packages to be installed for all architectures supported by a host (i.e. i686 and x86_64 on x86_64 installations). Only libraries are installed by default.</p></li><li class="listitem"><p><code class="literal">multiArch</code>
Whether to install 32bit multiPkgs into the FHSEnv in 64bit environments</p></li><li class="listitem"><p><code class="literal">extraBuildCommands</code>
Additional commands to be executed for finalizing the directory structure.</p></li><li class="listitem"><p><code class="literal">extraBuildCommandsMulti</code>
Like <code class="literal">extraBuildCommands</code>, but executed only on multilib architectures.</p></li><li class="listitem"><p><code class="literal">extraOutputsToInstall</code>
Additional derivation outputs to be linked for both target and multi-architecture packages.</p></li><li class="listitem"><p><code class="literal">extraInstallCommands</code>
Additional commands to be executed for finalizing the derivation with runner script.</p></li><li class="listitem"><p><code class="literal">runScript</code>
A shell command to be executed inside the sandbox. It defaults to <code class="literal">bash</code>. Command line arguments passed to the resulting wrapper are appended to this command by default.
This command must be escaped; i.e. <code class="literal">"foo app" --do-stuff --with "some file"</code>. See <code class="literal">lib.escapeShellArgs</code>.</p></li><li class="listitem"><p><code class="literal">profile</code>
Optional script for <code class="literal">/etc/profile</code> within the sandbox.</p></li></ul></div><p>You can create a simple environment using a <code class="literal">shell.nix</code> like this:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ pkgs ? <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {} }:

(pkgs.buildFHSEnv {
  <span class="hljs-attr">name</span> = <span class="hljs-string">"simple-x11-env"</span>;
  <span class="hljs-attr">targetPkgs</span> = pkgs: (<span class="hljs-keyword">with</span> pkgs; [
    udev
    alsa-lib
  ]) ++ (<span class="hljs-keyword">with</span> pkgs.xorg; [
    libX11
    libXcursor
    libXrandr
  ]);
  <span class="hljs-attr">multiPkgs</span> = pkgs: (<span class="hljs-keyword">with</span> pkgs; [
    udev
    alsa-lib
  ]);
  <span class="hljs-attr">runScript</span> = <span class="hljs-string">"bash"</span>;
}).env
</code></pre><p>Running <code class="literal">nix-shell</code> on it would drop you into a shell inside an FHS env where those libraries and binaries are available in FHS-compliant paths. Applications that expect an FHS structure (i.e. proprietary binaries) can run inside this environment without modification.
You can build a wrapper by running your binary in <code class="literal">runScript</code>, e.g. <code class="literal">./bin/start.sh</code>. Relative paths work as expected.</p><p>Additionally, the FHS builder links all relocated gsettings-schemas (the glib setup-hook moves them to <code class="literal">share/gsettings-schemas/${name}/glib-2.0/schemas</code>) to their standard FHS location. This means you don’t need to wrap binaries with <code class="literal">wrapGAppsHook</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-pkgs.makeSetupHook" class="title" style="clear: both">pkgs.makeSetupHook   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs.makeSetupHook" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs.makeSetupHook-usage">Usage</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs.makeSetupHook-attributes">Attributes</a> </span></dt> </dl></div><p><code class="literal">pkgs.makeSetupHook</code> is a build helper that produces hooks that go in to <code class="literal">nativeBuildInputs</code></p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-pkgs.makeSetupHook-usage" class="title">Usage   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs.makeSetupHook-usage" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">pkgs.makeSetupHook {
  <span class="hljs-attr">name</span> = <span class="hljs-string">"something-hook"</span>;
  <span class="hljs-attr">propagatedBuildInputs</span> = [ pkgs.commandsomething ];
  <span class="hljs-attr">depsTargetTargetPropagated</span> = [ pkgs.libsomething ];
} ./script.sh
</code></pre><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="sec-pkgs.makeSetupHook-usage-example" class="title">setup hook that depends on the hello package and runs hello and @shell@ is substituted with path to bash   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs.makeSetupHook-usage-example" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">pkgs.makeSetupHook {
    <span class="hljs-attr">name</span> = <span class="hljs-string">"run-hello-hook"</span>;
    <span class="hljs-attr">propagatedBuildInputs</span> = [ pkgs.hello ];
    <span class="hljs-attr">substitutions</span> = { <span class="hljs-attr">shell</span> = <span class="hljs-string">"<span class="hljs-subst">${pkgs.bash}</span>/bin/bash"</span>; };
    passthru.tests.<span class="hljs-attr">greeting</span> = callPackage ./test { };
    meta.<span class="hljs-attr">platforms</span> = lib.platforms.linux;
} (writeScript <span class="hljs-string">"run-hello-hook.sh"</span> <span class="hljs-string">''
    #!@shell@
    hello
''</span>)
</code></pre>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-pkgs.makeSetupHook-attributes" class="title">Attributes   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs.makeSetupHook-attributes" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">name</code> Set the name of the hook.</p></li><li class="listitem"><p><code class="literal">propagatedBuildInputs</code> Runtime dependencies (such as binaries) of the hook.</p></li><li class="listitem"><p><code class="literal">depsTargetTargetPropagated</code> Non-binary dependencies.</p></li><li class="listitem"><p><code class="literal">meta</code></p></li><li class="listitem"><p><code class="literal">passthru</code></p></li><li class="listitem"><p><code class="literal">substitutions</code> Variables for <code class="literal">substituteAll</code></p></li></ul></div>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-pkgs-mkShell" class="title" style="clear: both">pkgs.mkShell   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-mkShell" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-mkShell-usage">Usage</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-mkShell-attributes">Attributes</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-mkShell-building">Building the shell</a> </span></dt> </dl></div><p><code class="literal">pkgs.mkShell</code> is a specialized <code class="literal">stdenv.mkDerivation</code> that removes some
repetition when using it with <code class="literal">nix-shell</code> (or <code class="literal">nix develop</code>).</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-pkgs-mkShell-usage" class="title">Usage   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-mkShell-usage" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Here is a common usage example:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ pkgs ? <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {} }:
pkgs.mkShell {
  <span class="hljs-attr">packages</span> = [ pkgs.gnumake ];

  <span class="hljs-attr">inputsFrom</span> = [ pkgs.hello pkgs.gnutar ];

  <span class="hljs-attr">shellHook</span> = <span class="hljs-string">''
    export DEBUG=1
  ''</span>;
}
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-pkgs-mkShell-attributes" class="title">Attributes   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-mkShell-attributes" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">name</code> (default: <code class="literal">nix-shell</code>). Set the name of the derivation.</p></li><li class="listitem"><p><code class="literal">packages</code> (default: <code class="literal">[]</code>). Add executable packages to the <code class="literal">nix-shell</code> environment.</p></li><li class="listitem"><p><code class="literal">inputsFrom</code> (default: <code class="literal">[]</code>). Add build dependencies of the listed derivations to the <code class="literal">nix-shell</code> environment.</p></li><li class="listitem"><p><code class="literal">shellHook</code> (default: <code class="literal">""</code>). Bash statements that are executed by <code class="literal">nix-shell</code>.</p></li></ul></div><p>… all the attributes of <code class="literal">stdenv.mkDerivation</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-pkgs-mkShell-building" class="title">Building the shell   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-mkShell-building" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>This derivation output will contain a text file that contains a reference to
all the build inputs. This is useful in CI where we want to make sure that
every derivation, and its dependencies, build properly. Or when creating a GC
root so that the build dependencies don’t get garbage-collected.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-vm-tools" class="title" style="clear: both">vmTools   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-vm-tools" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#vm-tools-createEmptyImage"><code class="literal">vmTools.createEmptyImage</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#vm-tools-runInLinuxVM"><code class="literal">vmTools.runInLinuxVM</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#vm-tools-extractFs"><code class="literal">vmTools.extractFs</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#vm-tools-extractMTDfs"><code class="literal">vmTools.extractMTDfs</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#vm-tools-runInLinuxImage"><code class="literal">vmTools.runInLinuxImage</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#vm-tools-makeImageTestScript"><code class="literal">vmTools.makeImageTestScript</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#vm-tools-diskImageFuns"><code class="literal">vmTools.diskImageFuns</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#vm-tools-diskImageExtraFuns"><code class="literal">vmTools.diskImageExtraFuns</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#vm-tools-diskImages"><code class="literal">vmTools.diskImages</code></a> </span></dt> </dl></div><p>A set of VM related utilities, that help in building some packages in more advanced scenarios.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="vm-tools-createEmptyImage" class="title"><code class="literal">vmTools.createEmptyImage</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#vm-tools-createEmptyImage" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>A bash script fragment that produces a disk image at <code class="literal">destination</code>.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="vm-tools-createEmptyImage-attributes" class="title">Attributes   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#vm-tools-createEmptyImage-attributes" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">size</code>. The disk size, in MiB.</p></li><li class="listitem"><p><code class="literal">fullName</code>. Name that will be written to <code class="literal">${destination}/nix-support/full-name</code>.</p></li><li class="listitem"><p><code class="literal">destination</code> (optional, default <code class="literal">$out</code>). Where to write the image files.</p></li></ul></div>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="vm-tools-runInLinuxVM" class="title"><code class="literal">vmTools.runInLinuxVM</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#vm-tools-runInLinuxVM" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Run a derivation in a Linux virtual machine (using Qemu/KVM).
By default, there is no disk image; the root filesystem is a <code class="literal">tmpfs</code>, and the Nix store is shared with the host (via the <a class="link" href="https://wiki.qemu.org/Documentation/9p#9p_Protocol" target="_top">9P protocol</a>).
Thus, any pure Nix derivation should run unmodified.</p><p>If the build fails and Nix is run with the <code class="literal">-K/--keep-failed</code> option, a script <code class="literal">run-vm</code> will be left behind in the temporary build directory that allows you to boot into the VM and debug it interactively.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="vm-tools-runInLinuxVM-attributes" class="title">Attributes   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#vm-tools-runInLinuxVM-attributes" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">preVM</code> (optional). Shell command to be evaluated <span class="emphasis"><em>before</em></span> the VM is started (i.e., on the host).</p></li><li class="listitem"><p><code class="literal">memSize</code> (optional, default <code class="literal">512</code>). The memory size of the VM in MiB.</p></li><li class="listitem"><p><code class="literal">diskImage</code> (optional). A file system image to be attached to <code class="literal">/dev/sda</code>.
Note that currently we expect the image to contain a filesystem, not a full disk image with a partition table etc.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="vm-tools-runInLinuxVM-examples" class="title">Examples   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#vm-tools-runInLinuxVM-examples" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Build the derivation hello inside a VM:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ pkgs }: <span class="hljs-keyword">with</span> pkgs; <span class="hljs-keyword">with</span> vmTools;
runInLinuxVM hello
</code></pre><p>Build inside a VM with extra memory:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ pkgs }: <span class="hljs-keyword">with</span> pkgs; <span class="hljs-keyword">with</span> vmTools;
runInLinuxVM (hello.overrideAttrs (_: { <span class="hljs-attr">memSize</span> = <span class="hljs-number">1024</span>; }))
</code></pre><p>Use VM with a disk image (implicitly sets <code class="literal">diskImage</code>, see <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#vm-tools-createEmptyImage" title="vmTools.createEmptyImage"><code class="literal">vmTools.createEmptyImage</code></a>):</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ pkgs }: <span class="hljs-keyword">with</span> pkgs; <span class="hljs-keyword">with</span> vmTools;
runInLinuxVM (hello.overrideAttrs (_: {
  <span class="hljs-attr">preVM</span> = createEmptyImage {
    <span class="hljs-attr">size</span> = <span class="hljs-number">1024</span>;
    <span class="hljs-attr">fullName</span> = <span class="hljs-string">"vm-image"</span>;
  };
}))
</code></pre>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="vm-tools-extractFs" class="title"><code class="literal">vmTools.extractFs</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#vm-tools-extractFs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Takes a file, such as an ISO, and extracts its contents into the store.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="vm-tools-extractFs-attributes" class="title">Attributes   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#vm-tools-extractFs-attributes" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">file</code>. Path to the file to be extracted.
Note that currently we expect the image to contain a filesystem, not a full disk image with a partition table etc.</p></li><li class="listitem"><p><code class="literal">fs</code> (optional). Filesystem of the contents of the file.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="vm-tools-extractFs-examples" class="title">Examples   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#vm-tools-extractFs-examples" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Extract the contents of an ISO file:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ pkgs }: <span class="hljs-keyword">with</span> pkgs; <span class="hljs-keyword">with</span> vmTools;
extractFs { <span class="hljs-attr">file</span> = ./image.iso; }
</code></pre>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="vm-tools-extractMTDfs" class="title"><code class="literal">vmTools.extractMTDfs</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#vm-tools-extractMTDfs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Like <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#vm-tools-extractFs" title="vmTools.extractFs">the section called “<code class="literal">vmTools.extractFs</code>”</a>, but it makes use of a <a class="link" href="https://en.wikipedia.org/wiki/Memory_Technology_Device" target="_top">Memory Technology Device (MTD)</a>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="vm-tools-runInLinuxImage" class="title"><code class="literal">vmTools.runInLinuxImage</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#vm-tools-runInLinuxImage" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Like <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#vm-tools-runInLinuxVM" title="vmTools.runInLinuxVM">the section called “<code class="literal">vmTools.runInLinuxVM</code>”</a>, but instead of using <code class="literal">stdenv</code> from the Nix store, run the build using the tools provided by <code class="literal">/bin</code>, <code class="literal">/usr/bin</code>, etc. from the specified filesystem image, which typically is a filesystem containing a <a class="link" href="https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard" target="_top">FHS</a>-based Linux distribution.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="vm-tools-makeImageTestScript" class="title"><code class="literal">vmTools.makeImageTestScript</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#vm-tools-makeImageTestScript" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Generate a script that can be used to run an interactive session in the given image.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="vm-tools-makeImageTestScript-examples" class="title">Examples   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#vm-tools-makeImageTestScript-examples" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Create a script for running a Fedora 27 VM:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ pkgs }: <span class="hljs-keyword">with</span> pkgs; <span class="hljs-keyword">with</span> vmTools;
makeImageTestScript diskImages.fedora27x86_64
</code></pre><p>Create a script for running an Ubuntu 20.04 VM:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ pkgs }: <span class="hljs-keyword">with</span> pkgs; <span class="hljs-keyword">with</span> vmTools;
makeImageTestScript diskImages.ubuntu2004x86_64
</code></pre>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="vm-tools-diskImageFuns" class="title"><code class="literal">vmTools.diskImageFuns</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#vm-tools-diskImageFuns" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>A set of functions that build a predefined set of minimal Linux distributions images.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="vm-tools-diskImageFuns-images" class="title">Images   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#vm-tools-diskImageFuns-images" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>Fedora</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p><code class="literal">fedora26x86_64</code></p></li><li class="listitem"><p><code class="literal">fedora27x86_64</code></p></li></ul></div></li><li class="listitem"><p>CentOS</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p><code class="literal">centos6i386</code></p></li><li class="listitem"><p><code class="literal">centos6x86_64</code></p></li><li class="listitem"><p><code class="literal">centos7x86_64</code></p></li></ul></div></li><li class="listitem"><p>Ubuntu</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p><code class="literal">ubuntu1404i386</code></p></li><li class="listitem"><p><code class="literal">ubuntu1404x86_64</code></p></li><li class="listitem"><p><code class="literal">ubuntu1604i386</code></p></li><li class="listitem"><p><code class="literal">ubuntu1604x86_64</code></p></li><li class="listitem"><p><code class="literal">ubuntu1804i386</code></p></li><li class="listitem"><p><code class="literal">ubuntu1804x86_64</code></p></li><li class="listitem"><p><code class="literal">ubuntu2004i386</code></p></li><li class="listitem"><p><code class="literal">ubuntu2004x86_64</code></p></li><li class="listitem"><p><code class="literal">ubuntu2204i386</code></p></li><li class="listitem"><p><code class="literal">ubuntu2204x86_64</code></p></li></ul></div></li><li class="listitem"><p>Debian</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p><code class="literal">debian10i386</code></p></li><li class="listitem"><p><code class="literal">debian10x86_64</code></p></li><li class="listitem"><p><code class="literal">debian11i386</code></p></li><li class="listitem"><p><code class="literal">debian11x86_64</code></p></li></ul></div></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="vm-tools-diskImageFuns-attributes" class="title">Attributes   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#vm-tools-diskImageFuns-attributes" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">size</code> (optional, defaults to <code class="literal">4096</code>). The size of the image, in MiB.</p></li><li class="listitem"><p><code class="literal">extraPackages</code> (optional). A list names of additional packages from the distribution that should be included in the image.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="vm-tools-diskImageFuns-examples" class="title">Examples   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#vm-tools-diskImageFuns-examples" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>8GiB image containing Firefox in addition to the default packages:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ pkgs }: <span class="hljs-keyword">with</span> pkgs; <span class="hljs-keyword">with</span> vmTools;
diskImageFuns.ubuntu2004x86_64 { <span class="hljs-attr">extraPackages</span> = [ <span class="hljs-string">"firefox"</span> ]; <span class="hljs-attr">size</span> = <span class="hljs-number">8192</span>; }
</code></pre>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="vm-tools-diskImageExtraFuns" class="title"><code class="literal">vmTools.diskImageExtraFuns</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#vm-tools-diskImageExtraFuns" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Shorthand for <code class="literal">vmTools.diskImageFuns.&lt;attr&gt; { extraPackages = ... }</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="vm-tools-diskImages" class="title"><code class="literal">vmTools.diskImages</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#vm-tools-diskImages" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Shorthand for <code class="literal">vmTools.diskImageFuns.&lt;attr&gt; { }</code>.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-checkpoint-build" class="title" style="clear: both">pkgs.checkpointBuildTools   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-checkpoint-build" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-checkpoint-build-example">Example</a> </span></dt> </dl></div><p><code class="literal">pkgs.checkpointBuildTools</code> provides a way to build derivations incrementally. It consists of two functions to make checkpoint builds using Nix possible.</p><p>For hermeticity, Nix derivations do not allow any state to be carried over between builds, making a transparent incremental build within a derivation impossible.</p><p>However, we can tell Nix explicitly what the previous build state was, by representing that previous state as a derivation output. This allows the passed build state to be used for an incremental build.</p><p>To change a normal derivation to a checkpoint based build, these steps must be taken:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>apply <code class="literal">prepareCheckpointBuild</code> on the desired derivation, e.g.</p></li></ul></div><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">checkpointArtifacts</span> = (pkgs.checkpointBuildTools.prepareCheckpointBuild pkgs.virtualbox);
</code></pre><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>change something you want in the sources of the package, e.g. use a source override:</p></li></ul></div><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">changedVBox</span> = pkgs.virtualbox.overrideAttrs (old: {
  <span class="hljs-attr">src</span> = path/to/vbox/sources;
});
</code></pre><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>use <code class="literal">mkCheckpointBuild changedVBox checkpointArtifacts</code></p></li><li class="listitem"><p>enjoy shorter build times</p></li></ul></div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-checkpoint-build-example" class="title">Example   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-checkpoint-build-example" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ pkgs ? <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {} }:
<span class="hljs-keyword">let</span>
  <span class="hljs-keyword">inherit</span> (pkgs.checkpointBuildTools)
    prepareCheckpointBuild
    mkCheckpointBuild
    ;
  <span class="hljs-attr">helloCheckpoint</span> = prepareCheckpointBuild pkgs.hello;
  <span class="hljs-attr">changedHello</span> = pkgs.hello.overrideAttrs (_: {
    <span class="hljs-attr">doCheck</span> = <span class="hljs-literal">false</span>;
    <span class="hljs-attr">patchPhase</span> = <span class="hljs-string">''
      sed -i 's/Hello, world!/Hello, Nix!/g' src/hello.c
    ''</span>;
  });
<span class="hljs-keyword">in</span> mkCheckpointBuild changedHello helloCheckpoint
</code></pre>
</div>

</div>
</div><div class="chapter"> <div class="titlepage">  <div>   <div>    <h2 id="chap-images" class="title">Images   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#chap-images" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <p><strong>Table of Contents</strong></p> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-appimageTools">pkgs.appimageTools</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-dockerTools">pkgs.dockerTools</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-ociTools">pkgs.ociTools</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-snapTools">pkgs.snapTools</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-portableService">pkgs.portableService</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-make-disk-image"><code class="literal">&lt;nixpkgs/nixos/lib/make-disk-image.nix&gt;</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-binary-cache">pkgs.mkBinaryCache</a> </span></dt> </dl></div><p>This chapter describes tools for creating various types of images.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-pkgs-appimageTools" class="title" style="clear: both">pkgs.appimageTools   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-appimageTools" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-pkgs-appimageTools-formats">AppImage formats</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-pkgs-appimageTools-wrapping">Wrapping</a> </span></dt> </dl></div><p><code class="literal">pkgs.appimageTools</code> is a set of functions for extracting and wrapping <a class="link" href="https://appimage.org/" target="_top">AppImage</a> files. They are meant to be used if traditional packaging from source is infeasible, or it would take too long. To quickly run an AppImage file, <code class="literal">pkgs.appimage-run</code> can be used as well.</p><div class="warning"><h3 class="title">Warning</h3><p>The <code class="literal">appimageTools</code> API is unstable and may be subject to backwards-incompatible changes in the future.</p></div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-pkgs-appimageTools-formats" class="title">AppImage formats   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-pkgs-appimageTools-formats" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>There are different formats for AppImages, see <a class="link" href="https://github.com/AppImage/AppImageSpec/blob/74ad9ca2f94bf864a4a0dac1f369dd4f00bd1c28/draft.md#image-format" target="_top">the specification</a> for details.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>Type 1 images are ISO 9660 files that are also ELF executables.</p></li><li class="listitem"><p>Type 2 images are ELF executables with an appended filesystem.</p></li></ul></div><p>They can be told apart with <code class="literal">file -k</code>:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">file -k type1.AppImage</span>
type1.AppImage: ELF 64-bit LSB executable, x86-64, version 1 (SYSV) ISO 9660 CD-ROM filesystem data 'AppImage' (Lepton 3.x), scale 0-0,
spot sensor temperature 0.000000, unit celsius, color scheme 0, calibration: offset 0.000000, slope 0.000000, dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 2.6.18, BuildID[sha1]=d629f6099d2344ad82818172add1d38c5e11bc6d, stripped\012- data
<span class="hljs-meta prompt_">
$ </span><span class="language-bash">file -k type2.AppImage</span>
type2.AppImage: ELF 64-bit LSB executable, x86-64, version 1 (SYSV) (Lepton 3.x), scale 232-60668, spot sensor temperature -4.187500, color scheme 15, show scale bar, calibration: offset -0.000000, slope 0.000000 (Lepton 2.x), scale 4111-45000, spot sensor temperature 412442.250000, color scheme 3, minimum point enabled, calibration: offset -75402534979642766821519867692934234112.000000, slope 5815371847733706829839455140374904832.000000, dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 2.6.18, BuildID[sha1]=79dcc4e55a61c293c5e19edbd8d65b202842579f, stripped\012- data
</code></pre><p>Note how the type 1 AppImage is described as an <code class="literal">ISO 9660 CD-ROM filesystem</code>, and the type 2 AppImage is not.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-pkgs-appimageTools-wrapping" class="title">Wrapping   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-pkgs-appimageTools-wrapping" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Depending on the type of AppImage you’re wrapping, you’ll have to use <code class="literal">wrapType1</code> or <code class="literal">wrapType2</code>.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">appimageTools.wrapType2 { <span class="hljs-comment"># or wrapType1</span>
  <span class="hljs-attr">name</span> = <span class="hljs-string">"patchwork"</span>;
  <span class="hljs-attr">src</span> = fetchurl {
    <span class="hljs-attr">url</span> = <span class="hljs-string">"https://github.com/ssbc/patchwork/releases/download/v3.11.4/Patchwork-3.11.4-linux-x86_64.AppImage"</span>;
    <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-OqTitCeZ6xmWbqYTXp8sDrmVgTNjPZNW0hzUPW++mq4="</span>;
  };
  <span class="hljs-attr">extraPkgs</span> = pkgs: <span class="hljs-keyword">with</span> pkgs; [ ];
}
</code></pre><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">name</code> specifies the name of the resulting image.</p></li><li class="listitem"><p><code class="literal">src</code> specifies the AppImage file to extract.</p></li><li class="listitem"><p><code class="literal">extraPkgs</code> allows you to pass a function to include additional packages inside the FHS environment your AppImage is going to run in. There are a few ways to learn which dependencies an application needs:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>Looking through the extracted AppImage files, reading its scripts and running <code class="literal">patchelf</code> and <code class="literal">ldd</code> on its executables. This can also be done in <code class="literal">appimage-run</code>, by setting <code class="literal">APPIMAGE_DEBUG_EXEC=bash</code>.</p></li><li class="listitem"><p>Running <code class="literal">strace -vfefile</code> on the wrapped executable, looking for libraries that can’t be found.</p></li></ul></div></li></ul></div>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-pkgs-dockerTools" class="title" style="clear: both">pkgs.dockerTools   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-dockerTools" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-pkgs-dockerTools-buildImage">buildImage</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-pkgs-dockerTools-buildLayeredImage">buildLayeredImage</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-pkgs-dockerTools-streamLayeredImage">streamLayeredImage</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-pkgs-dockerTools-fetchFromRegistry">pullImage</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-pkgs-dockerTools-exportImage">exportImage</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-pkgs-dockerTools-helpers">Environment Helpers</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-pkgs-dockerTools-fakeNss">fakeNss</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-pkgs-dockerTools-buildNixShellImage">buildNixShellImage</a> </span></dt> </dl></div><p><code class="literal">pkgs.dockerTools</code> is a set of functions for creating and manipulating Docker images according to the <a class="link" href="https://github.com/moby/moby/blob/master/image/spec/v1.2.md#docker-image-specification-v120" target="_top">Docker Image Specification v1.2.0</a>. Docker itself is not used to perform any of the operations done by these functions.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-pkgs-dockerTools-buildImage" class="title">buildImage   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-pkgs-dockerTools-buildImage" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>This function is analogous to the <code class="literal">docker build</code> command, in that it can be used to build a Docker-compatible repository tarball containing a single image with one or multiple layers. As such, the result is suitable for being loaded in Docker with <code class="literal">docker load</code>.</p><p>The parameters of <code class="literal">buildImage</code> with relative example values are described below:</p><p><span id="ex-dockerTools-buildImage"></span>
<span id="ex-dockerTools-buildImage-runAsRoot"></span></p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">buildImage {
  <span class="hljs-attr">name</span> = <span class="hljs-string">"redis"</span>;
  <span class="hljs-attr">tag</span> = <span class="hljs-string">"latest"</span>;

  <span class="hljs-attr">fromImage</span> = someBaseImage;
  <span class="hljs-attr">fromImageName</span> = <span class="hljs-literal">null</span>;
  <span class="hljs-attr">fromImageTag</span> = <span class="hljs-string">"latest"</span>;

  <span class="hljs-attr">copyToRoot</span> = pkgs.buildEnv {
    <span class="hljs-attr">name</span> = <span class="hljs-string">"image-root"</span>;
    <span class="hljs-attr">paths</span> = [ pkgs.redis ];
    <span class="hljs-attr">pathsToLink</span> = [ <span class="hljs-string">"/bin"</span> ];
  };

  <span class="hljs-attr">runAsRoot</span> = <span class="hljs-string">''
    #!<span class="hljs-subst">${pkgs.runtimeShell}</span>
    mkdir -p /data
  ''</span>;

  <span class="hljs-attr">config</span> = {
    <span class="hljs-attr">Cmd</span> = [ <span class="hljs-string">"/bin/redis-server"</span> ];
    <span class="hljs-attr">WorkingDir</span> = <span class="hljs-string">"/data"</span>;
    <span class="hljs-attr">Volumes</span> = { <span class="hljs-string">"/data"</span> = { }; };
  };

  <span class="hljs-attr">diskSize</span> = <span class="hljs-number">1024</span>;
  <span class="hljs-attr">buildVMMemorySize</span> = <span class="hljs-number">512</span>;
}
</code></pre><p>The above example will build a Docker image <code class="literal">redis/latest</code> from the given base image. Loading and running this image in Docker results in <code class="literal">redis-server</code> being started automatically.</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><code class="literal">name</code> specifies the name of the resulting image. This is the only required argument for <code class="literal">buildImage</code>.</p></li><li class="listitem"><p><code class="literal">tag</code> specifies the tag of the resulting image. By default it’s <code class="literal">null</code>, which indicates that the nix output hash will be used as tag.</p></li><li class="listitem"><p><code class="literal">fromImage</code> is the repository tarball containing the base image. It must be a valid Docker image, such as exported by <code class="literal">docker save</code>. By default it’s <code class="literal">null</code>, which can be seen as equivalent to <code class="literal">FROM scratch</code> of a <code class="literal">Dockerfile</code>.</p></li><li class="listitem"><p><code class="literal">fromImageName</code> can be used to further specify the base image within the repository, in case it contains multiple images. By default it’s <code class="literal">null</code>, in which case <code class="literal">buildImage</code> will peek the first image available in the repository.</p></li><li class="listitem"><p><code class="literal">fromImageTag</code> can be used to further specify the tag of the base image within the repository, in case an image contains multiple tags. By default it’s <code class="literal">null</code>, in which case <code class="literal">buildImage</code> will peek the first tag available for the base image.</p></li><li class="listitem"><p><code class="literal">copyToRoot</code> is a derivation that will be copied in the new layer of the resulting image. This can be similarly seen as <code class="literal">ADD contents/ /</code> in a <code class="literal">Dockerfile</code>. By default it’s <code class="literal">null</code>.</p></li><li class="listitem"><p><code class="literal">runAsRoot</code> is a bash script that will run as root in an environment that overlays the existing layers of the base image with the new resulting layer, including the previously copied <code class="literal">contents</code> derivation. This can be similarly seen as <code class="literal">RUN ...</code> in a <code class="literal">Dockerfile</code>.</p></li></ul></div><div class="blockquote"><blockquote class="blockquote"><p><span class="strong"><strong><span class="emphasis"><em>NOTE:</em></span></strong></span> Using this parameter requires the <code class="literal">kvm</code> device to be available.</p></blockquote></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><code class="literal">config</code> is used to specify the configuration of the containers that will be started off the built image in Docker. The available options are listed in the <a class="link" href="https://github.com/moby/moby/blob/master/image/spec/v1.2.md#image-json-field-descriptions" target="_top">Docker Image Specification v1.2.0</a>.</p></li><li class="listitem"><p><code class="literal">architecture</code> is <span class="emphasis"><em>optional</em></span> and used to specify the image architecture, this is useful for multi-architecture builds that don’t need cross compiling. If not specified it will default to <code class="literal">hostPlatform</code>.</p></li><li class="listitem"><p><code class="literal">diskSize</code> is used to specify the disk size of the VM used to build the image in megabytes. By default it’s 1024 MiB.</p></li><li class="listitem"><p><code class="literal">buildVMMemorySize</code> is used to specify the memory size of the VM to build the image in megabytes. By default it’s 512 MiB.</p></li></ul></div><p>After the new layer has been created, its closure (to which <code class="literal">contents</code>, <code class="literal">config</code> and <code class="literal">runAsRoot</code> contribute) will be copied in the layer itself. Only new dependencies that are not already in the existing layers will be copied.</p><p>At the end of the process, only one new single layer will be produced and added to the resulting image.</p><p>The resulting repository will only list the single image <code class="literal">image/tag</code>. In the case of <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ex-dockerTools-buildImage">the <code class="literal">buildImage</code> example</a>, it would be <code class="literal">redis/latest</code>.</p><p>It is possible to inspect the arguments with which an image was built using its <code class="literal">buildArgs</code> attribute.</p><div class="blockquote"><blockquote class="blockquote"><p><span class="strong"><strong><span class="emphasis"><em>NOTE:</em></span></strong></span> If you see errors similar to <code class="literal">getProtocolByName: does not exist (no such protocol name: tcp)</code> you may need to add <code class="literal">pkgs.iana-etc</code> to <code class="literal">contents</code>.</p></blockquote></div><div class="blockquote"><blockquote class="blockquote"><p><span class="strong"><strong><span class="emphasis"><em>NOTE:</em></span></strong></span> If you see errors similar to <code class="literal">Error_Protocol ("certificate has unknown CA",True,UnknownCa)</code> you may need to add <code class="literal">pkgs.cacert</code> to <code class="literal">contents</code>.</p></blockquote></div><p>By default <code class="literal">buildImage</code> will use a static date of one second past the UNIX Epoch. This allows <code class="literal">buildImage</code> to produce binary reproducible images. When listing images with <code class="literal">docker images</code>, the newly created images will be listed like this:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker images</span>
REPOSITORY   TAG      IMAGE ID       CREATED        SIZE
hello        latest   08c791c7846e   48 years ago   25.2MB
</code></pre><p>You can break binary reproducibility but have a sorted, meaningful <code class="literal">CREATED</code> column by setting <code class="literal">created</code> to <code class="literal">now</code>.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">pkgs.dockerTools.buildImage {
  <span class="hljs-attr">name</span> = <span class="hljs-string">"hello"</span>;
  <span class="hljs-attr">tag</span> = <span class="hljs-string">"latest"</span>;
  <span class="hljs-attr">created</span> = <span class="hljs-string">"now"</span>;
  <span class="hljs-attr">copyToRoot</span> = pkgs.buildEnv {
    <span class="hljs-attr">name</span> = <span class="hljs-string">"image-root"</span>;
    <span class="hljs-attr">paths</span> = [ pkgs.hello ];
    <span class="hljs-attr">pathsToLink</span> = [ <span class="hljs-string">"/bin"</span> ];
  };

  config.<span class="hljs-attr">Cmd</span> = [ <span class="hljs-string">"/bin/hello"</span> ];
}
</code></pre><p>Now the Docker CLI will display a reasonable date and sort the images as expected:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker images</span>
REPOSITORY   TAG      IMAGE ID       CREATED              SIZE
hello        latest   de2bf4786de6   About a minute ago   25.2MB
</code></pre><p>However, the produced images will not be binary reproducible.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-pkgs-dockerTools-buildLayeredImage" class="title">buildLayeredImage   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-pkgs-dockerTools-buildLayeredImage" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Create a Docker image with many of the store paths being on their own layer to improve sharing between images. The image is realized into the Nix store as a gzipped tarball. Depending on the intended usage, many users might prefer to use <code class="literal">streamLayeredImage</code> instead, which this function uses internally.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">name</code></span></dt><dd><p>The name of the resulting image.</p></dd><dt><span class="term"><code class="literal">tag</code> <span class="emphasis"><em>optional</em></span></span></dt><dd><p>Tag of the generated image.</p><p><span class="emphasis"><em>Default:</em></span> the output path’s hash</p></dd><dt><span class="term"><code class="literal">fromImage</code> <span class="emphasis"><em>optional</em></span></span></dt><dd><p>The repository tarball containing the base image. It must be a valid Docker image, such as one exported by <code class="literal">docker save</code>.</p><p><span class="emphasis"><em>Default:</em></span> <code class="literal">null</code>, which can be seen as equivalent to <code class="literal">FROM scratch</code> of a <code class="literal">Dockerfile</code>.</p></dd><dt><span class="term"><code class="literal">contents</code> <span class="emphasis"><em>optional</em></span></span></dt><dd><p>Top-level paths in the container. Either a single derivation, or a list of derivations.</p><p><span class="emphasis"><em>Default:</em></span> <code class="literal">[]</code></p></dd></dl></div><p><code class="literal">config</code> <span class="emphasis"><em>optional</em></span></p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">architecture</code> is <span class="emphasis"><em>optional</em></span> and used to specify the image architecture, this is useful for multi-architecture builds that don’t need cross compiling. If not specified it will default to <code class="literal">hostPlatform</code>.</span></dt><dd><p>Run-time configuration of the container. A full list of the options available is in the <a class="link" href="https://github.com/moby/moby/blob/master/image/spec/v1.2.md#image-json-field-descriptions" target="_top">Docker Image Specification v1.2.0</a>.</p><p><span class="emphasis"><em>Default:</em></span> <code class="literal">{}</code></p></dd><dt><span class="term"><code class="literal">created</code> <span class="emphasis"><em>optional</em></span></span></dt><dd><p>Date and time the layers were created. Follows the same <code class="literal">now</code> exception supported by <code class="literal">buildImage</code>.</p><p><span class="emphasis"><em>Default:</em></span> <code class="literal">1970-01-01T00:00:01Z</code></p></dd><dt><span class="term"><code class="literal">maxLayers</code> <span class="emphasis"><em>optional</em></span></span></dt><dd><p>Maximum number of layers to create.</p><p><span class="emphasis"><em>Default:</em></span> <code class="literal">100</code></p><p><span class="emphasis"><em>Maximum:</em></span> <code class="literal">125</code></p></dd><dt><span class="term"><code class="literal">extraCommands</code> <span class="emphasis"><em>optional</em></span></span></dt><dd><p>Shell commands to run while building the final layer, without access to most of the layer contents. Changes to this layer are “on top” of all the other layers, so can create additional directories and files.</p></dd><dt><span class="term"><code class="literal">fakeRootCommands</code> <span class="emphasis"><em>optional</em></span></span></dt><dd><p>Shell commands to run while creating the archive for the final layer in a fakeroot environment. Unlike <code class="literal">extraCommands</code>, you can run <code class="literal">chown</code> to change the owners of the files in the archive, changing fakeroot’s state instead of the real filesystem. The latter would require privileges that the build user does not have. Static binaries do not interact with the fakeroot environment. By default all files in the archive will be owned by root.</p></dd><dt><span class="term"><code class="literal">enableFakechroot</code> <span class="emphasis"><em>optional</em></span></span></dt><dd><p>Whether to run in <code class="literal">fakeRootCommands</code> in <code class="literal">fakechroot</code>, making programs behave as though <code class="literal">/</code> is the root of the image being created, while files in the Nix store are available as usual. This allows scripts that perform installation in <code class="literal">/</code> to work as expected. Considering that <code class="literal">fakechroot</code> is implemented via the same mechanism as <code class="literal">fakeroot</code>, the same caveats apply.</p><p><span class="emphasis"><em>Default:</em></span> <code class="literal">false</code></p></dd></dl></div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="dockerTools-buildLayeredImage-arg-contents" class="title">Behavior of <code class="literal">contents</code> in the final image   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#dockerTools-buildLayeredImage-arg-contents" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Each path directly listed in <code class="literal">contents</code> will have a symlink in the root of the image.</p><p>For example:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">pkgs.dockerTools.buildLayeredImage {
  <span class="hljs-attr">name</span> = <span class="hljs-string">"hello"</span>;
  <span class="hljs-attr">contents</span> = [ pkgs.hello ];
}
</code></pre><p>will create symlinks for all the paths in the <code class="literal">hello</code> package:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes">/bin/hello -&gt; /nix/store/h1zb1padqbbb7jicsvkmrym3r6snphxg-hello-2.10/bin/hello
/share/info/hello.info -&gt; /nix/store/h1zb1padqbbb7jicsvkmrym3r6snphxg-hello-2.10/share/info/hello.info
/share/locale/bg/LC_MESSAGES/hello.mo -&gt; /nix/store/h1zb1padqbbb7jicsvkmrym3r6snphxg-hello-2.10/share/locale/bg/LC_MESSAGES/hello.mo
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="dockerTools-buildLayeredImage-arg-config" class="title">Automatic inclusion of <code class="literal">config</code> references   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#dockerTools-buildLayeredImage-arg-config" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>The closure of <code class="literal">config</code> is automatically included in the closure of the final image.</p><p>This allows you to make very simple Docker images with very little code. This container will start up and run <code class="literal">hello</code>:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">pkgs.dockerTools.buildLayeredImage {
  <span class="hljs-attr">name</span> = <span class="hljs-string">"hello"</span>;
  config.<span class="hljs-attr">Cmd</span> = [ <span class="hljs-string">"<span class="hljs-subst">${pkgs.hello}</span>/bin/hello"</span> ];
}
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="dockerTools-buildLayeredImage-arg-maxLayers" class="title">Adjusting <code class="literal">maxLayers</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#dockerTools-buildLayeredImage-arg-maxLayers" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Increasing the <code class="literal">maxLayers</code> increases the number of layers which have a chance to be shared between different images.</p><p>Modern Docker installations support up to 128 layers, but older versions support as few as 42.</p><p>If the produced image will not be extended by other Docker builds, it is safe to set <code class="literal">maxLayers</code> to <code class="literal">128</code>. However, it will be impossible to extend the image further.</p><p>The first (<code class="literal">maxLayers-2</code>) most “popular” paths will have their own individual layers, then layer #<code class="literal">maxLayers-1</code> will contain all the remaining “unpopular” paths, and finally layer #<code class="literal">maxLayers</code> will contain the Image configuration.</p><p>Docker’s Layers are not inherently ordered, they are content-addressable and are not explicitly layered until they are composed in to an Image.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-pkgs-dockerTools-streamLayeredImage" class="title">streamLayeredImage   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-pkgs-dockerTools-streamLayeredImage" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Builds a script which, when run, will stream an uncompressed tarball of a Docker image to stdout. The arguments to this function are as for <code class="literal">buildLayeredImage</code>. This method of constructing an image does not realize the image into the Nix store, so it saves on IO and disk/cache space, particularly with large images.</p><p>The image produced by running the output script can be piped directly into <code class="literal">docker load</code>, to load it into the local docker daemon:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$</span><span class="language-bash">(nix-build) | docker load</span>
</code></pre><p>Alternatively, the image be piped via <code class="literal">gzip</code> into <code class="literal">skopeo</code>, e.g., to copy it into a registry:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$</span><span class="language-bash">(nix-build) | gzip --fast | skopeo copy docker-archive:/dev/stdin docker://some_docker_registry/myimage:tag</span>
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-pkgs-dockerTools-fetchFromRegistry" class="title">pullImage   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-pkgs-dockerTools-fetchFromRegistry" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>This function is analogous to the <code class="literal">docker pull</code> command, in that it can be used to pull a Docker image from a Docker registry. By default <a class="link" href="https://hub.docker.com/" target="_top">Docker Hub</a> is used to pull images.</p><p>Its parameters are described in the example below:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">pullImage {
  <span class="hljs-attr">imageName</span> = <span class="hljs-string">"nixos/nix"</span>;
  <span class="hljs-attr">imageDigest</span> =
    <span class="hljs-string">"sha256:473a2b527958665554806aea24d0131bacec46d23af09fef4598eeab331850fa"</span>;
  <span class="hljs-attr">finalImageName</span> = <span class="hljs-string">"nix"</span>;
  <span class="hljs-attr">finalImageTag</span> = <span class="hljs-string">"2.11.1"</span>;
  <span class="hljs-attr">sha256</span> = <span class="hljs-string">"sha256-qvhj+Hlmviz+KEBVmsyPIzTB3QlVAFzwAY1zDPIBGxc="</span>;
  <span class="hljs-attr">os</span> = <span class="hljs-string">"linux"</span>;
  <span class="hljs-attr">arch</span> = <span class="hljs-string">"x86_64"</span>;
}
</code></pre><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><code class="literal">imageName</code> specifies the name of the image to be downloaded, which can also include the registry namespace (e.g. <code class="literal">nixos</code>). This argument is required.</p></li><li class="listitem"><p><code class="literal">imageDigest</code> specifies the digest of the image to be downloaded. This argument is required.</p></li><li class="listitem"><p><code class="literal">finalImageName</code>, if specified, this is the name of the image to be created. Note it is never used to fetch the image since we prefer to rely on the immutable digest ID. By default it’s equal to <code class="literal">imageName</code>.</p></li><li class="listitem"><p><code class="literal">finalImageTag</code>, if specified, this is the tag of the image to be created. Note it is never used to fetch the image since we prefer to rely on the immutable digest ID. By default it’s <code class="literal">latest</code>.</p></li><li class="listitem"><p><code class="literal">sha256</code> is the checksum of the whole fetched image. This argument is required.</p></li><li class="listitem"><p><code class="literal">os</code>, if specified, is the operating system of the fetched image. By default it’s <code class="literal">linux</code>.</p></li><li class="listitem"><p><code class="literal">arch</code>, if specified, is the cpu architecture of the fetched image. By default it’s <code class="literal">x86_64</code>.</p></li></ul></div><p><code class="literal">nix-prefetch-docker</code> command can be used to get required image parameters:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">nix run nixpkgs#nix-prefetch-docker -- --image-name mysql --image-tag 5</span>
</code></pre><p>Since a given <code class="literal">imageName</code> may transparently refer to a manifest list of images which support multiple architectures and/or operating systems, you can supply the <code class="literal">--os</code> and <code class="literal">--arch</code> arguments to specify exactly which image you want. By default it will match the OS and architecture of the host the command is run on.</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">nix-prefetch-docker --image-name mysql --image-tag 5 --<span class="hljs-built_in">arch</span> x86_64 --os linux</span>
</code></pre><p>Desired image name and tag can be set using <code class="literal">--final-image-name</code> and <code class="literal">--final-image-tag</code> arguments:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">nix-prefetch-docker --image-name mysql --image-tag 5 --final-image-name eu.gcr.io/my-project/mysql --final-image-tag prod</span>
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-pkgs-dockerTools-exportImage" class="title">exportImage   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-pkgs-dockerTools-exportImage" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>This function is analogous to the <code class="literal">docker export</code> command, in that it can be used to flatten a Docker image that contains multiple layers. It is in fact the result of the merge of all the layers of the image. As such, the result is suitable for being imported in Docker with <code class="literal">docker import</code>.</p><div class="blockquote"><blockquote class="blockquote"><p><span class="strong"><strong><span class="emphasis"><em>NOTE:</em></span></strong></span> Using this function requires the <code class="literal">kvm</code> device to be available.</p></blockquote></div><p>The parameters of <code class="literal">exportImage</code> are the following:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">exportImage {
  <span class="hljs-attr">fromImage</span> = someLayeredImage;
  <span class="hljs-attr">fromImageName</span> = <span class="hljs-literal">null</span>;
  <span class="hljs-attr">fromImageTag</span> = <span class="hljs-literal">null</span>;

  <span class="hljs-attr">name</span> = someLayeredImage.name;
}
</code></pre><p>The parameters relative to the base image have the same synopsis as described in <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ssec-pkgs-dockerTools-buildImage" title="buildImage">buildImage</a>, except that <code class="literal">fromImage</code> is the only required argument in this case.</p><p>The <code class="literal">name</code> argument is the name of the derivation output, which defaults to <code class="literal">fromImage.name</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-pkgs-dockerTools-helpers" class="title">Environment Helpers   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-pkgs-dockerTools-helpers" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Some packages expect certain files to be available globally.
When building an image from scratch (i.e. without <code class="literal">fromImage</code>), these files are missing.
<code class="literal">pkgs.dockerTools</code> provides some helpers to set up an environment with the necessary files.
You can include them in <code class="literal">copyToRoot</code> like this:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">buildImage {
  <span class="hljs-attr">name</span> = <span class="hljs-string">"environment-example"</span>;
  <span class="hljs-attr">copyToRoot</span> = <span class="hljs-keyword">with</span> pkgs.dockerTools; [
    usrBinEnv
    binSh
    caCertificates
    fakeNss
  ];
}
</code></pre><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="sssec-pkgs-dockerTools-helpers-usrBinEnv" class="title">usrBinEnv   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sssec-pkgs-dockerTools-helpers-usrBinEnv" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>This provides the <code class="literal">env</code> utility at <code class="literal">/usr/bin/env</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="sssec-pkgs-dockerTools-helpers-binSh" class="title">binSh   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sssec-pkgs-dockerTools-helpers-binSh" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>This provides <code class="literal">bashInteractive</code> at <code class="literal">/bin/sh</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="sssec-pkgs-dockerTools-helpers-caCertificates" class="title">caCertificates   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sssec-pkgs-dockerTools-helpers-caCertificates" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>This sets up <code class="literal">/etc/ssl/certs/ca-certificates.crt</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="sssec-pkgs-dockerTools-helpers-fakeNss" class="title">fakeNss   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sssec-pkgs-dockerTools-helpers-fakeNss" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Provides <code class="literal">/etc/passwd</code> and <code class="literal">/etc/group</code> that contain root and nobody.
Useful when packaging binaries that insist on using nss to look up
username/groups (like nginx).</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="ssec-pkgs-dockerTools-shadowSetup" class="title">shadowSetup   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-pkgs-dockerTools-shadowSetup" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>This constant string is a helper for setting up the base files for managing users and groups, only if such files don’t exist already. It is suitable for being used in a <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ex-dockerTools-buildImage-runAsRoot"><code class="literal">buildImage</code> <code class="literal">runAsRoot</code></a> script for cases like in the example below:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">buildImage {
  <span class="hljs-attr">name</span> = <span class="hljs-string">"shadow-basic"</span>;

  <span class="hljs-attr">runAsRoot</span> = <span class="hljs-string">''
    #!<span class="hljs-subst">${pkgs.runtimeShell}</span>
    <span class="hljs-subst">${pkgs.dockerTools.shadowSetup}</span>
    groupadd -r redis
    useradd -r -g redis redis
    mkdir /data
    chown redis:redis /data
  ''</span>;
}
</code></pre><p>Creating base files like <code class="literal">/etc/passwd</code> or <code class="literal">/etc/login.defs</code> is necessary for shadow-utils to manipulate users and groups.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-pkgs-dockerTools-fakeNss" class="title">fakeNss   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-pkgs-dockerTools-fakeNss" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>If your primary goal is providing a basic skeleton for user lookups to work,
and/or a lesser privileged user, adding <code class="literal">pkgs.fakeNss</code> to
the container image root might be the better choice than a custom script
running <code class="literal">useradd</code> and friends.</p><p>It provides a <code class="literal">/etc/passwd</code> and <code class="literal">/etc/group</code>, containing <code class="literal">root</code> and <code class="literal">nobody</code>
users and groups.</p><p>It also provides a <code class="literal">/etc/nsswitch.conf</code>, configuring NSS host resolution to
first check <code class="literal">/etc/hosts</code>, before checking DNS, as the default in the absence of
a config file (<code class="literal">dns [!UNAVAIL=return] files</code>) is quite unexpected.</p><p>You can pair it with <code class="literal">binSh</code>, which provides <code class="literal">bin/sh</code> as a symlink
to <code class="literal">bashInteractive</code> (as <code class="literal">/bin/sh</code> is configured as a shell).</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">buildImage {
  <span class="hljs-attr">name</span> = <span class="hljs-string">"shadow-basic"</span>;

  <span class="hljs-attr">copyToRoot</span> = pkgs.buildEnv {
    <span class="hljs-attr">name</span> = <span class="hljs-string">"image-root"</span>;
    <span class="hljs-attr">paths</span> = [ binSh pkgs.fakeNss ];
    <span class="hljs-attr">pathsToLink</span> = [ <span class="hljs-string">"/bin"</span> <span class="hljs-string">"/etc"</span> <span class="hljs-string">"/var"</span> ];
  };
}
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-pkgs-dockerTools-buildNixShellImage" class="title">buildNixShellImage   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-pkgs-dockerTools-buildNixShellImage" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Create a Docker image that sets up an environment similar to that of running <code class="literal">nix-shell</code> on a derivation.
When run in Docker, this environment somewhat resembles the Nix sandbox typically used by <code class="literal">nix-build</code>, with a major difference being that access to the internet is allowed.
It additionally also behaves like an interactive <code class="literal">nix-shell</code>, running things like <code class="literal">shellHook</code> and setting an interactive prompt.
If the derivation is fully buildable (i.e. <code class="literal">nix-build</code> can be used on it), running <code class="literal">buildDerivation</code> inside such a Docker image will build the derivation, with all its outputs being available in the correct <code class="literal">/nix/store</code> paths, pointed to by the respective environment variables like <code class="literal">$out</code>, etc.</p><div class="warning"><h3 class="title">Warning</h3><p>The behavior doesn’t match <code class="literal">nix-shell</code> or <code class="literal">nix-build</code> exactly and this function is known not to work correctly for e.g. fixed-output derivations, content-addressed derivations, impure derivations and other special types of derivations.</p></div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="ssec-pkgs-dockerTools-buildNixShellImage-arguments" class="title">Arguments   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-pkgs-dockerTools-buildNixShellImage-arguments" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">drv</code></span></dt><dd><p>The derivation on which to base the Docker image.</p><p>Adding packages to the Docker image is possible by e.g. extending the list of <code class="literal">nativeBuildInputs</code> of this derivation like</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">buildNixShellImage {
  <span class="hljs-attr">drv</span> = someDrv.overrideAttrs (old: {
    <span class="hljs-attr">nativeBuildInputs</span> = old.nativeBuildInputs <span class="hljs-literal">or</span> [] ++ [
      somethingExtra
    ];
  });
  <span class="hljs-comment"># ...</span>
}
</code></pre><p>Similarly, you can extend the image initialization script by extending <code class="literal">shellHook</code></p></dd><dt><span class="term"><code class="literal">name</code> <span class="emphasis"><em>optional</em></span></span></dt><dd><p>The name of the resulting image.</p><p><span class="emphasis"><em>Default:</em></span> <code class="literal">drv.name + "-env"</code></p></dd><dt><span class="term"><code class="literal">tag</code> <span class="emphasis"><em>optional</em></span></span></dt><dd><p>Tag of the generated image.</p><p><span class="emphasis"><em>Default:</em></span> the resulting image derivation output path’s hash</p></dd><dt><span class="term"><code class="literal">uid</code>/<code class="literal">gid</code> <span class="emphasis"><em>optional</em></span></span></dt><dd><p>The user/group ID to run the container as. This is like a <code class="literal">nixbld</code> build user.</p><p><span class="emphasis"><em>Default:</em></span> 1000/1000</p></dd><dt><span class="term"><code class="literal">homeDirectory</code> <span class="emphasis"><em>optional</em></span></span></dt><dd><p>The home directory of the user the container is running as</p><p><span class="emphasis"><em>Default:</em></span> <code class="literal">/build</code></p></dd><dt><span class="term"><code class="literal">shell</code> <span class="emphasis"><em>optional</em></span></span></dt><dd><p>The path to the <code class="literal">bash</code> binary to use as the shell. This shell is started when running the image.</p><p><span class="emphasis"><em>Default:</em></span> <code class="literal">pkgs.bashInteractive + "/bin/bash"</code></p></dd><dt><span class="term"><code class="literal">command</code> <span class="emphasis"><em>optional</em></span></span></dt><dd><p>Run this command in the environment of the derivation, in an interactive shell. See the <code class="literal">--command</code> option in the <a class="link" href="https://nixos.org/manual/nix/stable/command-ref/nix-shell?highlight=nix-shell#options" target="_top"><code class="literal">nix-shell</code> documentation</a>.</p><p><span class="emphasis"><em>Default:</em></span> (none)</p></dd><dt><span class="term"><code class="literal">run</code> <span class="emphasis"><em>optional</em></span></span></dt><dd><p>Same as <code class="literal">command</code>, but runs the command in a non-interactive shell instead. See the <code class="literal">--run</code> option in the <a class="link" href="https://nixos.org/manual/nix/stable/command-ref/nix-shell?highlight=nix-shell#options" target="_top"><code class="literal">nix-shell</code> documentation</a>.</p><p><span class="emphasis"><em>Default:</em></span> (none)</p></dd></dl></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="ssec-pkgs-dockerTools-buildNixShellImage-example" class="title">Example   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-pkgs-dockerTools-buildNixShellImage-example" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>The following shows how to build the <code class="literal">pkgs.hello</code> package inside a Docker container built with <code class="literal">buildNixShellImage</code>.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">with</span> <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {};
dockerTools.buildNixShellImage {
  <span class="hljs-attr">drv</span> = hello;
}
</code></pre><p>Build the derivation:</p><pre><code class="programlisting console hljs language-shell" data-highlighted="yes">nix-build hello.nix
</code></pre><pre><code class="programlisting hljs language-bash" data-highlighted="yes">these 8 derivations will be built:
  /nix/store/xmw3a5ln29rdalavcxk1w3m4zb2n7kk6-nix-shell-rc.drv
...
Creating layer 56 from paths: [<span class="hljs-string">'/nix/store/crpnj8ssz0va2q0p5ibv9i6k6n52gcya-stdenv-linux'</span>]
Creating layer 57 with customisation...
Adding manifests...
Done.
/nix/store/cpyn1lc897ghx0rhr2xy49jvyn52bazv-hello-2.12-env.tar.gz
</code></pre><p>Load the image:</p><pre><code class="programlisting console hljs language-shell" data-highlighted="yes">docker load -i result
</code></pre><pre><code class="programlisting hljs language-undefined" data-highlighted="yes">0d9f4c4cd109: Loading layer [==================================================&gt;]   2.56MB/2.56MB
...
ab1d897c0697: Loading layer [==================================================&gt;]  10.24kB/10.24kB
Loaded image: hello-2.12-env:pgj9h98nal555415faa43vsydg161bdz
</code></pre><p>Run the container:</p><pre><code class="programlisting console hljs language-shell" data-highlighted="yes">docker run -it hello-2.12-env:pgj9h98nal555415faa43vsydg161bdz
</code></pre><pre><code class="programlisting hljs language-bash" data-highlighted="yes">[nix-shell:/build]$
</code></pre><p>In the running container, run the build:</p><pre><code class="programlisting console hljs language-shell" data-highlighted="yes">buildDerivation
</code></pre><pre><code class="programlisting hljs language-bash" data-highlighted="yes">unpacking sources
unpacking <span class="hljs-built_in">source</span> archive /nix/store/8nqv6kshb3vs5q5bs2k600xpj5bkavkc-hello-2.12.tar.gz
...
patching script interpreter paths <span class="hljs-keyword">in</span> /nix/store/z5wwy5nagzy15gag42vv61c2agdpz2f2-hello-2.12
checking <span class="hljs-keyword">for</span> references to /build/ <span class="hljs-keyword">in</span> /nix/store/z5wwy5nagzy15gag42vv61c2agdpz2f2-hello-2.12...
</code></pre><p>Check the build result:</p><pre><code class="programlisting console hljs language-shell" data-highlighted="yes"><span class="hljs-meta prompt_">$</span><span class="language-bash">out/bin/hello</span>
</code></pre><pre><code class="programlisting hljs language-undefined" data-highlighted="yes">Hello, world!
</code></pre>
</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-pkgs-ociTools" class="title" style="clear: both">pkgs.ociTools   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-ociTools" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-pkgs-ociTools-buildContainer">buildContainer</a> </span></dt> </dl></div><p><code class="literal">pkgs.ociTools</code> is a set of functions for creating containers according to the <a class="link" href="https://github.com/opencontainers/runtime-spec" target="_top">OCI container specification v1.0.0</a>. Beyond that, it makes no assumptions about the container runner you choose to use to run the created container.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-pkgs-ociTools-buildContainer" class="title">buildContainer   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-pkgs-ociTools-buildContainer" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>This function creates a simple OCI container that runs a single command inside of it. An OCI container consists of a <code class="literal">config.json</code> and a rootfs directory. The nix store of the container will contain all referenced dependencies of the given command.</p><p>The parameters of <code class="literal">buildContainer</code> with an example value are described below:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">buildContainer {
  <span class="hljs-attr">args</span> = [
    (<span class="hljs-keyword">with</span> pkgs;
      writeScript <span class="hljs-string">"run.sh"</span> <span class="hljs-string">''
        #!<span class="hljs-subst">${bash}</span>/bin/bash
        exec <span class="hljs-subst">${bash}</span>/bin/bash
      ''</span>).outPath
  ];

  <span class="hljs-attr">mounts</span> = {
    <span class="hljs-string">"/data"</span> = {
      <span class="hljs-attr">type</span> = <span class="hljs-string">"none"</span>;
      <span class="hljs-attr">source</span> = <span class="hljs-string">"/var/lib/mydata"</span>;
      <span class="hljs-attr">options</span> = [ <span class="hljs-string">"bind"</span> ];
    };
  };

  <span class="hljs-attr">readonly</span> = <span class="hljs-literal">false</span>;
}
</code></pre><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><code class="literal">args</code> specifies a set of arguments to run inside the container. This is the only required argument for <code class="literal">buildContainer</code>. All referenced packages inside the derivation will be made available inside the container.</p></li><li class="listitem"><p><code class="literal">mounts</code> specifies additional mount points chosen by the user. By default only a minimal set of necessary filesystems are mounted into the container (e.g procfs, cgroupfs)</p></li><li class="listitem"><p><code class="literal">readonly</code> makes the container’s rootfs read-only if it is set to true. The default value is false <code class="literal">false</code>.</p></li></ul></div>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-pkgs-snapTools" class="title" style="clear: both">pkgs.snapTools   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-snapTools" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-pkgs-snapTools-makeSnap-signature">The makeSnap Function</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-pkgs-snapTools-build-a-snap-hello">Build a Hello World Snap</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-pkgs-snapTools-build-a-snap-firefox">Build a Graphical Snap</a> </span></dt> </dl></div><p><code class="literal">pkgs.snapTools</code> is a set of functions for creating Snapcraft images. Snap and Snapcraft is not used to perform these operations.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-pkgs-snapTools-makeSnap-signature" class="title">The makeSnap Function   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-pkgs-snapTools-makeSnap-signature" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p><code class="literal">makeSnap</code> takes a single named argument, <code class="literal">meta</code>. This argument mirrors <a class="link" href="https://docs.snapcraft.io/snap-format" target="_top">the upstream <code class="literal">snap.yaml</code> format</a> exactly.</p><p>The <code class="literal">base</code> should not be specified, as <code class="literal">makeSnap</code> will force set it.</p><p>Currently, <code class="literal">makeSnap</code> does not support creating GUI stubs.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-pkgs-snapTools-build-a-snap-hello" class="title">Build a Hello World Snap   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-pkgs-snapTools-build-a-snap-hello" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The following expression packages GNU Hello as a Snapcraft snap.</p><pre><code class="programlisting {#ex-snapTools-buildSnap-hello .nix} hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">let</span>
  <span class="hljs-keyword">inherit</span> (<span class="hljs-built_in">import</span> &lt;nixpkgs&gt; { }) snapTools hello;
<span class="hljs-keyword">in</span> snapTools.makeSnap {
  <span class="hljs-attr">meta</span> = {
    <span class="hljs-attr">name</span> = <span class="hljs-string">"hello"</span>;
    <span class="hljs-attr">summary</span> = hello.meta.description;
    <span class="hljs-attr">description</span> = hello.meta.longDescription;
    <span class="hljs-attr">architectures</span> = [ <span class="hljs-string">"amd64"</span> ];
    <span class="hljs-attr">confinement</span> = <span class="hljs-string">"strict"</span>;
    apps.hello.<span class="hljs-attr">command</span> = <span class="hljs-string">"<span class="hljs-subst">${hello}</span>/bin/hello"</span>;
  };
}
</code></pre><p><code class="literal">nix-build</code> this expression and install it with <code class="literal">snap install ./result --dangerous</code>. <code class="literal">hello</code> will now be the Snapcraft version of the package.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-pkgs-snapTools-build-a-snap-firefox" class="title">Build a Graphical Snap   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-pkgs-snapTools-build-a-snap-firefox" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Graphical programs require many more integrations with the host. This example uses Firefox as an example because it is one of the most complicated programs we could package.</p><pre><code class="programlisting {#ex-snapTools-buildSnap-firefox .nix} hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">let</span>
  <span class="hljs-keyword">inherit</span> (<span class="hljs-built_in">import</span> &lt;nixpkgs&gt; { }) snapTools firefox;
<span class="hljs-keyword">in</span> snapTools.makeSnap {
  <span class="hljs-attr">meta</span> = {
    <span class="hljs-attr">name</span> = <span class="hljs-string">"nix-example-firefox"</span>;
    <span class="hljs-attr">summary</span> = firefox.meta.description;
    <span class="hljs-attr">architectures</span> = [ <span class="hljs-string">"amd64"</span> ];
    apps.<span class="hljs-attr">nix-example-firefox</span> = {
      <span class="hljs-attr">command</span> = <span class="hljs-string">"<span class="hljs-subst">${firefox}</span>/bin/firefox"</span>;
      <span class="hljs-attr">plugs</span> = [
        <span class="hljs-string">"pulseaudio"</span>
        <span class="hljs-string">"camera"</span>
        <span class="hljs-string">"browser-support"</span>
        <span class="hljs-string">"avahi-observe"</span>
        <span class="hljs-string">"cups-control"</span>
        <span class="hljs-string">"desktop"</span>
        <span class="hljs-string">"desktop-legacy"</span>
        <span class="hljs-string">"gsettings"</span>
        <span class="hljs-string">"home"</span>
        <span class="hljs-string">"network"</span>
        <span class="hljs-string">"mount-observe"</span>
        <span class="hljs-string">"removable-media"</span>
        <span class="hljs-string">"x11"</span>
      ];
    };
    <span class="hljs-attr">confinement</span> = <span class="hljs-string">"strict"</span>;
  };
}
</code></pre><p><code class="literal">nix-build</code> this expression and install it with <code class="literal">snap install ./result --dangerous</code>. <code class="literal">nix-example-firefox</code> will now be the Snapcraft version of the Firefox package.</p><p>The specific meaning behind plugs can be looked up in the <a class="link" href="https://docs.snapcraft.io/supported-interfaces" target="_top">Snapcraft interface documentation</a>.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-pkgs-portableService" class="title" style="clear: both">pkgs.portableService   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-portableService" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p><code class="literal">pkgs.portableService</code> is a function to create <span class="emphasis"><em>portable service images</em></span>,
as read-only, immutable, <code class="literal">squashfs</code> archives.</p><p>systemd supports a concept of <a class="link" href="https://systemd.io/PORTABLE_SERVICES/" target="_top">Portable Services</a>.
Portable Services are a delivery method for system services that uses two specific features of container management:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>Applications are bundled. I.e. multiple services, their binaries and
all their dependencies are packaged in an image, and are run directly from it.</p></li><li class="listitem"><p>Stricter default security policies, i.e. sandboxing of applications.</p></li></ul></div><p>This allows using Nix to build images which can be run on many recent Linux distributions.</p><p>The primary tool for interacting with Portable Services is <code class="literal">portablectl</code>,
and they are managed by the <code class="literal">systemd-portabled</code> system service.</p><div class="note"><h3 class="title">Note</h3><p>Portable services are supported starting with systemd 239 (released on 2018-06-22).</p></div><p>A very simple example of using <code class="literal">portableService</code> is described below:</p><p><span id="ex-pkgs-portableService"></span></p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">pkgs.portableService {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"demo"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"1.0"</span>;
  <span class="hljs-attr">units</span> = [ demo-service demo-socket ];
}
</code></pre><p>The above example will build an squashfs archive image in <code class="literal">result/$pname_$version.raw</code>. The image will contain the
file system structure as required by the portable service specification, and a subset of the Nix store with all the
dependencies of the two derivations in the <code class="literal">units</code> list.
<code class="literal">units</code> must be a list of derivations, and their names must be prefixed with the service name (<code class="literal">"demo"</code> in this case).
Otherwise <code class="literal">systemd-portabled</code> will ignore them.</p><div class="note"><h3 class="title">Note</h3><p>The <code class="literal">.raw</code> file extension of the image is required by the portable services specification.</p></div><p>Some other options available are:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><code class="literal">description</code>, <code class="literal">homepage</code></p><p>Are added to the <code class="literal">/etc/os-release</code> in the image and are shown by the portable services tooling.
Default to empty values, not added to os-release.</p></li><li class="listitem"><p><code class="literal">symlinks</code></p><p>A list of attribute sets {object, symlink}. Symlinks will be created  in the root filesystem of the image to
objects in the Nix store. Defaults to an empty list.</p></li><li class="listitem"><p><code class="literal">contents</code></p><p>A list of additional derivations to be included in the image Nix store, as-is. Defaults to an empty list.</p></li><li class="listitem"><p><code class="literal">squashfsTools</code></p><p>Defaults to <code class="literal">pkgs.squashfsTools</code>, allows you to override the package that provides <code class="literal">mksquashfs</code>.</p></li><li class="listitem"><p><code class="literal">squash-compression</code>, <code class="literal">squash-block-size</code></p><p>Options to <code class="literal">mksquashfs</code>. Default to <code class="literal">"xz -Xdict-size 100%"</code> and <code class="literal">"1M"</code> respectively.</p></li></ul></div><p>A typical usage of <code class="literal">symlinks</code> would be:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">  <span class="hljs-attr">symlinks</span> = [
    { <span class="hljs-attr">object</span> = <span class="hljs-string">"<span class="hljs-subst">${pkgs.cacert}</span>/etc/ssl"</span>; <span class="hljs-attr">symlink</span> = <span class="hljs-string">"/etc/ssl"</span>; }
    { <span class="hljs-attr">object</span> = <span class="hljs-string">"<span class="hljs-subst">${pkgs.bash}</span>/bin/bash"</span>; <span class="hljs-attr">symlink</span> = <span class="hljs-string">"/bin/sh"</span>; }
    { <span class="hljs-attr">object</span> = <span class="hljs-string">"<span class="hljs-subst">${pkgs.php}</span>/bin/php"</span>; <span class="hljs-attr">symlink</span> = <span class="hljs-string">"/usr/bin/php"</span>; }
  ];
</code></pre><p>to create these symlinks for legacy applications that assume them existing globally.</p><p>Once the image is created, and deployed on a host in <code class="literal">/var/lib/portables/</code>, you can attach the image and run the service. As root run:</p><pre><code class="programlisting console hljs language-shell" data-highlighted="yes">portablectl attach demo_1.0.raw
systemctl enable --now demo.socket
systemctl enable --now demo.service
</code></pre><div class="note"><h3 class="title">Note</h3><p>See the <a class="link" href="https://www.freedesktop.org/software/systemd/man/portablectl.html" target="_top">man page</a> of <code class="literal">portablectl</code> for more info on its usage.</p></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-make-disk-image" class="title" style="clear: both"><code class="literal">&lt;nixpkgs/nixos/lib/make-disk-image.nix&gt;</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-make-disk-image" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-make-disk-image-features">Features</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-make-disk-image-usage">Usage</a> </span></dt> </dl></div><p><code class="literal">&lt;nixpkgs/nixos/lib/make-disk-image.nix&gt;</code> is a function to create <span class="emphasis"><em>disk images</em></span> in multiple formats: raw, QCOW2 (QEMU), QCOW2-Compressed (compressed version), VDI (VirtualBox), VPC (VirtualPC).</p><p>This function can create images in two ways:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>using <code class="literal">cptofs</code> without any virtual machine to create a Nix store disk image,</p></li><li class="listitem"><p>using a virtual machine to create a full NixOS installation.</p></li></ul></div><p>When testing early-boot or lifecycle parts of NixOS such as a bootloader or multiple generations, it is necessary to opt for a full NixOS system installation.
Whereas for many web servers, applications, it is possible to work with a Nix store only disk image and is faster to build.</p><p>NixOS tests also use this function when preparing the VM. The <code class="literal">cptofs</code> method is used when <code class="literal">virtualisation.useBootLoader</code> is false (the default). Otherwise the second method is used.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-make-disk-image-features" class="title">Features   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-make-disk-image-features" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>For reference, read the function signature source code for documentation on arguments: <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/nixos/lib/make-disk-image.nix" target="_top">https://github.com/NixOS/nixpkgs/blob/master/nixos/lib/make-disk-image.nix</a>.
Features are separated in various sections depending on if you opt for a Nix-store only image or a full NixOS image.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="sec-make-disk-image-features-common" class="title">Common   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-make-disk-image-features-common" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>arbitrary NixOS configuration</p></li><li class="listitem"><p>automatic or bound disk size: <code class="literal">diskSize</code> parameter, <code class="literal">additionalSpace</code> can be set when <code class="literal">diskSize</code> is <code class="literal">auto</code> to add a constant of disk space</p></li><li class="listitem"><p>multiple partition table layouts: EFI, legacy, legacy + GPT, hybrid, none through <code class="literal">partitionTableType</code> parameter</p></li><li class="listitem"><p>OVMF or EFI firmwares and variables templates can be customized</p></li><li class="listitem"><p>root filesystem <code class="literal">fsType</code> can be customized to whatever <code class="literal">mkfs.${fsType}</code> exist during operations</p></li><li class="listitem"><p>root filesystem label can be customized, defaults to <code class="literal">nix-store</code> if it’s a Nix store image, otherwise <code class="literal">nixpkgs/nixos</code></p></li><li class="listitem"><p>arbitrary code can be executed after disk image was produced with <code class="literal">postVM</code></p></li><li class="listitem"><p>the current nixpkgs can be realized as a channel in the disk image, which will change the hash of the image when the sources are updated</p></li><li class="listitem"><p>additional store paths can be provided through <code class="literal">additionalPaths</code></p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="sec-make-disk-image-features-full-image" class="title">Full NixOS image   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-make-disk-image-features-full-image" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>arbitrary contents with permissions can be placed in the target filesystem using <code class="literal">contents</code></p></li><li class="listitem"><p>a <code class="literal">/etc/nixpkgs/nixos/configuration.nix</code> can be provided through <code class="literal">configFile</code></p></li><li class="listitem"><p>bootloaders are supported</p></li><li class="listitem"><p>EFI variables can be mutated during image production and the result is exposed in <code class="literal">$out</code></p></li><li class="listitem"><p>boot partition size when partition table is <code class="literal">efi</code> or <code class="literal">hybrid</code></p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="sec-make-disk-image-features-reproducibility" class="title">On bit-to-bit reproducibility   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-make-disk-image-features-reproducibility" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Images are <span class="strong"><strong>NOT</strong></span> deterministic, please do not hesitate to try to fix this, source of determinisms are (not exhaustive) :</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>bootloader installation have timestamps</p></li><li class="listitem"><p>SQLite Nix store database contain registration times</p></li><li class="listitem"><p><code class="literal">/etc/shadow</code> is in a non-deterministic order</p></li></ul></div><p>A <code class="literal">deterministic</code> flag is available for best efforts determinism.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-make-disk-image-usage" class="title">Usage   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-make-disk-image-usage" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>To produce a Nix-store only image:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">let</span>
  <span class="hljs-attr">pkgs</span> = <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {};
  <span class="hljs-attr">lib</span> = pkgs.lib;
  <span class="hljs-attr">make-disk-image</span> = <span class="hljs-built_in">import</span> &lt;nixpkgs/nixos/lib/make-disk-image.nix&gt;;
<span class="hljs-keyword">in</span>
  make-disk-image {
    <span class="hljs-keyword">inherit</span> pkgs lib;
    <span class="hljs-attr">config</span> = {};
    <span class="hljs-attr">additionalPaths</span> = [ ];
    <span class="hljs-attr">format</span> = <span class="hljs-string">"qcow2"</span>;
    <span class="hljs-attr">onlyNixStore</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-attr">partitionTableType</span> = <span class="hljs-string">"none"</span>;
    <span class="hljs-attr">installBootLoader</span> = <span class="hljs-literal">false</span>;
    <span class="hljs-attr">touchEFIVars</span> = <span class="hljs-literal">false</span>;
    <span class="hljs-attr">diskSize</span> = <span class="hljs-string">"auto"</span>;
    <span class="hljs-attr">additionalSpace</span> = <span class="hljs-string">"0M"</span>; <span class="hljs-comment"># Defaults to 512M.</span>
    <span class="hljs-attr">copyChannel</span> = <span class="hljs-literal">false</span>;
  }
</code></pre><p>Some arguments can be left out, they are shown explicitly for the sake of the example.</p><p>Building this derivation will provide a QCOW2 disk image containing only the Nix store and its registration information.</p><p>To produce a NixOS installation image disk with UEFI and bootloader installed:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">let</span>
  <span class="hljs-attr">pkgs</span> = <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {};
  <span class="hljs-attr">lib</span> = pkgs.lib;
  <span class="hljs-attr">make-disk-image</span> = <span class="hljs-built_in">import</span> &lt;nixpkgs/nixos/lib/make-disk-image.nix&gt;;
  <span class="hljs-attr">evalConfig</span> = <span class="hljs-built_in">import</span> &lt;nixpkgs/nixos/lib/eval-config.nix&gt;;
<span class="hljs-keyword">in</span>
  make-disk-image {
    <span class="hljs-keyword">inherit</span> pkgs lib;
    <span class="hljs-attr">config</span> = evalConfig {
      <span class="hljs-attr">modules</span> = [
        {
          fileSystems.<span class="hljs-string">"/"</span> = { <span class="hljs-attr">device</span> = <span class="hljs-string">"/dev/vda"</span>; <span class="hljs-attr">fsType</span> = <span class="hljs-string">"ext4"</span>; <span class="hljs-attr">autoFormat</span> = <span class="hljs-literal">true</span>; };
          boot.grub.<span class="hljs-attr">device</span> = <span class="hljs-string">"/dev/vda"</span>;
        }
      ];
    };
    <span class="hljs-attr">format</span> = <span class="hljs-string">"qcow2"</span>;
    <span class="hljs-attr">onlyNixStore</span> = <span class="hljs-literal">false</span>;
    <span class="hljs-attr">partitionTableType</span> = <span class="hljs-string">"legacy+gpt"</span>;
    <span class="hljs-attr">installBootLoader</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-attr">touchEFIVars</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-attr">diskSize</span> = <span class="hljs-string">"auto"</span>;
    <span class="hljs-attr">additionalSpace</span> = <span class="hljs-string">"0M"</span>; <span class="hljs-comment"># Defaults to 512M.</span>
    <span class="hljs-attr">copyChannel</span> = <span class="hljs-literal">false</span>;
    <span class="hljs-attr">memSize</span> = <span class="hljs-number">2048</span>; <span class="hljs-comment"># Qemu VM memory size in megabytes. Defaults to 1024M.</span>
  }
</code></pre>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-pkgs-binary-cache" class="title" style="clear: both">pkgs.mkBinaryCache   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-binary-cache" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-binary-cache-example">Example</a> </span></dt> </dl></div><p><code class="literal">pkgs.mkBinaryCache</code> is a function for creating Nix flat-file binary caches. Such a cache exists as a directory on disk, and can be used as a Nix substituter by passing <code class="literal">--substituter file:///path/to/cache</code> to Nix commands.</p><p>Nix packages are most commonly shared between machines using <a class="link" href="https://nixos.org/manual/nix/stable/package-management/sharing-packages" target="_top">HTTP, SSH, or S3</a>, but a flat-file binary cache can still be useful in some situations. For example, you can copy it directly to another machine, or make it available on a network file system. It can also be a convenient way to make some Nix packages available inside a container via bind-mounting.</p><p>Note that this function is meant for advanced use-cases. The more idiomatic way to work with flat-file binary caches is via the <a class="link" href="https://nixos.org/manual/nix/stable/command-ref/nix-copy-closure" target="_top">nix-copy-closure</a> command. You may also want to consider <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-dockerTools" title="pkgs.dockerTools">dockerTools</a> for your containerization needs.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-pkgs-binary-cache-example" class="title">Example   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-binary-cache-example" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The following derivation will construct a flat-file binary cache containing the closure of <code class="literal">hello</code>.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">mkBinaryCache {
  <span class="hljs-attr">rootPaths</span> = [hello];
}
</code></pre><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">rootPaths</code> specifies a list of root derivations. The transitive closure of these derivations’ outputs will be copied into the cache.</p></li></ul></div><p>Here’s an example of building and using the cache.</p><p>Build the cache on one machine, <code class="literal">host1</code>:</p><pre><code class="programlisting shellSession hljs language-shellSession" data-highlighted="yes">nix-build -E 'with import &lt;nixpkgs&gt; {}; mkBinaryCache { rootPaths = [hello]; }'
</code></pre><pre><code class="programlisting shellSession hljs language-shellSession" data-highlighted="yes">/nix/store/cc0562q828rnjqjyfj23d5q162gb424g-binary-cache
</code></pre><p>Copy the resulting directory to the other machine, <code class="literal">host2</code>:</p><pre><code class="programlisting shellSession hljs language-shellSession" data-highlighted="yes">scp result host2:/tmp/hello-cache
</code></pre><p>Substitute the derivation using the flat-file binary cache on the other machine, <code class="literal">host2</code>:</p><pre><code class="programlisting shellSession hljs language-shellSession" data-highlighted="yes">nix-build -A hello '&lt;nixpkgs&gt;' \
  --option require-sigs false \
  --option trusted-substituters file:///tmp/hello-cache \
  --option substituters file:///tmp/hello-cache
</code></pre><pre><code class="programlisting shellSession hljs language-shellSession" data-highlighted="yes">/nix/store/gl5a41azbpsadfkfmbilh9yk40dh5dl0-hello-2.12.1
</code></pre>
</div>

</div>
</div><div class="chapter"> <div class="titlepage">  <div>   <div>    <h2 id="chap-hooks" class="title">Hooks reference   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#chap-hooks" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <p><strong>Table of Contents</strong></p> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#setup-hook-autoconf">Autoconf</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#setup-hook-automake">Automake</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#setup-hook-autopatchelfhook">autoPatchelfHook</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#bmake-hook">bmake</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#breakpointhook">breakpointHook</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#cmake">cmake</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#setup-hook-gdk-pixbuf">gdk-pixbuf</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ghc">GHC</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#gnome-platform">GNOME platform</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#installshellfiles"><code class="literal">installShellFiles</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#libiconv-libintl">libiconv, libintl</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#setup-hook-libxml2">libxml2</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#meson">Meson</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#setup-hook-mpi-check">mpiCheckPhaseHook</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ninja">ninja</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-patchRcPathHooks"><code class="literal">patchRcPath</code> hooks</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#setup-hook-perl">Perl</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#setup-hook-pkg-config">pkg-config</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-postgresqlTestHook"><code class="literal">postgresqlTestHook</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#setup-hook-python">Python</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#scons">scons</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#tetex-tex-live">teTeX / TeX Live</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#unzip">unzip</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#validatepkgconfig">validatePkgConfig</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#waf-hook">wafHook</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#zig-hook">zig.hook</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#xcbuildhook">xcbuildHook</a> </span></dt> </dl></div><p>Nixpkgs has several hook packages that augment the stdenv phases.</p><p>The stdenv built-in hooks are documented in <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#ssec-setup-hooks" title="Package setup hooks">the section called “Package setup hooks”</a>.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="setup-hook-autoconf" class="title" style="clear: both">Autoconf   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#setup-hook-autoconf" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>The <code class="literal">autoreconfHook</code> derivation adds <code class="literal">autoreconfPhase</code>, which runs autoreconf, libtoolize and automake, essentially preparing the configure script in autotools-based builds. Most autotools-based packages come with the configure script pre-generated, but this hook is necessary for a few packages and when you need to patch the package’s configure scripts.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="setup-hook-automake" class="title" style="clear: both">Automake   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#setup-hook-automake" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>Adds the <code class="literal">share/aclocal</code> subdirectory of each build input to the <code class="literal">ACLOCAL_PATH</code> environment variable.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="setup-hook-autopatchelfhook" class="title" style="clear: both">autoPatchelfHook   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#setup-hook-autopatchelfhook" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>This is a special setup hook which helps in packaging proprietary software in that it automatically tries to find missing shared library dependencies of ELF files based on the given <code class="literal">buildInputs</code> and <code class="literal">nativeBuildInputs</code>.</p><p>You can also specify a <code class="literal">runtimeDependencies</code> variable which lists dependencies to be unconditionally added to rpath of all executables. This is useful for programs that use dlopen 3 to load libraries at runtime.</p><p>In certain situations you may want to run the main command (<code class="literal">autoPatchelf</code>) of the setup hook on a file or a set of directories instead of unconditionally patching all outputs. This can be done by setting the <code class="literal">dontAutoPatchelf</code> environment variable to a non-empty value.</p><p>By default <code class="literal">autoPatchelf</code> will fail as soon as any ELF file requires a dependency which cannot be resolved via the given build inputs. In some situations you might prefer to just leave missing dependencies unpatched and continue to patch the rest. This can be achieved by setting the <code class="literal">autoPatchelfIgnoreMissingDeps</code> environment variable to a non-empty value. <code class="literal">autoPatchelfIgnoreMissingDeps</code> can be set to a list like <code class="literal">autoPatchelfIgnoreMissingDeps = [ "libcuda.so.1" "libcudart.so.1" ];</code> or to <code class="literal">[ "*" ]</code> to ignore all missing dependencies.</p><p>The <code class="literal">autoPatchelf</code> command also recognizes a <code class="literal">--no-recurse</code> command line flag, which prevents it from recursing into subdirectories.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="bmake-hook" class="title" style="clear: both">bmake   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#bmake-hook" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p><a class="link" href="https://www.crufty.net/help/sjg/bmake.html" target="_top">bmake</a> is the portable variant of
NetBSD make utility.</p><p>In Nixpkgs, <code class="literal">bmake</code> comes with a hook that overrides the default build, check,
install and dist phases.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="breakpointhook" class="title" style="clear: both">breakpointHook   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#breakpointhook" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>This hook will make a build pause instead of stopping when a failure happens. It prevents nix from cleaning up the build environment immediately and allows the user to attach to a build environment using the <code class="literal">cntr</code> command. Upon build error it will print instructions on how to use <code class="literal">cntr</code>, which can be used to enter the environment for debugging. Installing cntr and running the command will provide shell access to the build sandbox of failed build. At <code class="literal">/var/lib/cntr</code> the sandboxed filesystem is mounted. All commands and files of the system are still accessible within the shell. To execute commands from the sandbox use the cntr exec subcommand. <code class="literal">cntr</code> is only supported on Linux-based platforms. To use it first add <code class="literal">cntr</code> to your <code class="literal">environment.systemPackages</code> on NixOS or alternatively to the root user on non-NixOS systems. Then in the package that is supposed to be inspected, add <code class="literal">breakpointHook</code> to <code class="literal">nativeBuildInputs</code>.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">nativeBuildInputs</span> = [ breakpointHook ];
</code></pre><p>When a build failure happens there will be an instruction printed that shows how to attach with <code class="literal">cntr</code> to the build sandbox.</p><div class="note"><h3 class="title">Note</h3><p>Caution with remote builds</p><p>This won’t work with remote builds as the build environment is on a different machine and can’t be accessed by <code class="literal">cntr</code>. Remote builds can be turned off by setting <code class="literal">--option builders ''</code> for <code class="literal">nix-build</code> or <code class="literal">--builders ''</code> for <code class="literal">nix build</code>.</p></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="cmake" class="title" style="clear: both">cmake   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#cmake" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>Overrides the default configure phase to run the CMake command. By default, we use the Make generator of CMake. In addition, dependencies are added automatically to <code class="literal">CMAKE_PREFIX_PATH</code> so that packages are correctly detected by CMake. Some additional flags are passed in to give similar behavior to configure-based packages. You can disable this hook’s behavior by setting <code class="literal">configurePhase</code> to a custom value, or by setting <code class="literal">dontUseCmakeConfigure</code>. <code class="literal">cmakeFlags</code> controls flags passed only to CMake. By default, parallel building is enabled as CMake supports parallel building almost everywhere. When Ninja is also in use, CMake will detect that and use the ninja generator.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="setup-hook-gdk-pixbuf" class="title" style="clear: both">gdk-pixbuf   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#setup-hook-gdk-pixbuf" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>Exports <code class="literal">GDK_PIXBUF_MODULE_FILE</code> environment variable to the builder. Add librsvg package to <code class="literal">buildInputs</code> to get svg support. See also the <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ssec-gnome-hooks-gdk-pixbuf">setup hook description in GNOME platform docs</a>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="ghc" class="title" style="clear: both">GHC   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ghc" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>Creates a temporary package database and registers every Haskell build input in it (TODO: how?).</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="gnome-platform" class="title" style="clear: both">GNOME platform   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#gnome-platform" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>Hooks related to GNOME platform and related libraries like GLib, GTK and GStreamer are described in <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#sec-language-gnome" title="GNOME">the section called “GNOME”</a>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="installshellfiles" class="title" style="clear: both"><code class="literal">installShellFiles</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#installshellfiles" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>This hook helps with installing manpages and shell completion files. It exposes 2 shell functions <code class="literal">installManPage</code> and <code class="literal">installShellCompletion</code> that can be used from your <code class="literal">postInstall</code> hook.</p><p>The <code class="literal">installManPage</code> function takes one or more paths to manpages to install. The manpages must have a section suffix, and may optionally be compressed (with <code class="literal">.gz</code> suffix). This function will place them into the correct directory.</p><p>The <code class="literal">installShellCompletion</code> function takes one or more paths to shell completion files. By default it will autodetect the shell type from the completion file extension, but you may also specify it by passing one of <code class="literal">--bash</code>, <code class="literal">--fish</code>, or <code class="literal">--zsh</code>. These flags apply to all paths listed after them (up until another shell flag is given). Each path may also have a custom installation name provided by providing a flag <code class="literal">--name NAME</code> before the path. If this flag is not provided, zsh completions will be renamed automatically such that <code class="literal">foobar.zsh</code> becomes <code class="literal">_foobar</code>. A root name may be provided for all paths using the flag <code class="literal">--cmd NAME</code>; this synthesizes the appropriate name depending on the shell (e.g. <code class="literal">--cmd foo</code> will synthesize the name <code class="literal">foo.bash</code> for bash and <code class="literal">_foo</code> for zsh). The path may also be a fifo or named fd (such as produced by <code class="literal">&lt;(cmd)</code>), in which case the shell and name must be provided.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">nativeBuildInputs</span> = [ installShellFiles ];
<span class="hljs-attr">postInstall</span> = <span class="hljs-string">''
  installManPage doc/foobar.1 doc/barfoo.3
  # explicit behavior
  installShellCompletion --bash --name foobar.bash share/completions.bash
  installShellCompletion --fish --name foobar.fish share/completions.fish
  installShellCompletion --zsh --name _foobar share/completions.zsh
  # implicit behavior
  installShellCompletion share/completions/foobar.{bash,fish,zsh}
  # using named fd
  installShellCompletion --cmd foobar \
    --bash &lt;($out/bin/foobar --bash-completion) \
    --fish &lt;($out/bin/foobar --fish-completion) \
    --zsh &lt;($out/bin/foobar --zsh-completion)
''</span>;
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="libiconv-libintl" class="title" style="clear: both">libiconv, libintl   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#libiconv-libintl" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>A few libraries automatically add to <code class="literal">NIX_LDFLAGS</code> their library, making their symbols automatically available to the linker. This includes libiconv and libintl (gettext). This is done to provide compatibility between GNU Linux, where libiconv and libintl are bundled in, and other systems where that might not be the case. Sometimes, this behavior is not desired. To disable this behavior, set <code class="literal">dontAddExtraLibs</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="setup-hook-libxml2" class="title" style="clear: both">libxml2   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#setup-hook-libxml2" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>Adds every file named <code class="literal">catalog.xml</code> found under the <code class="literal">xml/dtd</code> and <code class="literal">xml/xsl</code> subdirectories of each build input to the <code class="literal">XML_CATALOG_FILES</code> environment variable.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="meson" class="title" style="clear: both">Meson   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#meson" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#meson-variables-controlling">Variables controlling Meson</a> </span></dt> </dl></div><p><a class="link" href="https://mesonbuild.com/" target="_top">Meson</a> is an open source meta build system meant to be
fast and user-friendly.</p><p>In Nixpkgs, meson comes with a setup hook that overrides the configure, check,
and install phases.</p><p>Being a meta build system, meson needs an accompanying backend. In the context
of Nixpkgs, the typical companion backend is <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ninja" title="ninja">Ninja</a>, that provides a
setup hook registering ninja-based build and install phases.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="meson-variables-controlling" class="title">Variables controlling Meson   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#meson-variables-controlling" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="meson-exclusive-variables" class="title">Meson Exclusive Variables   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#meson-exclusive-variables" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="meson-flags" class="title"><code class="literal">mesonFlags</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#meson-flags" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Controls the flags passed to <code class="literal">meson setup</code> during configure phase.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="meson-wrap-mode" class="title"><code class="literal">mesonWrapMode</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#meson-wrap-mode" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Which value is passed as
<a class="link" href="https://mesonbuild.com/Builtin-options.html#core-options" target="_top"><code class="literal">-Dwrap_mode=</code></a>
to. In Nixpkgs the default value is <code class="literal">nodownload</code>, so that no subproject will be
downloaded (since network access is already disabled during deployment in
Nixpkgs).</p><p>Note: Meson allows pre-population of subprojects that would otherwise be
downloaded.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="meson-build-type" class="title"><code class="literal">mesonBuildType</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#meson-build-type" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Which value is passed as
<a class="link" href="https://mesonbuild.com/Builtin-options.html#core-options" target="_top"><code class="literal">--buildtype</code></a> to
<code class="literal">meson setup</code> during configure phase. In Nixpkgs the default value is <code class="literal">plain</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="meson-auto-features" class="title"><code class="literal">mesonAutoFeatures</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#meson-auto-features" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Which value is passed as
<a class="link" href="https://mesonbuild.com/Builtin-options.html#core-options" target="_top"><code class="literal">-Dauto_features=</code></a>
to <code class="literal">meson setup</code> during configure phase. In Nixpkgs the default value is
<code class="literal">enabled</code>, meaning that every feature declared as “auto” by the meson scripts
will be enabled.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="meson-check-flags" class="title"><code class="literal">mesonCheckFlags</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#meson-check-flags" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Controls the flags passed to <code class="literal">meson test</code> during check phase.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="meson-install-flags" class="title"><code class="literal">mesonInstallFlags</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#meson-install-flags" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Controls the flags passed to <code class="literal">meson install</code> during install phase.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="meson-install-tags" class="title"><code class="literal">mesonInstallTags</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#meson-install-tags" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>A list of installation tags passed to Meson’s commandline option
<a class="link" href="https://mesonbuild.com/Installing.html#installation-tags" target="_top"><code class="literal">--tags</code></a> during
install phase.</p><p>Note: <code class="literal">mesonInstallTags</code> should be a list of strings, that will be converted to
a comma-separated string that is recognized to <code class="literal">--tags</code>.
Example: <code class="literal">mesonInstallTags = [ "emulator" "assembler" ];</code> will be converted to
<code class="literal">--tags emulator,assembler</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="dont-use-meson-configure" class="title"><code class="literal">dontUseMesonConfigure</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#dont-use-meson-configure" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>When set to true, don’t use the predefined <code class="literal">mesonConfigurePhase</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="dont-use-meson-check" class="title"><code class="literal">dontUseMesonCheck</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#dont-use-meson-check" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>When set to true, don’t use the predefined <code class="literal">mesonCheckPhase</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="dont-use-meson-install" class="title"><code class="literal">dontUseMesonInstall</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#dont-use-meson-install" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>When set to true, don’t use the predefined <code class="literal">mesonInstallPhase</code>.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="meson-honored-variables" class="title">Honored variables   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#meson-honored-variables" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>The following variables commonly used by <code class="literal">stdenv.mkDerivation</code> are honored by
Meson setup hook.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">prefixKey</code></p></li><li class="listitem"><p><code class="literal">enableParallelBuilding</code></p></li></ul></div>
</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="setup-hook-mpi-check" class="title" style="clear: both">mpiCheckPhaseHook   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#setup-hook-mpi-check" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>This hook can be used to setup a check phase that
requires running a MPI application. It detects the
used present MPI implementation type and exports
the neceesary environment variables to use
<code class="literal">mpirun</code> and <code class="literal">mpiexec</code> in a Nix sandbox.</p><p>Example:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">  { mpiCheckPhaseHook, mpi, ... }:

  ...

  <span class="hljs-attr">nativeCheckInputs</span> = [
    openssh
    mpiCheckPhaseHook
  ];
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="ninja" class="title" style="clear: both">ninja   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ninja" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>Overrides the build, install, and check phase to run ninja instead of make. You can disable this behavior with the <code class="literal">dontUseNinjaBuild</code>, <code class="literal">dontUseNinjaInstall</code>, and <code class="literal">dontUseNinjaCheck</code>, respectively. Parallel building is enabled by default in Ninja.</p><p>Note that if the <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#meson" title="Meson">Meson setup hook</a> is also active, Ninja’s install and check phases will be disabled in favor of Meson’s.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-patchRcPathHooks" class="title" style="clear: both"><code class="literal">patchRcPath</code> hooks   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-patchRcPathHooks" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>These hooks provide shell-specific utilities (with the same name as the hook) to patch shell scripts meant to be sourced by software users.</p><p>The typical usage is to patch initialisation or <a class="link" href="https://unix.stackexchange.com/questions/3467/what-does-rc-in-bashrc-stand-for" target="_top">rc</a> scripts inside <code class="literal">$out/bin</code> or <code class="literal">$out/etc</code>.
Such scripts, when being sourced, would insert the binary locations of certain commands into <code class="literal">PATH</code>, modify other environment variables or run a series of start-up commands.
When shipped from the upstream, they sometimes use commands that might not be available in the environment they are getting sourced in.</p><p>The compatible shells for each hook are:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">patchRcPathBash</code>: <a class="link" href="https://www.gnu.org/software/bash/" target="_top">Bash</a>, <a class="link" href="http://www.kornshell.org/" target="_top">ksh</a>, <a class="link" href="https://www.zsh.org/" target="_top">zsh</a> and other shells supporting the Bash-like parameter expansions.</p></li><li class="listitem"><p><code class="literal">patchRcPathCsh</code>: Csh scripts, such as those targeting <a class="link" href="https://www.tcsh.org/" target="_top">tcsh</a>.</p></li><li class="listitem"><p><code class="literal">patchRcPathFish</code>: <a class="link" href="https://fishshell.com/" target="_top">Fish</a> scripts.</p></li><li class="listitem"><p><code class="literal">patchRcPathPosix</code>: POSIX-conformant shells supporting the limited parameter expansions specified by the POSIX standard. Current implementation uses the parameter expansion <code class="literal">${foo-}</code> only.</p></li></ul></div><p>For each supported shell, it modifies the script with a <code class="literal">PATH</code> prefix that is later removed when the script ends.
It allows nested patching, which guarantees that a patched script may source another patched script.</p><p>Syntax to apply the utility to a script:</p><pre><code class="programlisting sh hljs language-bash" data-highlighted="yes">patchRcPath&lt;shell&gt; &lt;file&gt; &lt;PATH-prefix&gt;
</code></pre><p>Example usage:</p><p>Given a package <code class="literal">foo</code> containing an init script <code class="literal">this-foo.fish</code> that depends on <code class="literal">coreutils</code>, <code class="literal">man</code> and <code class="literal">which</code>,
patch the init script for users to source without having the above dependencies in their <code class="literal">PATH</code>:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ lib, stdenv, patchRcPathFish}:
stdenv.mkDerivation {

  <span class="hljs-comment"># ...</span>

  <span class="hljs-attr">nativeBuildInputs</span> = [
    patchRcPathFish
  ];

  <span class="hljs-attr">postFixup</span> = <span class="hljs-string">''
    patchRcPathFish $out/bin/this-foo.fish <span class="hljs-subst">${lib.makeBinPath [ coreutils man which ]}</span>
  ''</span>;
}
</code></pre><div class="note"><h3 class="title">Note</h3><p><code class="literal">patchRcPathCsh</code> and <code class="literal">patchRcPathPosix</code> implementation depends on <code class="literal">sed</code> to do the string processing.
The others are in vanilla shell and have no third-party dependencies.</p></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="setup-hook-perl" class="title" style="clear: both">Perl   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#setup-hook-perl" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>Adds the <code class="literal">lib/site_perl</code> subdirectory of each build input to the <code class="literal">PERL5LIB</code> environment variable. For instance, if <code class="literal">buildInputs</code> contains Perl, then the <code class="literal">lib/site_perl</code> subdirectory of each input is added to the <code class="literal">PERL5LIB</code> environment variable.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="setup-hook-pkg-config" class="title" style="clear: both">pkg-config   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#setup-hook-pkg-config" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>Adds the <code class="literal">lib/pkgconfig</code> and <code class="literal">share/pkgconfig</code> subdirectories of each build input to the <code class="literal">PKG_CONFIG_PATH</code> environment variable.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-postgresqlTestHook" class="title" style="clear: both"><code class="literal">postgresqlTestHook</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-postgresqlTestHook" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-postgresqlTestHook-variables">Variables</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-postgresqlTestHook-hooks">Hooks</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-postgresqlTestHook-tcp">TCP and the Nix sandbox</a> </span></dt> </dl></div><p>This hook starts a PostgreSQL server during the <code class="literal">checkPhase</code>. Example:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ stdenv, postgresql, postgresqlTestHook }:
stdenv.mkDerivation {

  <span class="hljs-comment"># ...</span>

  <span class="hljs-attr">nativeCheckInputs</span> = [
    postgresql
    postgresqlTestHook
  ];
}
</code></pre><p>If you use a custom <code class="literal">checkPhase</code>, remember to add the <code class="literal">runHook</code> calls:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">  checkPhase <span class="hljs-string">''
    runHook preCheck

    # ... your tests

    runHook postCheck
  ''</span>
</code></pre><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-postgresqlTestHook-variables" class="title">Variables   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-postgresqlTestHook-variables" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The hook logic will read a number of variables and set them to a default value if unset or empty.</p><p>Exported variables:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">PGDATA</code>: location of server files.</p></li><li class="listitem"><p><code class="literal">PGHOST</code>: location of UNIX domain socket directory; the default <code class="literal">host</code> in a connection string.</p></li><li class="listitem"><p><code class="literal">PGUSER</code>: user to create / log in with, default: <code class="literal">test_user</code>.</p></li><li class="listitem"><p><code class="literal">PGDATABASE</code>: database name, default: <code class="literal">test_db</code>.</p></li></ul></div><p>Bash-only variables:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">postgresqlTestUserOptions</code>: SQL options to use when creating the <code class="literal">$PGUSER</code> role, default: <code class="literal">"LOGIN"</code>. Example: <code class="literal">"LOGIN SUPERUSER"</code></p></li><li class="listitem"><p><code class="literal">postgresqlTestSetupSQL</code>: SQL commands to run as database administrator after startup, default: statements that create <code class="literal">$PGUSER</code> and <code class="literal">$PGDATABASE</code>.</p></li><li class="listitem"><p><code class="literal">postgresqlTestSetupCommands</code>: bash commands to run after database start, defaults to running <code class="literal">$postgresqlTestSetupSQL</code> as database administrator.</p></li><li class="listitem"><p><code class="literal">postgresqlEnableTCP</code>: set to <code class="literal">1</code> to enable TCP listening. Flaky; not recommended.</p></li><li class="listitem"><p><code class="literal">postgresqlStartCommands</code>: defaults to <code class="literal">pg_ctl start</code>.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-postgresqlTestHook-hooks" class="title">Hooks   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-postgresqlTestHook-hooks" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>A number of additional hooks are ran in postgresqlTestHook</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">postgresqlTestSetupPost</code>: ran after postgresql has been set up.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-postgresqlTestHook-tcp" class="title">TCP and the Nix sandbox   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-postgresqlTestHook-tcp" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p><code class="literal">postgresqlEnableTCP</code> relies on network sandboxing, which is not available on macOS and some custom Nix installations, resulting in flaky tests.
For this reason, it is disabled by default.</p><p>The preferred solution is to make the test suite use a UNIX domain socket connection. This is the default behavior when no <code class="literal">host</code> connection parameter is provided.
Some test suites hardcode a value for <code class="literal">host</code> though, so a patch may be required. If you can upstream the patch, you can make <code class="literal">host</code> default to the <code class="literal">PGHOST</code> environment variable when set. Otherwise, you can patch it locally to omit the <code class="literal">host</code> connection string parameter altogether.</p><div class="note"><h3 class="title">Note</h3><p>The error <code class="literal">libpq: failed (could not receive data from server: Connection refused</code> is generally an indication that the test suite is trying to connect through TCP.</p></div>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="setup-hook-python" class="title" style="clear: both">Python   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#setup-hook-python" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>Adds the <code class="literal">lib/${python.libPrefix}/site-packages</code> subdirectory of each build input to the <code class="literal">PYTHONPATH</code> environment variable.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="scons" class="title" style="clear: both">scons   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#scons" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>Overrides the build, install, and check phases. This uses the scons build system as a replacement for make. scons does not provide a configure phase, so everything is managed at build and install time.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="tetex-tex-live" class="title" style="clear: both">teTeX / TeX Live   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#tetex-tex-live" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>Adds the <code class="literal">share/texmf-nix</code> subdirectory of each build input to the <code class="literal">TEXINPUTS</code> environment variable.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="unzip" class="title" style="clear: both">unzip   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#unzip" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>This setup hook will allow you to unzip .zip files specified in <code class="literal">$src</code>. There are many similar packages like <code class="literal">unrar</code>, <code class="literal">undmg</code>, etc.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="validatepkgconfig" class="title" style="clear: both">validatePkgConfig   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#validatepkgconfig" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>The <code class="literal">validatePkgConfig</code> hook validates all pkg-config (<code class="literal">.pc</code>) files in a package. This helps catching some common errors in pkg-config files, such as undefined variables.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="waf-hook" class="title" style="clear: both">wafHook   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#waf-hook" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#waf-hook-variables-controlling">Variables controlling wafHook</a> </span></dt> </dl></div><p><a class="link" href="https://waf.io/" target="_top">Waf</a> is a Python-based software building system.</p><p>In Nixpkgs, <code class="literal">wafHook</code> overrides the default configure, build, and install phases.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="waf-hook-variables-controlling" class="title">Variables controlling wafHook   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#waf-hook-variables-controlling" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="waf-hook-exclusive-variables" class="title"><code class="literal">wafHook</code> Exclusive Variables   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#waf-hook-exclusive-variables" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>The variables below are exclusive of <code class="literal">wafHook</code>.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="waf-path" class="title"><code class="literal">wafPath</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#waf-path" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Location of the <code class="literal">waf</code> tool. It defaults to <code class="literal">./waf</code>, to honor software projects that include it directly inside their source trees.</p><p>If <code class="literal">wafPath</code> doesn’t exist, then <code class="literal">wafHook</code> will copy the <code class="literal">waf</code> provided from Nixpkgs to it.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="waf-flags" class="title"><code class="literal">wafFlags</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#waf-flags" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Controls the flags passed to waf tool during build and install phases. For settings specific to build or install phases, use <code class="literal">wafBuildFlags</code> or <code class="literal">wafInstallFlags</code> respectively.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="dont-add-waf-cross-flags" class="title"><code class="literal">dontAddWafCrossFlags</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#dont-add-waf-cross-flags" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>When set to <code class="literal">true</code>, don’t add cross compilation flags during configure phase.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="dont-use-waf-configure" class="title"><code class="literal">dontUseWafConfigure</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#dont-use-waf-configure" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>When set to true, don’t use the predefined <code class="literal">wafConfigurePhase</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="dont-use-waf-build" class="title"><code class="literal">dontUseWafBuild</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#dont-use-waf-build" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>When set to true, don’t use the predefined <code class="literal">wafBuildPhase</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="dont-use-waf-install" class="title"><code class="literal">dontUseWafInstall</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#dont-use-waf-install" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>When set to true, don’t use the predefined <code class="literal">wafInstallPhase</code>.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="waf-hook-similar-variables" class="title">Similar variables   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#waf-hook-similar-variables" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>The following variables are similar to their <code class="literal">stdenv.mkDerivation</code> counterparts.</p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col align="left"><col align="left"></colgroup><thead><tr><th align="left"><code class="literal">wafHook</code> Variable</th><th align="left"><code class="literal">stdenv.mkDerivation</code> Counterpart</th></tr></thead><tbody><tr><td align="left"><code class="literal">wafConfigureFlags</code></td><td align="left"><code class="literal">configureFlags</code></td></tr><tr><td align="left"><code class="literal">wafConfigureTargets</code></td><td align="left"><code class="literal">configureTargets</code></td></tr><tr><td align="left"><code class="literal">wafBuildFlags</code></td><td align="left"><code class="literal">buildFlags</code></td></tr><tr><td align="left"><code class="literal">wafBuildTargets</code></td><td align="left"><code class="literal">buildTargets</code></td></tr><tr><td align="left"><code class="literal">wafInstallFlags</code></td><td align="left"><code class="literal">installFlags</code></td></tr><tr><td align="left"><code class="literal">wafInstallTargets</code></td><td align="left"><code class="literal">installTargets</code></td></tr></tbody></table></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="waf-hook-honored-variables" class="title">Honored variables   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#waf-hook-honored-variables" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>The following variables commonly used by <code class="literal">stdenv.mkDerivation</code> are honored by <code class="literal">wafHook</code>.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">prefixKey</code></p></li><li class="listitem"><p><code class="literal">enableParallelBuilding</code></p></li><li class="listitem"><p><code class="literal">enableParallelInstalling</code></p></li></ul></div>
</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="zig-hook" class="title" style="clear: both">zig.hook   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#zig-hook" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#zig-hook-example-code-snippet">Example code snippet</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#zig-hook-variables-controlling">Variables controlling zig.hook</a> </span></dt> </dl></div><p><a class="link" href="https://ziglang.org/" target="_top">Zig</a> is a general-purpose programming language and toolchain for maintaining robust, optimal and reusable software.</p><p>In Nixpkgs, <code class="literal">zig.hook</code> overrides the default build, check and install phases.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="zig-hook-example-code-snippet" class="title">Example code snippet   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#zig-hook-example-code-snippet" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ lib
, stdenv
, zig_0_11
}:

stdenv.mkDerivation {
  <span class="hljs-comment"># . . .</span>

  <span class="hljs-attr">nativeBuildInputs</span> = [
    zig_0_11.hook
  ];

  <span class="hljs-attr">zigBuildFlags</span> = [ <span class="hljs-string">"-Dman-pages=true"</span> ];

  <span class="hljs-attr">dontUseZigCheck</span> = <span class="hljs-literal">true</span>;

  <span class="hljs-comment"># . . .</span>
}
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="zig-hook-variables-controlling" class="title">Variables controlling zig.hook   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#zig-hook-variables-controlling" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="zig-hook-exclusive-variables" class="title"><code class="literal">zig.hook</code> Exclusive Variables   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#zig-hook-exclusive-variables" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>The variables below are exclusive to <code class="literal">zig.hook</code>.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="dont-use-zig-build" class="title"><code class="literal">dontUseZigBuild</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#dont-use-zig-build" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Disables using <code class="literal">zigBuildPhase</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="dont-use-zig-check" class="title"><code class="literal">dontUseZigCheck</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#dont-use-zig-check" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Disables using <code class="literal">zigCheckPhase</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="dont-use-zig-install" class="title"><code class="literal">dontUseZigInstall</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#dont-use-zig-install" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Disables using <code class="literal">zigInstallPhase</code>.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="zig-hook-similar-variables" class="title">Similar variables   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#zig-hook-similar-variables" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>The following variables are similar to their <code class="literal">stdenv.mkDerivation</code> counterparts.</p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col align="left"><col align="left"></colgroup><thead><tr><th align="left"><code class="literal">zig.hook</code> Variable</th><th align="left"><code class="literal">stdenv.mkDerivation</code> Counterpart</th></tr></thead><tbody><tr><td align="left"><code class="literal">zigBuildFlags</code></td><td align="left"><code class="literal">buildFlags</code></td></tr><tr><td align="left"><code class="literal">zigCheckFlags</code></td><td align="left"><code class="literal">checkFlags</code></td></tr><tr><td align="left"><code class="literal">zigInstallFlags</code></td><td align="left"><code class="literal">installFlags</code></td></tr></tbody></table></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="zig-hook-variables-honored" class="title">Variables honored by zig.hook   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#zig-hook-variables-honored" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>The following variables commonly used by <code class="literal">stdenv.mkDerivation</code> are honored by <code class="literal">zig.hook</code>.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">prefixKey</code></p></li><li class="listitem"><p><code class="literal">dontAddPrefix</code></p></li></ul></div>
</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="xcbuildhook" class="title" style="clear: both">xcbuildHook   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#xcbuildhook" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>Overrides the build and install phases to run the “xcbuild” command. This hook is needed when a project only comes with build files for the XCode build system. You can disable this behavior by setting buildPhase and configurePhase to a custom value. xcbuildFlags controls flags passed only to xcbuild.</p>
</div>
</div><div class="chapter"> <div class="titlepage">  <div>   <div>    <h2 id="chap-language-support" class="title">Languages and frameworks   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#chap-language-support" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <p><strong>Table of Contents</strong></p> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#agda">Agda</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#android">Android</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-beam">BEAM Languages (Erlang, Elixir &amp; LFE)</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-bower">Bower</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-chicken">CHICKEN</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-language-coq">Coq and coq packages</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#crystal">Crystal</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#cuda">CUDA</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#cuelang">Cue (Cuelang)</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-language-dart">Dart</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-language-dhall">Dhall</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#dotnet">Dotnet</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#emscripten">Emscripten</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-language-gnome">GNOME</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-language-go">Go</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#haskell">Haskell</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-language-hy">Hy</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#idris">Idris</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ios">iOS</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-language-java">Java</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#language-javascript">Javascript</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#lisp">lisp-modules</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#users-guide-to-lua-infrastructure">User’s Guide to Lua Infrastructure</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#maven">Maven</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#nim">Nim</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-language-ocaml">OCaml</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-octave">Octave</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-language-perl">Perl</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-php">PHP</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-pkg-config">pkg-config</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#python">Python</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-language-qt">Qt</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#r">R</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-language-ruby">Ruby</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#rust">Rust</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#swift">Swift</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-language-texlive">TeX Live</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#titanium">Titanium</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#vim">Vim</a> </span></dt> </dl></div><p>The <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#chap-stdenv" title="The Standard Environment">standard build environment</a> makes it easy to build typical Autotools-based packages with very little code. Any other kind of package can be accommodated by overriding the appropriate phases of <code class="literal">stdenv</code>. However, there are specialised functions in Nixpkgs to easily build packages for other programming languages, such as Perl or Haskell. These are described in this chapter.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="agda" class="title" style="clear: both">Agda   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#agda" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#how-to-use-agda">How to use Agda</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#compiling-agda">Compiling Agda</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#writing-agda-packages">Writing Agda packages</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#maintaining-the-agda-package-set-on-nixpkgs">Maintaining the Agda package set on Nixpkgs</a> </span></dt> </dl></div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="how-to-use-agda" class="title">How to use Agda   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#how-to-use-agda" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Agda is available as the <a class="link" href="https://search.nixos.org/packages?channel=unstable&amp;show=agda&amp;from=0&amp;size=30&amp;sort=relevance&amp;query=agda" target="_top">agda</a>
package.</p><p>The <code class="literal">agda</code> package installs an Agda-wrapper, which calls <code class="literal">agda</code> with <code class="literal">--library-file</code>
set to a generated library-file within the nix store, this means your library-file in
<code class="literal">$HOME/.agda/libraries</code> will be ignored. By default the agda package installs Agda
with no libraries, i.e. the generated library-file is empty. To use Agda with libraries,
the <code class="literal">agda.withPackages</code> function can be used. This function either takes:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>A list of packages,</p></li><li class="listitem"><p>or a function which returns a list of packages when given the <code class="literal">agdaPackages</code> attribute set,</p></li><li class="listitem"><p>or an attribute set containing a list of packages and a GHC derivation for compilation (see below).</p></li><li class="listitem"><p>or an attribute set containing a function which returns a list of packages when given the <code class="literal">agdaPackages</code> attribute set and a GHC derivation for compilation (see below).</p></li></ul></div><p>For example, suppose we wanted a version of Agda which has access to the standard library. This can be obtained with the expressions:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">agda.withPackages [ agdaPackages.standard-library ]
</code></pre><p>or</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">agda.withPackages (p: [ p.standard-library ])
</code></pre><p>or can be called as in the <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#compiling-agda" title="Compiling Agda">Compiling Agda</a> section.</p><p>If you want to use a different version of a library (for instance a development version)
override the <code class="literal">src</code> attribute of the package to point to your local repository</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">agda.withPackages (p: [
  (p.standard-library.overrideAttrs (oldAttrs: {
    <span class="hljs-attr">version</span> = <span class="hljs-string">"local version"</span>;
    <span class="hljs-attr">src</span> = /path/to/local/repo/agda-stdlib;
  }))
])
</code></pre><p>You can also reference a GitHub repository</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">agda.withPackages (p: [
  (p.standard-library.overrideAttrs (oldAttrs: {
    <span class="hljs-attr">version</span> = <span class="hljs-string">"1.5"</span>;
    <span class="hljs-attr">src</span> =  fetchFromGitHub {
      <span class="hljs-attr">repo</span> = <span class="hljs-string">"agda-stdlib"</span>;
      <span class="hljs-attr">owner</span> = <span class="hljs-string">"agda"</span>;
      <span class="hljs-attr">rev</span> = <span class="hljs-string">"v1.5"</span>;
      <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-nEyxYGSWIDNJqBfGpRDLiOAnlHJKEKAOMnIaqfVZzJk="</span>;
    };
  }))
])
</code></pre><p>If you want to use a library not added to Nixpkgs, you can add a
dependency to a local library by calling <code class="literal">agdaPackages.mkDerivation</code>.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">agda.withPackages (p: [
  (p.mkDerivation {
    <span class="hljs-attr">pname</span> = <span class="hljs-string">"your-agda-lib"</span>;
    <span class="hljs-attr">version</span> = <span class="hljs-string">"1.0.0"</span>;
    <span class="hljs-attr">src</span> = /path/to/your-agda-lib;
  })
])
</code></pre><p>Again you can reference GitHub</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">agda.withPackages (p: [
  (p.mkDerivation {
    <span class="hljs-attr">pname</span> = <span class="hljs-string">"your-agda-lib"</span>;
    <span class="hljs-attr">version</span> = <span class="hljs-string">"1.0.0"</span>;
    <span class="hljs-attr">src</span> = fetchFromGitHub {
      <span class="hljs-attr">repo</span> = <span class="hljs-string">"repo"</span>;
      <span class="hljs-attr">owner</span> = <span class="hljs-string">"owner"</span>;
      <span class="hljs-attr">version</span> = <span class="hljs-string">"..."</span>;
      <span class="hljs-attr">rev</span> = <span class="hljs-string">"..."</span>;
      <span class="hljs-attr">hash</span> = <span class="hljs-string">"..."</span>;
    };
  })
])
</code></pre><p>See <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#building-agda-packages" title="Building Agda packages">Building Agda Packages</a> for more information on <code class="literal">mkDerivation</code>.</p><p>Agda will not by default use these libraries. To tell Agda to use a library we have some options:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>Call <code class="literal">agda</code> with the library flag:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">agda -l standard-library -i . MyFile.agda</span>
</code></pre></li><li class="listitem"><p>Write a <code class="literal">my-library.agda-lib</code> file for the project you are working on which may look like:</p><pre><code class="programlisting hljs language-undefined" data-highlighted="yes">name: my-library
include: .
depend: standard-library
</code></pre></li><li class="listitem"><p>Create the file <code class="literal">~/.agda/defaults</code> and add any libraries you want to use by default.</p></li></ul></div><p>More information can be found in the <a class="link" href="https://agda.readthedocs.io/en/v2.6.1/tools/package-system.html" target="_top">official Agda documentation on library management</a>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="compiling-agda" class="title">Compiling Agda   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#compiling-agda" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Agda modules can be compiled using the GHC backend with the <code class="literal">--compile</code> flag. A version of <code class="literal">ghc</code> with <code class="literal">ieee754</code> is made available to the Agda program via the <code class="literal">--with-compiler</code> flag.
This can be overridden by a different version of <code class="literal">ghc</code> as follows:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">agda.withPackages {
  <span class="hljs-attr">pkgs</span> = [ ... ];
  <span class="hljs-attr">ghc</span> = haskell.compiler.ghcHEAD;
}
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="writing-agda-packages" class="title">Writing Agda packages   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#writing-agda-packages" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>To write a nix derivation for an Agda library, first check that the library has a <code class="literal">*.agda-lib</code> file.</p><p>A derivation can then be written using <code class="literal">agdaPackages.mkDerivation</code>. This has similar arguments to <code class="literal">stdenv.mkDerivation</code> with the following additions:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">everythingFile</code> can be used to specify the location of the <code class="literal">Everything.agda</code> file, defaulting to <code class="literal">./Everything.agda</code>. If this file does not exist then either it should be patched in or the <code class="literal">buildPhase</code> should be overridden (see below).</p></li><li class="listitem"><p><code class="literal">libraryName</code> should be the name that appears in the <code class="literal">*.agda-lib</code> file, defaulting to <code class="literal">pname</code>.</p></li><li class="listitem"><p><code class="literal">libraryFile</code> should be the file name of the <code class="literal">*.agda-lib</code> file, defaulting to <code class="literal">${libraryName}.agda-lib</code>.</p></li></ul></div><p>Here is an example <code class="literal">default.nix</code></p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ nixpkgs ?  &lt;nixpkgs&gt; }:
<span class="hljs-keyword">with</span> (<span class="hljs-built_in">import</span> nixpkgs {});
agdaPackages.mkDerivation {
  <span class="hljs-attr">version</span> = <span class="hljs-string">"1.0"</span>;
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"my-agda-lib"</span>;
  <span class="hljs-attr">src</span> = ./.;
  <span class="hljs-attr">buildInputs</span> = [
    agdaPackages.standard-library
  ];
}
</code></pre><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="building-agda-packages" class="title">Building Agda packages   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#building-agda-packages" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>The default build phase for <code class="literal">agdaPackages.mkDerivation</code> runs <code class="literal">agda</code> on the <code class="literal">Everything.agda</code> file.
If something else is needed to build the package (e.g. <code class="literal">make</code>) then the <code class="literal">buildPhase</code> should be overridden.
Additionally, a <code class="literal">preBuild</code> or <code class="literal">configurePhase</code> can be used if there are steps that need to be done prior to checking the <code class="literal">Everything.agda</code> file.
<code class="literal">agda</code> and the Agda libraries contained in <code class="literal">buildInputs</code> are made available during the build phase.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="installing-agda-packages" class="title">Installing Agda packages   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#installing-agda-packages" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>The default install phase copies Agda source files, Agda interface files (<code class="literal">*.agdai</code>) and <code class="literal">*.agda-lib</code> files to the output directory.
This can be overridden.</p><p>By default, Agda sources are files ending on <code class="literal">.agda</code>, or literate Agda files ending on <code class="literal">.lagda</code>, <code class="literal">.lagda.tex</code>, <code class="literal">.lagda.org</code>, <code class="literal">.lagda.md</code>, <code class="literal">.lagda.rst</code>. The list of recognised Agda source extensions can be extended by setting the <code class="literal">extraExtensions</code> config variable.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="maintaining-the-agda-package-set-on-nixpkgs" class="title">Maintaining the Agda package set on Nixpkgs   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#maintaining-the-agda-package-set-on-nixpkgs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>We are aiming at providing all common Agda libraries as packages on <code class="literal">nixpkgs</code>,
and keeping them up to date.
Contributions and maintenance help is always appreciated,
but the maintenance effort is typically low since the Agda ecosystem is quite small.</p><p>The <code class="literal">nixpkgs</code> Agda package set tries to take up a role similar to that of <a class="link" href="https://www.stackage.org/" target="_top">Stackage</a> in the Haskell world.
It is a curated set of libraries that:</p><div class="orderedlist"><ol class="orderedlist compact" type="1"><li class="listitem"><p>Always work together.</p></li><li class="listitem"><p>Are as up-to-date as possible.</p></li></ol></div><p>While the Haskell ecosystem is huge, and Stackage is highly automatised,
the Agda package set is small and can (still) be maintained by hand.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="adding-agda-packages-to-nixpkgs" class="title">Adding Agda packages to Nixpkgs   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#adding-agda-packages-to-nixpkgs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>To add an Agda package to <code class="literal">nixpkgs</code>, the derivation should be written to <code class="literal">pkgs/development/libraries/agda/${library-name}/</code> and an entry should be added to <code class="literal">pkgs/top-level/agda-packages.nix</code>. Here it is called in a scope with access to all other Agda libraries, so the top line of the <code class="literal">default.nix</code> can look like:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ mkDerivation, standard-library, fetchFromGitHub }:
</code></pre><p>Note that the derivation function is called with <code class="literal">mkDerivation</code> set to <code class="literal">agdaPackages.mkDerivation</code>, therefore you
could use a similar set as in your <code class="literal">default.nix</code> from <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#writing-agda-packages" title="Writing Agda packages">Writing Agda Packages</a> with
<code class="literal">agdaPackages.mkDerivation</code> replaced with <code class="literal">mkDerivation</code>.</p><p>Here is an example skeleton derivation for iowa-stdlib:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">mkDerivation {
  <span class="hljs-attr">version</span> = <span class="hljs-string">"1.5.0"</span>;
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"iowa-stdlib"</span>;

  <span class="hljs-attr">src</span> = ...

  <span class="hljs-attr">libraryFile</span> = <span class="hljs-string">""</span>;
  <span class="hljs-attr">libraryName</span> = <span class="hljs-string">"IAL-1.3"</span>;

  <span class="hljs-attr">buildPhase</span> = <span class="hljs-string">''
    patchShebangs find-deps.sh
    make
  ''</span>;
}
</code></pre><p>This library has a file called <code class="literal">.agda-lib</code>, and so we give an empty string to <code class="literal">libraryFile</code> as nothing precedes <code class="literal">.agda-lib</code> in the filename. This file contains <code class="literal">name: IAL-1.3</code>, and so we let <code class="literal">libraryName =  "IAL-1.3"</code>. This library does not use an <code class="literal">Everything.agda</code> file and instead has a Makefile, so there is no need to set <code class="literal">everythingFile</code> and we set a custom <code class="literal">buildPhase</code>.</p><p>When writing an Agda package it is essential to make sure that no <code class="literal">.agda-lib</code> file gets added to the store as a single file (for example by using <code class="literal">writeText</code>). This causes Agda to think that the nix store is a Agda library and it will attempt to write to it whenever it typechecks something. See <a class="link" href="https://github.com/agda/agda/issues/4613" target="_top">https://github.com/agda/agda/issues/4613</a>.</p><p>In the pull request adding this library,
you can test whether it builds correctly by writing in a comment:</p><pre><code class="programlisting hljs language-undefined" data-highlighted="yes">@ofborg build agdaPackages.iowa-stdlib
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="agda-maintaining-packages" class="title">Maintaining Agda packages   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#agda-maintaining-packages" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>As mentioned before, the aim is to have a compatible, and up-to-date package set.
These two conditions sometimes exclude each other:
For example, if we update <code class="literal">agdaPackages.standard-library</code> because there was an upstream release,
this will typically break many reverse dependencies,
i.e. downstream Agda libraries that depend on the standard library.
In <code class="literal">nixpkgs</code> we are typically among the first to notice this,
since we have build tests in place to check this.</p><p>In a pull request updating e.g. the standard library, you should write the following comment:</p><pre><code class="programlisting hljs language-undefined" data-highlighted="yes">@ofborg build agdaPackages.standard-library.passthru.tests
</code></pre><p>This will build all reverse dependencies of the standard library,
for example <code class="literal">agdaPackages.agda-categories</code>, or <code class="literal">agdaPackages.generic</code>.</p><p>In some cases it is useful to build <span class="emphasis"><em>all</em></span> Agda packages.
This can be done with the following Github comment:</p><pre><code class="programlisting hljs language-undefined" data-highlighted="yes">@ofborg build agda.passthru.tests.allPackages
</code></pre><p>Sometimes, the builds of the reverse dependencies fail because they have not yet been updated and released.
You should drop the maintainers a quick issue notifying them of the breakage,
citing the build error (which you can get from the ofborg logs).
If you are motivated, you might even send a pull request that fixes it.
Usually, the maintainers will answer within a week or two with a new release.
Bumping the version of that reverse dependency should be a further commit on your PR.</p><p>In the rare case that a new release is not to be expected within an acceptable time,
mark the broken package as broken by setting <code class="literal">meta.broken = true;</code>.
This will exclude it from the build test.
It can be added later when it is fixed,
and does not hinder the advancement of the whole package set in the meantime.</p>
</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="android" class="title" style="clear: both">Android   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#android" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#deploying-an-android-sdk-installation-with-plugins">Deploying an Android SDK installation with plugins</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#using-predefined-android-package-compositions">Using predefined Android package compositions</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#building-an-android-application">Building an Android application</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#spawning-emulator-instances">Spawning emulator instances</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#notes-on-environment-variables-in-android-projects">Notes on environment variables in Android projects</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#notes-on-improving-build.gradle-compatibility">Notes on improving build.gradle compatibility</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#querying-the-available-versions-of-each-plugin">Querying the available versions of each plugin</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#updating-the-generated-expressions">Updating the generated expressions</a> </span></dt> </dl></div><p>The Android build environment provides three major features and a number of
supporting features.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="deploying-an-android-sdk-installation-with-plugins" class="title">Deploying an Android SDK installation with plugins   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#deploying-an-android-sdk-installation-with-plugins" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The first use case is deploying the SDK with a desired set of plugins or subsets
of an SDK.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">with</span> <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {};

<span class="hljs-keyword">let</span>
  <span class="hljs-attr">androidComposition</span> = androidenv.composeAndroidPackages {
    <span class="hljs-attr">cmdLineToolsVersion</span> = <span class="hljs-string">"8.0"</span>;
    <span class="hljs-attr">toolsVersion</span> = <span class="hljs-string">"26.1.1"</span>;
    <span class="hljs-attr">platformToolsVersion</span> = <span class="hljs-string">"30.0.5"</span>;
    <span class="hljs-attr">buildToolsVersions</span> = [ <span class="hljs-string">"30.0.3"</span> ];
    <span class="hljs-attr">includeEmulator</span> = <span class="hljs-literal">false</span>;
    <span class="hljs-attr">emulatorVersion</span> = <span class="hljs-string">"30.3.4"</span>;
    <span class="hljs-attr">platformVersions</span> = [ <span class="hljs-string">"28"</span> <span class="hljs-string">"29"</span> <span class="hljs-string">"30"</span> ];
    <span class="hljs-attr">includeSources</span> = <span class="hljs-literal">false</span>;
    <span class="hljs-attr">includeSystemImages</span> = <span class="hljs-literal">false</span>;
    <span class="hljs-attr">systemImageTypes</span> = [ <span class="hljs-string">"google_apis_playstore"</span> ];
    <span class="hljs-attr">abiVersions</span> = [ <span class="hljs-string">"armeabi-v7a"</span> <span class="hljs-string">"arm64-v8a"</span> ];
    <span class="hljs-attr">cmakeVersions</span> = [ <span class="hljs-string">"3.10.2"</span> ];
    <span class="hljs-attr">includeNDK</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-attr">ndkVersions</span> = [<span class="hljs-string">"22.0.7026061"</span>];
    <span class="hljs-attr">useGoogleAPIs</span> = <span class="hljs-literal">false</span>;
    <span class="hljs-attr">useGoogleTVAddOns</span> = <span class="hljs-literal">false</span>;
    <span class="hljs-attr">includeExtras</span> = [
      <span class="hljs-string">"extras;google;gcm"</span>
    ];
  };
<span class="hljs-keyword">in</span>
androidComposition.androidsdk
</code></pre><p>The above function invocation states that we want an Android SDK with the above
specified plugin versions. By default, most plugins are disabled. Notable
exceptions are the tools, platform-tools and build-tools sub packages.</p><p>The following parameters are supported:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">cmdLineToolsVersion </code>, specifies the version of the <code class="literal">cmdline-tools</code> package to use</p></li><li class="listitem"><p><code class="literal">toolsVersion</code>, specifies the version of the <code class="literal">tools</code> package. Notice <code class="literal">tools</code> is
obsolete, and currently only <code class="literal">26.1.1</code> is available, so there’s not a lot of
options here, however, you can set it as <code class="literal">null</code> if you don’t want it.</p></li><li class="listitem"><p><code class="literal">platformsToolsVersion</code> specifies the version of the <code class="literal">platform-tools</code> plugin</p></li><li class="listitem"><p><code class="literal">buildToolsVersions</code> specifies the versions of the <code class="literal">build-tools</code> plugins to
use.</p></li><li class="listitem"><p><code class="literal">includeEmulator</code> specifies whether to deploy the emulator package (<code class="literal">false</code>
by default). When enabled, the version of the emulator to deploy can be
specified by setting the <code class="literal">emulatorVersion</code> parameter.</p></li><li class="listitem"><p><code class="literal">cmakeVersions</code> specifies which CMake versions should be deployed.</p></li><li class="listitem"><p><code class="literal">includeNDK</code> specifies that the Android NDK bundle should be included.
Defaults to: <code class="literal">false</code>.</p></li><li class="listitem"><p><code class="literal">ndkVersions</code> specifies the NDK versions that we want to use. These are linked
under the <code class="literal">ndk</code> directory of the SDK root, and the first is linked under the
<code class="literal">ndk-bundle</code> directory.</p></li><li class="listitem"><p><code class="literal">ndkVersion</code> is equivalent to specifying one entry in <code class="literal">ndkVersions</code>, and
<code class="literal">ndkVersions</code> overrides this parameter if provided.</p></li><li class="listitem"><p><code class="literal">includeExtras</code> is an array of identifier strings referring to arbitrary
add-on packages that should be installed.</p></li><li class="listitem"><p><code class="literal">platformVersions</code> specifies which platform SDK versions should be included.</p></li></ul></div><p>For each platform version that has been specified, we can apply the following
options:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">includeSystemImages</code> specifies whether a system image for each platform SDK
should be included.</p></li><li class="listitem"><p><code class="literal">includeSources</code> specifies whether the sources for each SDK version should be
included.</p></li><li class="listitem"><p><code class="literal">useGoogleAPIs</code> specifies that for each selected platform version the
Google API should be included.</p></li><li class="listitem"><p><code class="literal">useGoogleTVAddOns</code> specifies that for each selected platform version the
Google TV add-on should be included.</p></li></ul></div><p>For each requested system image we can specify the following options:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">systemImageTypes</code> specifies what kind of system images should be included.
Defaults to: <code class="literal">default</code>.</p></li><li class="listitem"><p><code class="literal">abiVersions</code> specifies what kind of ABI version of each system image should
be included. Defaults to: <code class="literal">armeabi-v7a</code>.</p></li></ul></div><p>Most of the function arguments have reasonable default settings.</p><p>You can specify license names:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">extraLicenses</code> is a list of license names.
You can get these names from repo.json or <code class="literal">querypackages.sh licenses</code>. The SDK
license (<code class="literal">android-sdk-license</code>) is accepted for you if you set accept_license
to true. If you are doing something like working with preview SDKs, you will
want to add <code class="literal">android-sdk-preview-license</code> or whichever license applies here.</p></li></ul></div><p>Additionally, you can override the repositories that composeAndroidPackages will
pull from:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">repoJson</code> specifies a path to a generated repo.json file. You can generate this
by running <code class="literal">generate.sh</code>, which in turn will call into <code class="literal">mkrepo.rb</code>.</p></li><li class="listitem"><p><code class="literal">repoXmls</code> is an attribute set containing paths to repo XML files. If specified,
it takes priority over <code class="literal">repoJson</code>, and will trigger a local build writing out a
repo.json to the Nix store based on the given repository XMLs.</p></li></ul></div><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">repoXmls</span> = {
  <span class="hljs-attr">packages</span> = [ ./xml/repository2-<span class="hljs-number">1</span>.xml ];
  <span class="hljs-attr">images</span> = [
    ./xml/android-sys-img2-<span class="hljs-number">1</span>.xml
    ./xml/android-tv-sys-img2-<span class="hljs-number">1</span>.xml
    ./xml/android-wear-sys-img2-<span class="hljs-number">1</span>.xml
    ./xml/android-wear-cn-sys-img2-<span class="hljs-number">1</span>.xml
    ./xml/google_apis-sys-img2-<span class="hljs-number">1</span>.xml
    ./xml/google_apis_playstore-sys-img2-<span class="hljs-number">1</span>.xml
  ];
  <span class="hljs-attr">addons</span> = [ ./xml/addon2-<span class="hljs-number">1</span>.xml ];
};
</code></pre><p>When building the above expression with:</p><pre><code class="programlisting bash hljs language-bash" data-highlighted="yes">$ nix-build
</code></pre><p>The Android SDK gets deployed with all desired plugin versions.</p><p>We can also deploy subsets of the Android SDK. For example, to only the
<code class="literal">platform-tools</code> package, you can evaluate the following expression:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">with</span> <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {};

<span class="hljs-keyword">let</span>
  <span class="hljs-attr">androidComposition</span> = androidenv.composeAndroidPackages {
    <span class="hljs-comment"># ...</span>
  };
<span class="hljs-keyword">in</span>
androidComposition.platform-tools
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="using-predefined-android-package-compositions" class="title">Using predefined Android package compositions   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#using-predefined-android-package-compositions" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>In addition to composing an Android package set manually, it is also possible
to use a predefined composition that contains all basic packages for a specific
Android version, such as version 9.0 (API-level 28).</p><p>The following Nix expression can be used to deploy the entire SDK with all basic
plugins:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">with</span> <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {};

androidenv.androidPkgs_9_0.androidsdk
</code></pre><p>It is also possible to use one plugin only:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">with</span> <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {};

androidenv.androidPkgs_9_0.platform-tools
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="building-an-android-application" class="title">Building an Android application   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#building-an-android-application" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>In addition to the SDK, it is also possible to build an Ant-based Android
project and automatically deploy all the Android plugins that a project
requires.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">with</span> <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {};

androidenv.buildApp {
  <span class="hljs-attr">name</span> = <span class="hljs-string">"MyAndroidApp"</span>;
  <span class="hljs-attr">src</span> = ./myappsources;
  <span class="hljs-attr">release</span> = <span class="hljs-literal">true</span>;

  <span class="hljs-comment"># If release is set to true, you need to specify the following parameters</span>
  <span class="hljs-attr">keyStore</span> = ./keystore;
  <span class="hljs-attr">keyAlias</span> = <span class="hljs-string">"myfirstapp"</span>;
  <span class="hljs-attr">keyStorePassword</span> = <span class="hljs-string">"mykeystore"</span>;
  <span class="hljs-attr">keyAliasPassword</span> = <span class="hljs-string">"myfirstapp"</span>;

  <span class="hljs-comment"># Any Android SDK parameters that install all the relevant plugins that a</span>
  <span class="hljs-comment"># build requires</span>
  <span class="hljs-attr">platformVersions</span> = [ <span class="hljs-string">"24"</span> ];

  <span class="hljs-comment"># When we include the NDK, then ndk-build is invoked before Ant gets invoked</span>
  <span class="hljs-attr">includeNDK</span> = <span class="hljs-literal">true</span>;
}
</code></pre><p>Aside from the app-specific build parameters (<code class="literal">name</code>, <code class="literal">src</code>, <code class="literal">release</code> and
keystore parameters), the <code class="literal">buildApp {}</code> function supports all the function
parameters that the SDK composition function (the function shown in the
previous section) supports.</p><p>This build function is particularly useful when it is desired to use
<a class="link" href="https://nixos.org/hydra" target="_top">Hydra</a>: the Nix-based continuous integration solution
to build Android apps. An Android APK gets exposed as a build product and can be
installed on any Android device with a web browser by navigating to the build
result page.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="spawning-emulator-instances" class="title">Spawning emulator instances   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#spawning-emulator-instances" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>For testing purposes, it can also be quite convenient to automatically generate
scripts that spawn emulator instances with all desired configuration settings.</p><p>An emulator spawn script can be configured by invoking the <code class="literal">emulateApp {}</code>
function:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">with</span> <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {};

androidenv.emulateApp {
  <span class="hljs-attr">name</span> = <span class="hljs-string">"emulate-MyAndroidApp"</span>;
  <span class="hljs-attr">platformVersion</span> = <span class="hljs-string">"28"</span>;
  <span class="hljs-attr">abiVersion</span> = <span class="hljs-string">"x86"</span>; <span class="hljs-comment"># armeabi-v7a, mips, x86_64</span>
  <span class="hljs-attr">systemImageType</span> = <span class="hljs-string">"google_apis_playstore"</span>;
}
</code></pre><p>Additional flags may be applied to the Android SDK’s emulator through the runtime environment variable <code class="literal">$NIX_ANDROID_EMULATOR_FLAGS</code>.</p><p>It is also possible to specify an APK to deploy inside the emulator
and the package and activity names to launch it:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">with</span> <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {};

androidenv.emulateApp {
  <span class="hljs-attr">name</span> = <span class="hljs-string">"emulate-MyAndroidApp"</span>;
  <span class="hljs-attr">platformVersion</span> = <span class="hljs-string">"24"</span>;
  <span class="hljs-attr">abiVersion</span> = <span class="hljs-string">"armeabi-v7a"</span>; <span class="hljs-comment"># mips, x86, x86_64</span>
  <span class="hljs-attr">systemImageType</span> = <span class="hljs-string">"default"</span>;
  <span class="hljs-attr">app</span> = ./MyApp.apk;
  <span class="hljs-attr">package</span> = <span class="hljs-string">"MyApp"</span>;
  <span class="hljs-attr">activity</span> = <span class="hljs-string">"MainActivity"</span>;
}
</code></pre><p>In addition to prebuilt APKs, you can also bind the APK parameter to a
<code class="literal">buildApp {}</code> function invocation shown in the previous example.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="notes-on-environment-variables-in-android-projects" class="title">Notes on environment variables in Android projects   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#notes-on-environment-variables-in-android-projects" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">ANDROID_SDK_ROOT</code> should point to the Android SDK. In your Nix expressions, this should be
<code class="literal">${androidComposition.androidsdk}/libexec/android-sdk</code>. Note that <code class="literal">ANDROID_HOME</code> is deprecated,
but if you rely on tools that need it, you can export it too.</p></li><li class="listitem"><p><code class="literal">ANDROID_NDK_ROOT</code> should point to the Android NDK, if you’re doing NDK development.
In your Nix expressions, this should be <code class="literal">${ANDROID_SDK_ROOT}/ndk-bundle</code>.</p></li></ul></div><p>If you are running the Android Gradle plugin, you need to export GRADLE_OPTS to override aapt2
to point to the aapt2 binary in the Nix store as well, or use a FHS environment so the packaged
aapt2 can run. If you don’t want to use a FHS environment, something like this should work:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">let</span>
  <span class="hljs-attr">buildToolsVersion</span> = <span class="hljs-string">"30.0.3"</span>;

  <span class="hljs-comment"># Use buildToolsVersion when you define androidComposition</span>
  <span class="hljs-attr">androidComposition</span> = &lt;...&gt;;
<span class="hljs-keyword">in</span>
pkgs.mkShell <span class="hljs-keyword">rec</span> {
  <span class="hljs-attr">ANDROID_SDK_ROOT</span> = <span class="hljs-string">"<span class="hljs-subst">${androidComposition.androidsdk}</span>/libexec/android-sdk"</span>;
  <span class="hljs-attr">ANDROID_NDK_ROOT</span> = <span class="hljs-string">"<span class="hljs-subst">${ANDROID_SDK_ROOT}</span>/ndk-bundle"</span>;

  <span class="hljs-comment"># Use the same buildToolsVersion here</span>
  <span class="hljs-attr">GRADLE_OPTS</span> = <span class="hljs-string">"-Dorg.gradle.project.android.aapt2FromMavenOverride=<span class="hljs-subst">${ANDROID_SDK_ROOT}</span>/build-tools/<span class="hljs-subst">${buildToolsVersion}</span>/aapt2"</span>;
}
</code></pre><p>If you are using cmake, you need to add it to PATH in a shell hook or FHS env profile.
The path is suffixed with a build number, but properly prefixed with the version.
So, something like this should suffice:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">let</span>
  <span class="hljs-attr">cmakeVersion</span> = <span class="hljs-string">"3.10.2"</span>;

  <span class="hljs-comment"># Use cmakeVersion when you define androidComposition</span>
  <span class="hljs-attr">androidComposition</span> = &lt;...&gt;;
<span class="hljs-keyword">in</span>
pkgs.mkShell <span class="hljs-keyword">rec</span> {
  <span class="hljs-attr">ANDROID_SDK_ROOT</span> = <span class="hljs-string">"<span class="hljs-subst">${androidComposition.androidsdk}</span>/libexec/android-sdk"</span>;
  <span class="hljs-attr">ANDROID_NDK_ROOT</span> = <span class="hljs-string">"<span class="hljs-subst">${ANDROID_SDK_ROOT}</span>/ndk-bundle"</span>;

  <span class="hljs-comment"># Use the same cmakeVersion here</span>
  <span class="hljs-attr">shellHook</span> = <span class="hljs-string">''
    export PATH="$(echo "$ANDROID_SDK_ROOT/cmake/<span class="hljs-subst">${cmakeVersion}</span>".*/bin):$PATH"
  ''</span>;
}
</code></pre><p>Note that running Android Studio with ANDROID_SDK_ROOT set will automatically write a
<code class="literal">local.properties</code> file with <code class="literal">sdk.dir</code> set to $ANDROID_SDK_ROOT if one does not already
exist. If you are using the NDK as well, you may have to add <code class="literal">ndk.dir</code> to this file.</p><p>An example shell.nix that does all this for you is provided in examples/shell.nix.
This shell.nix includes a shell hook that overwrites local.properties with the correct
sdk.dir and ndk.dir values. This will ensure that the SDK and NDK directories will
both be correct when you run Android Studio inside nix-shell.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="notes-on-improving-build.gradle-compatibility" class="title">Notes on improving build.gradle compatibility   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#notes-on-improving-build.gradle-compatibility" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Ensure that your buildToolsVersion and ndkVersion match what is declared in androidenv.
If you are using cmake, make sure its declared version is correct too.</p><p>Otherwise, you may get cryptic errors from aapt2 and the Android Gradle plugin warning
that it cannot install the build tools because the SDK directory is not writeable.</p><pre><code class="programlisting gradle hljs language-nix" data-highlighted="yes">android {
    buildToolsVersion <span class="hljs-string">"30.0.3"</span>
    <span class="hljs-attr">ndkVersion</span> = <span class="hljs-string">"22.0.7026061"</span>
    externalNativeBuild {
        cmake {
            version <span class="hljs-string">"3.10.2"</span>
        }
    }
}

</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="querying-the-available-versions-of-each-plugin" class="title">Querying the available versions of each plugin   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#querying-the-available-versions-of-each-plugin" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>repo.json provides all the options in one file now.</p><p>A shell script in the <code class="literal">pkgs/development/mobile/androidenv/</code> subdirectory can be used to retrieve all
possible options:</p><pre><code class="programlisting bash hljs language-bash" data-highlighted="yes">./querypackages.sh packages
</code></pre><p>The above command-line instruction queries all package versions in repo.json.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="updating-the-generated-expressions" class="title">Updating the generated expressions   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#updating-the-generated-expressions" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>repo.json is generated from XML files that the Android Studio package manager uses.
To update the expressions run the <code class="literal">generate.sh</code> script that is stored in the
<code class="literal">pkgs/development/mobile/androidenv/</code> subdirectory:</p><pre><code class="programlisting bash hljs language-bash" data-highlighted="yes">./generate.sh
</code></pre>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-beam" class="title" style="clear: both">BEAM Languages (Erlang, Elixir &amp; LFE)   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-beam" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#beam-introduction">Introduction</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#available-versions-and-deprecations-schedule">Available versions and deprecations schedule</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#beam-structure">Structure</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#build-tools">Build Tools</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#how-to-install-beam-packages">How to Install BEAM Packages</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#packaging-beam-applications">Packaging BEAM Applications</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#how-to-develop">How to Develop</a> </span></dt> </dl></div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="beam-introduction" class="title">Introduction   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#beam-introduction" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>In this document and related Nix expressions, we use the term, <span class="emphasis"><em>BEAM</em></span>, to describe the environment. BEAM is the name of the Erlang Virtual Machine and, as far as we’re concerned, from a packaging perspective, all languages that run on the BEAM are interchangeable. That which varies, like the build system, is transparent to users of any given BEAM package, so we make no distinction.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="available-versions-and-deprecations-schedule" class="title">Available versions and deprecations schedule   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#available-versions-and-deprecations-schedule" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="elixir" class="title">Elixir   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#elixir" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>nixpkgs follows the <a class="link" href="https://hexdocs.pm/elixir/compatibility-and-deprecations.html" target="_top">official elixir deprecation schedule</a> and keeps the last 5 released versions of Elixir available.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="beam-structure" class="title">Structure   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#beam-structure" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>All BEAM-related expressions are available via the top-level <code class="literal">beam</code> attribute, which includes:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><code class="literal">interpreters</code>: a set of compilers running on the BEAM, including multiple Erlang/OTP versions (<code class="literal">beam.interpreters.erlang_22</code>, etc), Elixir (<code class="literal">beam.interpreters.elixir</code>) and LFE (Lisp Flavoured Erlang) (<code class="literal">beam.interpreters.lfe</code>).</p></li><li class="listitem"><p><code class="literal">packages</code>: a set of package builders (Mix and rebar3), each compiled with a specific Erlang/OTP version, e.g. <code class="literal">beam.packages.erlang22</code>.</p></li></ul></div><p>The default Erlang compiler, defined by <code class="literal">beam.interpreters.erlang</code>, is aliased as <code class="literal">erlang</code>. The default BEAM package set is defined by <code class="literal">beam.packages.erlang</code> and aliased at the top level as <code class="literal">beamPackages</code>.</p><p>To create a package builder built with a custom Erlang version, use the lambda, <code class="literal">beam.packagesWith</code>, which accepts an Erlang/OTP derivation and produces a package builder similar to <code class="literal">beam.packages.erlang</code>.</p><p>Many Erlang/OTP distributions available in <code class="literal">beam.interpreters</code> have versions with ODBC and/or Java enabled or without wx (no observer support). For example, there’s <code class="literal">beam.interpreters.erlang_22_odbc_javac</code>, which corresponds to <code class="literal">beam.interpreters.erlang_22</code> and <code class="literal">beam.interpreters.erlang_22_nox</code>, which corresponds to <code class="literal">beam.interpreters.erlang_22</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="build-tools" class="title">Build Tools   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#build-tools" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="build-tools-rebar3" class="title">Rebar3   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#build-tools-rebar3" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>We provide a version of Rebar3, under <code class="literal">rebar3</code>. We also provide a helper to fetch Rebar3 dependencies from a lockfile under <code class="literal">fetchRebar3Deps</code>.</p><p>We also provide a version on Rebar3 with plugins included, under <code class="literal">rebar3WithPlugins</code>. This package is a function which takes two arguments: <code class="literal">plugins</code>, a list of nix derivations to include as plugins (loaded only when specified in <code class="literal">rebar.config</code>), and <code class="literal">globalPlugins</code>, which should always be loaded by rebar3. Example: <code class="literal">rebar3WithPlugins { globalPlugins = [beamPackages.pc]; }</code>.</p><p>When adding a new plugin it is important that the <code class="literal">packageName</code> attribute is the same as the atom used by rebar3 to refer to the plugin.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="build-tools-other" class="title">Mix &amp; Erlang.mk   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#build-tools-other" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Erlang.mk works exactly as expected. There is a bootstrap process that needs to be run, which is supported by the <code class="literal">buildErlangMk</code> derivation.</p><p>For Elixir applications use <code class="literal">mixRelease</code> to make a release. See examples for more details.</p><p>There is also a <code class="literal">buildMix</code> helper, whose behavior is closer to that of <code class="literal">buildErlangMk</code> and <code class="literal">buildRebar3</code>. The primary difference is that mixRelease makes a release, while buildMix only builds the package, making it useful for libraries and other dependencies.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="how-to-install-beam-packages" class="title">How to Install BEAM Packages   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#how-to-install-beam-packages" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>BEAM builders are not registered at the top level, because they are not relevant to the vast majority of Nix users.
To use any of those builders into your environment, refer to them by their attribute path under <code class="literal">beamPackages</code>, e.g. <code class="literal">beamPackages.rebar3</code>:</p><div class="example"><span id="ex-beam-ephemeral-shell"></span><p class="title"><strong>Example&nbsp;235.&nbsp;Ephemeral shell</strong></p><div class="example-contents"><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">nix-shell -p beamPackages.rebar3</span>
</code></pre></div></div><br class="example-break"><div class="example"><span id="ex-beam-declarative-shell"></span><p class="title"><strong>Example&nbsp;236.&nbsp;Declarative shell</strong></p><div class="example-contents"><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">let</span>
  <span class="hljs-attr">pkgs</span> = <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; { <span class="hljs-attr">config</span> = {}; <span class="hljs-attr">overlays</span> = []; };
<span class="hljs-keyword">in</span>
pkgs.mkShell {
  <span class="hljs-attr">packages</span> = [ pkgs.beamPackages.rebar3 ];
}
</code></pre></div></div><br class="example-break">
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="packaging-beam-applications" class="title">Packaging BEAM Applications   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#packaging-beam-applications" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="packaging-erlang-applications" class="title">Erlang Applications   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#packaging-erlang-applications" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="rebar3-packages" class="title">Rebar3 Packages   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#rebar3-packages" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>The Nix function, <code class="literal">buildRebar3</code>, defined in <code class="literal">beam.packages.erlang.buildRebar3</code> and aliased at the top level, can be used to build a derivation that understands how to build a Rebar3 project.</p><p>If a package needs to compile native code via Rebar3’s port compilation mechanism, add <code class="literal">compilePort = true;</code> to the derivation.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="erlang-mk-packages" class="title">Erlang.mk Packages   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#erlang-mk-packages" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Erlang.mk functions similarly to Rebar3, except we use <code class="literal">buildErlangMk</code> instead of <code class="literal">buildRebar3</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="mix-packages" class="title">Mix Packages   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#mix-packages" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p><code class="literal">mixRelease</code> is used to make a release in the mix sense. Dependencies will need to be fetched with <code class="literal">fetchMixDeps</code> and passed to it.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="mix-release-elixir-phoenix-example" class="title">mixRelease - Elixir Phoenix example   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#mix-release-elixir-phoenix-example" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>there are 3 steps, frontend dependencies (javascript), backend dependencies (elixir) and the final derivation that puts both of those together</p><div class="section"> <div class="titlepage">  <div>   <div>    <h6 id="mix-release-javascript-deps" class="title">mixRelease - Frontend dependencies (javascript)   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#mix-release-javascript-deps" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h6>  </div> </div></div><p>For phoenix projects, inside of nixpkgs you can either use yarn2nix (mkYarnModule) or node2nix. An example with yarn2nix can be found <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/servers/web-apps/plausible/default.nix#L39" target="_top">here</a>. An example with node2nix will follow. To package something outside of nixpkgs, you have alternatives like <a class="link" href="https://github.com/nix-community/npmlock2nix" target="_top">npmlock2nix</a> or <a class="link" href="https://github.com/serokell/nix-npm-buildpackage" target="_top">nix-npm-buildpackage</a></p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h6 id="mix-release-mix-deps" class="title">mixRelease - backend dependencies (mix)   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#mix-release-mix-deps" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h6>  </div> </div></div><p>There are 2 ways to package backend dependencies. With mix2nix and with a fixed-output-derivation (FOD).</p><div class="section"> <div class="titlepage">  <div>   <div>    <h6 id="mix2nix" class="title">mix2nix   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#mix2nix" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h6>  </div> </div></div><p><code class="literal">mix2nix</code> is a cli tool available in nixpkgs. it will generate a nix expression from a mix.lock file. It is quite standard in the 2nix tool series.</p><p>Note that currently mix2nix can’t handle git dependencies inside the mix.lock file. If you have git dependencies, you can either add them manually (see <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/servers/pleroma/default.nix#L20" target="_top">example</a>) or use the FOD method.</p><p>The advantage of using mix2nix is that nix will know your whole dependency graph. On a dependency update, this won’t trigger a full rebuild and download of all the dependencies, where FOD will do so.</p><p>Practical steps:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>run <code class="literal">mix2nix &gt; mix_deps.nix</code> in the upstream repo.</p></li><li class="listitem"><p>pass <code class="literal">mixNixDeps = with pkgs; import ./mix_deps.nix { inherit lib beamPackages; };</code> as an argument to mixRelease.</p></li></ul></div><p>If there are git dependencies.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>You’ll need to fix the version artificially in mix.exs and regenerate the mix.lock with fixed version (on upstream). This will enable you to run <code class="literal">mix2nix &gt; mix_deps.nix</code>.</p></li><li class="listitem"><p>From the mix_deps.nix file, remove the dependencies that had git versions and pass them as an override to the import function.</p></li></ul></div><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">  <span class="hljs-attr">mixNixDeps</span> = <span class="hljs-built_in">import</span> ./mix.nix {
    <span class="hljs-keyword">inherit</span> beamPackages lib;
    <span class="hljs-attr">overrides</span> = (final: prev: {
      <span class="hljs-comment"># mix2nix does not support git dependencies yet,</span>
      <span class="hljs-comment"># so we need to add them manually</span>
      <span class="hljs-attr">prometheus_ex</span> = beamPackages.buildMix <span class="hljs-keyword">rec</span> {
        <span class="hljs-attr">name</span> = <span class="hljs-string">"prometheus_ex"</span>;
        <span class="hljs-attr">version</span> = <span class="hljs-string">"3.0.5"</span>;

        <span class="hljs-comment"># Change the argument src with the git src that you actually need</span>
        <span class="hljs-attr">src</span> = fetchFromGitLab {
          <span class="hljs-attr">domain</span> = <span class="hljs-string">"git.pleroma.social"</span>;
          <span class="hljs-attr">group</span> = <span class="hljs-string">"pleroma"</span>;
          <span class="hljs-attr">owner</span> = <span class="hljs-string">"elixir-libraries"</span>;
          <span class="hljs-attr">repo</span> = <span class="hljs-string">"prometheus.ex"</span>;
          <span class="hljs-attr">rev</span> = <span class="hljs-string">"a4e9beb3c1c479d14b352fd9d6dd7b1f6d7deee5"</span>;
          <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-U17LlN6aGUKUFnT4XyYXppRN+TvUBIBRHEUsfeIiGOw="</span>;
        };
        <span class="hljs-comment"># you can re-use the same beamDeps argument as generated</span>
        <span class="hljs-attr">beamDeps</span> = <span class="hljs-keyword">with</span> final; [ prometheus ];
      };
  });
};
</code></pre><p>You will need to run the build process once to fix the hash to correspond to your new git src.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h6 id="fixed-output-derivation" class="title">FOD   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#fixed-output-derivation" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h6>  </div> </div></div><p>A fixed output derivation will download mix dependencies from the internet. To ensure reproducibility, a hash will be supplied. Note that mix is relatively reproducible. An FOD generating a different hash on each run hasn’t been observed (as opposed to npm where the chances are relatively high). See <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/development/beam-modules/elixir-ls/default.nix" target="_top">elixir-ls</a> for a usage example of FOD.</p><p>Practical steps</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>start with the following argument to mixRelease</p></li></ul></div><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">  <span class="hljs-attr">mixFodDeps</span> = fetchMixDeps {
    <span class="hljs-attr">pname</span> = <span class="hljs-string">"mix-deps-<span class="hljs-subst">${pname}</span>"</span>;
    <span class="hljs-keyword">inherit</span> src version;
    <span class="hljs-attr">hash</span> = lib.fakeHash;
  };
</code></pre><p>The first build will complain about the hash value, you can replace with the suggested value after that.</p><p>Note that if after you’ve replaced the value, nix suggests another hash, then mix is not fetching the dependencies reproducibly. An FOD will not work in that case and you will have to use mix2nix.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h6 id="mix-release-example" class="title">mixRelease - example   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#mix-release-example" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h6>  </div> </div></div><p>Here is how your <code class="literal">default.nix</code> file would look for a phoenix project.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">with</span> <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; { };

<span class="hljs-keyword">let</span>
  <span class="hljs-comment"># beam.interpreters.erlang_26 is available if you need a particular version</span>
  <span class="hljs-attr">packages</span> = beam.packagesWith beam.interpreters.erlang;

  <span class="hljs-attr">pname</span> = <span class="hljs-string">"your_project"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"0.0.1"</span>;

  <span class="hljs-attr">src</span> = <span class="hljs-built_in">builtins</span>.fetchgit {
    <span class="hljs-attr">url</span> = <span class="hljs-string">"ssh://git@github.com/your_id/your_repo"</span>;
    <span class="hljs-attr">rev</span> = <span class="hljs-string">"replace_with_your_commit"</span>;
  };

  <span class="hljs-comment"># if using mix2nix you can use the mixNixDeps attribute</span>
  <span class="hljs-attr">mixFodDeps</span> = packages.fetchMixDeps {
    <span class="hljs-attr">pname</span> = <span class="hljs-string">"mix-deps-<span class="hljs-subst">${pname}</span>"</span>;
    <span class="hljs-keyword">inherit</span> src version;
    <span class="hljs-comment"># nix will complain and tell you the right value to replace this with</span>
    <span class="hljs-attr">hash</span> = lib.fakeHash;
    <span class="hljs-attr">mixEnv</span> = <span class="hljs-string">""</span>; <span class="hljs-comment"># default is "prod", when empty includes all dependencies, such as "dev", "test".</span>
    <span class="hljs-comment"># if you have build time environment variables add them here</span>
    <span class="hljs-attr">MY_ENV_VAR="my_value";</span>
  };

  <span class="hljs-attr">nodeDependencies</span> = (pkgs.callPackage ./assets/default.nix { }).shell.nodeDependencies;

<span class="hljs-keyword">in</span> packages.mixRelease {
  <span class="hljs-keyword">inherit</span> src pname version mixFodDeps;
  <span class="hljs-comment"># if you have build time environment variables add them here</span>
  <span class="hljs-attr">MY_ENV_VAR="my_value";</span>

  <span class="hljs-attr">postBuild</span> = <span class="hljs-string">''
    ln -sf <span class="hljs-subst">${nodeDependencies}</span>/lib/node_modules assets/node_modules
    npm run deploy --prefix ./assets

    # for external task you need a workaround for the no deps check flag
    # https://github.com/phoenixframework/phoenix/issues/2690
    mix do deps.loadpaths --no-deps-check, phx.digest
    mix phx.digest --no-deps-check
  ''</span>;
}
</code></pre><p>Setup will require the following steps:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>Move your secrets to runtime environment variables. For more information refer to the <a class="link" href="https://hexdocs.pm/mix/Mix.Tasks.Release.html#module-runtime-configuration" target="_top">runtime.exs docs</a>. On a fresh Phoenix build that would mean that both <code class="literal">DATABASE_URL</code> and <code class="literal">SECRET_KEY</code> need to be moved to <code class="literal">runtime.exs</code>.</p></li><li class="listitem"><p><code class="literal">cd assets</code> and <code class="literal">nix-shell -p node2nix --run node2nix --development</code> will generate a Nix expression containing your frontend dependencies</p></li><li class="listitem"><p>commit and push those changes</p></li><li class="listitem"><p>you can now <code class="literal">nix-build .</code></p></li><li class="listitem"><p>To run the release, set the <code class="literal">RELEASE_TMP</code> environment variable to a directory that your program has write access to. It will be used to store the BEAM settings.</p></li></ul></div>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="example-of-creating-a-service-for-an-elixir---phoenix-project" class="title">Example of creating a service for an Elixir - Phoenix project   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#example-of-creating-a-service-for-an-elixir---phoenix-project" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>In order to create a service with your release, you could add a <code class="literal">service.nix</code>
in your project with the following</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{config, pkgs, lib, ...}:

<span class="hljs-keyword">let</span>
  <span class="hljs-attr">release</span> = pkgs.callPackage ./default.nix;
  <span class="hljs-attr">release_name</span> = <span class="hljs-string">"app"</span>;
  <span class="hljs-attr">working_directory</span> = <span class="hljs-string">"/home/app"</span>;
<span class="hljs-keyword">in</span>
{
  systemd.services.${release_name} = {
    <span class="hljs-attr">wantedBy</span> = [ <span class="hljs-string">"multi-user.target"</span> ];
    <span class="hljs-attr">after</span> = [ <span class="hljs-string">"network.target"</span> <span class="hljs-string">"postgresql.service"</span> ];
    <span class="hljs-comment"># note that if you are connecting to a postgres instance on a different host</span>
    <span class="hljs-comment"># postgresql.service should not be included in the requires.</span>
    <span class="hljs-attr">requires</span> = [ <span class="hljs-string">"network-online.target"</span> <span class="hljs-string">"postgresql.service"</span> ];
    <span class="hljs-attr">description</span> = <span class="hljs-string">"my app"</span>;
    <span class="hljs-attr">environment</span> = {
      <span class="hljs-comment"># RELEASE_TMP is used to write the state of the</span>
      <span class="hljs-comment"># VM configuration when the system is running</span>
      <span class="hljs-comment"># it needs to be a writable directory</span>
      <span class="hljs-attr">RELEASE_TMP</span> = working_directory;
      <span class="hljs-comment"># can be generated in an elixir console with</span>
      <span class="hljs-comment"># Base.encode32(:crypto.strong_rand_bytes(32))</span>
      <span class="hljs-attr">RELEASE_COOKIE</span> = <span class="hljs-string">"my_cookie"</span>;
      <span class="hljs-attr">MY_VAR</span> = <span class="hljs-string">"my_var"</span>;
    };
    <span class="hljs-attr">serviceConfig</span> = {
      <span class="hljs-attr">Type</span> = <span class="hljs-string">"exec"</span>;
      <span class="hljs-attr">DynamicUser</span> = <span class="hljs-literal">true</span>;
      <span class="hljs-attr">WorkingDirectory</span> = working_directory;
      <span class="hljs-comment"># Implied by DynamicUser, but just to emphasize due to RELEASE_TMP</span>
      <span class="hljs-attr">PrivateTmp</span> = <span class="hljs-literal">true</span>;
      <span class="hljs-attr">ExecStart</span> = <span class="hljs-string">''
        <span class="hljs-subst">${release}</span>/bin/<span class="hljs-subst">${release_name}</span> start
      ''</span>;
      <span class="hljs-attr">ExecStop</span> = <span class="hljs-string">''
        <span class="hljs-subst">${release}</span>/bin/<span class="hljs-subst">${release_name}</span> stop
      ''</span>;
      <span class="hljs-attr">ExecReload</span> = <span class="hljs-string">''
        <span class="hljs-subst">${release}</span>/bin/<span class="hljs-subst">${release_name}</span> restart
      ''</span>;
      <span class="hljs-attr">Restart</span> = <span class="hljs-string">"on-failure"</span>;
      <span class="hljs-attr">RestartSec</span> = <span class="hljs-number">5</span>;
      <span class="hljs-attr">StartLimitBurst</span> = <span class="hljs-number">3</span>;
      <span class="hljs-attr">StartLimitInterval</span> = <span class="hljs-number">10</span>;
    };
    <span class="hljs-comment"># disksup requires bash</span>
    <span class="hljs-attr">path</span> = [ pkgs.bash ];
  };

  <span class="hljs-comment"># in case you have migration scripts or you want to use a remote shell</span>
  environment.<span class="hljs-attr">systemPackages</span> = [ release ];
}
</code></pre>
</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="how-to-develop" class="title">How to Develop   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#how-to-develop" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="creating-a-shell" class="title">Creating a Shell   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#creating-a-shell" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Usually, we need to create a <code class="literal">shell.nix</code> file and do our development inside of the environment specified therein. Just install your version of Erlang and any other interpreters, and then use your normal build tools. As an example with Elixir:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ pkgs ? <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {} }:

<span class="hljs-keyword">with</span> pkgs;
<span class="hljs-keyword">let</span>
  <span class="hljs-attr">elixir</span> = beam.packages.erlang_24.elixir_1_12;
<span class="hljs-keyword">in</span>
mkShell {
  <span class="hljs-attr">buildInputs</span> = [ elixir ];
}
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="beam-using-overlays" class="title">Using an overlay   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#beam-using-overlays" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>If you need to use an overlay to change some attributes of a derivation, e.g. if you need a bugfix from a version that is not yet available in nixpkgs, you can override attributes such as <code class="literal">version</code> (and the corresponding <code class="literal">hash</code>) and then use this overlay in your development environment:</p><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="beam-using-overlays-shell.nix" class="title"><code class="literal">shell.nix</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#beam-using-overlays-shell.nix" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">let</span>
  <span class="hljs-attr">elixir_1_13_1_overlay</span> = (self: super: {
      <span class="hljs-attr">elixir_1_13</span> = super.elixir_1_13.override {
        <span class="hljs-attr">version</span> = <span class="hljs-string">"1.13.1"</span>;
        <span class="hljs-attr">sha256</span> = <span class="hljs-string">"sha256-t0ic1LcC7EV3avWGdR7VbyX7pGDpnJSW1ZvwvQUPC3w="</span>;
      };
    });
  <span class="hljs-attr">pkgs</span> = <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; { <span class="hljs-attr">overlays</span> = [ elixir_1_13_1_overlay ]; };
<span class="hljs-keyword">in</span>
<span class="hljs-keyword">with</span> pkgs;
mkShell {
  <span class="hljs-attr">buildInputs</span> = [
    elixir_1_13
  ];
}
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="elixir---phoenix-project" class="title">Elixir - Phoenix project   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#elixir---phoenix-project" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Here is an example <code class="literal">shell.nix</code>.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">with</span> <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; { };

<span class="hljs-keyword">let</span>
  <span class="hljs-comment"># define packages to install</span>
  <span class="hljs-attr">basePackages</span> = [
    git
    <span class="hljs-comment"># replace with beam.packages.erlang.elixir_1_13 if you need</span>
    beam.packages.erlang.elixir
    nodejs
    postgresql_14
    <span class="hljs-comment"># only used for frontend dependencies</span>
    <span class="hljs-comment"># you are free to use yarn2nix as well</span>
    nodePackages.node2nix
    <span class="hljs-comment"># formatting js file</span>
    nodePackages.prettier
  ];

  <span class="hljs-attr">inputs</span> = basePackages ++ lib.optionals stdenv.isLinux [ inotify-tools ]
    ++ lib.optionals stdenv.isDarwin
    (<span class="hljs-keyword">with</span> darwin.apple_sdk.frameworks; [ CoreFoundation CoreServices ]);

  <span class="hljs-comment"># define shell startup command</span>
  <span class="hljs-attr">hooks</span> = <span class="hljs-string">''
    # this allows mix to work on the local directory
    mkdir -p .nix-mix .nix-hex
    export MIX_HOME=$PWD/.nix-mix
    export HEX_HOME=$PWD/.nix-mix
    # make hex from Nixpkgs available
    # `mix local.hex` will install hex into MIX_HOME and should take precedence
    export MIX_PATH="<span class="hljs-subst">${beam.packages.erlang.hex}</span>/lib/erlang/lib/hex/ebin"
    export PATH=$MIX_HOME/bin:$HEX_HOME/bin:$PATH
    export LANG=C.UTF-8
    # keep your shell history in iex
    export ERL_AFLAGS="-kernel shell_history enabled"

    # postges related
    # keep all your db data in a folder inside the project
    export PGDATA="$PWD/db"

    # phoenix related env vars
    export POOL_SIZE=15
    export DB_URL="postgresql://postgres:postgres@localhost:5432/db"
    export PORT=4000
    export MIX_ENV=dev
    # add your project env vars here, word readable in the nix store.
    export ENV_VAR="your_env_var"
  ''</span>;

<span class="hljs-keyword">in</span> mkShell {
  <span class="hljs-attr">buildInputs</span> = inputs;
  <span class="hljs-attr">shellHook</span> = hooks;
}
</code></pre><p>Initializing the project will require the following steps:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>create the db directory <code class="literal">initdb ./db</code> (inside your mix project folder)</p></li><li class="listitem"><p>create the postgres user <code class="literal">createuser postgres -ds</code></p></li><li class="listitem"><p>create the db <code class="literal">createdb db</code></p></li><li class="listitem"><p>start the postgres instance <code class="literal">pg_ctl -l "$PGDATA/server.log" start</code></p></li><li class="listitem"><p>add the <code class="literal">/db</code> folder to your <code class="literal">.gitignore</code></p></li><li class="listitem"><p>you can start your phoenix server and get a shell with <code class="literal">iex -S mix phx.server</code></p></li></ul></div>
</div>

</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-bower" class="title" style="clear: both">Bower   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-bower" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-bower2nix-usage">bower2nix usage</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-build-bower-components">buildBowerComponents function</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-bower2nix-troubleshooting">Troubleshooting</a> </span></dt> </dl></div><p><a class="link" href="https://bower.io/" target="_top">Bower</a> is a package manager for web site front-end components. Bower packages (comprising of build artifacts and sometimes sources) are stored in <code class="literal">git</code> repositories, typically on Github. The package registry is run by the Bower team with package metadata coming from the <code class="literal">bower.json</code> file within each package.</p><p>The end result of running Bower is a <code class="literal">bower_components</code> directory which can be included in the web app’s build process.</p><p>Bower can be run interactively, by installing <code class="literal">nodePackages.bower</code>. More interestingly, the Bower components can be declared in a Nix derivation, with the help of <code class="literal">nodePackages.bower2nix</code>.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-bower2nix-usage" class="title">bower2nix usage   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-bower2nix-usage" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Suppose you have a <code class="literal">bower.json</code> with the following contents:</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="ex-bowerJson" class="title">Example bower.json   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ex-bowerJson" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><pre><code class="programlisting json hljs language-bash" data-highlighted="yes">  <span class="hljs-string">"name"</span>: <span class="hljs-string">"my-web-app"</span>,
  <span class="hljs-string">"dependencies"</span>: {
    <span class="hljs-string">"angular"</span>: <span class="hljs-string">"~1.5.0"</span>,
    <span class="hljs-string">"bootstrap"</span>: <span class="hljs-string">"~3.3.6"</span>
  }
</code></pre><p>Running <code class="literal">bower2nix</code> will produce something like the following output:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ fetchbower, buildEnv }:
buildEnv { <span class="hljs-attr">name</span> = <span class="hljs-string">"bower-env"</span>; <span class="hljs-attr">ignoreCollisions</span> = <span class="hljs-literal">true</span>; <span class="hljs-attr">paths</span> = [
  (fetchbower <span class="hljs-string">"angular"</span> <span class="hljs-string">"1.5.3"</span> <span class="hljs-string">"~1.5.0"</span> <span class="hljs-string">"1749xb0firxdra4rzadm4q9x90v6pzkbd7xmcyjk6qfza09ykk9y"</span>)
  (fetchbower <span class="hljs-string">"bootstrap"</span> <span class="hljs-string">"3.3.6"</span> <span class="hljs-string">"~3.3.6"</span> <span class="hljs-string">"1vvqlpbfcy0k5pncfjaiskj3y6scwifxygfqnw393sjfxiviwmbv"</span>)
  (fetchbower <span class="hljs-string">"jquery"</span> <span class="hljs-string">"2.2.2"</span> <span class="hljs-string">"1.9.1 - 2"</span> <span class="hljs-string">"10sp5h98sqwk90y4k6hbdviwqzvzwqf47r3r51pakch5ii2y7js1"</span>)
];
</code></pre><p>Using the <code class="literal">bower2nix</code> command line arguments, the output can be redirected to a file. A name like <code class="literal">bower-packages.nix</code> would be fine.</p><p>The resulting derivation is a union of all the downloaded Bower packages (and their dependencies). To use it, they still need to be linked together by Bower, which is where <code class="literal">buildBowerComponents</code> is useful.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-build-bower-components" class="title">buildBowerComponents function   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-build-bower-components" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The function is implemented in <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/development/bower-modules/generic/default.nix" target="_top">pkgs/development/bower-modules/generic/default.nix</a>.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="ex-buildBowerComponents" class="title">Example buildBowerComponents   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ex-buildBowerComponents" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">bowerComponents</span> = buildBowerComponents {
  <span class="hljs-attr">name</span> = <span class="hljs-string">"my-web-app"</span>;
  <span class="hljs-attr">generated</span> = ./bower-packages.nix; <span class="hljs-comment"># note 1</span>
  <span class="hljs-attr">src</span> = myWebApp; <span class="hljs-comment"># note 2</span>
};
</code></pre><p>In <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ex-buildBowerComponents" title="Example buildBowerComponents">“buildBowerComponents” example</a> the following arguments are of special significance to the function:</p><div class="orderedlist"><ol class="orderedlist compact" type="1"><li class="listitem"><p><code class="literal">generated</code> specifies the file which was created by <span class="command"><strong>bower2nix</strong></span>.</p></li><li class="listitem"><p><code class="literal">src</code> is your project’s sources. It needs to contain a <code class="filename">bower.json</code> file.</p></li></ol></div><p><code class="literal">buildBowerComponents</code> will run Bower to link together the output of <code class="literal">bower2nix</code>, resulting in a <code class="literal">bower_components</code> directory which can be used.</p><p>Here is an example of a web frontend build process using <code class="literal">gulp</code>. You might use <code class="literal">grunt</code>, or anything else.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="ex-bowerGulpFile" class="title">Example build script (gulpfile.js)   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ex-bowerGulpFile" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><pre><code class="programlisting javascript hljs language-bash" data-highlighted="yes">var gulp = require(<span class="hljs-string">'gulp'</span>);

gulp.task(<span class="hljs-string">'default'</span>, [], <span class="hljs-function"><span class="hljs-title">function</span></span> () {
  gulp.start(<span class="hljs-string">'build'</span>);
});

gulp.task(<span class="hljs-string">'build'</span>, [], <span class="hljs-function"><span class="hljs-title">function</span></span> () {
  console.log(<span class="hljs-string">"Just a dummy gulp build"</span>);
  gulp
    .src([<span class="hljs-string">"./bower_components/**/*"</span>])
    .pipe(gulp.dest(<span class="hljs-string">"./gulpdist/"</span>));
});
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="ex-buildBowerComponentsDefaultNix" class="title">Example Full example — default.nix   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ex-buildBowerComponentsDefaultNix" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ myWebApp ? { <span class="hljs-attr">outPath</span> = ./.; <span class="hljs-attr">name</span> = <span class="hljs-string">"myWebApp"</span>; }
, pkgs ? <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {}
}:

pkgs.stdenv.mkDerivation {
  <span class="hljs-attr">name</span> = <span class="hljs-string">"my-web-app-frontend"</span>;
  <span class="hljs-attr">src</span> = myWebApp;

  <span class="hljs-attr">buildInputs</span> = [ pkgs.nodePackages.gulp ];

  <span class="hljs-attr">bowerComponents</span> = pkgs.buildBowerComponents { <span class="hljs-comment"># note 1</span>
    <span class="hljs-attr">name</span> = <span class="hljs-string">"my-web-app"</span>;
    <span class="hljs-attr">generated</span> = ./bower-packages.nix;
    <span class="hljs-attr">src</span> = myWebApp;
  };

  <span class="hljs-attr">buildPhase</span> = <span class="hljs-string">''
    cp --reflink=auto --no-preserve=mode -R $bowerComponents/bower_components . # note 2
    export HOME=$PWD # note 3
    <span class="hljs-subst">${pkgs.nodePackages.gulp}</span>/bin/gulp build # note 4
  ''</span>;

  <span class="hljs-attr">installPhase</span> = <span class="hljs-string">"mv gulpdist $out"</span>;
}
</code></pre><p>A few notes about <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ex-buildBowerComponentsDefaultNix" title="Example Full example — default.nix">Full example — <code class="literal">default.nix</code></a>:</p><div class="orderedlist"><ol class="orderedlist compact" type="1"><li class="listitem"><p>The result of <code class="literal">buildBowerComponents</code> is an input to the frontend build.</p></li><li class="listitem"><p>Whether to symlink or copy the <code class="filename">bower_components</code> directory depends on the build tool in use.
In this case a copy is used to avoid <span class="command"><strong>gulp</strong></span> silliness with permissions.</p></li><li class="listitem"><p><span class="command"><strong>gulp</strong></span> requires <code class="literal">HOME</code> to refer to a writeable directory.</p></li><li class="listitem"><p>The actual build command in this example is <span class="command"><strong>gulp</strong></span>. Other tools could be used instead.</p></li></ol></div>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-bower2nix-troubleshooting" class="title">Troubleshooting   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-bower2nix-troubleshooting" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="enocache-errors-from-buildbowercomponents" class="title">ENOCACHE errors from buildBowerComponents   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#enocache-errors-from-buildbowercomponents" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>This means that Bower was looking for a package version which doesn’t exist in the generated <code class="literal">bower-packages.nix</code>.</p><p>If <code class="literal">bower.json</code> has been updated, then run <code class="literal">bower2nix</code> again.</p><p>It could also be a bug in <code class="literal">bower2nix</code> or <code class="literal">fetchbower</code>. If possible, try reformulating the version specification in <code class="literal">bower.json</code>.</p>
</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-chicken" class="title" style="clear: both">CHICKEN   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-chicken" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-chicken-using">Using Eggs</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-chicken-updating-eggs">Updating Eggs</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-chicken-adding-eggs">Adding Eggs</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-chicken-override-scope">Override Scope</a> </span></dt> </dl></div><p><a class="link" href="https://call-cc.org/" target="_top">CHICKEN</a> is a
<a class="link" href="https://schemers.org/Documents/Standards/R5RS/HTML/" target="_top">R⁵RS</a>-compliant Scheme
compiler. It includes an interactive mode and a custom package format, “eggs”.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-chicken-using" class="title">Using Eggs   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-chicken-using" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Eggs described in nixpkgs are available inside the
<code class="literal">chickenPackages.chickenEggs</code> attrset. Including an egg as a build input is
done in the typical Nix fashion. For example, to include support for <a class="link" href="https://srfi.schemers.org/srfi-189/srfi-189.html" target="_top">SRFI
189</a> in a derivation, one
might write:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">  <span class="hljs-attr">buildInputs</span> = [
    chicken
    chickenPackages.chickenEggs.srfi-<span class="hljs-number">189</span>
  ];
</code></pre><p>Both <code class="literal">chicken</code> and its eggs have a setup hook which configures the environment
variables <code class="literal">CHICKEN_INCLUDE_PATH</code> and <code class="literal">CHICKEN_REPOSITORY_PATH</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-chicken-updating-eggs" class="title">Updating Eggs   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-chicken-updating-eggs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>nixpkgs only knows about a subset of all published eggs. It uses
<a class="link" href="https://github.com/the-kenny/egg2nix" target="_top">egg2nix</a> to generate a
package set from a list of eggs to include.</p><p>The package set is regenerated by running the following shell commands:</p><pre><code class="programlisting hljs language-shell" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">nix-shell -p chickenPackages.egg2nix</span>
<span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cd</span> pkgs/development/compilers/chicken/5/</span>
<span class="hljs-meta prompt_">$ </span><span class="language-bash">egg2nix eggs.scm &gt; eggs.nix</span>
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-chicken-adding-eggs" class="title">Adding Eggs   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-chicken-adding-eggs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>When we run <code class="literal">egg2nix</code>, we obtain one collection of eggs with
mutually-compatible versions. This means that when we add new eggs, we may
need to update existing eggs. To keep those separate, follow the procedure for
updating eggs before including more eggs.</p><p>To include more eggs, edit <code class="literal">pkgs/development/compilers/chicken/5/eggs.scm</code>.
The first section of this file lists eggs which are required by <code class="literal">egg2nix</code>
itself; all other eggs go into the second section. After editing, follow the
procedure for updating eggs.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-chicken-override-scope" class="title">Override Scope   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-chicken-override-scope" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The chicken package and its eggs, respectively, reside in a scope. This means,
the scope can be overridden to effect other packages in it.</p><p>This example shows how to use a local copy of <code class="literal">srfi-180</code> and have it affect
all the other eggs:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">let</span>
  <span class="hljs-attr">myChickenPackages</span> = pkgs.chickenPackages.overrideScope' (self: super: {
      <span class="hljs-comment"># The chicken package itself can be overridden to effect the whole ecosystem.</span>
      <span class="hljs-comment"># chicken = super.chicken.overrideAttrs {</span>
      <span class="hljs-comment">#   src = ...</span>
      <span class="hljs-comment"># };</span>

      <span class="hljs-attr">chickenEggs</span> = super.chickenEggs.overrideScope' (eggself: eggsuper: {
        <span class="hljs-attr">srfi-180</span> = eggsuper.srfi-<span class="hljs-number">180</span>.overrideAttrs {
          <span class="hljs-comment"># path to a local copy of srfi-180</span>
          <span class="hljs-attr">src</span> = ...
        };
      });
  });
<span class="hljs-keyword">in</span>
<span class="hljs-comment"># Here, `myChickenPackages.chickenEggs.json-rpc`, which depends on `srfi-180` will use</span>
<span class="hljs-comment"># the local copy of `srfi-180`.</span>
<span class="hljs-comment"># ...</span>
</code></pre>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-language-coq" class="title" style="clear: both">Coq and coq packages   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-language-coq" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#coq-derivation-coq">Coq derivation: <code class="literal">coq</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#coq-packages-attribute-sets-coqpackages">Coq packages attribute sets: <code class="literal">coqPackages</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#coq-overriding-packages">Three ways of overriding Coq packages</a> </span></dt> </dl></div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="coq-derivation-coq" class="title">Coq derivation: <code class="literal">coq</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#coq-derivation-coq" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The Coq derivation is overridable through the <code class="literal">coq.override overrides</code>, where overrides is an attribute set which contains the arguments to override. We recommend overriding either of the following</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">version</code> (optional, defaults to the latest version of Coq selected for nixpkgs, see <code class="literal">pkgs/top-level/coq-packages</code> to witness this choice), which follows the conventions explained in the <code class="literal">coqPackages</code> section below,</p></li><li class="listitem"><p><code class="literal">customOCamlPackages</code> (optional, defaults to <code class="literal">null</code>, which lets Coq choose a version automatically), which can be set to any of the ocaml packages attribute of <code class="literal">ocaml-ng</code> (such as <code class="literal">ocaml-ng.ocamlPackages_4_10</code> which is the default for Coq 8.11 for example).</p></li><li class="listitem"><p><code class="literal">coq-version</code> (optional, defaults to the short version e.g. “8.10”), is a version number of the form “x.y” that indicates which Coq’s version build behavior to mimic when using a source which is not a release. E.g. <code class="literal">coq.override { version = "d370a9d1328a4e1cdb9d02ee032f605a9d94ec7a"; coq-version = "8.10"; }</code>.</p></li></ul></div><p>The associated package set can be obtained using <code class="literal">mkCoqPackages coq</code>, where <code class="literal">coq</code> is the derivation to use.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="coq-packages-attribute-sets-coqpackages" class="title">Coq packages attribute sets: <code class="literal">coqPackages</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#coq-packages-attribute-sets-coqpackages" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The recommended way of defining a derivation for a Coq library, is to use the <code class="literal">coqPackages.mkCoqDerivation</code> function, which is essentially a specialization of <code class="literal">mkDerivation</code> taking into account most of the specifics of Coq libraries. The following attributes are supported:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">pname</code> (required) is the name of the package,</p></li><li class="listitem"><p><code class="literal">version</code> (optional, defaults to <code class="literal">null</code>), is the version to fetch and build,
this attribute is interpreted in several ways depending on its type and pattern:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>if it is a known released version string, i.e. from the <code class="literal">release</code> attribute below, the according release is picked, and the <code class="literal">version</code> attribute of the resulting derivation is set to this release string,</p></li><li class="listitem"><p>if it is a majorMinor <code class="literal">"x.y"</code> prefix of a known released version (as defined above), then the latest <code class="literal">"x.y.z"</code> known released version is selected (for the ordering given by <code class="literal">versionAtLeast</code>),</p></li><li class="listitem"><p>if it is a path or a string representing an absolute path (i.e. starting with <code class="literal">"/"</code>), the provided path is selected as a source, and the <code class="literal">version</code> attribute of the resulting derivation is set to <code class="literal">"dev"</code>,</p></li><li class="listitem"><p>if it is a string of the form <code class="literal">owner:branch</code> then it tries to download the <code class="literal">branch</code> of owner <code class="literal">owner</code> for a project of the same name using the same vcs, and the <code class="literal">version</code> attribute of the resulting derivation is set to <code class="literal">"dev"</code>, additionally if the owner is not provided (i.e. if the <code class="literal">owner:</code> prefix is missing), it defaults to the original owner of the package (see below),</p></li><li class="listitem"><p>if it is a string of the form <code class="literal">"#N"</code>, and the domain is github, then it tries to download the current head of the pull request <code class="literal">#N</code> from github,</p></li></ul></div></li><li class="listitem"><p><code class="literal">defaultVersion</code> (optional). Coq libraries may be compatible with some specific versions of Coq only. The <code class="literal">defaultVersion</code> attribute is used when no <code class="literal">version</code> is provided (or if <code class="literal">version = null</code>) to select the version of the library to use by default, depending on the context. This selection will mainly depend on a <code class="literal">coq</code> version number but also possibly on other packages versions (e.g. <code class="literal">mathcomp</code>). If its value ends up to be <code class="literal">null</code>, the package is marked for removal in end-user <code class="literal">coqPackages</code> attribute set.</p></li><li class="listitem"><p><code class="literal">release</code> (optional, defaults to <code class="literal">{}</code>), lists all the known releases of the library and for each of them provides an attribute set with at least a <code class="literal">sha256</code> attribute (you may put the empty string <code class="literal">""</code> in order to automatically insert a fake sha256, this will trigger an error which will allow you to find the correct sha256), each attribute set of the list of releases also takes optional overloading arguments for the fetcher as below (i.e.<code class="literal">domain</code>, <code class="literal">owner</code>, <code class="literal">repo</code>, <code class="literal">rev</code> assuming the default fetcher is used) and optional overrides for the result of the fetcher (i.e. <code class="literal">version</code> and <code class="literal">src</code>).</p></li><li class="listitem"><p><code class="literal">fetcher</code> (optional, defaults to a generic fetching mechanism supporting github or gitlab based infrastructures), is a function that takes at least an <code class="literal">owner</code>, a <code class="literal">repo</code>, a <code class="literal">rev</code>, and a <code class="literal">hash</code> and returns an attribute set with a <code class="literal">version</code> and <code class="literal">src</code>.</p></li><li class="listitem"><p><code class="literal">repo</code> (optional, defaults to the value of <code class="literal">pname</code>),</p></li><li class="listitem"><p><code class="literal">owner</code> (optional, defaults to <code class="literal">"coq-community"</code>).</p></li><li class="listitem"><p><code class="literal">domain</code> (optional, defaults to <code class="literal">"github.com"</code>), domains including the strings <code class="literal">"github"</code> or <code class="literal">"gitlab"</code> in their names are automatically supported, otherwise, one must change the <code class="literal">fetcher</code> argument to support them (cf <code class="literal">pkgs/development/coq-modules/heq/default.nix</code> for an example),</p></li><li class="listitem"><p><code class="literal">releaseRev</code> (optional, defaults to <code class="literal">(v: v)</code>), provides a default mapping from release names to revision hashes/branch names/tags,</p></li><li class="listitem"><p><code class="literal">displayVersion</code> (optional), provides a way to alter the computation of <code class="literal">name</code> from <code class="literal">pname</code>, by explaining how to display version numbers,</p></li><li class="listitem"><p><code class="literal">namePrefix</code> (optional, defaults to <code class="literal">[ "coq" ]</code>), provides a way to alter the computation of <code class="literal">name</code> from <code class="literal">pname</code>, by explaining which dependencies must occur in <code class="literal">name</code>,</p></li><li class="listitem"><p><code class="literal">nativeBuildInputs</code> (optional), is a list of executables that are required to build the current derivation, in addition to the default ones (namely <code class="literal">which</code>, <code class="literal">dune</code> and <code class="literal">ocaml</code> depending on whether <code class="literal">useDune</code>, <code class="literal">useDuneifVersion</code> and <code class="literal">mlPlugin</code> are set).</p></li><li class="listitem"><p><code class="literal">extraNativeBuildInputs</code> (optional, deprecated), an additional list of derivation to add to <code class="literal">nativeBuildInputs</code>,</p></li><li class="listitem"><p><code class="literal">overrideNativeBuildInputs</code> (optional) replaces the default list of derivation to which <code class="literal">nativeBuildInputs</code> and <code class="literal">extraNativeBuildInputs</code> adds extra elements,</p></li><li class="listitem"><p><code class="literal">buildInputs</code> (optional), is a list of libraries and dependencies that are required to build and run the current derivation, in addition to the default one <code class="literal">[ coq ]</code>,</p></li><li class="listitem"><p><code class="literal">extraBuildInputs</code> (optional, deprecated), an additional list of derivation to add to <code class="literal">buildInputs</code>,</p></li><li class="listitem"><p><code class="literal">overrideBuildInputs</code> (optional) replaces the default list of derivation to which <code class="literal">buildInputs</code> and <code class="literal">extraBuildInputs</code> adds extras elements,</p></li><li class="listitem"><p><code class="literal">propagatedBuildInputs</code> (optional) is passed as is to <code class="literal">mkDerivation</code>, we recommend to use this for Coq libraries and Coq plugin dependencies, as this makes sure the paths of the compiled libraries and plugins will always be added to the build environments of subsequent derivation, which is necessary for Coq packages to work correctly,</p></li><li class="listitem"><p><code class="literal">mlPlugin</code> (optional, defaults to <code class="literal">false</code>). Some extensions (plugins) might require OCaml and sometimes other OCaml packages. Standard dependencies can be added by setting the current option to <code class="literal">true</code>. For a finer grain control, the <code class="literal">coq.ocamlPackages</code> attribute can be used in <code class="literal">nativeBuildInputs</code>, <code class="literal">buildInputs</code>, and <code class="literal">propagatedBuildInputs</code> to depend on the same package set Coq was built against.</p></li><li class="listitem"><p><code class="literal">useDuneifVersion</code> (optional, default to <code class="literal">(x: false)</code> uses Dune to build the package if the provided predicate evaluates to true on the version, e.g. <code class="literal">useDuneifVersion = versions.isGe "1.1"</code>  will use dune if the version of the package is greater or equal to <code class="literal">"1.1"</code>,</p></li><li class="listitem"><p><code class="literal">useDune</code> (optional, defaults to <code class="literal">false</code>) uses Dune to build the package if set to true, the presence of this attribute overrides the behavior of the previous one.</p></li><li class="listitem"><p><code class="literal">opam-name</code> (optional, defaults to concatenating with a dash separator the components of <code class="literal">namePrefix</code> and <code class="literal">pname</code>), name of the Dune package to build.</p></li><li class="listitem"><p><code class="literal">enableParallelBuilding</code> (optional, defaults to <code class="literal">true</code>), since it is activated by default, we provide a way to disable it.</p></li><li class="listitem"><p><code class="literal">extraInstallFlags</code> (optional), allows to extend <code class="literal">installFlags</code> which initializes the variable <code class="literal">COQMF_COQLIB</code> so as to install in the proper subdirectory. Indeed Coq libraries should be installed in <code class="literal">$(out)/lib/coq/${coq.coq-version}/user-contrib/</code>. Such directories are automatically added to the <code class="literal">$COQPATH</code> environment variable by the hook defined in the Coq derivation.</p></li><li class="listitem"><p><code class="literal">setCOQBIN</code> (optional, defaults to <code class="literal">true</code>), by default, the environment variable <code class="literal">$COQBIN</code> is set to the current Coq’s binary, but one can disable this behavior by setting it to <code class="literal">false</code>,</p></li><li class="listitem"><p><code class="literal">useMelquiondRemake</code> (optional, default to <code class="literal">null</code>) is an attribute set, which, if given, overloads the <code class="literal">preConfigurePhases</code>, <code class="literal">configureFlags</code>, <code class="literal">buildPhase</code>, and <code class="literal">installPhase</code> attributes of the derivation for a specific use in libraries using <code class="literal">remake</code> as set up by Guillaume Melquiond for <code class="literal">flocq</code>, <code class="literal">gappalib</code>, <code class="literal">interval</code>, and <code class="literal">coquelicot</code> (see the corresponding derivation for concrete examples of use of this option). For backward compatibility, the attribute <code class="literal">useMelquiondRemake.logpath</code> must be set to the logical root of the library (otherwise, one can pass <code class="literal">useMelquiondRemake = {}</code> to activate this without backward compatibility).</p></li><li class="listitem"><p><code class="literal">dropAttrs</code>, <code class="literal">keepAttrs</code>, <code class="literal">dropDerivationAttrs</code> are all optional and allow to tune which attribute is added or removed from the final call to <code class="literal">mkDerivation</code>.</p></li></ul></div><p>It also takes other standard <code class="literal">mkDerivation</code> attributes, they are added as such, except for <code class="literal">meta</code> which extends an automatically computed <code class="literal">meta</code> (where the <code class="literal">platform</code> is the same as <code class="literal">coq</code> and the homepage is automatically computed).</p><p>Here is a simple package example. It is a pure Coq library, thus it depends on Coq. It builds on the Mathematical Components library, thus it also takes some <code class="literal">mathcomp</code> derivations as <code class="literal">extraBuildInputs</code>.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ lib, mkCoqDerivation, version ? <span class="hljs-literal">null</span>
, coq, mathcomp, mathcomp-finmap, mathcomp-bigenough }:
<span class="hljs-keyword">with</span> lib; mkCoqDerivation {
  <span class="hljs-comment">/* namePrefix leads to e.g. `name = coq8.11-mathcomp1.11-multinomials-1.5.2` */</span>
  <span class="hljs-attr">namePrefix</span> = [ <span class="hljs-string">"coq"</span> <span class="hljs-string">"mathcomp"</span> ];
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"multinomials"</span>;
  <span class="hljs-attr">owner</span> = <span class="hljs-string">"math-comp"</span>;
  <span class="hljs-keyword">inherit</span> version;
  <span class="hljs-attr">defaultVersion</span> =  <span class="hljs-keyword">with</span> versions; switch [ coq.version mathcomp.version ] [
      { <span class="hljs-attr">cases</span> = [ (range <span class="hljs-string">"8.7"</span> <span class="hljs-string">"8.12"</span>)  <span class="hljs-string">"1.11.0"</span> ];             <span class="hljs-attr">out</span> = <span class="hljs-string">"1.5.2"</span>; }
      { <span class="hljs-attr">cases</span> = [ (range <span class="hljs-string">"8.7"</span> <span class="hljs-string">"8.11"</span>)  (range <span class="hljs-string">"1.8"</span> <span class="hljs-string">"1.10"</span>) ]; <span class="hljs-attr">out</span> = <span class="hljs-string">"1.5.0"</span>; }
      { <span class="hljs-attr">cases</span> = [ (range <span class="hljs-string">"8.7"</span> <span class="hljs-string">"8.10"</span>)  (range <span class="hljs-string">"1.8"</span> <span class="hljs-string">"1.10"</span>) ]; <span class="hljs-attr">out</span> = <span class="hljs-string">"1.4"</span>; }
      { <span class="hljs-attr">cases</span> = [ <span class="hljs-string">"8.6"</span>                 (range <span class="hljs-string">"1.6"</span> <span class="hljs-string">"1.7"</span>) ];  <span class="hljs-attr">out</span> = <span class="hljs-string">"1.1"</span>; }
    ] <span class="hljs-literal">null</span>;
  <span class="hljs-attr">release</span> = {
    <span class="hljs-string">"1.5.2"</span>.<span class="hljs-attr">sha256</span> = <span class="hljs-string">"15aspf3jfykp1xgsxf8knqkxv8aav2p39c2fyirw7pwsfbsv2c4s"</span>;
    <span class="hljs-string">"1.5.1"</span>.<span class="hljs-attr">sha256</span> = <span class="hljs-string">"13nlfm2wqripaq671gakz5mn4r0xwm0646araxv0nh455p9ndjs3"</span>;
    <span class="hljs-string">"1.5.0"</span>.<span class="hljs-attr">sha256</span> = <span class="hljs-string">"064rvc0x5g7y1a0nip6ic91vzmq52alf6in2bc2dmss6dmzv90hw"</span>;
    <span class="hljs-string">"1.5.0"</span>.<span class="hljs-attr">rev</span>    = <span class="hljs-string">"1.5"</span>;
    <span class="hljs-string">"1.4"</span>.<span class="hljs-attr">sha256</span>   = <span class="hljs-string">"0vnkirs8iqsv8s59yx1fvg1nkwnzydl42z3scya1xp1b48qkgn0p"</span>;
    <span class="hljs-string">"1.3"</span>.<span class="hljs-attr">sha256</span>   = <span class="hljs-string">"0l3vi5n094nx3qmy66hsv867fnqm196r8v605kpk24gl0aa57wh4"</span>;
    <span class="hljs-string">"1.2"</span>.<span class="hljs-attr">sha256</span>   = <span class="hljs-string">"1mh1w339dslgv4f810xr1b8v2w7rpx6fgk9pz96q0fyq49fw2xcq"</span>;
    <span class="hljs-string">"1.1"</span>.<span class="hljs-attr">sha256</span>   = <span class="hljs-string">"1q8alsm89wkc0lhcvxlyn0pd8rbl2nnxg81zyrabpz610qqjqc3s"</span>;
    <span class="hljs-string">"1.0"</span>.<span class="hljs-attr">sha256</span>   = <span class="hljs-string">"1qmbxp1h81cy3imh627pznmng0kvv37k4hrwi2faa101s6bcx55m"</span>;
  };

  <span class="hljs-attr">propagatedBuildInputs</span> =
    [ mathcomp.ssreflect mathcomp.algebra mathcomp-finmap mathcomp-bigenough ];

  <span class="hljs-attr">meta</span> = {
    <span class="hljs-attr">description</span> = <span class="hljs-string">"A Coq/SSReflect Library for Monoidal Rings and Multinomials"</span>;
    <span class="hljs-attr">license</span> = licenses.cecill-c;
  };
}
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="coq-overriding-packages" class="title">Three ways of overriding Coq packages   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#coq-overriding-packages" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>There are three distinct ways of changing a Coq package by overriding one of its values: <code class="literal">.override</code>, <code class="literal">overrideCoqDerivation</code>, and <code class="literal">.overrideAttrs</code>.  This section explains what sort of values can be overridden with each of these methods.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="coq-override" class="title"><code class="literal">.override</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#coq-override" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><code class="literal">.override</code> lets you change arguments to a Coq derivation.  In the case of the <code class="literal">multinomials</code> package above, <code class="literal">.override</code> would let you override arguments like <code class="literal">mkCoqDerivation</code>, <code class="literal">version</code>, <code class="literal">coq</code>, <code class="literal">mathcomp</code>, <code class="literal">mathcom-finmap</code>, etc.</p><p>For example, assuming you have a special <code class="literal">mathcomp</code> dependency you want to use, here is how you could override the <code class="literal">mathcomp</code> dependency:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">multinomials.override {
  <span class="hljs-attr">mathcomp</span> = my-special-mathcomp;
}
</code></pre><p>In Nixpkgs, all Coq derivations take a <code class="literal">version</code> argument.  This can be overridden in order to easily use a different version:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">coqPackages.multinomials.override {
  <span class="hljs-attr">version</span> = <span class="hljs-string">"1.5.1"</span>;
}
</code></pre><p>Refer to <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#coq-packages-attribute-sets-coqpackages" title="Coq packages attribute sets: coqPackages">the section called “Coq packages attribute sets: <code class="literal">coqPackages</code>”</a> for all the different formats that you can potentially pass to <code class="literal">version</code>, as well as the restrictions.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="coq-overrideCoqDerivation" class="title"><code class="literal">overrideCoqDerivation</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#coq-overrideCoqDerivation" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>The <code class="literal">overrideCoqDerivation</code> function lets you easily change arguments to <code class="literal">mkCoqDerivation</code>.  These arguments are described in <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#coq-packages-attribute-sets-coqpackages" title="Coq packages attribute sets: coqPackages">the section called “Coq packages attribute sets: <code class="literal">coqPackages</code>”</a>.</p><p>For example, here is how you could locally add a new release of the <code class="literal">multinomials</code> library, and set the <code class="literal">defaultVersion</code> to use this release:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">coqPackages.lib.overrideCoqDerivation
  {
    <span class="hljs-attr">defaultVersion</span> = <span class="hljs-string">"2.0"</span>;
    release.<span class="hljs-string">"2.0"</span>.<span class="hljs-attr">sha256</span> = <span class="hljs-string">"1lq8x86vd3vqqh2yq6hvyagpnhfq5wmk5pg2z0xq7b7dbbbhyfkk"</span>;
  }
  coqPackages.multinomials
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="coq-overrideAttrs" class="title"><code class="literal">.overrideAttrs</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#coq-overrideAttrs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><code class="literal">.overrideAttrs</code> lets you override arguments to the underlying <code class="literal">stdenv.mkDerivation</code> call. Internally, <code class="literal">mkCoqDerivation</code> uses <code class="literal">stdenv.mkDerivation</code> to create derivations for Coq libraries.  You can override arguments to <code class="literal">stdenv.mkDerivation</code> with <code class="literal">.overrideAttrs</code>.</p><p>For instance, here is how you could add some code to be performed in the derivation after installation is complete:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">coqPackages.multinomials.overrideAttrs (oldAttrs: {
  <span class="hljs-attr">postInstall</span> = oldAttrs.postInstall <span class="hljs-literal">or</span> <span class="hljs-string">""</span> + <span class="hljs-string">''
    echo "you can do anything you want here"
  ''</span>;
})
</code></pre>
</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="crystal" class="title" style="clear: both">Crystal   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#crystal" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#building-a-crystal-package">Building a Crystal package</a> </span></dt> </dl></div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="building-a-crystal-package" class="title">Building a Crystal package   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#building-a-crystal-package" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>This section uses <a class="link" href="https://github.com/mint-lang/mint" target="_top">Mint</a> as an example for how to build a Crystal package.</p><p>If the Crystal project has any dependencies, the first step is to get a <code class="literal">shards.nix</code> file encoding those. Get a copy of the project and go to its root directory such that its <code class="literal">shard.lock</code> file is in the current directory. Executable projects should usually commit the <code class="literal">shard.lock</code> file, but sometimes that’s not the case, which means you need to generate it yourself. With an existing <code class="literal">shard.lock</code> file, <code class="literal">crystal2nix</code> can be run.</p><pre><code class="programlisting bash hljs language-bash" data-highlighted="yes">$ git <span class="hljs-built_in">clone</span> https://github.com/mint-lang/mint
$ <span class="hljs-built_in">cd</span> mint
$ git checkout 0.5.0
$ <span class="hljs-keyword">if</span> [ ! -f shard.lock ]; <span class="hljs-keyword">then</span> nix-shell -p shards --run <span class="hljs-string">"shards lock"</span>; <span class="hljs-keyword">fi</span>
$ nix-shell -p crystal2nix --run crystal2nix
</code></pre><p>This should have generated a <code class="literal">shards.nix</code> file.</p><p>Next create a Nix file for your derivation and use <code class="literal">pkgs.crystal.buildCrystalPackage</code> as follows:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">with</span> <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {};
crystal.buildCrystalPackage <span class="hljs-keyword">rec</span> {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"mint"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"0.5.0"</span>;

  <span class="hljs-attr">src</span> = fetchFromGitHub {
    <span class="hljs-attr">owner</span> = <span class="hljs-string">"mint-lang"</span>;
    <span class="hljs-attr">repo</span> = <span class="hljs-string">"mint"</span>;
    <span class="hljs-attr">rev</span> = version;
    <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-dFN9l5fgrM/TtOPqlQvUYgixE4KPr629aBmkwdDoq28="</span>;
  };

  <span class="hljs-comment"># Insert the path to your shards.nix file here</span>
  <span class="hljs-attr">shardsFile</span> = ./shards.nix;

  ...
}
</code></pre><p>This won’t build anything yet, because we haven’t told it what files build. We can specify a mapping from binary names to source files with the <code class="literal">crystalBinaries</code> attribute. The project’s compilation instructions should show this. For Mint, the binary is called “mint”, which is compiled from the source file <code class="literal">src/mint.cr</code>, so we’ll specify this as follows:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">  crystalBinaries.mint.<span class="hljs-attr">src</span> = <span class="hljs-string">"src/mint.cr"</span>;

  <span class="hljs-comment"># ...</span>
</code></pre><p>Additionally you can override the default <code class="literal">crystal build</code> options (which are currently <code class="literal">--release --progress --no-debug --verbose</code>) with</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">  crystalBinaries.mint.<span class="hljs-attr">options</span> = [ <span class="hljs-string">"--release"</span> <span class="hljs-string">"--verbose"</span> ];
</code></pre><p>Depending on the project, you might need additional steps to get it to compile successfully. In Mint’s case, we need to link against openssl, so in the end the Nix file looks as follows:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">with</span> <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {};
crystal.buildCrystalPackage <span class="hljs-keyword">rec</span> {
  <span class="hljs-attr">version</span> = <span class="hljs-string">"0.5.0"</span>;
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"mint"</span>;
  <span class="hljs-attr">src</span> = fetchFromGitHub {
    <span class="hljs-attr">owner</span> = <span class="hljs-string">"mint-lang"</span>;
    <span class="hljs-attr">repo</span> = <span class="hljs-string">"mint"</span>;
    <span class="hljs-attr">rev</span> = version;
    <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-dFN9l5fgrM/TtOPqlQvUYgixE4KPr629aBmkwdDoq28="</span>;
  };

  <span class="hljs-attr">shardsFile</span> = ./shards.nix;
  crystalBinaries.mint.<span class="hljs-attr">src</span> = <span class="hljs-string">"src/mint.cr"</span>;

  <span class="hljs-attr">buildInputs</span> = [ openssl ];
}
</code></pre>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="cuda" class="title" style="clear: both">CUDA   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#cuda" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#adding-a-new-cuda-release">Adding a new CUDA release</a> </span></dt> </dl></div><p>CUDA-only packages are stored in the <code class="literal">cudaPackages</code> packages set. This set
includes the <code class="literal">cudatoolkit</code>, portions of the toolkit in separate derivations,
<code class="literal">cudnn</code>, <code class="literal">cutensor</code> and <code class="literal">nccl</code>.</p><p>A package set is available for each CUDA version, so for example
<code class="literal">cudaPackages_11_6</code>. Within each set is a matching version of the above listed
packages. Additionally, other versions of the packages that are packaged and
compatible are available as well. For example, there can be a
<code class="literal">cudaPackages.cudnn_8_3</code> package.</p><p>To use one or more CUDA packages in an expression, give the expression a <code class="literal">cudaPackages</code> parameter, and in case CUDA is optional</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ config
, cudaSupport ? config.cudaSupport
, cudaPackages ? { }
, ...
}:
</code></pre><p>When using <code class="literal">callPackage</code>, you can choose to pass in a different variant, e.g.
when a different version of the toolkit suffices</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">mypkg</span> = callPackage { <span class="hljs-attr">cudaPackages</span> = cudaPackages_11_5; }
</code></pre><p>If another version of say <code class="literal">cudnn</code> or <code class="literal">cutensor</code> is needed, you can override the
package set to make it the default. This guarantees you get a consistent package
set.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">mypkg</span> = <span class="hljs-keyword">let</span>
  <span class="hljs-attr">cudaPackages</span> = cudaPackages_11_5.overrideScope (final: prev: {
    <span class="hljs-attr">cudnn</span> = prev.cudnn_8_3;
  }});
<span class="hljs-keyword">in</span> callPackage { <span class="hljs-keyword">inherit</span> cudaPackages; };
</code></pre><p>The CUDA NVCC compiler requires flags to determine which hardware you
want to target for in terms of SASS (real hardware) or PTX (JIT kernels).</p><p>Nixpkgs tries to target support real architecture defaults based on the
CUDA toolkit version with PTX support for future hardware.  Experienced
users may optimize this configuration for a variety of reasons such as
reducing binary size and compile time, supporting legacy hardware, or
optimizing for specific hardware.</p><p>You may provide capabilities to add support or reduce binary size through
<code class="literal">config</code> using <code class="literal">cudaCapabilities = [ "6.0" "7.0" ];</code> and
<code class="literal">cudaForwardCompat = true;</code> if you want PTX support for future hardware.</p><p>Please consult <a class="link" href="https://en.wikipedia.org/wiki/CUDA#GPUs_supported" target="_top">GPUs supported</a>
for your specific card(s).</p><p>Library maintainers should consult <a class="link" href="https://docs.nvidia.com/cuda/cuda-compiler-driver-nvcc/" target="_top">NVCC Docs</a>
and release notes for their software package.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="adding-a-new-cuda-release" class="title">Adding a new CUDA release   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#adding-a-new-cuda-release" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><div class="blockquote"><blockquote class="blockquote"><p><span class="strong"><strong>WARNING</strong></span></p><p>This section of the docs is still very much in progress. Feedback is welcome in GitHub Issues tagging @NixOS/cuda-maintainers or on <a class="link" href="https://matrix.to/#/#cuda:nixos.org" target="_top">Matrix</a>.</p></blockquote></div><p>The CUDA Toolkit is a suite of CUDA libraries and software meant to provide a development environment for CUDA-accelerated applications. Until the release of CUDA 11.4, NVIDIA had only made the CUDA Toolkit available as a multi-gigabyte runfile installer, which we provide through the <a class="link" href="https://search.nixos.org/packages?channel=unstable&amp;type=packages&amp;query=cudaPackages.cudatoolkit" target="_top"><code class="literal">cudaPackages.cudatoolkit</code></a> attribute. From CUDA 11.4 and onwards, NVIDIA has also provided CUDA redistributables (“CUDA-redist”): individually packaged CUDA Toolkit components meant to facilitate redistribution and inclusion in downstream projects. These packages are available in the <a class="link" href="https://search.nixos.org/packages?channel=unstable&amp;type=packages&amp;query=cudaPackages" target="_top"><code class="literal">cudaPackages</code></a> package set.</p><p>All new projects should use the CUDA redistributables available in <a class="link" href="https://search.nixos.org/packages?channel=unstable&amp;type=packages&amp;query=cudaPackages" target="_top"><code class="literal">cudaPackages</code></a> in place of <a class="link" href="https://search.nixos.org/packages?channel=unstable&amp;type=packages&amp;query=cudaPackages.cudatoolkit" target="_top"><code class="literal">cudaPackages.cudatoolkit</code></a>, as they are much easier to maintain and update.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="updating-cuda-redistributables" class="title">Updating CUDA redistributables   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#updating-cuda-redistributables" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><div class="orderedlist"><ol class="orderedlist " type="1"><li class="listitem"><p>Go to NVIDIA’s index of CUDA redistributables: <a class="link" href="https://developer.download.nvidia.com/compute/cuda/redist/" target="_top">https://developer.download.nvidia.com/compute/cuda/redist/</a></p></li><li class="listitem"><p>Copy the <code class="literal">redistrib_*.json</code> corresponding to the release to <code class="literal">pkgs/development/compilers/cudatoolkit/redist/manifests</code>.</p></li><li class="listitem"><p>Generate the <code class="literal">redistrib_features_*.json</code> file by running:</p><pre><code class="programlisting bash hljs language-bash" data-highlighted="yes">nix run github:ConnorBaker/cuda-redist-find-features -- &lt;path to manifest&gt;
</code></pre><p>That command will generate the <code class="literal">redistrib_features_*.json</code> file in the same directory as the manifest.</p></li><li class="listitem"><p>Include the path to the new manifest in <code class="literal">pkgs/development/compilers/cudatoolkit/redist/extension.nix</code>.</p></li></ol></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="updating-the-cuda-toolkit" class="title">Updating the CUDA Toolkit runfile installer   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#updating-the-cuda-toolkit" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><div class="blockquote"><blockquote class="blockquote"><p><span class="strong"><strong>WARNING</strong></span></p><p>While the CUDA Toolkit runfile installer is still available in Nixpkgs as the <a class="link" href="https://search.nixos.org/packages?channel=unstable&amp;type=packages&amp;query=cudaPackages.cudatoolkit" target="_top"><code class="literal">cudaPackages.cudatoolkit</code></a> attribute, its use is not recommended and should it be considered deprecated. Please migrate to the CUDA redistributables provided by the <a class="link" href="https://search.nixos.org/packages?channel=unstable&amp;type=packages&amp;query=cudaPackages" target="_top"><code class="literal">cudaPackages</code></a> package set.</p><p>To ensure packages relying on the CUDA Toolkit runfile installer continue to build, it will continue to be updated until a migration path is available.</p></blockquote></div><div class="orderedlist"><ol class="orderedlist " type="1"><li class="listitem"><p>Go to NVIDIA’s CUDA Toolkit runfile installer download page: <a class="link" href="https://developer.nvidia.com/cuda-downloads" target="_top">https://developer.nvidia.com/cuda-downloads</a></p></li><li class="listitem"><p>Select the appropriate OS, architecture, distribution, and version, and installer type.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>For example: Linux, x86_64, Ubuntu, 22.04, runfile (local)</p></li><li class="listitem"><p>NOTE: Typically, we use the Ubuntu runfile. It is unclear if the runfile for other distributions will work.</p></li></ul></div></li><li class="listitem"><p>Take the link provided by the installer instructions on the webpage after selecting the installer type and get its hash by running:</p><pre><code class="programlisting bash hljs language-bash" data-highlighted="yes">nix store prefetch-file --hash-type sha256 &lt;<span class="hljs-built_in">link</span>&gt;
</code></pre></li><li class="listitem"><p>Update <code class="literal">pkgs/development/compilers/cudatoolkit/versions.toml</code> to include the release.</p></li></ol></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="updating-the-cuda-package-set" class="title">Updating the CUDA package set   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#updating-the-cuda-package-set" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><div class="orderedlist"><ol class="orderedlist " type="1"><li class="listitem"><p>Include a new <code class="literal">cudaPackages_&lt;major&gt;_&lt;minor&gt;</code> package set in <code class="literal">pkgs/top-level/all-packages.nix</code>.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>NOTE: Changing the default CUDA package set should occur in a separate PR, allowing time for additional testing.</p></li></ul></div></li><li class="listitem"><p>Successfully build the closure of the new package set, updating <code class="literal">pkgs/development/compilers/cudatoolkit/redist/overrides.nix</code> as needed. Below are some common failures:</p></li></ol></div><div class="informaltable"><table class="informaltable" border="1"><colgroup><col align="left"><col align="left"><col align="left"><col align="left"><col align="left"></colgroup><thead><tr><th align="left">Unable to …</th><th align="left">During …</th><th align="left">Reason</th><th align="left">Solution</th><th align="left">Note</th></tr></thead><tbody><tr><td align="left">Find headers</td><td align="left"><code class="literal">configurePhase</code> or <code class="literal">buildPhase</code></td><td align="left">Missing dependency on a <code class="literal">dev</code> output</td><td align="left">Add the missing dependency</td><td align="left">The <code class="literal">dev</code> output typically contain the headers</td></tr><tr><td align="left">Find libraries</td><td align="left"><code class="literal">configurePhase</code></td><td align="left">Missing dependency on a <code class="literal">dev</code> output</td><td align="left">Add the missing dependency</td><td align="left">The <code class="literal">dev</code> output typically contain CMake configuration files</td></tr><tr><td align="left">Find libraries</td><td align="left"><code class="literal">buildPhase</code> or <code class="literal">patchelf</code></td><td align="left">Missing dependency on a <code class="literal">lib</code> or <code class="literal">static</code> output</td><td align="left">Add the missing dependency</td><td align="left">The <code class="literal">lib</code> or <code class="literal">static</code> output typically contain the libraries</td></tr></tbody></table></div><p>In the scenario you are unable to run the resulting binary: this is arguably the most complicated as it could be any combination of the previous reasons. This type of failure typically occurs when a library attempts to load or open a library it depends on that it does not declare in its <code class="literal">DT_NEEDED</code> section. As a first step, ensure that dependencies are patched with <a class="link" href="https://search.nixos.org/packages?channel=unstable&amp;type=packages&amp;query=cudaPackages.autoAddOpenGLRunpath" target="_top"><code class="literal">cudaPackages.autoAddOpenGLRunpath</code></a>. Failing that, try running the application with <a class="link" href="https://github.com/guibou/nixGL" target="_top"><code class="literal">nixGL</code></a> or a similar wrapper tool. If that works, it likely means that the application is attempting to load a library that is not in the <code class="literal">RPATH</code> or <code class="literal">RUNPATH</code> of the binary.</p>
</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="cuelang" class="title" style="clear: both">Cue (Cuelang)   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#cuelang" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#cuelang-quickstart">Cuelang schema quick start</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#cuelang-writeCueValidator"><code class="literal">writeCueValidator</code></a> </span></dt> </dl></div><p><a class="link" href="https://cuelang.org/" target="_top">Cuelang</a> is a language to:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>describe schemas and validate backward-compatibility</p></li><li class="listitem"><p>generate code and schemas in various formats (e.g. JSON Schema, OpenAPI)</p></li><li class="listitem"><p>do configuration akin to <a class="link" href="https://dhall-lang.org/" target="_top">Dhall Lang</a></p></li><li class="listitem"><p>perform data validation</p></li></ul></div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="cuelang-quickstart" class="title">Cuelang schema quick start   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#cuelang-quickstart" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Cuelang schemas are similar to JSON, here is a quick cheatsheet:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>Default types includes: <code class="literal">null</code>, <code class="literal">string</code>, <code class="literal">bool</code>, <code class="literal">bytes</code>, <code class="literal">number</code>, <code class="literal">int</code>, <code class="literal">float</code>, lists as <code class="literal">[...T]</code> where <code class="literal">T</code> is a type.</p></li><li class="listitem"><p>All structures, defined by: <code class="literal">myStructName: { &lt;fields&gt; }</code> are <span class="strong"><strong>open</strong></span> – they accept fields which are not specified.</p></li><li class="listitem"><p>Closed structures can be built by doing <code class="literal">myStructName: close({ &lt;fields&gt; })</code> – they are strict in what they accept.</p></li><li class="listitem"><p><code class="literal">#X</code> are <span class="strong"><strong>definitions</strong></span>, referenced definitions are <span class="strong"><strong>recursively closed</strong></span>, i.e. all its children structures are <span class="strong"><strong>closed</strong></span>.</p></li><li class="listitem"><p><code class="literal">&amp;</code> operator is the <a class="link" href="https://cuelang.org/docs/references/spec/#unification" target="_top">unification operator</a> (similar to a type-level merging operator), <code class="literal">|</code> is the <a class="link" href="https://cuelang.org/docs/references/spec/#disjunction" target="_top">disjunction operator</a> (similar to a type-level union operator).</p></li><li class="listitem"><p>Values <span class="strong"><strong>are</strong></span> types, i.e. <code class="literal">myStruct: { a: 3 }</code> is a valid type definition that only allows <code class="literal">3</code> as value.</p></li><li class="listitem"><p>Read <a class="link" href="https://cuelang.org/docs/concepts/logic/" target="_top">https://cuelang.org/docs/concepts/logic/</a> to learn more about the semantics.</p></li><li class="listitem"><p>Read <a class="link" href="https://cuelang.org/docs/references/spec/" target="_top">https://cuelang.org/docs/references/spec/</a> to learn about the language specification.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="cuelang-writeCueValidator" class="title"><code class="literal">writeCueValidator</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#cuelang-writeCueValidator" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Nixpkgs provides a <code class="literal">pkgs.writeCueValidator</code> helper, which will write a validation script based on the provided Cuelang schema.</p><p>Here is an example:</p><pre><code class="programlisting hljs language-bash" data-highlighted="yes">pkgs.writeCueValidator
  (pkgs.writeText <span class="hljs-string">"schema.cue"</span> <span class="hljs-string">''</span>
    <span class="hljs-comment">#Def1: {</span>
      field1: string
    }
  <span class="hljs-string">''</span>)
  { document = <span class="hljs-string">"#Def1"</span>; }
</code></pre><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>The first parameter is the Cue schema file.</p></li><li class="listitem"><p>The second parameter is an options parameter, currently, only: <code class="literal">document</code> can be passed.</p></li></ul></div><p><code class="literal">document</code> : match your input data against this fragment of structure or definition, e.g. you may use the same schema file but different documents based on the data you are validating.</p><p>Another example, given the following <code class="literal">validator.nix</code> :</p><pre><code class="programlisting hljs language-bash" data-highlighted="yes">{ pkgs ? import &lt;nixpkgs&gt; {} }:
<span class="hljs-built_in">let</span>
  genericValidator = version:
  pkgs.writeCueValidator
    (pkgs.writeText <span class="hljs-string">"schema.cue"</span> <span class="hljs-string">''</span>
      <span class="hljs-comment">#Version1: {</span>
        field1: string
      }
      <span class="hljs-comment">#Version2: #Version1 &amp; {</span>
        field1: <span class="hljs-string">"unused"</span>
      }<span class="hljs-string">''</span>
    )
    { document = <span class="hljs-string">"#Version<span class="hljs-variable">${toString version}</span>"</span>; };
<span class="hljs-keyword">in</span>
{
  validateV1 = genericValidator 1;
  validateV2 = genericValidator 2;
}
</code></pre><p>The result is a script that will validate the file you pass as the first argument against the schema you provided <code class="literal">writeCueValidator</code>.</p><p>It can be any format that <code class="literal">cue vet</code> supports, i.e. YAML or JSON for example.</p><p>Here is an example, named <code class="literal">example.json</code>, given the following JSON:</p><pre><code class="programlisting hljs language-bash" data-highlighted="yes">{ <span class="hljs-string">"field1"</span>: <span class="hljs-string">"abc"</span> }
</code></pre><p>You can run the result script (named <code class="literal">validate</code>) as the following:</p><pre><code class="programlisting console hljs language-shell" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">nix-build validator.nix</span>
<span class="hljs-meta prompt_">$ </span><span class="language-bash">./result example.json</span>
<span class="hljs-meta prompt_">$ </span><span class="language-bash">./result-2 example.json</span>
field1: conflicting values "unused" and "abc":
    ./example.json:1:13
    ../../../../../../nix/store/v64dzx3vr3glpk0cq4hzmh450lrwh6sg-schema.cue:5:11
<span class="hljs-meta prompt_">$ </span><span class="language-bash">sed -i <span class="hljs-string">'s/"abc"/3/'</span> example.json</span>
<span class="hljs-meta prompt_">$ </span><span class="language-bash">./result example.json</span>
field1: conflicting values 3 and string (mismatched types int and string):
    ./example.json:1:13
    ../../../../../../nix/store/v64dzx3vr3glpk0cq4hzmh450lrwh6sg-schema.cue:5:11
</code></pre><p><span class="strong"><strong>Known limitations</strong></span></p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>The script will enforce <span class="strong"><strong>concrete</strong></span> values and will not accept lossy transformations (strictness). You can add these options if you need them.</p></li></ul></div>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-language-dart" class="title" style="clear: both">Dart   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-language-dart" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-dart-applications">Dart applications</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-dart-flutter">Flutter applications</a> </span></dt> </dl></div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-dart-applications" class="title">Dart applications   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-dart-applications" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The function <code class="literal">buildDartApplication</code> builds Dart applications managed with pub.</p><p>It fetches its Dart dependencies automatically through <code class="literal">fetchDartDeps</code>, and (through a series of hooks) builds and installs the executables specified in the pubspec file. The hooks can be used in other derivations, if needed. The phases can also be overridden to do something different from installing binaries.</p><p>If you are packaging a Flutter desktop application, use <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ssec-dart-flutter" title="Flutter applications"><code class="literal">buildFlutterApplication</code></a> instead.</p><p><code class="literal">vendorHash</code>: is the hash of the output of the dependency fetcher derivation. To obtain it, set it to <code class="literal">lib.fakeHash</code> (or omit it) and run the build (<a class="link" href="https://nixos.org/manual/nixpkgs/stable/#sec-source-hashes" title="Obtaining source hash">more details here</a>).</p><p>If the upstream source is missing a <code class="literal">pubspec.lock</code> file, you’ll have to vendor one and specify it using <code class="literal">pubspecLockFile</code>. If it is needed, one will be generated for you and printed when attempting to build the derivation.</p><p>The <code class="literal">depsListFile</code> must always be provided when packaging in Nixpkgs. It will be generated and printed if the derivation is attempted to be built without one. Alternatively, <code class="literal">autoDepsList</code> may be set to <code class="literal">true</code> only when outside of Nixpkgs, as it relies on import-from-derivation.</p><p>The <code class="literal">dart</code> commands run can be overridden through <code class="literal">pubGetScript</code> and <code class="literal">dartCompileCommand</code>, you can also add flags using <code class="literal">dartCompileFlags</code> or <code class="literal">dartJitFlags</code>.</p><p>Dart supports multiple <a class="link" href="https://dart.dev/tools/dart-compile#types-of-output" target="_top">outputs types</a>, you can choose between them using <code class="literal">dartOutputType</code> (defaults to <code class="literal">exe</code>). If you want to override the binaries path or the source path they come from, you can use <code class="literal">dartEntryPoints</code>. Outputs that require a runtime will automatically be wrapped with the relevant runtime (<code class="literal">dartaotruntime</code> for <code class="literal">aot-snapshot</code>, <code class="literal">dart run</code> for <code class="literal">jit-snapshot</code> and <code class="literal">kernel</code>, <code class="literal">node</code> for <code class="literal">js</code>), this can be overridden through <code class="literal">dartRuntimeCommand</code>.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ buildDartApplication, fetchFromGitHub }:

buildDartApplication <span class="hljs-keyword">rec</span> {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"dart-sass"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"1.62.1"</span>;

  <span class="hljs-attr">src</span> = fetchFromGitHub {
    <span class="hljs-attr">owner</span> = <span class="hljs-string">"sass"</span>;
    <span class="hljs-attr">repo</span> = pname;
    <span class="hljs-attr">rev</span> = version;
    <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-U6enz8yJcc4Wf8m54eYIAnVg/jsGi247Wy8lp1r1wg4="</span>;
  };

  <span class="hljs-attr">pubspecLockFile</span> = ./pubspec.lock;
  <span class="hljs-attr">depsListFile</span> = ./deps.json;
  <span class="hljs-attr">vendorHash</span> = <span class="hljs-string">"sha256-Atm7zfnDambN/BmmUf4BG0yUz/y6xWzf0reDw3Ad41s="</span>;
}
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-dart-flutter" class="title">Flutter applications   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-dart-flutter" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The function <code class="literal">buildFlutterApplication</code> builds Flutter applications.</p><p>See the <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ssec-dart-applications" title="Dart applications">Dart documentation</a> for more details on required files and arguments.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{  flutter, fetchFromGitHub }:

flutter.buildFlutterApplication {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"firmware-updater"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"unstable-2023-04-30"</span>;

  <span class="hljs-attr">src</span> = fetchFromGitHub {
    <span class="hljs-attr">owner</span> = <span class="hljs-string">"canonical"</span>;
    <span class="hljs-attr">repo</span> = <span class="hljs-string">"firmware-updater"</span>;
    <span class="hljs-attr">rev</span> = <span class="hljs-string">"6e7dbdb64e344633ea62874b54ff3990bd3b8440"</span>;
    <span class="hljs-attr">sha256</span> = <span class="hljs-string">"sha256-s5mwtr5MSPqLMN+k851+pFIFFPa0N1hqz97ys050tFA="</span>;
    <span class="hljs-attr">fetchSubmodules</span> = <span class="hljs-literal">true</span>;
  };

  <span class="hljs-attr">pubspecLockFile</span> = ./pubspec.lock;
  <span class="hljs-attr">depsListFile</span> = ./deps.json;
  <span class="hljs-attr">vendorHash</span> = <span class="hljs-string">"sha256-cdMO+tr6kYiN5xKXa+uTMAcFf2C75F3wVPrn21G4QPQ="</span>;
}
</code></pre>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-language-dhall" class="title" style="clear: both">Dhall   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-language-dhall" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-dhall-remote-imports">Remote imports</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-dhall-packaging-expression">Packaging a Dhall expression from scratch</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-dhall-package-contents">Contents of a Dhall package</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-dhall-packaging-functions">Packaging functions</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-dhall-dhall-to-nixpkgs"><code class="literal">dhall-to-nixpkgs</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-dhall-overriding-dependency-versions">Overriding dependency versions</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-dhall-overrides">Overrides</a> </span></dt> </dl></div><p>The Nixpkgs support for Dhall assumes some familiarity with Dhall’s language
support for importing Dhall expressions, which is documented here:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><a class="link" href="https://docs.dhall-lang.org/tutorials/Language-Tour.html#installing-packages" target="_top"><code class="literal">dhall-lang.org</code> - Installing packages</a></p></li></ul></div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-dhall-remote-imports" class="title">Remote imports   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-dhall-remote-imports" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Nixpkgs bypasses Dhall’s support for remote imports using Dhall’s
semantic integrity checks.  Specifically, any Dhall import can be protected by
an integrity check like:</p><pre><code class="programlisting dhall hljs language-bash" data-highlighted="yes">https://prelude.dhall-lang.org/v20.1.0/package.dhall
  sha256:26b0ef498663d269e4dc6a82b0ee289ec565d683ef4c00d0ebdd25333a5a3c98
</code></pre><p>… and if the import is cached then the interpreter will load the import from
cache instead of fetching the URL.</p><p>Nixpkgs uses this trick to add all of a Dhall expression’s dependencies into the
cache so that the Dhall interpreter never needs to resolve any remote URLs.  In
fact, Nixpkgs uses a Dhall interpreter with remote imports disabled when
packaging Dhall expressions to enforce that the interpreter never resolves a
remote import.  This means that Nixpkgs only supports building Dhall expressions
if all of their remote imports are protected by semantic integrity checks.</p><p>Instead of remote imports, Nixpkgs uses Nix to fetch remote Dhall code.  For
example, the Prelude Dhall package uses <code class="literal">pkgs.fetchFromGitHub</code> to fetch the
<code class="literal">dhall-lang</code> repository containing the Prelude.  Relying exclusively on Nix
to fetch Dhall code ensures that Dhall packages built using Nix remain pure and
also behave well when built within a sandbox.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-dhall-packaging-expression" class="title">Packaging a Dhall expression from scratch   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-dhall-packaging-expression" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>We can illustrate how Nixpkgs integrates Dhall by beginning from the following
trivial Dhall expression with one dependency (the Prelude):</p><pre><code class="programlisting dhall hljs language-bash" data-highlighted="yes">-- ./true.dhall

<span class="hljs-built_in">let</span> Prelude = https://prelude.dhall-lang.org/v20.1.0/package.dhall

<span class="hljs-keyword">in</span>  Prelude.Bool.not False
</code></pre><p>As written, this expression cannot be built using Nixpkgs because the
expression does not protect the Prelude import with a semantic integrity
check, so the first step is to freeze the expression using <code class="literal">dhall freeze</code>,
like this:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">dhall freeze --inplace ./true.dhall</span>
</code></pre><p>… which gives us:</p><pre><code class="programlisting dhall hljs language-bash" data-highlighted="yes">-- ./true.dhall

<span class="hljs-built_in">let</span> Prelude =
      https://prelude.dhall-lang.org/v20.1.0/package.dhall
        sha256:26b0ef498663d269e4dc6a82b0ee289ec565d683ef4c00d0ebdd25333a5a3c98

<span class="hljs-keyword">in</span>  Prelude.Bool.not False
</code></pre><p>To package that expression, we create a <code class="literal">./true.nix</code> file containing the
following specification for the Dhall package:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-comment"># ./true.nix</span>

{ buildDhallPackage, Prelude }:

buildDhallPackage {
  <span class="hljs-attr">name</span> = <span class="hljs-string">"true"</span>;
  <span class="hljs-attr">code</span> = ./<span class="hljs-literal">true</span>.dhall;
  <span class="hljs-attr">dependencies</span> = [ Prelude ];
  <span class="hljs-attr">source</span> = <span class="hljs-literal">true</span>;
}
</code></pre><p>… and we complete the build by incorporating that Dhall package into the
<code class="literal">pkgs.dhallPackages</code> hierarchy using an overlay, like this:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-comment"># ./example.nix</span>

<span class="hljs-keyword">let</span>
  <span class="hljs-attr">nixpkgs</span> = <span class="hljs-built_in">builtins</span>.fetchTarball {
    <span class="hljs-attr">url</span>    = <span class="hljs-string">"https://github.com/NixOS/nixpkgs/archive/94b2848559b12a8ed1fe433084686b2a81123c99.tar.gz"</span>;
    <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-B4Q3c6IvTLg3Q92qYa8y+i4uTaphtFdjp+Ir3QQjdN0="</span>;
  };

  <span class="hljs-attr">dhallOverlay</span> = self: super: {
    <span class="hljs-attr">true</span> = self.callPackage ./<span class="hljs-literal">true</span>.nix { };
  };

  <span class="hljs-attr">overlay</span> = self: super: {
    <span class="hljs-attr">dhallPackages</span> = super.dhallPackages.override (old: {
      <span class="hljs-attr">overrides</span> =
        self.lib.composeExtensions (old.overrides <span class="hljs-literal">or</span> (_: _: {})) dhallOverlay;
    });
  };

  <span class="hljs-attr">pkgs</span> = <span class="hljs-built_in">import</span> nixpkgs { <span class="hljs-attr">config</span> = {}; <span class="hljs-attr">overlays</span> = [ overlay ]; };

<span class="hljs-keyword">in</span>
  pkgs
</code></pre><p>… which we can then build using this command:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">nix build --file ./example.nix dhallPackages.<span class="hljs-literal">true</span></span>
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-dhall-package-contents" class="title">Contents of a Dhall package   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-dhall-package-contents" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The above package produces the following directory tree:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">tree -a ./result</span>
result
├── .cache
│&nbsp;&nbsp; └── dhall
│&nbsp;&nbsp;     └── 122027abdeddfe8503496adeb623466caa47da5f63abd2bc6fa19f6cfcb73ecfed70
├── binary.dhall
└── source.dhall
</code></pre><p>… where:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><code class="literal">source.dhall</code> contains the result of interpreting our Dhall package:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cat</span> ./result/source.dhall</span>
True
</code></pre></li><li class="listitem"><p>The <code class="literal">.cache</code> subdirectory contains one binary cache product encoding the
same result as <code class="literal">source.dhall</code>:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">dhall decode &lt; ./result/.cache/dhall/122027abdeddfe8503496adeb623466caa47da5f63abd2bc6fa19f6cfcb73ecfed70</span>
True
</code></pre></li><li class="listitem"><p><code class="literal">binary.dhall</code> contains a Dhall expression which handles fetching and decoding
the same cache product:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cat</span> ./result/binary.dhall</span>
missing sha256:27abdeddfe8503496adeb623466caa47da5f63abd2bc6fa19f6cfcb73ecfed70
<span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cp</span> -r ./result/.cache .cache</span>
<span class="hljs-meta prompt_">
$ </span><span class="language-bash"><span class="hljs-built_in">chmod</span> -R u+w .cache</span>
<span class="hljs-meta prompt_">
$ </span><span class="language-bash">XDG_CACHE_HOME=.cache dhall --file ./result/binary.dhall</span>
True
</code></pre></li></ul></div><p>The <code class="literal">source.dhall</code> file is only present for packages that specify
<code class="literal">source = true;</code>.  By default, Dhall packages omit the <code class="literal">source.dhall</code> in order
to conserve disk space when they are used exclusively as dependencies.  For
example, if we build the Prelude package it will only contain the binary
encoding of the expression:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">nix build --file ./example.nix dhallPackages.Prelude</span>
<span class="hljs-meta prompt_">
$ </span><span class="language-bash">tree -a result</span>
result
├── .cache
│&nbsp;&nbsp; └── dhall
│&nbsp;&nbsp;     └── 122026b0ef498663d269e4dc6a82b0ee289ec565d683ef4c00d0ebdd25333a5a3c98
└── binary.dhall

2 directories, 2 files
</code></pre><p>Typically, you only specify <code class="literal">source = true;</code> for the top-level Dhall expression
of interest (such as our example <code class="literal">true.nix</code> Dhall package).  However, if you
wish to specify <code class="literal">source = true</code> for all Dhall packages, then you can amend the
Dhall overlay like this:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">  <span class="hljs-attr">dhallOverrides</span> = self: super: {
    <span class="hljs-comment"># Enable source for all Dhall packages</span>
    <span class="hljs-attr">buildDhallPackage</span> =
      args: super.buildDhallPackage (args // { <span class="hljs-attr">source</span> = <span class="hljs-literal">true</span>; });

    <span class="hljs-attr">true</span> = self.callPackage ./<span class="hljs-literal">true</span>.nix { };
  };
</code></pre><p>… and now the Prelude will contain the fully decoded result of interpreting
the Prelude:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">nix build --file ./example.nix dhallPackages.Prelude</span>
<span class="hljs-meta prompt_">
$ </span><span class="language-bash">tree -a result</span>
result
├── .cache
│&nbsp;&nbsp; └── dhall
│&nbsp;&nbsp;     └── 122026b0ef498663d269e4dc6a82b0ee289ec565d683ef4c00d0ebdd25333a5a3c98
├── binary.dhall
└── source.dhall
<span class="hljs-meta prompt_">
$ </span><span class="language-bash"><span class="hljs-built_in">cat</span> ./result/source.dhall</span>
{ Bool =
  { and =
      \(_ : List Bool) -&gt;
        List/fold Bool _ Bool (\(_ : Bool) -&gt; \(_ : Bool) -&gt; _@1 &amp;&amp; _) True
  , build = \(_ : Type -&gt; _ -&gt; _@1 -&gt; _@2) -&gt; _ Bool True False
  , even =
      \(_ : List Bool) -&gt;
        List/fold Bool _ Bool (\(_ : Bool) -&gt; \(_ : Bool) -&gt; _@1 == _) True
  , fold =
      \(_ : Bool) -&gt;
…
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-dhall-packaging-functions" class="title">Packaging functions   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-dhall-packaging-functions" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>We already saw an example of using <code class="literal">buildDhallPackage</code> to create a Dhall
package from a single file, but most Dhall packages consist of more than one
file and there are two derived utilities that you may find more useful when
packaging multiple files:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><code class="literal">buildDhallDirectoryPackage</code> - build a Dhall package from a local directory</p></li><li class="listitem"><p><code class="literal">buildDhallGitHubPackage</code> - build a Dhall package from a GitHub repository</p></li></ul></div><p>The <code class="literal">buildDhallPackage</code> is the lowest-level function and accepts the following
arguments:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><code class="literal">name</code>: The name of the derivation</p></li><li class="listitem"><p><code class="literal">dependencies</code>: Dhall dependencies to build and cache ahead of time</p></li><li class="listitem"><p><code class="literal">code</code>: The top-level expression to build for this package</p><p>Note that the <code class="literal">code</code> field accepts an arbitrary Dhall expression.  You’re
not limited to just a file.</p></li><li class="listitem"><p><code class="literal">source</code>: Set to <code class="literal">true</code> to include the decoded result as <code class="literal">source.dhall</code> in the
build product, at the expense of requiring more disk space</p></li><li class="listitem"><p><code class="literal">documentationRoot</code>: Set to the root directory of the package if you want
<code class="literal">dhall-docs</code> to generate documentation underneath the <code class="literal">docs</code> subdirectory of
the build product</p></li></ul></div><p>The <code class="literal">buildDhallDirectoryPackage</code> is a higher-level function implemented in terms
of <code class="literal">buildDhallPackage</code> that accepts the following arguments:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><code class="literal">name</code>: Same as <code class="literal">buildDhallPackage</code></p></li><li class="listitem"><p><code class="literal">dependencies</code>: Same as <code class="literal">buildDhallPackage</code></p></li><li class="listitem"><p><code class="literal">source</code>: Same as <code class="literal">buildDhallPackage</code></p></li><li class="listitem"><p><code class="literal">src</code>: The directory containing Dhall code that you want to turn into a Dhall
package</p></li><li class="listitem"><p><code class="literal">file</code>: The top-level file (<code class="literal">package.dhall</code> by default) that is the entrypoint
to the rest of the package</p></li><li class="listitem"><p><code class="literal">document</code>: Set to <code class="literal">true</code> to generate documentation for the package</p></li></ul></div><p>The <code class="literal">buildDhallGitHubPackage</code> is another higher-level function implemented in
terms of <code class="literal">buildDhallPackage</code> that accepts the following arguments:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><code class="literal">name</code>: Same as <code class="literal">buildDhallPackage</code></p></li><li class="listitem"><p><code class="literal">dependencies</code>: Same as <code class="literal">buildDhallPackage</code></p></li><li class="listitem"><p><code class="literal">source</code>: Same as <code class="literal">buildDhallPackage</code></p></li><li class="listitem"><p><code class="literal">owner</code>: The owner of the repository</p></li><li class="listitem"><p><code class="literal">repo</code>: The repository name</p></li><li class="listitem"><p><code class="literal">rev</code>: The desired revision (or branch, or tag)</p></li><li class="listitem"><p><code class="literal">directory</code>: The subdirectory of the Git repository to package (if a
directory other than the root of the repository)</p></li><li class="listitem"><p><code class="literal">file</code>: The top-level file (<code class="literal">${directory}/package.dhall</code> by default) that is
the entrypoint to the rest of the package</p></li><li class="listitem"><p><code class="literal">document</code>: Set to <code class="literal">true</code> to generate documentation for the package</p></li></ul></div><p>Additionally, <code class="literal">buildDhallGitHubPackage</code> accepts the same arguments as
<code class="literal">fetchFromGitHub</code>, such as <code class="literal">hash</code> or <code class="literal">fetchSubmodules</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-dhall-dhall-to-nixpkgs" class="title"><code class="literal">dhall-to-nixpkgs</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-dhall-dhall-to-nixpkgs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>You can use the <code class="literal">dhall-to-nixpkgs</code> command-line utility to automate
packaging Dhall code.  For example:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">nix-shell -p haskellPackages.dhall-nixpkgs nix-prefetch-git</span>
<span class="hljs-meta prompt_">[nix-shell]$ </span><span class="language-bash">dhall-to-nixpkgs github https://github.com/Gabriella439/dhall-semver.git</span>
{ buildDhallGitHubPackage, Prelude }:
  buildDhallGitHubPackage {
    name = "dhall-semver";
    githubBase = "github.com";
    owner = "Gabriella439";
    repo = "dhall-semver";
    rev = "2d44ae605302ce5dc6c657a1216887fbb96392a4";
    fetchSubmodules = false;
    hash = "sha256-n0nQtswVapWi/x7or0O3MEYmAkt/a1uvlOtnje6GGnk=";
    directory = "";
    file = "package.dhall";
    source = false;
    document = false;
    dependencies = [ (Prelude.overridePackage { file = "package.dhall"; }) ];
    }
</code></pre><div class="note"><h3 class="title">Note</h3><p><code class="literal">nix-prefetch-git</code> is added to the <code class="literal">nix-shell -p</code> invocation above, because it has to be in <code class="literal">$PATH</code> for <code class="literal">dhall-to-nixpkgs</code> to work.</p></div><p>The utility takes care of automatically detecting remote imports and converting
them to package dependencies.  You can also use the utility on local
Dhall directories, too:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">dhall-to-nixpkgs directory ~/proj/dhall-semver</span>
{ buildDhallDirectoryPackage, Prelude }:
  buildDhallDirectoryPackage {
    name = "proj";
    src = ~/proj/dhall-semver;
    file = "package.dhall";
    source = false;
    document = false;
    dependencies = [ (Prelude.overridePackage { file = "package.dhall"; }) ];
    }
</code></pre><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="ssec-dhall-remote-imports-as-fod" class="title">Remote imports as fixed-output derivations   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-dhall-remote-imports-as-fod" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><code class="literal">dhall-to-nixpkgs</code> has the ability to fetch and build remote imports as
fixed-output derivations by using their Dhall integrity check. This is
sometimes easier than manually packaging all remote imports.</p><p>This can be used like the following:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">dhall-to-nixpkgs directory --fixed-output-derivations ~/proj/dhall-semver</span>
{ buildDhallDirectoryPackage, buildDhallUrl }:
  buildDhallDirectoryPackage {
    name = "proj";
    src = ~/proj/dhall-semver;
    file = "package.dhall";
    source = false;
    document = false;
    dependencies = [
      (buildDhallUrl {
        url = "https://prelude.dhall-lang.org/v17.0.0/package.dhall";
        hash = "sha256-ENs8kZwl6QRoM9+Jeo/+JwHcOQ+giT2VjDQwUkvlpD4=";
        dhallHash = "sha256:10db3c919c25e9046833df897a8ffe2701dc390fa0893d958c3430524be5a43e";
        })
      ];
    }
</code></pre><p>Here, <code class="literal">dhall-semver</code>’s <code class="literal">Prelude</code> dependency is fetched and built with the
<code class="literal">buildDhallUrl</code> helper function, instead of being passed in as a function
argument.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-dhall-overriding-dependency-versions" class="title">Overriding dependency versions   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-dhall-overriding-dependency-versions" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Suppose that we change our <code class="literal">true.dhall</code> example expression to depend on an older
version of the Prelude (19.0.0):</p><pre><code class="programlisting dhall hljs language-bash" data-highlighted="yes">-- ./true.dhall

<span class="hljs-built_in">let</span> Prelude =
      https://prelude.dhall-lang.org/v19.0.0/package.dhall
        sha256:eb693342eb769f782174157eba9b5924cf8ac6793897fc36a31ccbd6f56dafe2

<span class="hljs-keyword">in</span>  Prelude.Bool.not False
</code></pre><p>If we try to rebuild that expression the build will fail:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">nix build --file ./example.nix dhallPackages.<span class="hljs-literal">true</span></span>
builder for '/nix/store/0f1hla7ff1wiaqyk1r2ky4wnhnw114fi-true.drv' failed with exit code 1; last 10 log lines:

  Dhall was compiled without the 'with-http' flag.

  The requested URL was: https://prelude.dhall-lang.org/v19.0.0/package.dhall


  4│       https://prelude.dhall-lang.org/v19.0.0/package.dhall
  5│         sha256:eb693342eb769f782174157eba9b5924cf8ac6793897fc36a31ccbd6f56dafe2

  /nix/store/rsab4y99h14912h4zplqx2iizr5n4rc2-true.dhall:4:7
[1 built (1 failed), 0.0 MiB DL]
error: build of '/nix/store/0f1hla7ff1wiaqyk1r2ky4wnhnw114fi-true.drv' failed
</code></pre><p>… because the default Prelude selected by Nixpkgs revision
<code class="literal">94b2848559b12a8ed1fe433084686b2a81123c99is</code> is version 20.1.0, which doesn’t
have the same integrity check as version 19.0.0.  This means that version
19.0.0 is not cached and the interpreter is not allowed to fall back to
importing the URL.</p><p>However, we can override the default Prelude version by using <code class="literal">dhall-to-nixpkgs</code>
to create a Dhall package for our desired Prelude:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">dhall-to-nixpkgs github https://github.com/dhall-lang/dhall-lang.git \
    --name Prelude \
    --directory Prelude \
    --rev v19.0.0 \
    &gt; Prelude.nix</span>
</code></pre><p>… and then referencing that package in our Dhall overlay, by either overriding
the Prelude globally for all packages, like this:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">  <span class="hljs-attr">dhallOverrides</span> = self: super: {
    <span class="hljs-attr">true</span> = self.callPackage ./<span class="hljs-literal">true</span>.nix { };

    <span class="hljs-attr">Prelude</span> = self.callPackage ./Prelude.nix { };
  };
</code></pre><p>… or selectively overriding the Prelude dependency for just the <code class="literal">true</code> package,
like this:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">  <span class="hljs-attr">dhallOverrides</span> = self: super: {
    <span class="hljs-attr">true</span> = self.callPackage ./<span class="hljs-literal">true</span>.nix {
      <span class="hljs-attr">Prelude</span> = self.callPackage ./Prelude.nix { };
    };
  };
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-dhall-overrides" class="title">Overrides   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-dhall-overrides" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>You can override any of the arguments to <code class="literal">buildDhallGitHubPackage</code> or
<code class="literal">buildDhallDirectoryPackage</code> using the <code class="literal">overridePackage</code> attribute of a package.
For example, suppose we wanted to selectively enable <code class="literal">source = true</code> just for the Prelude.  We can do that like this:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">  <span class="hljs-attr">dhallOverrides</span> = self: super: {
    <span class="hljs-attr">Prelude</span> = super.Prelude.overridePackage { <span class="hljs-attr">source</span> = <span class="hljs-literal">true</span>; };

    …
  };
</code></pre>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="dotnet" class="title" style="clear: both">Dotnet   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#dotnet" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#local-development-workflow">Local Development Workflow</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#dotnet-sdk-vs-dotnetcorepackages.sdk">dotnet-sdk vs dotnetCorePackages.sdk</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#dotnetcorepackages.sdk-vs-dotnetcorepackages.runtime-vs-dotnetcorepackages.aspnetcore">dotnetCorePackages.sdk vs dotnetCorePackages.runtime vs dotnetCorePackages.aspnetcore</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#packaging-a-dotnet-application">Packaging a Dotnet Application</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#dotnet-global-tools">Dotnet global tools</a> </span></dt> </dl></div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="local-development-workflow" class="title">Local Development Workflow   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#local-development-workflow" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>For local development, it’s recommended to use nix-shell to create a dotnet environment:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-comment"># shell.nix</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {};

mkShell {
  <span class="hljs-attr">name</span> = <span class="hljs-string">"dotnet-env"</span>;
  <span class="hljs-attr">packages</span> = [
    dotnet-sdk
  ];
}
</code></pre><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="using-many-sdks-in-a-workflow" class="title">Using many sdks in a workflow   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#using-many-sdks-in-a-workflow" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>It’s very likely that more than one sdk will be needed on a given project. Dotnet provides several different frameworks (E.g dotnetcore, aspnetcore, etc.) as well as many versions for a given framework. Normally, dotnet is able to fetch a framework and install it relative to the executable. However, this would mean writing to the nix store in nixpkgs, which is read-only. To support the many-sdk use case, one can compose an environment using <code class="literal">dotnetCorePackages.combinePackages</code>:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">with</span> <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {};

mkShell {
  <span class="hljs-attr">name</span> = <span class="hljs-string">"dotnet-env"</span>;
  <span class="hljs-attr">packages</span> = [
    (<span class="hljs-keyword">with</span> dotnetCorePackages; combinePackages [
      sdk_6_0
      sdk_7_0
    ])
  ];
}
</code></pre><p>This will produce a dotnet installation that has the dotnet 6.0 7.0 sdk. The first sdk listed will have it’s cli utility present in the resulting environment. Example info output:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">dotnet --info</span>
.NET SDK:
 Version:   7.0.202
 Commit:    6c74320bc3

Środowisko uruchomieniowe:
 OS Name:     nixos
 OS Version:  23.05
 OS Platform: Linux
 RID:         linux-x64
 Base Path:   /nix/store/n2pm44xq20hz7ybsasgmd7p3yh31gnh4-dotnet-sdk-7.0.202/sdk/7.0.202/

Host:
  Version:      7.0.4
  Architecture: x64
  Commit:       0a396acafe

.NET SDKs installed:
  6.0.407 [/nix/store/3b19303vwrhv0xxz1hg355c7f2hgxxgd-dotnet-core-combined/sdk]
  7.0.202 [/nix/store/3b19303vwrhv0xxz1hg355c7f2hgxxgd-dotnet-core-combined/sdk]

.NET runtimes installed:
  Microsoft.AspNetCore.App 6.0.15 [/nix/store/3b19303vwrhv0xxz1hg355c7f2hgxxgd-dotnet-core-combined/shared/Microsoft.AspNetCore.App]
  Microsoft.AspNetCore.App 7.0.4 [/nix/store/3b19303vwrhv0xxz1hg355c7f2hgxxgd-dotnet-core-combined/shared/Microsoft.AspNetCore.App]
  Microsoft.NETCore.App 6.0.15 [/nix/store/3b19303vwrhv0xxz1hg355c7f2hgxxgd-dotnet-core-combined/shared/Microsoft.NETCore.App]
  Microsoft.NETCore.App 7.0.4 [/nix/store/3b19303vwrhv0xxz1hg355c7f2hgxxgd-dotnet-core-combined/shared/Microsoft.NETCore.App]

Other architectures found:
  None

Environment variables:
  Not set

global.json file:
  Not found

Learn more:
  https://aka.ms/dotnet/info

Download .NET:
  https://aka.ms/dotnet/download
</code></pre>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="dotnet-sdk-vs-dotnetcorepackages.sdk" class="title">dotnet-sdk vs dotnetCorePackages.sdk   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#dotnet-sdk-vs-dotnetcorepackages.sdk" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The <code class="literal">dotnetCorePackages.sdk_X_Y</code> is preferred over the old dotnet-sdk as both major and minor version are very important for a dotnet environment. If a given minor version isn’t present (or was changed), then this will likely break your ability to build a project.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="dotnetcorepackages.sdk-vs-dotnetcorepackages.runtime-vs-dotnetcorepackages.aspnetcore" class="title">dotnetCorePackages.sdk vs dotnetCorePackages.runtime vs dotnetCorePackages.aspnetcore   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#dotnetcorepackages.sdk-vs-dotnetcorepackages.runtime-vs-dotnetcorepackages.aspnetcore" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The <code class="literal">dotnetCorePackages.sdk</code> contains both a runtime and the full sdk of a given version. The <code class="literal">runtime</code> and <code class="literal">aspnetcore</code> packages are meant to serve as minimal runtimes to deploy alongside already built applications.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="packaging-a-dotnet-application" class="title">Packaging a Dotnet Application   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#packaging-a-dotnet-application" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>To package Dotnet applications, you can use <code class="literal">buildDotnetModule</code>. This has similar arguments to <code class="literal">stdenv.mkDerivation</code>, with the following additions:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">projectFile</code> is used for specifying the dotnet project file, relative to the source root. These have <code class="literal">.sln</code> (entire solution) or <code class="literal">.csproj</code> (single project) file extensions. This can be a list of multiple projects as well. When omitted, will attempt to find and build the solution (<code class="literal">.sln</code>). If running into problems, make sure to set it to a file (or a list of files) with the <code class="literal">.csproj</code> extension - building applications as entire solutions is not fully supported by the .NET CLI.</p></li><li class="listitem"><p><code class="literal">nugetDeps</code> takes either a path to a <code class="literal">deps.nix</code> file, or a derivation. The <code class="literal">deps.nix</code> file can be generated using the script attached to <code class="literal">passthru.fetch-deps</code>. This file can also be generated manually using <code class="literal">nuget-to-nix</code> tool, which is available in nixpkgs. If the argument is a derivation, it will be used directly and assume it has the same output as <code class="literal">mkNugetDeps</code>.</p></li><li class="listitem"><p><code class="literal">packNupkg</code> is used to pack project as a <code class="literal">nupkg</code>, and installs it to <code class="literal">$out/share</code>. If set to <code class="literal">true</code>, the derivation can be used as a dependency for another dotnet project by adding it to <code class="literal">projectReferences</code>.</p></li><li class="listitem"><p><code class="literal">projectReferences</code> can be used to resolve <code class="literal">ProjectReference</code> project items. Referenced projects can be packed with <code class="literal">buildDotnetModule</code> by setting the <code class="literal">packNupkg = true</code> attribute and passing a list of derivations to <code class="literal">projectReferences</code>. Since we are sharing referenced projects as NuGets they must be added to csproj/fsproj files as <code class="literal">PackageReference</code> as well.
For example, your project has a local dependency:</p></li></ul></div><pre><code class="programlisting xml hljs language-bash" data-highlighted="yes">    &lt;ProjectReference Include=<span class="hljs-string">"../foo/bar.fsproj"</span> /&gt;
</code></pre><p>To enable discovery through <code class="literal">projectReferences</code> you would need to add:</p><pre><code class="programlisting xml hljs language-bash" data-highlighted="yes">    &lt;ProjectReference Include=<span class="hljs-string">"../foo/bar.fsproj"</span> /&gt;
    &lt;PackageReference Include=<span class="hljs-string">"bar"</span> Version=<span class="hljs-string">"*"</span> Condition=<span class="hljs-string">" '<span class="hljs-subst">$(ContinuousIntegrationBuild)</span>'=='true' "</span>/&gt;
</code></pre><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">executables</code> is used to specify which executables get wrapped to <code class="literal">$out/bin</code>, relative to <code class="literal">$out/lib/$pname</code>. If this is unset, all executables generated will get installed. If you do not want to install any, set this to <code class="literal">[]</code>. This gets done in the <code class="literal">preFixup</code> phase.</p></li><li class="listitem"><p><code class="literal">runtimeDeps</code> is used to wrap libraries into <code class="literal">LD_LIBRARY_PATH</code>. This is how dotnet usually handles runtime dependencies.</p></li><li class="listitem"><p><code class="literal">buildType</code> is used to change the type of build. Possible values are <code class="literal">Release</code>, <code class="literal">Debug</code>, etc. By default, this is set to <code class="literal">Release</code>.</p></li><li class="listitem"><p><code class="literal">selfContainedBuild</code> allows to enable the <a class="link" href="https://docs.microsoft.com/en-us/dotnet/core/deploying/#publish-self-contained" target="_top">self-contained</a> build flag. By default, it is set to false and generated applications have a dependency on the selected dotnet runtime. If enabled, the dotnet runtime is bundled into the executable and the built app has no dependency on .NET.</p></li><li class="listitem"><p><code class="literal">useAppHost</code> will enable creation of a binary executable that runs the .NET application using the specified root. More info in <a class="link" href="https://learn.microsoft.com/en-us/dotnet/core/deploying/#publish-framework-dependent" target="_top">Microsoft docs</a>. Enabled by default.</p></li><li class="listitem"><p><code class="literal">useDotnetFromEnv</code> will change the binary wrapper so that it uses the .NET from the environment. The runtime specified by <code class="literal">dotnet-runtime</code> is given as a fallback in case no .NET is installed in the user’s environment. This is most useful for .NET global tools and LSP servers, which often extend the .NET CLI and their runtime should match the users’ .NET runtime.</p></li><li class="listitem"><p><code class="literal">dotnet-sdk</code> is useful in cases where you need to change what dotnet SDK is being used. You can also set this to the result of <code class="literal">dotnetSdkPackages.combinePackages</code>, if the project uses multiple SDKs to build.</p></li><li class="listitem"><p><code class="literal">dotnet-runtime</code> is useful in cases where you need to change what dotnet runtime is being used. This can be either a regular dotnet runtime, or an aspnetcore.</p></li><li class="listitem"><p><code class="literal">dotnet-test-sdk</code> is useful in cases where unit tests expect a different dotnet SDK. By default, this is set to the <code class="literal">dotnet-sdk</code> attribute.</p></li><li class="listitem"><p><code class="literal">testProjectFile</code> is useful in cases where the regular project file does not contain the unit tests. It gets restored and build, but not installed. You may need to regenerate your nuget lockfile after setting this. Note that if set, only tests from this project are executed.</p></li><li class="listitem"><p><code class="literal">disabledTests</code> is used to disable running specific unit tests. This gets passed as: <code class="literal">dotnet test --filter "FullyQualifiedName!={}"</code>, to ensure compatibility with all unit test frameworks.</p></li><li class="listitem"><p><code class="literal">dotnetRestoreFlags</code> can be used to pass flags to <code class="literal">dotnet restore</code>.</p></li><li class="listitem"><p><code class="literal">dotnetBuildFlags</code> can be used to pass flags to <code class="literal">dotnet build</code>.</p></li><li class="listitem"><p><code class="literal">dotnetTestFlags</code> can be used to pass flags to <code class="literal">dotnet test</code>. Used only if <code class="literal">doCheck</code> is set to <code class="literal">true</code>.</p></li><li class="listitem"><p><code class="literal">dotnetInstallFlags</code> can be used to pass flags to <code class="literal">dotnet install</code>.</p></li><li class="listitem"><p><code class="literal">dotnetPackFlags</code> can be used to pass flags to <code class="literal">dotnet pack</code>. Used only if <code class="literal">packNupkg</code> is set to <code class="literal">true</code>.</p></li><li class="listitem"><p><code class="literal">dotnetFlags</code> can be used to pass flags to all of the above phases.</p></li></ul></div><p>When packaging a new application, you need to fetch its dependencies. Create an empty <code class="literal">deps.nix</code>, set <code class="literal">nugetDeps = ./deps.nix</code>, then run <code class="literal">nix-build -A package.fetch-deps</code> to generate a script that will build the lockfile for you.</p><p>Here is an example <code class="literal">default.nix</code>, using some of the previously discussed arguments:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ lib, buildDotnetModule, dotnetCorePackages, ffmpeg }:

<span class="hljs-keyword">let</span>
  <span class="hljs-attr">referencedProject</span> = <span class="hljs-built_in">import</span> ../../bar { ... };
<span class="hljs-keyword">in</span> buildDotnetModule <span class="hljs-keyword">rec</span> {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"someDotnetApplication"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"0.1"</span>;

  <span class="hljs-attr">src</span> = ./.;

  <span class="hljs-attr">projectFile</span> = <span class="hljs-string">"src/project.sln"</span>;
  <span class="hljs-comment"># File generated with `nix-build -A package.passthru.fetch-deps`.</span>
  <span class="hljs-comment"># To run fetch-deps when this file does not yet exist, set nugetDeps to null</span>
  <span class="hljs-attr">nugetDeps</span> = ./deps.nix;

  <span class="hljs-attr">projectReferences</span> = [ referencedProject ]; <span class="hljs-comment"># `referencedProject` must contain `nupkg` in the folder structure.</span>

  <span class="hljs-attr">dotnet-sdk</span> = dotnetCorePackages.sdk_6.<span class="hljs-number">0</span>;
  <span class="hljs-attr">dotnet-runtime</span> = dotnetCorePackages.runtime_6_0;

  <span class="hljs-attr">executables</span> = [ <span class="hljs-string">"foo"</span> ]; <span class="hljs-comment"># This wraps "$out/lib/$pname/foo" to `$out/bin/foo`.</span>
  <span class="hljs-attr">executables</span> = []; <span class="hljs-comment"># Don't install any executables.</span>

  <span class="hljs-attr">packNupkg</span> = <span class="hljs-literal">true</span>; <span class="hljs-comment"># This packs the project as "foo-0.1.nupkg" at `$out/share`.</span>

  <span class="hljs-attr">runtimeDeps</span> = [ ffmpeg ]; <span class="hljs-comment"># This will wrap ffmpeg's library path into `LD_LIBRARY_PATH`.</span>
}
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="dotnet-global-tools" class="title">Dotnet global tools   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#dotnet-global-tools" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p><a class="link" href="https://learn.microsoft.com/en-us/dotnet/core/tools/global-tools" target="_top">.NET Global tools</a> are a mechanism provided by the dotnet CLI to install .NET binaries from Nuget packages.</p><p>They can be installed either as a global tool for the entire system, or as a local tool specific to project.</p><p>The local installation is the easiest and works on NixOS in the same way as on other Linux distributions.
<a class="link" href="https://learn.microsoft.com/en-us/dotnet/core/tools/global-tools#install-a-local-tool" target="_top">See dotnet documentation</a> to learn more.</p><p><a class="link" href="https://learn.microsoft.com/en-us/dotnet/core/tools/global-tools#install-a-global-tool" target="_top">The global installation method</a>
should also work most of the time. You have to remember to update the <code class="literal">PATH</code>
value to the location the tools are installed to (the CLI will inform you about it during installation) and also set
the <code class="literal">DOTNET_ROOT</code> value, so that the tool can find the .NET SDK package.
You can find the path to the SDK by running <code class="literal">nix eval --raw nixpkgs#dotnet-sdk</code> (substitute the <code class="literal">dotnet-sdk</code> package for
another if a different SDK version is needed).</p><p>This method is not recommended on NixOS, since it’s not declarative and involves installing binaries not made for NixOS,
which will not always work.</p><p>The third, and preferred way, is packaging the tool into a Nix derivation.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="packaging-dotnet-global-tools" class="title">Packaging Dotnet global tools   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#packaging-dotnet-global-tools" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Dotnet global tools are standard .NET binaries, just made available through a special
NuGet package. Therefore, they can be built and packaged like every .NET application,
using <code class="literal">buildDotnetModule</code>.</p><p>If however the source is not available or difficult to build, the
<code class="literal">buildDotnetGlobalTool</code> helper can be used, which will package the tool
straight from its NuGet package.</p><p>This helper has the same arguments as <code class="literal">buildDotnetModule</code>, with a few differences:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">pname</code> and <code class="literal">version</code> are required, and will be used to find the NuGet package of the tool</p></li><li class="listitem"><p><code class="literal">nugetName</code> can be used to override the NuGet package name that will be downloaded, if it’s different from <code class="literal">pname</code></p></li><li class="listitem"><p><code class="literal">nugetSha256</code> is the hash of the fetched NuGet package. Set this to <code class="literal">lib.fakeHash256</code> for the first build, and it will error out, giving you the proper hash. Also remember to update it during version updates (it will not error out if you just change the version while having a fetched package in <code class="literal">/nix/store</code>)</p></li><li class="listitem"><p><code class="literal">dotnet-runtime</code> is set to <code class="literal">dotnet-sdk</code> by default. When changing this, remember that .NET tools fetched from NuGet require an SDK.</p></li></ul></div><p>Here is an example of packaging <code class="literal">pbm</code>, an unfree binary without source available:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ buildDotnetGlobalTool, lib }:

buildDotnetGlobalTool {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"pbm"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"1.3.1"</span>;

  <span class="hljs-attr">nugetSha256</span> = <span class="hljs-string">"sha256-ZG2HFyKYhVNVYd2kRlkbAjZJq88OADe3yjxmLuxXDUo="</span>;

  <span class="hljs-attr">meta</span> = <span class="hljs-keyword">with</span> lib; {
    <span class="hljs-attr">homepage</span> = <span class="hljs-string">"https://cmd.petabridge.com/index.html"</span>;
    <span class="hljs-attr">changelog</span> = <span class="hljs-string">"https://cmd.petabridge.com/articles/RELEASE_NOTES.html"</span>;
    <span class="hljs-attr">license</span> = licenses.unfree;
    <span class="hljs-attr">platforms</span> = platforms.linux;
  };
}
</code></pre><p>When packaging a new .NET application in nixpkgs, you can tag the <a class="link" href="https://github.com/orgs/nixos/teams/dotnet" target="_top"><code class="literal">@NixOS/dotnet</code></a> team for help and code review.</p>
</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="emscripten" class="title" style="clear: both">Emscripten   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#emscripten" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#declarative-usage">Examples</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#declarative-debugging">Debugging</a> </span></dt> </dl></div><p><a class="link" href="https://github.com/kripken/emscripten" target="_top">Emscripten</a>: An LLVM-to-JavaScript Compiler</p><p>If you want to work with <code class="literal">emcc</code>, <code class="literal">emconfigure</code> and <code class="literal">emmake</code> as you are used to from Ubuntu and similar distributions,</p><pre><code class="programlisting console hljs language-shell" data-highlighted="yes">nix-shell -p emscripten
</code></pre><p>A few things to note:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">export EMCC_DEBUG=2</code> is nice for debugging</p></li><li class="listitem"><p>The build artifact cache in <code class="literal">~/.emscripten</code> sometimes creates issues and needs to be removed from time to time</p></li></ul></div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="declarative-usage" class="title">Examples   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#declarative-usage" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Let’s see two different examples from <code class="literal">pkgs/top-level/emscripten-packages.nix</code>:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">pkgs.zlib.override</code></p></li><li class="listitem"><p><code class="literal">pkgs.buildEmscriptenPackage</code></p></li></ul></div><p>A special requirement of the <code class="literal">pkgs.buildEmscriptenPackage</code> is the <code class="literal">doCheck = true</code>.
This means each Emscripten package requires that a <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ssec-check-phase" title="The check phase"><code class="literal">checkPhase</code></a> is implemented.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>Use <code class="literal">export EMCC_DEBUG=2</code> from within a phase to get more detailed debug output what is going wrong.</p></li><li class="listitem"><p>The cache at <code class="literal">~/.emscripten</code> requires to set <code class="literal">HOME=$TMPDIR</code> in individual phases.
This makes compilation slower but also more deterministic.</p></li></ul></div><div class="example"><span id="usage-1-pkgs.zlib.override"></span><p class="title"><strong>Example&nbsp;237.&nbsp;Using <code class="literal">pkgs.zlib.override {}</code></strong></p><div class="example-contents"><p>This example uses <code class="literal">zlib</code> from Nixpkgs, but instead of compiling <span class="strong"><strong>C</strong></span> to <span class="strong"><strong>ELF</strong></span> it compiles <span class="strong"><strong>C</strong></span> to <span class="strong"><strong>JavaScript</strong></span> since we were using <code class="literal">pkgs.zlib.override</code> and changed <code class="literal">stdenv</code> to <code class="literal">pkgs.emscriptenStdenv</code>.</p><p>A few adaptions and hacks were put in place to make it work.
One advantage is that when <code class="literal">pkgs.zlib</code> is updated, it will automatically update this package as well.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">(pkgs.zlib.override {
  <span class="hljs-attr">stdenv</span> = pkgs.emscriptenStdenv;
}).overrideAttrs
(old: <span class="hljs-keyword">rec</span> {
  <span class="hljs-attr">buildInputs</span> = old.buildInputs ++ [ pkg-config ];
  <span class="hljs-comment"># we need to reset this setting!</span>
  <span class="hljs-attr">env</span> = (old.env <span class="hljs-literal">or</span> { }) // { <span class="hljs-attr">NIX_CFLAGS_COMPILE</span> = <span class="hljs-string">""</span>; };
  <span class="hljs-attr">configurePhase</span> = <span class="hljs-string">''
    # FIXME: Some tests require writing at $HOME
    HOME=$TMPDIR
    runHook preConfigure

    #export EMCC_DEBUG=2
    emconfigure ./configure --prefix=$out --shared

    runHook postConfigure
  ''</span>;
  <span class="hljs-attr">dontStrip</span> = <span class="hljs-literal">true</span>;
  <span class="hljs-attr">outputs</span> = [ <span class="hljs-string">"out"</span> ];
  <span class="hljs-attr">buildPhase</span> = <span class="hljs-string">''
    emmake make
  ''</span>;
  <span class="hljs-attr">installPhase</span> = <span class="hljs-string">''
    emmake make install
  ''</span>;
  <span class="hljs-attr">checkPhase</span> = <span class="hljs-string">''
    echo "================= testing zlib using node ================="

    echo "Compiling a custom test"
    set -x
    emcc -O2 -s EMULATE_FUNCTION_POINTER_CASTS=1 test/example.c -DZ_SOLO \
    libz.so.<span class="hljs-subst">${old.version}</span> -I . -o example.js

    echo "Using node to execute the test"
    <span class="hljs-subst">${pkgs.nodejs}</span>/bin/node ./example.js

    set +x
    if [ $? -ne 0 ]; then
      echo "test failed for some reason"
      exit 1;
    else
      echo "it seems to work! very good."
    fi
    echo "================= /testing zlib using node ================="
  ''</span>;

  <span class="hljs-attr">postPatch</span> = pkgs.lib.optionalString pkgs.stdenv.isDarwin <span class="hljs-string">''
    substituteInPlace configure \
      --replace '/usr/bin/libtool' 'ar' \
      --replace 'AR="libtool"' 'AR="ar"' \
      --replace 'ARFLAGS="-o"' 'ARFLAGS="-r"'
  ''</span>;
})
</code></pre><div class="example"><span id="usage-2-pkgs.buildemscriptenpackage"></span><p class="title"><strong>Example&nbsp;238.&nbsp;Using <code class="literal">pkgs.buildEmscriptenPackage {}</code></strong></p><div class="example-contents"><p>This <code class="literal">xmlmirror</code> example features an Emscripten package that is defined completely from this context and no <code class="literal">pkgs.zlib.override</code> is used.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">pkgs.buildEmscriptenPackage <span class="hljs-keyword">rec</span> {
  <span class="hljs-attr">name</span> = <span class="hljs-string">"xmlmirror"</span>;

  <span class="hljs-attr">buildInputs</span> = [ pkg-config autoconf automake libtool gnumake libxml2 nodejs openjdk json_c ];
  <span class="hljs-attr">nativeBuildInputs</span> = [ pkg-config zlib ];

  <span class="hljs-attr">src</span> = pkgs.fetchgit {
    <span class="hljs-attr">url</span> = <span class="hljs-string">"https://gitlab.com/odfplugfest/xmlmirror.git"</span>;
    <span class="hljs-attr">rev</span> = <span class="hljs-string">"4fd7e86f7c9526b8f4c1733e5c8b45175860a8fd"</span>;
    <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-i+QgY+5PYVg5pwhzcDnkfXAznBg3e8sWH2jZtixuWsk="</span>;
  };

  <span class="hljs-attr">configurePhase</span> = <span class="hljs-string">''
    rm -f fastXmlLint.js*
    # a fix for ERROR:root:For asm.js, TOTAL_MEMORY must be a multiple of 16MB, was 234217728
    # https://gitlab.com/odfplugfest/xmlmirror/issues/8
    sed -e "s/TOTAL_MEMORY=234217728/TOTAL_MEMORY=268435456/g" -i Makefile.emEnv
    # https://github.com/kripken/emscripten/issues/6344
    # https://gitlab.com/odfplugfest/xmlmirror/issues/9
    sed -e "s/\$(JSONC_LDFLAGS) \$(ZLIB_LDFLAGS) \$(LIBXML20_LDFLAGS)/\$(JSONC_LDFLAGS) \$(LIBXML20_LDFLAGS) \$(ZLIB_LDFLAGS) /g" -i Makefile.emEnv
    # https://gitlab.com/odfplugfest/xmlmirror/issues/11
    sed -e "s/-o fastXmlLint.js/-s EXTRA_EXPORTED_RUNTIME_METHODS='[\"ccall\", \"cwrap\"]' -o fastXmlLint.js/g" -i Makefile.emEnv
  ''</span>;

  <span class="hljs-attr">buildPhase</span> = <span class="hljs-string">''
    HOME=$TMPDIR
    make -f Makefile.emEnv
  ''</span>;

  <span class="hljs-attr">outputs</span> = [ <span class="hljs-string">"out"</span> <span class="hljs-string">"doc"</span> ];

  <span class="hljs-attr">installPhase</span> = <span class="hljs-string">''
    mkdir -p $out/share
    mkdir -p $doc/share/<span class="hljs-subst">${name}</span>

    cp Demo* $out/share
    cp -R codemirror-5.12 $out/share
    cp fastXmlLint.js* $out/share
    cp *.xsd $out/share
    cp *.js $out/share
    cp *.xhtml $out/share
    cp *.html $out/share
    cp *.json $out/share
    cp *.rng $out/share
    cp README.md $doc/share/<span class="hljs-subst">${name}</span>
  ''</span>;
  <span class="hljs-attr">checkPhase</span> = <span class="hljs-string">''

  ''</span>;
}
</code></pre></div></div><br class="example-break"></div></div><br class="example-break">
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="declarative-debugging" class="title">Debugging   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#declarative-debugging" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Use <code class="literal">nix-shell -I nixpkgs=/some/dir/nixpkgs -A emscriptenPackages.libz</code> and from there you can go trough the individual steps. This makes it easy to build a good <code class="literal">unit test</code> or list the files of the project.</p><div class="orderedlist"><ol class="orderedlist compact" type="1"><li class="listitem"><p><code class="literal">nix-shell -I nixpkgs=/some/dir/nixpkgs -A emscriptenPackages.libz</code></p></li><li class="listitem"><p><code class="literal">cd /tmp/</code></p></li><li class="listitem"><p><code class="literal">unpackPhase</code></p></li><li class="listitem"><p>cd libz-1.2.3</p></li><li class="listitem"><p><code class="literal">configurePhase</code></p></li><li class="listitem"><p><code class="literal">buildPhase</code></p></li><li class="listitem"><p>… happy hacking…</p></li></ol></div>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-language-gnome" class="title" style="clear: both">GNOME   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-language-gnome" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-gnome-packaging">Packaging GNOME applications</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-gnome-hooks">Onto <code class="literal">wrapGAppsHook</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-gnome-updating">Updating GNOME packages</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-gnome-common-issues">Frequently encountered issues</a> </span></dt> </dl></div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-gnome-packaging" class="title">Packaging GNOME applications   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-gnome-packaging" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Programs in the GNOME universe are written in various languages but they all use GObject-based libraries like GLib, GTK or GStreamer. These libraries are often modular, relying on looking into certain directories to find their modules. However, due to Nix’s specific file system organization, this will fail without our intervention. Fortunately, the libraries usually allow overriding the directories through environment variables, either natively or thanks to a patch in nixpkgs. <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#fun-wrapProgram" title="wrapProgram &lt;executable&gt; &lt;makeWrapperArgs&gt;">Wrapping</a> the executables to ensure correct paths are available to the application constitutes a significant part of packaging a modern desktop application. In this section, we will describe various modules needed by such applications, environment variables needed to make the modules load, and finally a script that will do the work for us.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="ssec-gnome-settings" class="title">Settings   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-gnome-settings" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><a class="link" href="https://developer.gnome.org/gio/stable/GSettings.html" target="_top">GSettings</a> API is often used for storing settings. GSettings schemas are required, to know the type and other metadata of the stored values. GLib looks for <code class="literal">glib-2.0/schemas/gschemas.compiled</code> files inside the directories of <code class="literal">XDG_DATA_DIRS</code>.</p><p>On Linux, GSettings API is implemented using <a class="link" href="https://wiki.gnome.org/Projects/dconf" target="_top">dconf</a> backend. You will need to add <code class="literal">dconf</code> <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ssec-gnome-gio-modules" title="GIO modules">GIO module</a> to <code class="literal">GIO_EXTRA_MODULES</code> variable, otherwise the <code class="literal">memory</code> backend will be used and the saved settings will not be persistent.</p><p>Last you will need the dconf database D-Bus service itself. You can enable it using <code class="literal">programs.dconf.enable</code>.</p><p>Some applications will also require <code class="literal">gsettings-desktop-schemas</code> for things like reading proxy configuration or user interface customization. This dependency is often not mentioned by upstream, you should grep for <code class="literal">org.gnome.desktop</code> and <code class="literal">org.gnome.system</code> to see if the schemas are needed.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="ssec-gnome-gio-modules" class="title">GIO modules   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-gnome-gio-modules" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>GLib’s <a class="link" href="https://developer.gnome.org/gio/stable/ch01.html" target="_top">GIO</a> library supports several <a class="link" href="https://developer.gnome.org/gio/stable/extending-gio.html" target="_top">extension points</a>. Notably, they allow:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>implementing settings backends (already <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ssec-gnome-settings" title="Settings">mentioned</a>)</p></li><li class="listitem"><p>adding TLS support</p></li><li class="listitem"><p>proxy settings</p></li><li class="listitem"><p>virtual file systems</p></li></ul></div><p>The modules are typically installed to <code class="literal">lib/gio/modules/</code> directory of a package and you need to add them to <code class="literal">GIO_EXTRA_MODULES</code> if you need any of those features.</p><p>In particular, we recommend:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>adding <code class="literal">dconf.lib</code> for any software on Linux that reads <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ssec-gnome-settings" title="Settings">GSettings</a> (even transitively through e.g. GTK’s file manager)</p></li><li class="listitem"><p>adding <code class="literal">glib-networking</code> for any software that accesses network using GIO or libsoup – glib-networking contains a module that implements TLS support and loads system-wide proxy settings</p></li></ul></div><p>To allow software to use various virtual file systems, <code class="literal">gvfs</code> package can be also added. But that is usually an optional feature so we typically use <code class="literal">gvfs</code> from the system (e.g. installed globally using NixOS module).</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="ssec-gnome-gdk-pixbuf-loaders" class="title">GdkPixbuf loaders   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-gnome-gdk-pixbuf-loaders" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>GTK applications typically use <a class="link" href="https://gitlab.gnome.org/GNOME/gdk-pixbuf/" target="_top">GdkPixbuf</a> to load images. But <code class="literal">gdk-pixbuf</code> package only supports basic bitmap formats like JPEG, PNG or TIFF, requiring to use third-party loader modules for other formats. This is especially painful since GTK itself includes SVG icons, which cannot be rendered without a loader provided by <code class="literal">librsvg</code>.</p><p>Unlike other libraries mentioned in this section, GdkPixbuf only supports a single value in its controlling environment variable <code class="literal">GDK_PIXBUF_MODULE_FILE</code>. It is supposed to point to a cache file containing information about the available loaders. Each loader package will contain a <code class="literal">lib/gdk-pixbuf-2.0/2.10.0/loaders.cache</code> file describing the default loaders in <code class="literal">gdk-pixbuf</code> package plus the loader contained in the package itself. If you want to use multiple third-party loaders, you will need to create your own cache file manually. Fortunately, this is pretty rare as <a class="link" href="https://gitlab.gnome.org/federico/gdk-pixbuf-survey/blob/master/src/modules.md" target="_top">not many loaders exist</a>.</p><p><code class="literal">gdk-pixbuf</code> contains <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ssec-gnome-hooks-gdk-pixbuf">a setup hook</a> that sets <code class="literal">GDK_PIXBUF_MODULE_FILE</code> from dependencies but as mentioned in further section, it is pretty limited. Loaders should propagate this setup hook.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="ssec-gnome-icons" class="title">Icons   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-gnome-icons" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>When an application uses icons, an icon theme should be available in <code class="literal">XDG_DATA_DIRS</code> during runtime. The package for the default, icon-less <a class="link" href="https://www.freedesktop.org/wiki/Software/icon-theme/" target="_top">hicolor-icon-theme</a> (should be propagated by every icon theme) contains <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ssec-gnome-hooks-hicolor-icon-theme">a setup hook</a> that will pick up icon themes from <code class="literal">buildInputs</code> and add their datadirs to <code class="literal">XDG_ICON_DIRS</code> environment variable (this is Nixpkgs specific, not actually a XDG standard variable). Unfortunately, relying on that would mean every user has to download the theme included in the package expression no matter their preference. For that reason, we leave the installation of icon theme on the user. If you use one of the desktop environments, you probably already have an icon theme installed.</p><p>In the rare case you need to use icons from dependencies (e.g. when an app forces an icon theme), you can use the following to pick them up:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">  <span class="hljs-attr">buildInputs</span> = [
    pantheon.elementary-icon-theme
  ];
  <span class="hljs-attr">preFixup</span> = <span class="hljs-string">''
    gappsWrapperArgs+=(
      # The icon theme is hardcoded.
      --prefix XDG_DATA_DIRS : "$XDG_ICON_DIRS"
    )
  ''</span>;
</code></pre><p>To avoid costly file system access when locating icons, GTK, <a class="link" href="https://woboq.com/blog/qicon-reads-gtk-icon-cache-in-qt57.html" target="_top">as well as Qt</a>, can rely on <code class="literal">icon-theme.cache</code> files from the themes’ top-level directories. These files are generated using <code class="literal">gtk-update-icon-cache</code>, which is expected to be run whenever an icon is added or removed to an icon theme (typically an application icon into <code class="literal">hicolor</code> theme) and some programs do indeed run this after icon installation. However, since packages are installed into their own prefix by Nix, this would lead to conflicts. For that reason, <code class="literal">gtk3</code> provides a <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ssec-gnome-hooks-gtk-drop-icon-theme-cache">setup hook</a> that will clean the file from installation. Since most applications only ship their own icon that will be loaded on start-up, it should not affect them too much. On the other hand, icon themes are much larger and more widely used so we need to cache them. Because we recommend installing icon themes globally, we will generate the cache files from all packages in a profile using a NixOS module. You can enable the cache generation using <code class="literal">gtk.iconCache.enable</code> option if your desktop environment does not already do that.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="ssec-icon-theme-packaging" class="title">Packaging icon themes   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-icon-theme-packaging" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Icon themes may inherit from other icon themes. The inheritance is specified using the <code class="literal">Inherits</code> key in the <code class="literal">index.theme</code> file distributed with the icon theme. According to the <a class="link" href="https://specifications.freedesktop.org/icon-theme-spec/icon-theme-spec-latest.html" target="_top">icon theme specification</a>, icons not provided by the theme are looked for in its parent icon themes. Therefore the parent themes should be installed as dependencies for a more complete experience regarding the icon sets used.</p><p>The package <code class="literal">hicolor-icon-theme</code> provides a setup hook which makes symbolic links for the parent themes into the directory <code class="literal">share/icons</code> of the current theme directory in the nix store, making sure they can be found at runtime. For that to work the packages providing parent icon themes should be listed as propagated build dependencies, together with <code class="literal">hicolor-icon-theme</code>.</p><p>Also make sure that <code class="literal">icon-theme.cache</code> is installed for each theme provided by the package, and set <code class="literal">dontDropIconThemeCache</code> to <code class="literal">true</code> so that the cache file is not removed by the <code class="literal">gtk3</code> setup hook.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="ssec-gnome-themes" class="title">GTK Themes   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-gnome-themes" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Previously, a GTK theme needed to be in <code class="literal">XDG_DATA_DIRS</code>. This is no longer necessary for most programs since GTK incorporated Adwaita theme. Some programs (for example, those designed for <a class="link" href="https://docs.elementary.io/hig" target="_top">elementary HIG</a>) might require a special theme like <code class="literal">pantheon.elementary-gtk-theme</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="ssec-gnome-typelibs" class="title">GObject introspection typelibs   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-gnome-typelibs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><a class="link" href="https://wiki.gnome.org/Projects/GObjectIntrospection" target="_top">GObject introspection</a> allows applications to use C libraries in other languages easily. It does this through <code class="literal">typelib</code> files searched in <code class="literal">GI_TYPELIB_PATH</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="ssec-gnome-plugins" class="title">Various plug-ins   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-gnome-plugins" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>If your application uses <a class="link" href="https://gstreamer.freedesktop.org/" target="_top">GStreamer</a> or <a class="link" href="https://wiki.gnome.org/Projects/Grilo" target="_top">Grilo</a>, you should set <code class="literal">GST_PLUGIN_SYSTEM_PATH_1_0</code> and <code class="literal">GRL_PLUGIN_PATH</code>, respectively.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-gnome-hooks" class="title">Onto <code class="literal">wrapGAppsHook</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-gnome-hooks" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Given the requirements above, the package expression would become messy quickly:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">preFixup</span> = <span class="hljs-string">''
  for f in $(find $out/bin/ $out/libexec/ -type f -executable); do
    wrapProgram "$f" \
      --prefix GIO_EXTRA_MODULES : "<span class="hljs-subst">${getLib dconf}</span>/lib/gio/modules" \
      --prefix XDG_DATA_DIRS : "$out/share" \
      --prefix XDG_DATA_DIRS : "$out/share/gsettings-schemas/<span class="hljs-subst">${name}</span>" \
      --prefix XDG_DATA_DIRS : "<span class="hljs-subst">${gsettings-desktop-schemas}</span>/share/gsettings-schemas/<span class="hljs-subst">${gsettings-desktop-schemas.name}</span>" \
      --prefix XDG_DATA_DIRS : "<span class="hljs-subst">${hicolor-icon-theme}</span>/share" \
      --prefix GI_TYPELIB_PATH : "<span class="hljs-subst">${lib.makeSearchPath <span class="hljs-string">"lib/girepository-1.0"</span> [ pango json-glib ]}</span>"
  done
''</span>;
</code></pre><p>Fortunately, there is <span id="ssec-gnome-hooks-wrapgappshook"></span><code class="literal">wrapGAppsHook</code>. It works in conjunction with other setup hooks that populate environment variables, and it will then wrap all executables in <code class="literal">bin</code> and <code class="literal">libexec</code> directories using said variables.</p><p>For convenience, it also adds <code class="literal">dconf.lib</code> for a GIO module implementing a GSettings backend using <code class="literal">dconf</code>, <code class="literal">gtk3</code> for GSettings schemas, and <code class="literal">librsvg</code> for GdkPixbuf loader to the closure. There is also <span id="ssec-gnome-hooks-wrapgappshook4"></span><code class="literal">wrapGAppsHook4</code>, which replaces GTK 3 with GTK 4. And in case you are packaging a program without a graphical interface, you might want to use <span id="ssec-gnome-hooks-wrapgappsnoguihook"></span><code class="literal">wrapGAppsNoGuiHook</code>, which runs the same script as <code class="literal">wrapGAppsHook</code> but does not bring <code class="literal">gtk3</code> and <code class="literal">librsvg</code> into the closure.</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><code class="literal">wrapGAppsHook</code> itself will add the package’s <code class="literal">share</code> directory to <code class="literal">XDG_DATA_DIRS</code>.</p></li><li class="listitem"><p><span id="ssec-gnome-hooks-glib"></span> <code class="literal">glib</code> setup hook will populate <code class="literal">GSETTINGS_SCHEMAS_PATH</code> and then <code class="literal">wrapGAppsHook</code> will prepend it to <code class="literal">XDG_DATA_DIRS</code>.</p></li><li class="listitem"><p><span id="ssec-gnome-hooks-gdk-pixbuf"></span> <code class="literal">gdk-pixbuf</code> setup hook will populate <code class="literal">GDK_PIXBUF_MODULE_FILE</code> with the path to biggest <code class="literal">loaders.cache</code> file from the dependencies containing <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ssec-gnome-gdk-pixbuf-loaders" title="GdkPixbuf loaders">GdkPixbuf loaders</a>. This works fine when there are only two packages containing loaders (<code class="literal">gdk-pixbuf</code> and e.g. <code class="literal">librsvg</code>) – it will choose the second one, reasonably expecting that it will be bigger since it describes extra loader in addition to the default ones. But when there are more than two loader packages, this logic will break. One possible solution would be constructing a custom cache file for each package containing a program like <code class="literal">services/x11/gdk-pixbuf.nix</code> NixOS module does. <code class="literal">wrapGAppsHook</code> copies the <code class="literal">GDK_PIXBUF_MODULE_FILE</code> environment variable into the produced wrapper.</p></li><li class="listitem"><p><span id="ssec-gnome-hooks-gtk-drop-icon-theme-cache"></span> One of <code class="literal">gtk3</code>’s setup hooks will remove <code class="literal">icon-theme.cache</code> files from package’s icon theme directories to avoid conflicts. Icon theme packages should prevent this with <code class="literal">dontDropIconThemeCache = true;</code>.</p></li><li class="listitem"><p><span id="ssec-gnome-hooks-dconf"></span> <code class="literal">dconf.lib</code> is a dependency of <code class="literal">wrapGAppsHook</code>, which then also adds it to the <code class="literal">GIO_EXTRA_MODULES</code> variable.</p></li><li class="listitem"><p><span id="ssec-gnome-hooks-hicolor-icon-theme"></span> <code class="literal">hicolor-icon-theme</code>’s setup hook will add icon themes to <code class="literal">XDG_ICON_DIRS</code>.</p></li><li class="listitem"><p><span id="ssec-gnome-hooks-gobject-introspection"></span> <code class="literal">gobject-introspection</code> setup hook populates <code class="literal">GI_TYPELIB_PATH</code> variable with <code class="literal">lib/girepository-1.0</code> directories of dependencies, which is then added to wrapper by <code class="literal">wrapGAppsHook</code>. It also adds <code class="literal">share</code> directories of dependencies to <code class="literal">XDG_DATA_DIRS</code>, which is intended to promote GIR files but it also <a class="link" href="https://github.com/NixOS/nixpkgs/issues/32790" target="_top">pollutes the closures</a> of packages using <code class="literal">wrapGAppsHook</code>.</p></li><li class="listitem"><p><span id="ssec-gnome-hooks-gst-grl-plugins"></span> Setup hooks of <code class="literal">gst_all_1.gstreamer</code> and <code class="literal">grilo</code> will populate the <code class="literal">GST_PLUGIN_SYSTEM_PATH_1_0</code> and <code class="literal">GRL_PLUGIN_PATH</code> variables, respectively, which will then be added to the wrapper by <code class="literal">wrapGAppsHook</code>.</p></li></ul></div><p>You can also pass additional arguments to <code class="literal">makeWrapper</code> using <code class="literal">gappsWrapperArgs</code> in <code class="literal">preFixup</code> hook:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">preFixup</span> = <span class="hljs-string">''
  gappsWrapperArgs+=(
    # Thumbnailers
    --prefix XDG_DATA_DIRS : "<span class="hljs-subst">${gdk-pixbuf}</span>/share"
    --prefix XDG_DATA_DIRS : "<span class="hljs-subst">${librsvg}</span>/share"
    --prefix XDG_DATA_DIRS : "<span class="hljs-subst">${shared-mime-info}</span>/share"
  )
''</span>;
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-gnome-updating" class="title">Updating GNOME packages   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-gnome-updating" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Most GNOME package offer <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#var-passthru-updateScript" title="passthru.updateScript"><code class="literal">updateScript</code></a>, it is therefore possible to update to latest source tarball by running <code class="literal">nix-shell maintainers/scripts/update.nix --argstr package gnome.nautilus</code> or even en masse with <code class="literal">nix-shell maintainers/scripts/update.nix --argstr path gnome</code>. Read the package’s <code class="literal">NEWS</code> file to see what changed.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-gnome-common-issues" class="title">Frequently encountered issues   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-gnome-common-issues" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="ssec-gnome-common-issues-no-schemas" class="title"><code class="literal">GLib-GIO-ERROR **: 06:04:50.903: No GSettings schemas are installed on the system</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-gnome-common-issues-no-schemas" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>There are no schemas available in <code class="literal">XDG_DATA_DIRS</code>. Temporarily add a random package containing schemas like <code class="literal">gsettings-desktop-schemas</code> to <code class="literal">buildInputs</code>. <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ssec-gnome-hooks-glib"><code class="literal">glib</code></a> and <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ssec-gnome-hooks-wrapgappshook"><code class="literal">wrapGAppsHook</code></a> setup hooks will take care of making the schemas available to application and you will see the actual missing schemas with the <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ssec-gnome-common-issues-missing-schema" title="GLib-GIO-ERROR **: 06:04:50.903: Settings schema ‘org.gnome.foo’ is not installed">next error</a>. Or you can try looking through the source code for the actual schemas used.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="ssec-gnome-common-issues-missing-schema" class="title"><code class="literal">GLib-GIO-ERROR **: 06:04:50.903: Settings schema ‘org.gnome.foo’ is not installed</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-gnome-common-issues-missing-schema" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Package is missing some GSettings schemas. You can find out the package containing the schema with <code class="literal">nix-locate org.gnome.foo.gschema.xml</code> and let the hooks handle the wrapping as <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ssec-gnome-common-issues-no-schemas" title="GLib-GIO-ERROR **: 06:04:50.903: No GSettings schemas are installed on the system">above</a>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="ssec-gnome-common-issues-double-wrapped" class="title">When using <code class="literal">wrapGAppsHook</code> with special derivers you can end up with double wrapped binaries.   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-gnome-common-issues-double-wrapped" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>This is because derivers like <code class="literal">python.pkgs.buildPythonApplication</code> or <code class="literal">qt5.mkDerivation</code> have setup-hooks automatically added that produce wrappers with makeWrapper. The simplest way to workaround that is to disable the <code class="literal">wrapGAppsHook</code> automatic wrapping with <code class="literal">dontWrapGApps = true;</code> and pass the arguments it intended to pass to makeWrapper to another.</p><p>In the case of a Python application it could look like:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">python3.pkgs.buildPythonApplication {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"gnome-music"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"3.32.2"</span>;

  <span class="hljs-attr">nativeBuildInputs</span> = [
    wrapGAppsHook
    gobject-introspection
    ...
  ];

  <span class="hljs-attr">dontWrapGApps</span> = <span class="hljs-literal">true</span>;

  <span class="hljs-comment"># Arguments to be passed to `makeWrapper`, only used by buildPython*</span>
  <span class="hljs-attr">preFixup</span> = <span class="hljs-string">''
    makeWrapperArgs+=("<span class="hljs-char escape_">''$</span>{gappsWrapperArgs[@]}")
  ''</span>;
}
</code></pre><p>And for a QT app like:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">mkDerivation {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"calibre"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"3.47.0"</span>;

  <span class="hljs-attr">nativeBuildInputs</span> = [
    wrapGAppsHook
    qmake
    ...
  ];

  <span class="hljs-attr">dontWrapGApps</span> = <span class="hljs-literal">true</span>;

  <span class="hljs-comment"># Arguments to be passed to `makeWrapper`, only used by qt5’s mkDerivation</span>
  <span class="hljs-attr">preFixup</span> = <span class="hljs-string">''
    qtWrapperArgs+=("<span class="hljs-char escape_">''$</span>{gappsWrapperArgs[@]}")
  ''</span>;
}
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="ssec-gnome-common-issues-unwrappable-package" class="title">I am packaging a project that cannot be wrapped, like a library or GNOME Shell extension.   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-gnome-common-issues-unwrappable-package" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>You can rely on applications depending on the library setting the necessary environment variables but that is often easy to miss. Instead we recommend to patch the paths in the source code whenever possible. Here are some examples:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><span id="ssec-gnome-common-issues-unwrappable-package-gnome-shell-ext"></span> <a class="link" href="https://github.com/NixOS/nixpkgs/blob/7bb8f05f12ca3cff9da72b56caa2f7472d5732bc/pkgs/desktops/gnome-3/core/gnome-shell-extensions/default.nix#L21-L24" target="_top">Replacing a <code class="literal">GI_TYPELIB_PATH</code> in GNOME Shell extension</a> – we are using <code class="literal">substituteAll</code> to include the path to a typelib into a patch.</p></li><li class="listitem"><p><span id="ssec-gnome-common-issues-unwrappable-package-gsettings"></span> The following examples are hardcoding GSettings schema paths. To get the schema paths we use the functions</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p><code class="literal">glib.getSchemaPath</code> Takes a nix package attribute as an argument.</p></li><li class="listitem"><p><code class="literal">glib.makeSchemaPath</code> Takes a package output like <code class="literal">$out</code> and a derivation name. You should use this if the schemas you need to hardcode are in the same derivation.</p></li></ul></div><p><span id="ssec-gnome-common-issues-unwrappable-package-gsettings-vala"></span> <a class="link" href="https://github.com/NixOS/nixpkgs/blob/7bb8f05f12ca3cff9da72b56caa2f7472d5732bc/pkgs/desktops/pantheon/apps/elementary-files/default.nix#L78-L86" target="_top">Hard-coding GSettings schema path in Vala plug-in (dynamically loaded library)</a> – here, <code class="literal">substituteAll</code> cannot be used since the schema comes from the same package preventing us from pass its path to the function, probably due to a <a class="link" href="https://github.com/NixOS/nix/issues/1846" target="_top">Nix bug</a>.</p><p><span id="ssec-gnome-common-issues-unwrappable-package-gsettings-c"></span> <a class="link" href="https://github.com/NixOS/nixpkgs/blob/29c120c065d03b000224872251bed93932d42412/pkgs/development/libraries/glib-networking/default.nix#L31-L34" target="_top">Hard-coding GSettings schema path in C library</a> – nothing special other than using <a class="link" href="https://github.com/NixOS/nixpkgs/pull/67957#issuecomment-527717467" target="_top">Coccinelle patch</a> to generate the patch itself.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="ssec-gnome-common-issues-weird-location" class="title">I need to wrap a binary outside <code class="literal">bin</code> and <code class="literal">libexec</code> directories.   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-gnome-common-issues-weird-location" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>You can manually trigger the wrapping with <code class="literal">wrapGApp</code> in <code class="literal">preFixup</code> phase. It takes a path to a program as a first argument; the remaining arguments are passed directly to <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#fun-wrapProgram" title="wrapProgram &lt;executable&gt; &lt;makeWrapperArgs&gt;"><code class="literal">wrapProgram</code></a> function.</p>
</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-language-go" class="title" style="clear: both">Go   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-language-go" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-language-go">Go modules</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-go-legacy"><code class="literal">buildGoPackage</code> (legacy)</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-go-common-attributes">Attributes used by the builders</a> </span></dt> </dl></div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-language-go" class="title">Go modules   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-language-go" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The function <code class="literal">buildGoModule</code> builds Go programs managed with Go modules. It builds a <a class="link" href="https://github.com/golang/go/wiki/Modules" target="_top">Go Modules</a> through a two phase build:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>An intermediate fetcher derivation. This derivation will be used to fetch all of the dependencies of the Go module.</p></li><li class="listitem"><p>A final derivation will use the output of the intermediate derivation to build the binaries and produce the final output.</p></li></ul></div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="ex-buildGoModule" class="title">Example for <code class="literal">buildGoModule</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ex-buildGoModule" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>In the following is an example expression using <code class="literal">buildGoModule</code>, the following arguments are of special significance to the function:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><code class="literal">vendorHash</code>: is the hash of the output of the intermediate fetcher derivation.</p><p><code class="literal">vendorHash</code> can also be set to <code class="literal">null</code>.
In that case, rather than fetching the dependencies and vendoring them, the dependencies vendored in the source repo will be used.</p><p>To avoid updating this field when dependencies change, run <code class="literal">go mod vendor</code> in your source repo and set <code class="literal">vendorHash = null;</code></p><p>To obtain the actual hash, set <code class="literal">vendorHash = lib.fakeHash;</code> and run the build (<a class="link" href="https://nixos.org/manual/nixpkgs/stable/#sec-source-hashes" title="Obtaining source hash">more details here</a>).</p></li><li class="listitem"><p><code class="literal">proxyVendor</code>: Fetches (go mod download) and proxies the vendor directory. This is useful if your code depends on c code and go mod tidy does not include the needed sources to build or if any dependency has case-insensitive conflicts which will produce platform-dependent <code class="literal">vendorHash</code> checksums.</p></li><li class="listitem"><p><code class="literal">modPostBuild</code>: Shell commands to run after the build of the goModules executes <code class="literal">go mod vendor</code>, and before calculating fixed output derivation’s <code class="literal">vendorHash</code>. Note that if you change this attribute, you need to update <code class="literal">vendorHash</code> attribute.</p></li></ul></div><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">pet</span> = buildGoModule <span class="hljs-keyword">rec</span> {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"pet"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"0.3.4"</span>;

  <span class="hljs-attr">src</span> = fetchFromGitHub {
    <span class="hljs-attr">owner</span> = <span class="hljs-string">"knqyf263"</span>;
    <span class="hljs-attr">repo</span> = <span class="hljs-string">"pet"</span>;
    <span class="hljs-attr">rev</span> = <span class="hljs-string">"v<span class="hljs-subst">${version}</span>"</span>;
    <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-Gjw1dRrgM8D3G7v6WIM2+50r4HmTXvx0Xxme2fH9TlQ="</span>;
  };

  <span class="hljs-attr">vendorHash</span> = <span class="hljs-string">"sha256-ciBIR+a1oaYH+H1PcC8cD8ncfJczk1IiJ8iYNM+R6aA="</span>;

  <span class="hljs-attr">meta</span> = <span class="hljs-keyword">with</span> lib; {
    <span class="hljs-attr">description</span> = <span class="hljs-string">"Simple command-line snippet manager, written in Go"</span>;
    <span class="hljs-attr">homepage</span> = <span class="hljs-string">"https://github.com/knqyf263/pet"</span>;
    <span class="hljs-attr">license</span> = licenses.mit;
    <span class="hljs-attr">maintainers</span> = <span class="hljs-keyword">with</span> maintainers; [ kalbasit ];
  };
}
</code></pre>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-go-legacy" class="title"><code class="literal">buildGoPackage</code> (legacy)   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-go-legacy" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The function <code class="literal">buildGoPackage</code> builds legacy Go programs, not supporting Go modules.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="example-for-buildgopackage" class="title">Example for <code class="literal">buildGoPackage</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#example-for-buildgopackage" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>In the following is an example expression using buildGoPackage, the following arguments are of special significance to the function:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">goPackagePath</code> specifies the package’s canonical Go import path.</p></li><li class="listitem"><p><code class="literal">goDeps</code> is where the Go dependencies of a Go program are listed as a list of package source identified by Go import path. It could be imported as a separate <code class="literal">deps.nix</code> file for readability. The dependency data structure is described below.</p></li></ul></div><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">deis</span> = buildGoPackage <span class="hljs-keyword">rec</span> {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"deis"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"1.13.0"</span>;

  <span class="hljs-attr">goPackagePath</span> = <span class="hljs-string">"github.com/deis/deis"</span>;

  <span class="hljs-attr">src</span> = fetchFromGitHub {
    <span class="hljs-attr">owner</span> = <span class="hljs-string">"deis"</span>;
    <span class="hljs-attr">repo</span> = <span class="hljs-string">"deis"</span>;
    <span class="hljs-attr">rev</span> = <span class="hljs-string">"v<span class="hljs-subst">${version}</span>"</span>;
    <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-XCPD4LNWtAd8uz7zyCLRfT8rzxycIUmTACjU03GnaeM="</span>;
  };

  <span class="hljs-attr">goDeps</span> = ./deps.nix;
}
</code></pre><p>The <code class="literal">goDeps</code> attribute can be imported from a separate <code class="literal">nix</code> file that defines which Go libraries are needed and should be included in <code class="literal">GOPATH</code> for <code class="literal">buildPhase</code>:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-comment"># deps.nix</span>
[ <span class="hljs-comment"># goDeps is a list of Go dependencies.</span>
  {
    <span class="hljs-comment"># goPackagePath specifies Go package import path.</span>
    <span class="hljs-attr">goPackagePath</span> = <span class="hljs-string">"gopkg.in/yaml.v2"</span>;
    <span class="hljs-attr">fetch</span> = {
      <span class="hljs-comment"># `fetch type` that needs to be used to get package source.</span>
      <span class="hljs-comment"># If `git` is used there should be `url`, `rev` and `hash` defined next to it.</span>
      <span class="hljs-attr">type</span> = <span class="hljs-string">"git"</span>;
      <span class="hljs-attr">url</span> = <span class="hljs-string">"https://gopkg.in/yaml.v2"</span>;
      <span class="hljs-attr">rev</span> = <span class="hljs-string">"a83829b6f1293c91addabc89d0571c246397bbf4"</span>;
      <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-EMrdy0M0tNuOcITaTAmT5/dPSKPXwHDKCXFpkGbVjdQ="</span>;
    };
  }
  {
    <span class="hljs-attr">goPackagePath</span> = <span class="hljs-string">"github.com/docopt/docopt-go"</span>;
    <span class="hljs-attr">fetch</span> = {
      <span class="hljs-attr">type</span> = <span class="hljs-string">"git"</span>;
      <span class="hljs-attr">url</span> = <span class="hljs-string">"https://github.com/docopt/docopt-go"</span>;
      <span class="hljs-attr">rev</span> = <span class="hljs-string">"784ddc588536785e7299f7272f39101f7faccc3f"</span>;
      <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-Uo89zjE+v3R7zzOq/gbQOHj3SMYt2W1nDHS7RCUin3M="</span>;
    };
  }
]
</code></pre><p>To extract dependency information from a Go package in automated way use <a class="link" href="https://github.com/kamilchm/go2nix" target="_top">go2nix</a>. It can produce complete derivation and <code class="literal">goDeps</code> file for Go programs.</p><p>You may use Go packages installed into the active Nix profiles by adding the following to your ~/.bashrc:</p><pre><code class="programlisting bash hljs language-bash" data-highlighted="yes"><span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> <span class="hljs-variable">$NIX_PROFILES</span>; <span class="hljs-keyword">do</span>
    GOPATH=<span class="hljs-string">"<span class="hljs-variable">$p</span>/share/go:<span class="hljs-variable">$GOPATH</span>"</span>
<span class="hljs-keyword">done</span>
</code></pre>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-go-common-attributes" class="title">Attributes used by the builders   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-go-common-attributes" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Many attributes <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#variables-controlling-the-build-phase" title="Variables controlling the build phase">controlling the build phase</a> are respected by both <code class="literal">buildGoModule</code> and <code class="literal">buildGoPackage</code>. Note that <code class="literal">buildGoModule</code> reads the following attributes also when building the <code class="literal">vendor/</code> goModules fixed output derivation as well:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-sourceRoot" title="sourceRoot"><code class="literal">sourceRoot</code></a></p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-prePatch" title="prePatch"><code class="literal">prePatch</code></a></p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-patches" title="patches"><code class="literal">patches</code></a></p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-patchFlags" title="patchFlags"><code class="literal">patchFlags</code></a></p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-postPatch" title="postPatch"><code class="literal">postPatch</code></a></p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-preBuild" title="preBuild"><code class="literal">preBuild</code></a></p></li></ul></div><p>In addition to the above attributes, and the many more variables respected also by <code class="literal">stdenv.mkDerivation</code>, both <code class="literal">buildGoModule</code> and <code class="literal">buildGoPackage</code> respect Go-specific attributes that tweak them to behave slightly differently:</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="var-go-ldflags" class="title"><code class="literal">ldflags</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-go-ldflags" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Arguments to pass to the Go linker tool via the <code class="literal">-ldflags</code> argument of <code class="literal">go build</code>. The most common use case for this argument is to make the resulting executable aware of its own version. For example:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">  <span class="hljs-attr">ldflags</span> = [
    <span class="hljs-string">"-X main.Version=<span class="hljs-subst">${version}</span>"</span>
    <span class="hljs-string">"-X main.Commit=<span class="hljs-subst">${version}</span>"</span>
  ];
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="var-go-tags" class="title"><code class="literal">tags</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-go-tags" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Arguments to pass to the Go via the <code class="literal">-tags</code> argument of <code class="literal">go build</code>. For example:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">  <span class="hljs-attr">tags</span> = [
    <span class="hljs-string">"production"</span>
    <span class="hljs-string">"sqlite"</span>
  ];
</code></pre><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">  <span class="hljs-attr">tags</span> = [ <span class="hljs-string">"production"</span> ] ++ lib.optionals withSqlite [ <span class="hljs-string">"sqlite"</span> ];
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="var-go-deleteVendor" class="title"><code class="literal">deleteVendor</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-go-deleteVendor" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Removes the pre-existing vendor directory. This should only be used if the dependencies included in the vendor folder are broken or incomplete.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="var-go-subPackages" class="title"><code class="literal">subPackages</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-go-subPackages" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Specified as a string or list of strings. Limits the builder from building child packages that have not been listed. If <code class="literal">subPackages</code> is not specified, all child packages will be built.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="var-go-excludedPackages" class="title"><code class="literal">excludedPackages</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#var-go-excludedPackages" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Specified as a string or list of strings. Causes the builder to skip building child packages that match any of the provided values. If <code class="literal">excludedPackages</code> is not specified, all child packages will be built.</p>
</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="haskell" class="title" style="clear: both">Haskell   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#haskell" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#haskell-available-packages">Available packages</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#haskell-mkderivation"><code class="literal">haskellPackages.mkDerivation</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#haskell-development-environments">Development environments</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#haskell-overriding-haskell-packages">Overriding Haskell packages</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#haskell-faq">F.A.Q.</a> </span></dt> </dl></div><p>The Haskell infrastructure in Nixpkgs has two main purposes: The primary purpose
is to provide a Haskell compiler and build tools as well as infrastructure for
packaging Haskell-based packages.</p><p>The secondary purpose is to provide support for Haskell development environments
including prebuilt Haskell libraries. However, in this area sacrifices have been
made due to self-imposed restrictions in Nixpkgs, to lessen the maintenance
effort and to improve performance. (More details in the subsection
<a class="link" href="https://nixos.org/manual/nixpkgs/stable/#haskell-limitations" title="Limitations">Limitations.</a>)</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="haskell-available-packages" class="title">Available packages   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#haskell-available-packages" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The compiler and most build tools are exposed at the top level:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">ghc</code> is the default version of GHC</p></li><li class="listitem"><p>Language specific tools: <code class="literal">cabal-install</code>, <code class="literal">stack</code>, <code class="literal">hpack</code>, …</p></li></ul></div><p>Many “normal” user facing packages written in Haskell, like <code class="literal">niv</code> or <code class="literal">cachix</code>,
are also exposed at the top level, and there is nothing Haskell specific to
installing and using them.</p><p>All of these packages are originally defined in the <code class="literal">haskellPackages</code> package
set and are re-exposed with a reduced dependency closure for convenience.
(see <code class="literal">justStaticExecutables</code> or <code class="literal">separateBinOutput</code> below)</p><p>The <code class="literal">haskellPackages</code> set includes at least one version of every package from
Hackage as well as some manually injected packages. This amounts to a lot of
packages, so it is hidden from <code class="literal">nix-env -qa</code> by default for performance reasons.
You can still list all packages in the set like this:</p><pre><code class="programlisting console hljs language-shell" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">nix-env -f <span class="hljs-string">'&lt;nixpkgs&gt;'</span> -qaP -A haskellPackages</span>
haskellPackages.a50                                                         a50-0.5
haskellPackages.AAI                                                         AAI-0.2.0.1
haskellPackages.aasam                                                       aasam-0.2.0.0
haskellPackages.abacate                                                     abacate-0.0.0.0
haskellPackages.abc-puzzle                                                  abc-puzzle-0.2.1
…
</code></pre><p>Also, the <code class="literal">haskellPackages</code> set is included on <a class="link" href="https://search.nixos.org/" target="_top">search.nixos.org</a>.</p><p>The attribute names in <code class="literal">haskellPackages</code> always correspond with their name on
Hackage. Since Hackage allows names that are not valid Nix without escaping,
you need to take care when handling attribute names like <code class="literal">3dmodels</code>.</p><p>For packages that are part of <a class="link" href="https://www.stackage.org/" target="_top">Stackage</a> (a curated set of known to be
compatible packages), we use the version prescribed by a Stackage snapshot
(usually the current LTS one) as the default version. For all other packages we
use the latest version from <a class="link" href="https://hackage.org/" target="_top">Hackage</a> (the repository of
basically all open source Haskell packages). See [below](#haskell-available-
versions) for a few more details on this.</p><p>Roughly half of the 16K packages contained in <code class="literal">haskellPackages</code> don’t actually
build and are <a class="link" href="https://github.com/NixOS/nixpkgs/blob/haskell-updates/pkgs/development/haskell-modules/configuration-hackage2nix/broken.yaml" target="_top">marked as broken semi-automatically</a>.
Most of those packages are deprecated or unmaintained, but sometimes packages
that should build, do not build. Very often fixing them is not a lot of work.</p><p><code class="literal">haskellPackages</code> is built with our default compiler, but we also provide other
releases of GHC and package sets built with them. You can list all available
compilers like this:</p><pre><code class="programlisting console hljs language-shell" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">nix-env -f <span class="hljs-string">'&lt;nixpkgs&gt;'</span> -qaP -A haskell.compiler</span>
haskell.compiler.ghc810                  ghc-8.10.7
haskell.compiler.ghc88                   ghc-8.8.4
haskell.compiler.ghc90                   ghc-9.0.2
haskell.compiler.ghc924                  ghc-9.2.4
haskell.compiler.ghc925                  ghc-9.2.5
haskell.compiler.ghc926                  ghc-9.2.6
haskell.compiler.ghc92                   ghc-9.2.7
haskell.compiler.ghc942                  ghc-9.4.2
haskell.compiler.ghc943                  ghc-9.4.3
haskell.compiler.ghc94                   ghc-9.4.4
haskell.compiler.ghcHEAD                 ghc-9.7.20221224
haskell.compiler.ghc8102Binary           ghc-binary-8.10.2
haskell.compiler.ghc8102BinaryMinimal    ghc-binary-8.10.2
haskell.compiler.ghc8107BinaryMinimal    ghc-binary-8.10.7
haskell.compiler.ghc8107Binary           ghc-binary-8.10.7
haskell.compiler.ghc865Binary            ghc-binary-8.6.5
haskell.compiler.ghc924Binary            ghc-binary-9.2.4
haskell.compiler.ghc924BinaryMinimal     ghc-binary-9.2.4
haskell.compiler.integer-simple.ghc810   ghc-integer-simple-8.10.7
haskell.compiler.integer-simple.ghc8107  ghc-integer-simple-8.10.7
haskell.compiler.integer-simple.ghc88    ghc-integer-simple-8.8.4
haskell.compiler.integer-simple.ghc884   ghc-integer-simple-8.8.4
haskell.compiler.native-bignum.ghc90     ghc-native-bignum-9.0.2
haskell.compiler.native-bignum.ghc902    ghc-native-bignum-9.0.2
haskell.compiler.native-bignum.ghc924    ghc-native-bignum-9.2.4
haskell.compiler.native-bignum.ghc925    ghc-native-bignum-9.2.5
haskell.compiler.native-bignum.ghc926    ghc-native-bignum-9.2.6
haskell.compiler.native-bignum.ghc92     ghc-native-bignum-9.2.7
haskell.compiler.native-bignum.ghc927    ghc-native-bignum-9.2.7
haskell.compiler.native-bignum.ghc942    ghc-native-bignum-9.4.2
haskell.compiler.native-bignum.ghc943    ghc-native-bignum-9.4.3
haskell.compiler.native-bignum.ghc94     ghc-native-bignum-9.4.4
haskell.compiler.native-bignum.ghc944    ghc-native-bignum-9.4.4
haskell.compiler.native-bignum.ghcHEAD   ghc-native-bignum-9.7.20221224
haskell.compiler.ghcjs                   ghcjs-8.10.7
</code></pre><p>Each of those compiler versions has a corresponding attribute set built using
it. However, the non-standard package sets are not tested regularly and, as a
result, contain fewer working packages. The corresponding package set for GHC
9.4.5 is <code class="literal">haskell.packages.ghc945</code>. In fact <code class="literal">haskellPackages</code> is just an alias
for <code class="literal">haskell.packages.ghc927</code>:</p><pre><code class="programlisting console hljs language-shell" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">nix-env -f <span class="hljs-string">'&lt;nixpkgs&gt;'</span> -qaP -A haskell.packages.ghc927</span>
haskell.packages.ghc927.a50                                                         a50-0.5
haskell.packages.ghc927.AAI                                                         AAI-0.2.0.1
haskell.packages.ghc927.aasam                                                       aasam-0.2.0.0
haskell.packages.ghc927.abacate                                                     abacate-0.0.0.0
haskell.packages.ghc927.abc-puzzle                                                  abc-puzzle-0.2.1
…
</code></pre><p>Every package set also re-exposes the GHC used to build its packages as <code class="literal">haskell.packages.*.ghc</code>.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="haskell-available-versions" class="title">Available package versions   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#haskell-available-versions" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>We aim for a “blessed” package set which only contains one version of each
package, like <a class="link" href="https://www.stackage.org/" target="_top">Stackage</a>, which is a curated set of known to be compatible
packages. We use the version information from Stackage snapshots and extend it
with more packages. Normally in Nixpkgs the number of building Haskell packages
is roughly two to three times the size of Stackage. For choosing the version to
use for a certain package we use the following rules:</p><div class="orderedlist"><ol class="orderedlist compact" type="1"><li class="listitem"><p>By default, for <code class="literal">haskellPackages.foo</code> is the newest version of the package
<code class="literal">foo</code> found on <a class="link" href="https://hackage.org/" target="_top">Hackage</a>, which is the central registry
of all open source Haskell packages. Nixpkgs contains a reference to a pinned
Hackage snapshot, thus we use the state of Hackage as of the last time we
updated this pin.</p></li><li class="listitem"><p>If the <a class="link" href="https://www.stackage.org/" target="_top">Stackage</a> snapshot that we use (usually the newest LTS snapshot)
contains a package, <a class="link" href="https://github.com/NixOS/nixpkgs/blob/haskell-updates/pkgs/development/haskell-modules/configuration-hackage2nix/stackage.yaml" target="_top">we use instead the version in the Stackage snapshot as
default version for that package.</a></p></li><li class="listitem"><p>For some packages, which are not on Stackage, we have if necessary <a class="link" href="https://github.com/NixOS/nixpkgs/blob/haskell-updates/pkgs/development/haskell-modules/configuration-hackage2nix/main.yaml" target="_top">manual
overrides to set the default version to a version older than the newest on
Hackage.</a></p></li><li class="listitem"><p>For all packages, for which the newest Hackage version is not the default
version, there will also be a <code class="literal">haskellPackages.foo_x_y_z</code> package with the
newest version. The <code class="literal">x_y_z</code> part encodes the version with dots replaced by
underscores. When the newest version changes by a new release to Hackage the
old package will disappear under that name and be replaced by a newer one under
the name with the new version. The package name including the version will
also disappear when the default version e.g. from Stackage catches up with the
newest version from Hackage. E.g. if <code class="literal">haskellPackages.foo</code> gets updated from
1.0.0 to 1.1.0 the package <code class="literal">haskellPackages.foo_1_1_0</code> becomes obsolete and
gets dropped.</p></li><li class="listitem"><p>For some packages, we also <a class="link" href="https://github.com/NixOS/nixpkgs/blob/haskell-updates/pkgs/development/haskell-modules/configuration-hackage2nix/main.yaml" target="_top">manually add other <code class="literal">haskellPackages.foo_x_y_z</code>
versions</a>,
if they are required for a certain build.</p></li></ol></div><p>Relying on <code class="literal">haskellPackages.foo_x_y_z</code> attributes in derivations outside
nixpkgs is discouraged because they may change or disappear with every package
set update.
</p><p>All <code class="literal">haskell.packages.*</code> package sets use the same package descriptions and the same sets
of versions by default. There are however GHC version specific override <code class="literal">.nix</code>
files to loosen this a bit.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="haskell-dependency-resolution" class="title">Dependency resolution   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#haskell-dependency-resolution" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Normally when you build Haskell packages with <code class="literal">cabal-install</code>, <code class="literal">cabal-install</code>
does dependency resolution. It will look at all Haskell package versions known
on Hackage and tries to pick for every (transitive) dependency of your build
exactly one version. Those versions need to satisfy all the version constraints
given in the <code class="literal">.cabal</code> file of your package and all its dependencies.</p><p>The <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#haskell-mkderivation" title="haskellPackages.mkDerivation">Haskell builder in nixpkgs</a> does no such thing.
It will take as input packages with names off the desired dependencies
and just check whether they fulfill the version bounds and fail if they don’t
(by default, see <code class="literal">jailbreak</code> to circumvent this).</p><p>The <code class="literal">haskellPackages.callPackage</code> function does the package resolution.
It will, e.g., use <code class="literal">haskellPackages.aeson</code>which has the default version as
described above for a package input of name <code class="literal">aeson</code>. (More general:
<code class="literal">&lt;packages&gt;.callPackage f</code> will call <code class="literal">f</code> with named inputs provided from the
package set <code class="literal">&lt;packages&gt;</code>.)
While this is the default behavior, it is possible to override the dependencies
for a specific package, see
<a class="link" href="https://nixos.org/manual/nixpkgs/stable/#haskell-overriding-haskell-packages" title="Overriding Haskell packages"><code class="literal">override</code> and <code class="literal">overrideScope</code></a>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="haskell-limitations" class="title">Limitations   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#haskell-limitations" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Our main objective with <code class="literal">haskellPackages</code> is to package Haskell software in
nixpkgs. This entails some limitations, partially due to self-imposed
restrictions of nixpkgs, partially in the name of maintainability:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>Only the packages built with the default compiler see extensive testing of the
whole package set. For other GHC versions only a few essential packages are
tested and cached.</p></li><li class="listitem"><p>As described above we only build one version of most packages.</p></li></ul></div><p>The experience using an older or newer packaged compiler or using different
versions may be worse, because builds will not be cached on <code class="literal">cache.nixos.org</code>
or may fail.</p><p>Thus, to get the best experience, make sure that your project can be compiled
using the default compiler of nixpkgs and recent versions of its dependencies.</p><p>A result of this setup is, that getting a valid build plan for a given
package can sometimes be quite painful, and in fact this is where most of the
maintenance work for <code class="literal">haskellPackages</code> is required. Besides that, it is not
possible to get the dependencies of a legacy project from nixpkgs or to use a
specific stack solver for compiling a project.</p><p>Even though we couldn’t use them directly in nixpkgs, it would be desirable
to have tooling to generate working Nix package sets from build plans generated
by <code class="literal">cabal-install</code> or a specific Stackage snapshot via import-from-derivation.
Sadly we currently don’t have tooling for this. For this you might be
interested in the alternative <a class="link" href="https://input-output-hk.github.io/haskell.nix/index.html" target="_top">haskell.nix</a> framework, which, be warned, is
completely incompatible with packages from <code class="literal">haskellPackages</code>.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="haskell-mkderivation" class="title"><code class="literal">haskellPackages.mkDerivation</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#haskell-mkderivation" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Every haskell package set has its own haskell-aware <code class="literal">mkDerivation</code> which is used
to build its packages. Generally you won’t have to interact with this builder
since <a class="link" href="https://github.com/nixos/cabal2nix" target="_top">cabal2nix</a> can generate packages
using it for an arbitrary cabal package definition. Still it is useful to know
the parameters it takes when you need to
<a class="link" href="https://nixos.org/manual/nixpkgs/stable/#haskell-overriding-haskell-packages" title="Overriding Haskell packages">override</a> a generated Nix expression.</p><p><code class="literal">haskellPackages.mkDerivation</code> is a wrapper around <code class="literal">stdenv.mkDerivation</code> which
re-defines the default phases to be haskell aware and handles dependency
specification, test suites, benchmarks etc. by compiling and invoking the
package’s <code class="literal">Setup.hs</code>. It does <span class="emphasis"><em>not</em></span> use or invoke the <code class="literal">cabal-install</code> binary,
but uses the underlying <code class="literal">Cabal</code> library instead.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="haskell-derivation-args" class="title">General arguments   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#haskell-derivation-args" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">pname</code></span></dt><dd><p>Package name, assumed to be the same as on Hackage (if applicable)</p></dd><dt><span class="term"><code class="literal">version</code></span></dt><dd><p>Packaged version, assumed to be the same as on Hackage (if applicable)</p></dd><dt><span class="term"><code class="literal">src</code></span></dt><dd><p>Source of the package. If omitted, fetch package corresponding to <code class="literal">pname</code>
and <code class="literal">version</code> from Hackage.</p></dd><dt><span class="term"><code class="literal">sha256</code></span></dt><dd><p>Hash to use for the default case of <code class="literal">src</code>.</p></dd><dt><span class="term"><code class="literal">revision</code></span></dt><dd><p>Revision number of the updated cabal file to fetch from Hackage.
If <code class="literal">null</code> (which is the default value), the one included in <code class="literal">src</code> is used.</p></dd><dt><span class="term"><code class="literal">editedCabalFile</code></span></dt><dd><p><code class="literal">sha256</code> hash of the cabal file identified by <code class="literal">revision</code> or <code class="literal">null</code>.</p></dd><dt><span class="term"><code class="literal">configureFlags</code></span></dt><dd><p>Extra flags passed when executing the <code class="literal">configure</code> command of <code class="literal">Setup.hs</code>.</p></dd><dt><span class="term"><code class="literal">buildFlags</code></span></dt><dd><p>Extra flags passed when executing the <code class="literal">build</code> command of <code class="literal">Setup.hs</code>.</p></dd><dt><span class="term"><code class="literal">haddockFlags</code></span></dt><dd><p>Extra flags passed to <code class="literal">Setup.hs haddock</code> when building the documentation.</p></dd><dt><span class="term"><code class="literal">doCheck</code></span></dt><dd><p>Whether to execute the package’s test suite if it has one. Defaults to <code class="literal">true</code> unless cross-compiling.</p></dd><dt><span class="term"><code class="literal">doBenchmark</code></span></dt><dd><p>Whether to execute the package’s benchmark if it has one. Defaults to <code class="literal">false</code>.</p></dd><dt><span class="term"><code class="literal">doHoogle</code></span></dt><dd><p>Whether to generate an index file for <a class="link" href="https://wiki.haskell.org/Hoogle" target="_top">hoogle</a> as part of
<code class="literal">haddockPhase</code> by passing the <a class="link" href="https://haskell-haddock.readthedocs.io/en/latest/invoking.html#cmdoption-hoogle" target="_top"><code class="literal">--hoogle</code> option</a>.
Defaults to <code class="literal">true</code>.</p></dd><dt><span class="term"><code class="literal">doHaddockQuickjump</code></span></dt><dd><p>Whether to generate an index for interactive navigation of the HTML documentation.
Defaults to <code class="literal">true</code> if supported.</p></dd><dt><span class="term"><code class="literal">doInstallIntermediates</code></span></dt><dd><p>Whether to install intermediate build products (files written to <code class="literal">dist/build</code>
by GHC during the build process). With <code class="literal">enableSeparateIntermediatesOutput</code>,
these files are instead installed to <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#chap-multiple-output" target="_top">a separate <code class="literal">intermediates</code>
output.</a> The output can then be passed into a future build of
the same package with the <code class="literal">previousIntermediates</code> argument to support
incremental builds. See <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#haskell-incremental-builds" title="Incremental builds">“Incremental builds”</a> for
more information. Defaults to <code class="literal">false</code>.</p></dd><dt><span class="term"><code class="literal">enableLibraryProfiling</code></span></dt><dd><p>Whether to enable <a class="link" href="https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/profiling.html" target="_top">profiling</a> for libraries contained in the
package. Enabled by default if supported.</p></dd><dt><span class="term"><code class="literal">enableExecutableProfiling</code></span></dt><dd><p>Whether to enable <a class="link" href="https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/profiling.html" target="_top">profiling</a> for executables contained in the
package. Disabled by default.</p></dd><dt><span class="term"><code class="literal">profilingDetail</code></span></dt><dd><p><a class="link" href="https://cabal.readthedocs.io/en/latest/cabal-project.html#cfg-field-profiling-detail" target="_top">Profiling detail level</a> to set. Defaults to <code class="literal">exported-functions</code>.</p></dd><dt><span class="term"><code class="literal">enableSharedExecutables</code></span></dt><dd><p>Whether to link executables dynamically. By default, executables are linked statically.</p></dd><dt><span class="term"><code class="literal">enableSharedLibraries</code></span></dt><dd><p>Whether to build shared Haskell libraries. This is enabled by default unless we are using
<code class="literal">pkgsStatic</code> or shared libraries have been disabled in GHC.</p></dd><dt><span class="term"><code class="literal">enableStaticLibraries</code></span></dt><dd><p>Whether to build static libraries. Enabled by default if supported.</p></dd><dt><span class="term"><code class="literal">enableDeadCodeElimination</code></span></dt><dd><p>Whether to enable linker based dead code elimination in GHC.
Enabled by default if supported.</p></dd><dt><span class="term"><code class="literal">enableHsc2hsViaAsm</code></span></dt><dd><p>Whether to pass <code class="literal">--via-asm</code> to <code class="literal">hsc2hs</code>. Enabled by default only on Windows.</p></dd><dt><span class="term"><code class="literal">hyperlinkSource</code></span></dt><dd><p>Whether to render the source as well as part of the haddock documentation
by passing the <a class="link" href="https://haskell-haddock.readthedocs.io/en/latest/invoking.html#cmdoption-hyperlinked-source" target="_top"><code class="literal">--hyperlinked-source</code> flag</a>.
Defaults to <code class="literal">true</code>.</p></dd><dt><span class="term"><code class="literal">isExecutable</code></span></dt><dd><p>Whether the package contains an executable.</p></dd><dt><span class="term"><code class="literal">isLibrary</code></span></dt><dd><p>Whether the package contains a library.</p></dd><dt><span class="term"><code class="literal">jailbreak</code></span></dt><dd><p>Whether to execute <a class="link" href="https://github.com/NixOS/jailbreak-cabal/" target="_top">jailbreak-cabal</a> before <code class="literal">configurePhase</code>
to lift any version constraints in the cabal file. Note that this can’t
lift version bounds if they are conditional, i.e. if a dependency is hidden
behind a flag.</p></dd><dt><span class="term"><code class="literal">enableParallelBuilding</code></span></dt><dd><p>Whether to use the <code class="literal">-j</code> flag to make GHC/Cabal start multiple jobs in parallel.</p></dd><dt><span class="term"><code class="literal">maxBuildCores</code></span></dt><dd><p>Upper limit of jobs to use in parallel for compilation regardless of
<code class="literal">$NIX_BUILD_CORES</code>. Defaults to 16 as Haskell compilation with GHC currently
sees a <a class="link" href="https://gitlab.haskell.org/ghc/ghc/-/issues/9221" target="_top">performance regression</a>
if too many parallel jobs are used.</p></dd><dt><span class="term"><code class="literal">doCoverage</code></span></dt><dd><p>Whether to generate and install files needed for <a class="link" href="https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/profiling.html#observing-code-coverage" target="_top">HPC</a>.
Defaults to <code class="literal">false</code>.</p></dd><dt><span class="term"><code class="literal">doHaddock</code></span></dt><dd><p>Whether to build (HTML) documentation using <a class="link" href="https://www.haskell.org/haddock/" target="_top">haddock</a>.
Defaults to <code class="literal">true</code> if supported.</p></dd><dt><span class="term"><code class="literal">testTarget</code></span></dt><dd><p>Name of the test suite to build and run. If unset, all test suites will be executed.</p></dd><dt><span class="term"><code class="literal">preCompileBuildDriver</code></span></dt><dd><p>Shell code to run before compiling <code class="literal">Setup.hs</code>.</p></dd><dt><span class="term"><code class="literal">postCompileBuildDriver</code></span></dt><dd><p>Shell code to run after compiling <code class="literal">Setup.hs</code>.</p></dd><dt><span class="term"><code class="literal">preHaddock</code></span></dt><dd><p>Shell code to run before building documentation using haddock.</p></dd><dt><span class="term"><code class="literal">postHaddock</code></span></dt><dd><p>Shell code to run after building documentation using haddock.</p></dd><dt><span class="term"><code class="literal">coreSetup</code></span></dt><dd><p>Whether to only allow core libraries to be used while building <code class="literal">Setup.hs</code>.
Defaults to <code class="literal">false</code>.</p></dd><dt><span class="term"><code class="literal">useCpphs</code></span></dt><dd><p>Whether to enable the <a class="link" href="https://hackage.haskell.org/package/cpphs" target="_top">cpphs</a> preprocessor. Defaults to <code class="literal">false</code>.</p></dd><dt><span class="term"><code class="literal">enableSeparateBinOutput</code></span></dt><dd><p>Whether to install executables to a separate <code class="literal">bin</code> output. Defaults to <code class="literal">false</code>.</p></dd><dt><span class="term"><code class="literal">enableSeparateDataOutput</code></span></dt><dd><p>Whether to install data files shipped with the package to a separate <code class="literal">data</code> output.
Defaults to <code class="literal">false</code>.</p></dd><dt><span class="term"><code class="literal">enableSeparateDocOutput</code></span></dt><dd><p>Whether to install documentation to a separate <code class="literal">doc</code> output.
Is automatically enabled if <code class="literal">doHaddock</code> is <code class="literal">true</code>.</p></dd><dt><span class="term"><code class="literal">enableSeparateIntermediatesOutput</code></span></dt><dd><p>When <code class="literal">doInstallIntermediates</code> is true, whether to install intermediate build
products to a separate <code class="literal">intermediates</code> output. See <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#haskell-incremental-builds" title="Incremental builds">“Incremental
builds”</a> for more information. Defaults to
<code class="literal">false</code>.</p></dd><dt><span class="term"><code class="literal">allowInconsistentDependencies</code></span></dt><dd><p>If enabled, allow multiple versions of the same Haskell package in the
dependency tree at configure time. Often in such a situation compilation would
later fail because of type mismatches. Defaults to <code class="literal">false</code>.</p></dd><dt><span class="term"><code class="literal">enableLibraryForGhci</code></span></dt><dd><p>Build and install a special object file for GHCi. This improves performance
when loading the library in the REPL, but requires extra build time and
disk space. Defaults to <code class="literal">false</code>.</p></dd><dt><span class="term"><code class="literal">previousIntermediates</code></span></dt><dd><p>If non-null, intermediate build artifacts are copied from this input to
<code class="literal">dist/build</code> before performing compiling. See <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#haskell-incremental-builds" title="Incremental builds">“Incremental
builds”</a> for more information. Defaults to <code class="literal">null</code>.</p></dd><dt><span class="term"><code class="literal">buildTarget</code></span></dt><dd><p>Name of the executable or library to build and install.
If unset, all available targets are built and installed.</p></dd></dl></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="haskell-derivation-deps" class="title">Specifying dependencies   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#haskell-derivation-deps" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Since <code class="literal">haskellPackages.mkDerivation</code> is intended to be generated from cabal
files, it reflects cabal’s way of specifying dependencies. For one, dependencies
are grouped by what part of the package they belong to. This helps to reduce the
dependency closure of a derivation, for example benchmark dependencies are not
included if <code class="literal">doBenchmark == false</code>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">setup*Depends</code></span></dt><dd><p>dependencies necessary to compile <code class="literal">Setup.hs</code></p></dd><dt><span class="term"><code class="literal">library*Depends</code></span></dt><dd><p>dependencies of a library contained in the package</p></dd><dt><span class="term"><code class="literal">executable*Depends</code></span></dt><dd><p>dependencies of an executable contained in the package</p></dd><dt><span class="term"><code class="literal">test*Depends</code></span></dt><dd><p>dependencies of a test suite contained in the package</p></dd><dt><span class="term"><code class="literal">benchmark*Depends</code></span></dt><dd><p>dependencies of a benchmark contained in the package</p></dd></dl></div><p>The other categorization relates to the way the package depends on the dependency:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">*ToolDepends</code></span></dt><dd><p>Tools we need to run as part of the build process.
They are added to the derivation’s <code class="literal">nativeBuildInputs</code>.</p></dd><dt><span class="term"><code class="literal">*HaskellDepends</code></span></dt><dd><p>Haskell libraries the package depends on.
They are added to <code class="literal">propagatedBuildInputs</code>.</p></dd><dt><span class="term"><code class="literal">*SystemDepends</code></span></dt><dd><p>Non-Haskell libraries the package depends on.
They are added to <code class="literal">buildInputs</code></p></dd><dt><span class="term"><code class="literal">*PkgconfigDepends</code></span></dt><dd><p><code class="literal">*SystemDepends</code> which are discovered using <code class="literal">pkg-config</code>.
They are added to <code class="literal">buildInputs</code> and it is additionally
ensured that <code class="literal">pkg-config</code> is available at build time.</p></dd><dt><span class="term"><code class="literal">*FrameworkDepends</code></span></dt><dd><p>Apple SDK Framework which the package depends on when compiling it on Darwin.</p></dd></dl></div><p>Using these two distinctions, you should be able to categorize most of the dependency
specifications that are available:
<code class="literal">benchmarkFrameworkDepends</code>,
<code class="literal">benchmarkHaskellDepends</code>,
<code class="literal">benchmarkPkgconfigDepends</code>,
<code class="literal">benchmarkSystemDepends</code>,
<code class="literal">benchmarkToolDepends</code>,
<code class="literal">executableFrameworkDepends</code>,
<code class="literal">executableHaskellDepends</code>,
<code class="literal">executablePkgconfigDepends</code>,
<code class="literal">executableSystemDepends</code>,
<code class="literal">executableToolDepends</code>,
<code class="literal">libraryFrameworkDepends</code>,
<code class="literal">libraryHaskellDepends</code>,
<code class="literal">libraryPkgconfigDepends</code>,
<code class="literal">librarySystemDepends</code>,
<code class="literal">libraryToolDepends</code>,
<code class="literal">setupHaskellDepends</code>,
<code class="literal">testFrameworkDepends</code>,
<code class="literal">testHaskellDepends</code>,
<code class="literal">testPkgconfigDepends</code>,
<code class="literal">testSystemDepends</code> and
<code class="literal">testToolDepends</code>.</p><p>That only leaves the following extra ways for specifying dependencies:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">buildDepends</code></span></dt><dd><p>Allows specifying Haskell dependencies which are added to <code class="literal">propagatedBuildInputs</code> unconditionally.</p></dd><dt><span class="term"><code class="literal">buildTools</code></span></dt><dd><p>Like <code class="literal">*ToolDepends</code>, but are added to <code class="literal">nativeBuildInputs</code> unconditionally.</p></dd><dt><span class="term"><code class="literal">extraLibraries</code></span></dt><dd><p>Like <code class="literal">*SystemDepends</code>, but are added to <code class="literal">buildInputs</code> unconditionally.</p></dd><dt><span class="term"><code class="literal">pkg-configDepends</code></span></dt><dd><p>Like <code class="literal">*PkgconfigDepends</code>, but are added to <code class="literal">buildInputs</code> unconditionally.</p></dd><dt><span class="term"><code class="literal">testDepends</code></span></dt><dd><p>Deprecated, use either <code class="literal">testHaskellDepends</code> or <code class="literal">testSystemDepends</code>.</p></dd><dt><span class="term"><code class="literal">benchmarkDepends</code></span></dt><dd><p>Deprecated, use either <code class="literal">benchmarkHaskellDepends</code> or <code class="literal">benchmarkSystemDepends</code>.</p></dd></dl></div><p>The dependency specification methods in this list which are unconditional
are especially useful when writing <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#haskell-overriding-haskell-packages" title="Overriding Haskell packages">overrides</a>
when you want to make sure that they are definitely included. However, it is
recommended to use the more accurate ones listed above when possible.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="haskell-derivation-meta" class="title">Meta attributes   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#haskell-derivation-meta" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><code class="literal">haskellPackages.mkDerivation</code> accepts the following attributes as direct
arguments which are transparently set in <code class="literal">meta</code> of the resulting derivation. See
the <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#chap-meta" title="Meta-attributes">Meta-attributes section</a> for their documentation.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>These attributes are populated with a default value if omitted:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p><code class="literal">homepage</code>: defaults to the Hackage page for <code class="literal">pname</code>.</p></li><li class="listitem"><p><code class="literal">platforms</code>: defaults to <code class="literal">lib.platforms.all</code> (since GHC can cross-compile)</p></li></ul></div></li><li class="listitem"><p>These attributes are only set if given:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p><code class="literal">description</code></p></li><li class="listitem"><p><code class="literal">license</code></p></li><li class="listitem"><p><code class="literal">changelog</code></p></li><li class="listitem"><p><code class="literal">maintainers</code></p></li><li class="listitem"><p><code class="literal">broken</code></p></li><li class="listitem"><p><code class="literal">hydraPlatforms</code></p></li></ul></div></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="haskell-incremental-builds" class="title">Incremental builds   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#haskell-incremental-builds" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><code class="literal">haskellPackages.mkDerivation</code> supports incremental builds for GHC 9.4 and
newer with the <code class="literal">doInstallIntermediates</code>, <code class="literal">enableSeparateIntermediatesOutput</code>,
and <code class="literal">previousIntermediates</code> arguments.</p><p>The basic idea is to first perform a full build of the package in question,
save its intermediate build products for later, and then copy those build
products into the build directory of an incremental build performed later.
Then, GHC will use those build artifacts to avoid recompiling unchanged
modules.</p><p>For more detail on how to store and use incremental build products, see
<a class="link" href="https://www.haskellforall.com/2022/12/nixpkgs-support-for-incremental-haskell.html" target="_top">Gabriella Gonzalez’ blog post “Nixpkgs support for incremental Haskell
builds”.</a> motivation behind this feature.</p><p>An incremental build for <a class="link" href="https://hackage.haskell.org/package/turtle" target="_top">the <code class="literal">turtle</code> package</a> can be performed like
so:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">let</span>
  <span class="hljs-attr">pkgs</span> = <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {};
  <span class="hljs-keyword">inherit</span> (pkgs) haskell;
  <span class="hljs-keyword">inherit</span> (haskell.lib.compose) overrideCabal;

  <span class="hljs-comment"># Incremental builds work with GHC &gt;=9.4.</span>
  <span class="hljs-attr">turtle</span> = haskell.packages.ghc944.turtle;

  <span class="hljs-comment"># This will do a full build of `turtle`, while writing the intermediate build products</span>
  <span class="hljs-comment"># (compiled modules, etc.) to the `intermediates` output.</span>
  <span class="hljs-attr">turtle-full-build-with-incremental-output</span> = overrideCabal (drv: {
    <span class="hljs-attr">doInstallIntermediates</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-attr">enableSeparateIntermediatesOutput</span> = <span class="hljs-literal">true</span>;
  }) turtle;

  <span class="hljs-comment"># This will do an incremental build of `turtle` by copying the previously</span>
  <span class="hljs-comment"># compiled modules and intermediate build products into the source tree</span>
  <span class="hljs-comment"># before running the build.</span>
  <span class="hljs-comment">#</span>
  <span class="hljs-comment"># GHC will then naturally pick up and reuse these products, making this build</span>
  <span class="hljs-comment"># complete much more quickly than the previous one.</span>
  <span class="hljs-attr">turtle-incremental-build</span> = overrideCabal (drv: {
    <span class="hljs-attr">previousIntermediates</span> = turtle-full-build-<span class="hljs-keyword">with</span>-incremental-output.intermediates;
  }) turtle;
<span class="hljs-keyword">in</span>
  turtle-incremental-build
</code></pre>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="haskell-development-environments" class="title">Development environments   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#haskell-development-environments" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>In addition to building and installing Haskell software, nixpkgs can also
provide development environments for Haskell projects. This has the obvious
advantage that you benefit from <code class="literal">cache.nixos.org</code> and no longer need to compile
all project dependencies yourself. While it is often very useful, this is not
the primary use case of our package set. Have a look at the section
<a class="link" href="https://nixos.org/manual/nixpkgs/stable/#haskell-available-versions" title="Available package versions">available package versions</a> to learn which
versions of packages we provide and the section
<a class="link" href="https://nixos.org/manual/nixpkgs/stable/#haskell-limitations" title="Limitations">limitations</a>, to judge whether a <code class="literal">haskellPackages</code>
based development environment for your project is feasible.</p><p>By default, every derivation built using
<a class="link" href="https://nixos.org/manual/nixpkgs/stable/#haskell-mkderivation" title="haskellPackages.mkDerivation"><code class="literal">haskellPackages.mkDerivation</code></a> exposes an environment
suitable for building it interactively as the <code class="literal">env</code> attribute. For example, if
you have a local checkout of <code class="literal">random</code>, you can enter a development environment
for it like this (if the dependencies in the development and packaged version
match):</p><pre><code class="programlisting console hljs language-shell" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cd</span> ~/src/random</span>
<span class="hljs-meta prompt_">$ </span><span class="language-bash">nix-shell -A haskellPackages.random.env <span class="hljs-string">'&lt;nixpkgs&gt;'</span></span>
[nix-shell:~/src/random]$ ghc-pkg list
/nix/store/a8hhl54xlzfizrhcf03c1l3f6l9l8qwv-ghc-9.2.4-with-packages/lib/ghc-9.2.4/package.conf.d
    Cabal-3.6.3.0
    array-0.5.4.0
    base-4.16.3.0
    binary-0.8.9.0
    …
    ghc-9.2.4
    …
</code></pre><p>As you can see, the environment contains a GHC which is set up so it finds all
dependencies of <code class="literal">random</code>. Note that this environment does not mirror
the environment used to build the package, but is intended as a convenient
tool for development and simple debugging. <code class="literal">env</code> relies on the <code class="literal">ghcWithPackages</code>
wrapper which automatically injects a pre-populated package-db into every
GHC invocation. In contrast, using <code class="literal">nix-shell -A haskellPackages.random</code> will
not result in an environment in which the dependencies are in GHCs package
database. Instead, the Haskell builder will pass in all dependencies explicitly
via configure flags.</p><p><code class="literal">env</code> mirrors the normal derivation environment in one aspect: It does not include
familiar development tools like <code class="literal">cabal-install</code>, since we rely on plain <code class="literal">Setup.hs</code>
to build all packages. However, <code class="literal">cabal-install</code> will work as expected if in
<code class="literal">PATH</code> (e.g. when installed globally and using a <code class="literal">nix-shell</code> without <code class="literal">--pure</code>).
A declarative and pure way of adding arbitrary development tools is provided
via <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#haskell-shellFor" title="shellFor"><code class="literal">shellFor</code></a>.</p><p>When using <code class="literal">cabal-install</code> for dependency resolution you need to be a bit
careful to achieve build purity. <code class="literal">cabal-install</code> will find and use all
dependencies installed from the packages <code class="literal">env</code> via Nix, but it will also
consult Hackage to potentially download and compile dependencies if it can’t
find a valid build plan locally. To prevent this you can either never run
<code class="literal">cabal update</code>, remove the cabal database from your <code class="literal">~/.cabal</code> folder or run
<code class="literal">cabal</code> with <code class="literal">--offline</code>. Note though, that for some usecases <code class="literal">cabal2nix</code> needs
the local Hackage db.</p><p>Often you won’t work on a package that is already part of <code class="literal">haskellPackages</code> or
Hackage, so we first need to write a Nix expression to obtain the development
environment from. Luckily, we can generate one very easily from an already
existing cabal file using <code class="literal">cabal2nix</code>:</p><pre><code class="programlisting console hljs language-shell" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">ls</span></span>
my-project.cabal src …
<span class="hljs-meta prompt_">$ </span><span class="language-bash">cabal2nix ./. &gt; my-project.nix</span>
</code></pre><p>The generated Nix expression evaluates to a function ready to be
<code class="literal">callPackage</code>-ed. For now, we can add a minimal <code class="literal">default.nix</code> which does just
that:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-comment"># Retrieve nixpkgs impurely from NIX_PATH for now, you can pin it instead, of course.</span>
{ pkgs ? <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {} }:

<span class="hljs-comment"># use the nixpkgs default haskell package set</span>
pkgs.haskellPackages.callPackage ./my-project.nix { }
</code></pre><p>Using <code class="literal">nix-build default.nix</code> we can now build our project, but we can also
enter a shell with all the package’s dependencies available using <code class="literal">nix-shell -A env default.nix</code>. If you have <code class="literal">cabal-install</code> installed globally, it’ll work
inside the shell as expected.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="haskell-shellFor" class="title">shellFor   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#haskell-shellFor" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Having to install tools globally is obviously not great, especially if you want
to provide a batteries-included <code class="literal">shell.nix</code> with your project. Luckily there’s a
proper tool for making development environments out of packages’ build
environments: <code class="literal">shellFor</code>, a function exposed by every haskell package set. It
takes the following arguments and returns a derivation which is suitable as a
development environment inside <code class="literal">nix-shell</code>:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">packages</code></span></dt><dd><p>This argument is used to select the packages for which to build the
development environment. This should be a function which takes a haskell package
set and returns a list of packages. <code class="literal">shellFor</code> will pass the used package set to
this function and include all dependencies of the returned package in the build
environment. This means you can reuse Nix expressions of packages included in
nixpkgs, but also use local Nix expressions like this: <code class="literal">hpkgs: [ (hpkgs.callPackage ./my-project.nix { }) ]</code>.</p></dd><dt><span class="term"><code class="literal">nativeBuildInputs</code></span></dt><dd><p>Expects a list of derivations to add as build tools to the build environment.
This is the place to add packages like <code class="literal">cabal-install</code>, <code class="literal">doctest</code> or <code class="literal">hlint</code>.
Defaults to <code class="literal">[]</code>.</p></dd><dt><span class="term"><code class="literal">buildInputs</code></span></dt><dd><p>Expects a list of derivations to add as library dependencies, like <code class="literal">openssl</code>.
This is rarely necessary as the haskell package expressions usually track system
dependencies as well. Defaults to <code class="literal">[]</code>. (see also
<a class="link" href="https://nixos.org/manual/nixpkgs/stable/#haskell-derivation-deps" title="Specifying dependencies">derivation dependencies</a>)</p></dd><dt><span class="term"><code class="literal">withHoogle</code></span></dt><dd><p>If this is true, <code class="literal">hoogle</code> will be added to <code class="literal">nativeBuildInputs</code>.
Additionally, its database will be populated with all included dependencies,
so you’ll be able search through the documentation of your dependencies.
Defaults to <code class="literal">false</code>.</p></dd><dt><span class="term"><code class="literal">genericBuilderArgsModifier</code></span></dt><dd><p>This argument accepts a function allowing you to modify the arguments passed
to <code class="literal">mkDerivation</code> in order to create the development environment. For example,
<code class="literal">args: { doCheck = false; }</code> would cause the environment to not include any test
dependencies. Defaults to <code class="literal">lib.id</code>.</p></dd><dt><span class="term"><code class="literal">doBenchmark</code></span></dt><dd><p>This is a shortcut for enabling <code class="literal">doBenchmark</code> via <code class="literal">genericBuilderArgsModifier</code>.
Setting it to <code class="literal">true</code> will cause the development environment to include all
benchmark dependencies which would be excluded by default. Defaults to <code class="literal">false</code>.</p></dd></dl></div><p>One neat property of <code class="literal">shellFor</code> is that it allows you to work on multiple
packages using the same environment in conjunction with
<a class="link" href="https://cabal.readthedocs.io/en/latest/cabal-project.html" target="_top">cabal.project files</a>.
Say our example above depends on <code class="literal">distribution-nixpkgs</code> and we have a project
file set up for both, we can add the following <code class="literal">shell.nix</code> expression:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ pkgs ? <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {} }:

pkgs.haskellPackages.shellFor {
  <span class="hljs-attr">packages</span> = hpkgs: [
    <span class="hljs-comment"># reuse the nixpkgs for this package</span>
    hpkgs.distribution-nixpkgs
    <span class="hljs-comment"># call our generated Nix expression manually</span>
    (hpkgs.callPackage ./my-project/my-project.nix { })
  ];

  <span class="hljs-comment"># development tools we use</span>
  <span class="hljs-attr">nativeBuildInputs</span> = [
    pkgs.cabal-install
    pkgs.haskellPackages.doctest
    pkgs.cabal2nix
  ];

  <span class="hljs-comment"># Extra arguments are added to mkDerivation's arguments as-is.</span>
  <span class="hljs-comment"># Since it adds all passed arguments to the shell environment,</span>
  <span class="hljs-comment"># we can use this to set the environment variable the `Paths_`</span>
  <span class="hljs-comment"># module of distribution-nixpkgs uses to search for bundled</span>
  <span class="hljs-comment"># files.</span>
  <span class="hljs-comment"># See also: https://cabal.readthedocs.io/en/latest/cabal-package.html#accessing-data-files-from-package-code</span>
  <span class="hljs-attr">distribution_nixpkgs_datadir</span> = <span class="hljs-built_in">toString</span> ./distribution-nixpkgs;
}
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="haskell-language-server" class="title">haskell-language-server   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#haskell-language-server" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>To use HLS in short: Install <code class="literal">pkgs.haskell-language-server</code> e.g. in
<code class="literal">nativeBuildInputs</code> in <code class="literal">shellFor</code> and use the <code class="literal">haskell-language-server-wrapper</code>
command to run it. See the <a class="link" href="https://haskell-language-server.readthedocs.io/en/latest/configuration.html#configuring-your-editor" target="_top">HLS user guide</a> on how to configure your text
editor to use HLS and how to test your setup.</p><p>HLS needs to be compiled with the GHC version of the project you use it
on.</p><p><code class="literal">pkgs.haskell-language-server</code> provides
<code class="literal">haskell-language-server-wrapper</code>, <code class="literal">haskell-language-server</code>
and <code class="literal">haskell-language-server-x.x.x</code>
binaries, where <code class="literal">x.x.x</code> is the GHC version for which it is compiled. By
default, it only includes binaries for the current GHC version, to reduce
closure size. The closure size is large, because HLS needs to be dynamically
linked to work reliably. You can override the list of supported GHC versions
with e.g.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">pkgs.haskell-language-server.override { <span class="hljs-attr">supportedGhcVersions</span> = [ <span class="hljs-string">"90"</span> <span class="hljs-string">"94"</span> ]; }
</code></pre><p>Where all strings <code class="literal">version</code> are allowed such that
<code class="literal">haskell.packages.ghc${version}</code> is an existing package set.</p><p>When you run <code class="literal">haskell-language-server-wrapper</code> it will detect the GHC
version used by the project you are working on (by asking e.g.&nbsp;cabal or
stack) and pick the appropriate versioned binary from your path.</p><p>Be careful when installing HLS globally and using a pinned nixpkgs for a
Haskell project in a <code class="literal">nix-shell</code>. If the nixpkgs versions deviate to much
(e.g.,&nbsp;use different <code class="literal">glibc</code> versions) the <code class="literal">haskell-language-server-?.?.?</code>
executable will try to detect these situations and refuse to start. It is
recommended to obtain HLS via <code class="literal">nix-shell</code> from the nixpkgs version pinned in
there instead.</p><p>The top level <code class="literal">pkgs.haskell-language-server</code> attribute is just a convenience
wrapper to make it possible to install HLS for multiple GHC versions at the
same time. If you know, that you only use one GHC version, e.g.,&nbsp;in a project
specific <code class="literal">nix-shell</code> you can use
<code class="literal">pkgs.haskellPackages.haskell-language-server</code> or
<code class="literal">pkgs.haskell.packages.*.haskell-language-server</code> from the package set you use.</p><p>If you use <code class="literal">nix-shell</code> for your development environments remember to start your
editor in that environment. You may want to use something like <code class="literal">direnv</code> and/or an
editor plugin to achieve this.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="haskell-overriding-haskell-packages" class="title">Overriding Haskell packages   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#haskell-overriding-haskell-packages" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="haskell-overriding-a-single-package" class="title">Overriding a single package   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#haskell-overriding-a-single-package" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Like many language specific subsystems in nixpkgs, the Haskell infrastructure
also has its own quirks when it comes to overriding. Overriding of the <span class="emphasis"><em>inputs</em></span>
to a package at least follows the standard procedure. For example, imagine you
need to build <code class="literal">nix-tree</code> with a more recent version of <code class="literal">brick</code> than the default
one provided by <code class="literal">haskellPackages</code>:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">haskellPackages.nix-tree.override {
  <span class="hljs-attr">brick</span> = haskellPackages.brick_0_67;
}
</code></pre><p>The custom interface comes into play when you want to override the arguments
passed to <code class="literal">haskellPackages.mkDerivation</code>. For this, the function <code class="literal">overrideCabal</code>
from <code class="literal">haskell.lib.compose</code> is used. E.g., if you want to install a man page
that is distributed with the package, you can do something like this:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">haskell.lib.compose.overrideCabal (drv: {
  <span class="hljs-attr">postInstall</span> = <span class="hljs-string">''
    <span class="hljs-subst">${drv.postInstall <span class="hljs-literal">or</span> <span class="hljs-string">""</span>}</span>
    install -Dm644 man/pnbackup.1 -t $out/share/man/man1
  ''</span>;
}) haskellPackages.pnbackup
</code></pre><p><code class="literal">overrideCabal</code> takes two arguments:</p><div class="orderedlist"><ol class="orderedlist compact" type="1"><li class="listitem"><p>A function which receives all arguments passed to <code class="literal">haskellPackages.mkDerivation</code>
before and returns a set of arguments to replace (or add) with a new value.</p></li><li class="listitem"><p>The Haskell derivation to override.</p></li></ol></div><p>The arguments are ordered so that you can easily create helper functions by making
use of currying:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">let</span>
  <span class="hljs-attr">installManPage</span> = haskell.lib.compose.overrideCabal (drv: {
    <span class="hljs-attr">postInstall</span> = <span class="hljs-string">''
      <span class="hljs-subst">${drv.postInstall <span class="hljs-literal">or</span> <span class="hljs-string">""</span>}</span>
      install -Dm644 man/<span class="hljs-subst">${drv.pname}</span>.1 -t "$out/share/man/man1"
    ''</span>;
  });
<span class="hljs-keyword">in</span>

installManPage haskellPackages.pnbackup
</code></pre><p>In fact, <code class="literal">haskell.lib.compose</code> already provides lots of useful helpers for common
tasks, detailed in the next section. They are also structured in such a way that
they can be combined using <code class="literal">lib.pipe</code>:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">lib.pipe my-haskell-package [
  <span class="hljs-comment"># lift version bounds on dependencies</span>
  haskell.lib.compose.doJailbreak
  <span class="hljs-comment"># disable building the haddock documentation</span>
  haskell.lib.compose.dontHaddock
  <span class="hljs-comment"># pass extra package flag to Cabal's configure step</span>
  (haskell.lib.compose.enableCabalFlag <span class="hljs-string">"myflag"</span>)
]
</code></pre><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="haskell-haskell.lib.compose" class="title"><code class="literal">haskell.lib.compose</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#haskell-haskell.lib.compose" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>The base interface for all overriding is the following function:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">overrideCabal f drv</code></span></dt><dd><p>Takes the arguments passed to obtain <code class="literal">drv</code> to <code class="literal">f</code> and uses the resulting
attribute set to update the argument set. Then a recomputed version of <code class="literal">drv</code>
using the new argument set is returned.</p></dd></dl></div><p>All other helper functions are implemented in terms of <code class="literal">overrideCabal</code> and make
common overrides shorter and more complicate ones trivial. The simple overrides
which only change a single argument are only described very briefly in the
following overview. Refer to the
<a class="link" href="https://nixos.org/manual/nixpkgs/stable/#haskell-mkderivation" title="haskellPackages.mkDerivation">documentation of <code class="literal">haskellPackages.mkDerivation</code></a>
for a more detailed description of the effects of the respective arguments.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h6 id="haskell-packaging-helpers" class="title">Packaging Helpers   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#haskell-packaging-helpers" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h6>  </div> </div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">overrideSrc { src, version } drv</code></span></dt><dd><p>Replace the source used for building <code class="literal">drv</code> with the path or derivation given
as <code class="literal">src</code>. The <code class="literal">version</code> attribute is optional. Prefer this function over
overriding <code class="literal">src</code> via <code class="literal">overrideCabal</code>, since it also automatically takes care of
removing any Hackage revisions.</p></dd></dl></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">justStaticExecutables drv</code></span></dt><dd><p>Only build and install the executables produced by <code class="literal">drv</code>, removing everything
that may refer to other Haskell packages’ store paths (like libraries and
documentation). This dramatically reduces the closure size of the resulting
derivation. Note that the executables are only statically linked against their
Haskell dependencies, but will still link dynamically against libc, GMP and
other system library dependencies. If dependencies use their Cabal-generated
<code class="literal">Paths_*</code> module, this may not work as well if GHC’s dead code elimination
is unable to remove the references to the dependency’s store path that module
contains.</p></dd><dt><span class="term"><code class="literal">enableSeparateBinOutput drv</code></span></dt><dd><p>Install executables produced by <code class="literal">drv</code> to a separate <code class="literal">bin</code> output. This
has a similar effect as <code class="literal">justStaticExecutables</code>, but preserves the libraries
and documentation in the <code class="literal">out</code> output alongside the <code class="literal">bin</code> output with a
much smaller closure size.</p></dd><dt><span class="term"><code class="literal">markBroken drv</code></span></dt><dd><p>Sets the <code class="literal">broken</code> flag to <code class="literal">true</code> for <code class="literal">drv</code>.</p></dd><dt><span class="term"><code class="literal">markUnbroken drv</code>, <code class="literal">unmarkBroken drv</code></span></dt><dd><p>Set the <code class="literal">broken</code> flag to <code class="literal">false</code> for <code class="literal">drv</code>.</p></dd><dt><span class="term"><code class="literal">doDistribute drv</code></span></dt><dd><p>Updates <code class="literal">hydraPlatforms</code> so that Hydra will build <code class="literal">drv</code>. This is
sometimes necessary when working with versioned packages in
<code class="literal">haskellPackages</code> which are not built by default.</p></dd><dt><span class="term"><code class="literal">dontDistribute drv</code></span></dt><dd><p>Sets <code class="literal">hydraPlatforms</code> to <code class="literal">[]</code>, causing Hydra to skip this package
altogether. Useful if it fails to evaluate cleanly and is causing
noise in the evaluation errors tab on Hydra.</p></dd></dl></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h6 id="haskell-development-helpers" class="title">Development Helpers   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#haskell-development-helpers" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h6>  </div> </div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">sdistTarball drv</code></span></dt><dd><p>Create a source distribution tarball like those found on Hackage
instead of building the package <code class="literal">drv</code>.</p></dd><dt><span class="term"><code class="literal">documentationTarball drv</code></span></dt><dd><p>Create a documentation tarball suitable for uploading to Hackage
instead of building the package <code class="literal">drv</code>.</p></dd><dt><span class="term"><code class="literal">buildFromSdist drv</code></span></dt><dd><p>Uses <code class="literal">sdistTarball drv</code> as the source to compile <code class="literal">drv</code>. This helps to catch
packaging bugs when building from a local directory, e.g. when required files
are missing from <code class="literal">extra-source-files</code>.</p></dd><dt><span class="term"><code class="literal">failOnAllWarnings drv</code></span></dt><dd><p>Enables all warnings GHC supports and makes it fail the build if any of them
are emitted.</p></dd></dl></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">enableDWARFDebugging drv</code></span></dt><dd><p>Compiles the package with additional debug symbols enabled, useful
for debugging with e.g. <code class="literal">gdb</code>.</p></dd><dt><span class="term"><code class="literal">doStrip drv</code></span></dt><dd><p>Sets <code class="literal">doStrip</code> to <code class="literal">true</code> for <code class="literal">drv</code>.</p></dd><dt><span class="term"><code class="literal">dontStrip drv</code></span></dt><dd><p>Sets <code class="literal">doStrip</code> to <code class="literal">false</code> for <code class="literal">drv</code>.</p></dd></dl></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h6 id="haskell-trivial-helpers" class="title">Trivial Helpers   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#haskell-trivial-helpers" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h6>  </div> </div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">doJailbreak drv</code></span></dt><dd><p>Sets the <code class="literal">jailbreak</code> argument to <code class="literal">true</code> for <code class="literal">drv</code>.</p></dd><dt><span class="term"><code class="literal">dontJailbreak drv</code></span></dt><dd><p>Sets the <code class="literal">jailbreak</code> argument to <code class="literal">false</code> for <code class="literal">drv</code>.</p></dd><dt><span class="term"><code class="literal">doHaddock drv</code></span></dt><dd><p>Sets <code class="literal">doHaddock</code> to <code class="literal">true</code> for <code class="literal">drv</code>.</p></dd><dt><span class="term"><code class="literal">dontHaddock drv</code></span></dt><dd><p>Sets <code class="literal">doHaddock</code> to <code class="literal">false</code> for <code class="literal">drv</code>. Useful if the build of a package is
failing because of e.g. a syntax error in the Haddock documentation.</p></dd><dt><span class="term"><code class="literal">doHyperlinkSource drv</code></span></dt><dd><p>Sets <code class="literal">hyperlinkSource</code> to <code class="literal">true</code> for <code class="literal">drv</code>.</p></dd><dt><span class="term"><code class="literal">dontHyperlinkSource drv</code></span></dt><dd><p>Sets <code class="literal">hyperlinkSource</code> to <code class="literal">false</code> for <code class="literal">drv</code>.</p></dd><dt><span class="term"><code class="literal">doCheck drv</code></span></dt><dd><p>Sets <code class="literal">doCheck</code> to <code class="literal">true</code> for <code class="literal">drv</code>.</p></dd><dt><span class="term"><code class="literal">dontCheck drv</code></span></dt><dd><p>Sets <code class="literal">doCheck</code> to <code class="literal">false</code> for <code class="literal">drv</code>. Useful if a package has a broken,
flaky or otherwise problematic test suite breaking the build.</p></dd></dl></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">appendConfigureFlags list drv</code></span></dt><dd><p>Adds the strings in <code class="literal">list</code> to the <code class="literal">configureFlags</code> argument for <code class="literal">drv</code>.</p></dd><dt><span class="term"><code class="literal">enableCabalFlag flag drv</code></span></dt><dd><p>Makes sure that the Cabal flag <code class="literal">flag</code> is enabled in Cabal’s configure step.</p></dd><dt><span class="term"><code class="literal">disableCabalFlag flag drv</code></span></dt><dd><p>Makes sure that the Cabal flag <code class="literal">flag</code> is disabled in Cabal’s configure step.</p></dd><dt><span class="term"><code class="literal">appendBuildFlags list drv</code></span></dt><dd><p>Adds the strings in <code class="literal">list</code> to the <code class="literal">buildFlags</code> argument for <code class="literal">drv</code>.</p></dd></dl></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">appendPatches list drv</code></span></dt><dd><p>Adds the <code class="literal">list</code> of derivations or paths to the <code class="literal">patches</code> argument for <code class="literal">drv</code>.</p></dd></dl></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">addBuildTools list drv</code></span></dt><dd><p>Adds the <code class="literal">list</code> of derivations to the <code class="literal">buildTools</code> argument for <code class="literal">drv</code>.</p></dd><dt><span class="term"><code class="literal">addExtraLibraries list drv</code></span></dt><dd><p>Adds the <code class="literal">list</code> of derivations to the <code class="literal">extraLibraries</code> argument for <code class="literal">drv</code>.</p></dd><dt><span class="term"><code class="literal">addBuildDepends list drv</code></span></dt><dd><p>Adds the <code class="literal">list</code> of derivations to the <code class="literal">buildDepends</code> argument for <code class="literal">drv</code>.</p></dd><dt><span class="term"><code class="literal">addTestToolDepends list drv</code></span></dt><dd><p>Adds the <code class="literal">list</code> of derivations to the <code class="literal">testToolDepends</code> argument for <code class="literal">drv</code>.</p></dd><dt><span class="term"><code class="literal">addPkgconfigDepends list drv</code></span></dt><dd><p>Adds the <code class="literal">list</code> of derivations to the <code class="literal">pkg-configDepends</code> argument for <code class="literal">drv</code>.</p></dd><dt><span class="term"><code class="literal">addSetupDepends list drv</code></span></dt><dd><p>Adds the <code class="literal">list</code> of derivations to the <code class="literal">setupHaskellDepends</code> argument for <code class="literal">drv</code>.</p></dd><dt><span class="term"><code class="literal">doBenchmark drv</code></span></dt><dd><p>Set <code class="literal">doBenchmark</code> to <code class="literal">true</code> for <code class="literal">drv</code>. Useful if your development
environment is missing the dependencies necessary for compiling the
benchmark component.</p></dd><dt><span class="term"><code class="literal">dontBenchmark drv</code></span></dt><dd><p>Set <code class="literal">doBenchmark</code> to <code class="literal">false</code> for <code class="literal">drv</code>.</p></dd><dt><span class="term"><code class="literal">setBuildTargets drv list</code></span></dt><dd><p>Sets the <code class="literal">buildTarget</code> argument for <code class="literal">drv</code> so that the targets specified in <code class="literal">list</code> are built.</p></dd><dt><span class="term"><code class="literal">doCoverage drv</code></span></dt><dd><p>Sets the <code class="literal">doCoverage</code> argument to <code class="literal">true</code> for <code class="literal">drv</code>.</p></dd><dt><span class="term"><code class="literal">dontCoverage drv</code></span></dt><dd><p>Sets the <code class="literal">doCoverage</code> argument to <code class="literal">false</code> for <code class="literal">drv</code>.</p></dd><dt><span class="term"><code class="literal">enableExecutableProfiling drv</code></span></dt><dd><p>Sets the <code class="literal">enableExecutableProfiling</code> argument to <code class="literal">true</code> for <code class="literal">drv</code>.</p></dd><dt><span class="term"><code class="literal">disableExecutableProfiling drv</code></span></dt><dd><p>Sets the <code class="literal">enableExecutableProfiling</code> argument to <code class="literal">false</code> for <code class="literal">drv</code>.</p></dd><dt><span class="term"><code class="literal">enableLibraryProfiling drv</code></span></dt><dd><p>Sets the <code class="literal">enableLibraryProfiling</code> argument to <code class="literal">true</code> for <code class="literal">drv</code>.</p></dd><dt><span class="term"><code class="literal">disableLibraryProfiling drv</code></span></dt><dd><p>Sets the <code class="literal">enableLibraryProfiling</code> argument to <code class="literal">false</code> for <code class="literal">drv</code>.</p></dd></dl></div>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="haskell-package-set-lib-functions" class="title">Library functions in the Haskell package sets   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#haskell-package-set-lib-functions" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Some library functions depend on packages from the Haskell package sets. Thus they are
exposed from those instead of from <code class="literal">haskell.lib.compose</code> which can only access what is
passed directly to it. When using the functions below, make sure that you are obtaining them
from the same package set (<code class="literal">haskellPackages</code>, <code class="literal">haskell.packages.ghc944</code> etc.) as the packages
you are working with or – even better – from the <code class="literal">self</code>/<code class="literal">final</code> fix point of your overlay to
<code class="literal">haskellPackages</code>.</p><p>Note: Some functions like <code class="literal">shellFor</code> that are not intended for overriding per se, are omitted
in this section. </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">cabalSdist { src, name ? ... }</code></span></dt><dd><p>Generates the Cabal sdist tarball for <code class="literal">src</code>, suitable for uploading to Hackage.
Contrary to <code class="literal">haskell.lib.compose.sdistTarball</code>, it uses <code class="literal">cabal-install</code> over <code class="literal">Setup.hs</code>,
so it is usually faster: No build dependencies need to be downloaded, and we can
skip compiling <code class="literal">Setup.hs</code>.</p></dd><dt><span class="term"><code class="literal">buildFromCabalSdist drv</code></span></dt><dd><p>Build <code class="literal">drv</code>, but run its <code class="literal">src</code> attribute through <code class="literal">cabalSdist</code> first. Useful for catching
files necessary for compilation that are missing from the sdist.</p></dd><dt><span class="term"><code class="literal">generateOptparseApplicativeCompletions list drv</code></span></dt><dd><p>Generate and install shell completion files for the installed executables whose
names are given via <code class="literal">list</code>. The executables need to be using <code class="literal">optparse-applicative</code>
for <a class="link" href="https://github.com/pcapriotti/optparse-applicative/blob/7726b63796aa5d0df82e926d467f039b78ca09e2/README.md#bash-zsh-and-fish-completions" target="_top">this to work</a>.
Note that this feature is automatically disabled when cross-compiling, since it
requires executing the binaries in question.</p></dd></dl></div>
</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="haskell-faq" class="title">F.A.Q.   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#haskell-faq" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="haskell-why-not-covered" class="title">Why is topic X not covered in this section? Why is section Y missing?   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#haskell-why-not-covered" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>We have been working on <a class="link" href="https://github.com/NixOS/nixpkgs/issues/121403" target="_top">moving the nixpkgs Haskell documentation back into the
nixpkgs manual</a>. Since this
process has not been completed yet, you may find some topics missing here
covered in the old <a class="link" href="https://haskell4nix.readthedocs.io/" target="_top">haskell4nix docs</a>.</p><p>If you feel any important topic is not documented at all, feel free to comment
on the issue linked above.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="haskell-faq-override-profiling" class="title">How to enable or disable profiling builds globally?   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#haskell-faq-override-profiling" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>By default, Nixpkgs builds a profiling version of each Haskell library. The
exception to this rule are some platforms where it is disabled due to concerns
over output size. You may want to…</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>…enable profiling globally so that you can build a project you are working on
with profiling ability giving you insight in the time spent across your code
and code you depend on using <a class="link" href="https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/profiling.html" target="_top">GHC’s profiling feature</a>.</p></li><li class="listitem"><p>…disable profiling (globally) to reduce the time spent building the profiling
versions of libraries which a significant amount of build time is spent on
(although they are not as expensive as the “normal” build of a Haskell library).</p></li></ul></div><div class="note"><h3 class="title">Note</h3><p>The method described below affects the build of all libraries in the
respective Haskell package set as well as GHC. If your choices differ from
Nixpkgs’ default for your (host) platform, you will lose the ability to
substitute from the official binary cache.</p><p>If you are concerned about build times and thus want to disable profiling, it
probably makes sense to use <code class="literal">haskell.lib.compose.disableLibraryProfiling</code> (see
<a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#haskell-trivial-helpers" title="Trivial Helpers">the section called “Trivial Helpers”</a>) on the packages you are building locally while
continuing to substitute their dependencies and GHC.</p></div><p>Since we need to change the profiling settings for the desired Haskell package
set <span class="emphasis"><em>and</em></span> GHC (as the core libraries like <code class="literal">base</code>, <code class="literal">filepath</code> etc. are bundled
with GHC), it is recommended to use overlays for Nixpkgs to change them.
Since the interrelated parts, i.e. the package set and GHC, are connected
via the Nixpkgs fixpoint, we need to modify them both in a way that preserves
their connection (or else we’d have to wire it up again manually). This is
achieved by changing GHC and the package set in separate overlays to prevent
the package set from pulling in GHC from <code class="literal">prev</code>.</p><p>The result is two overlays like the ones shown below. Adjustable parts are
annotated with comments, as are any optional or alternative ways to achieve
the desired profiling settings without causing too many rebuilds.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">let</span>
  <span class="hljs-comment"># Name of the compiler and package set you want to change. If you are using</span>
  <span class="hljs-comment"># the default package set `haskellPackages`, you need to look up what version</span>
  <span class="hljs-comment"># of GHC it currently uses (note that this is subject to change).</span>
  <span class="hljs-attr">ghcName</span> = <span class="hljs-string">"ghc92"</span>;
  <span class="hljs-comment"># Desired new setting</span>
  <span class="hljs-attr">enableProfiling</span> = <span class="hljs-literal">true</span>;
<span class="hljs-keyword">in</span>

[
  <span class="hljs-comment"># The first overlay modifies the GHC derivation so that it does or does not</span>
  <span class="hljs-comment"># build profiling versions of the core libraries bundled with it. It is</span>
  <span class="hljs-comment"># recommended to only use such an overlay if you are enabling profiling on a</span>
  <span class="hljs-comment"># platform that doesn't by default, because compiling GHC from scratch is</span>
  <span class="hljs-comment"># quite expensive.</span>
  (final: prev:
  <span class="hljs-keyword">let</span>
    <span class="hljs-keyword">inherit</span> (final) lib;
  <span class="hljs-keyword">in</span>

  {
    <span class="hljs-attr">haskell</span> = lib.recursiveUpdate prev.haskell {
      compiler.${ghcName} = prev.haskell.compiler.${ghcName}.override {
        <span class="hljs-comment"># Unfortunately, the GHC setting is named differently for historical reasons</span>
        <span class="hljs-attr">enableProfiledLibs</span> = enableProfiling;
      };
    };
  })

  (final: prev:
  <span class="hljs-keyword">let</span>
    <span class="hljs-keyword">inherit</span> (final) lib;
    <span class="hljs-attr">haskellLib</span> = final.haskell.lib.compose;
  <span class="hljs-keyword">in</span>

  {
    <span class="hljs-attr">haskell</span> = lib.recursiveUpdate prev.haskell {
      packages.${ghcName} = prev.haskell.packages.${ghcName}.override {
        <span class="hljs-attr">overrides</span> = hfinal: hprev: {
          <span class="hljs-attr">mkDerivation</span> = args: hprev.mkDerivation (args // {
            <span class="hljs-comment"># Since we are forcing our ideas upon mkDerivation, this change will</span>
            <span class="hljs-comment"># affect every package in the package set.</span>
            <span class="hljs-attr">enableLibraryProfiling</span> = enableProfiling;

            <span class="hljs-comment"># To actually use profiling on an executable, executable profiling</span>
            <span class="hljs-comment"># needs to be enabled for the executable you want to profile. You</span>
            <span class="hljs-comment"># can either do this globally or…</span>
            <span class="hljs-attr">enableExecutableProfiling</span> = enableProfiling;
          });

          <span class="hljs-comment"># …only for the package that contains an executable you want to profile.</span>
          <span class="hljs-comment"># That saves on unnecessary rebuilds for packages that you only depend</span>
          <span class="hljs-comment"># on for their library, but also contain executables (e.g. pandoc).</span>
          <span class="hljs-attr">my-executable</span> = haskellLib.enableExecutableProfiling hprev.my-executable;

          <span class="hljs-comment"># If you are disabling profiling to save on build time, but want to</span>
          <span class="hljs-comment"># retain the ability to substitute from the binary cache. Drop the</span>
          <span class="hljs-comment"># override for mkDerivation above and instead have an override like</span>
          <span class="hljs-comment"># this for the specific packages you are building locally and want</span>
          <span class="hljs-comment"># to make cheaper to build.</span>
          <span class="hljs-attr">my-library</span> = haskellLib.disableLibraryProfiling hprev.my-library;
        };
      };
    };
  })
]
</code></pre>
</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-language-hy" class="title" style="clear: both">Hy   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-language-hy" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-hy-installation">Installation</a> </span></dt> </dl></div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-hy-installation" class="title">Installation   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-hy-installation" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="installation-without-packages" class="title">Installation without packages   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#installation-without-packages" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>You can install <code class="literal">hy</code> via nix-env or by adding it to <code class="literal">configuration.nix</code> by referring to it as a <code class="literal">hy</code> attribute. This kind of installation adds <code class="literal">hy</code> to your environment and it successfully works with <code class="literal">python3</code>.</p><div class="caution"><h3 class="title">Caution</h3><p>Packages that are installed with your python derivation, are not accessible by <code class="literal">hy</code> this way.</p></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="installation-with-packages" class="title">Installation with packages   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#installation-with-packages" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Creating <code class="literal">hy</code> derivation with custom <code class="literal">python</code> packages is really simple and similar to the way that python does it. Attribute <code class="literal">hy</code> provides function <code class="literal">withPackages</code> that creates custom <code class="literal">hy</code> derivation with specified packages.</p><p>For example if you want to create shell with <code class="literal">matplotlib</code> and <code class="literal">numpy</code>, you can do it like so:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">nix-shell -p <span class="hljs-string">"hy.withPackages (ps: with ps; [ numpy matplotlib ])"</span></span>
</code></pre><p>Or if you want to extend your <code class="literal">configuration.nix</code>:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ <span class="hljs-comment"># ...</span>

  environment.<span class="hljs-attr">systemPackages</span> = <span class="hljs-keyword">with</span> pkgs; [
    (hy.withPackages (py-packages: <span class="hljs-keyword">with</span> py-packages; [ numpy matplotlib ]))
  ];
}
</code></pre>
</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="idris" class="title" style="clear: both">Idris   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#idris" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#installing-idris">Installing Idris</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#starting-idris-with-library-support">Starting Idris with library support</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#building-an-idris-project-with-nix">Building an Idris project with Nix</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#passing-options-to-idris-commands">Passing options to <code class="literal">idris</code> commands</a> </span></dt> </dl></div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="installing-idris" class="title">Installing Idris   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#installing-idris" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The easiest way to get a working idris version is to install the <code class="literal">idris</code> attribute:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">nix-env -f <span class="hljs-string">"&lt;nixpkgs&gt;"</span> -iA idris</span>
</code></pre><p>This however only provides the <code class="literal">prelude</code> and <code class="literal">base</code> libraries. To install idris with additional libraries, you can use the <code class="literal">idrisPackages.with-packages</code> function, e.g. in an overlay in <code class="literal">~/.config/nixpkgs/overlays/my-idris.nix</code>:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">self: super: {
  <span class="hljs-attr">myIdris</span> = <span class="hljs-keyword">with</span> self.idrisPackages; <span class="hljs-keyword">with</span>-packages [ contrib pruviloj ];
}
</code></pre><p>And then:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-comment"># On NixOS</span></span>
<span class="hljs-meta prompt_">$ </span><span class="language-bash">nix-env -iA nixos.myIdris</span>
<span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-comment"># On non-NixOS</span></span>
<span class="hljs-meta prompt_">$ </span><span class="language-bash">nix-env -iA nixpkgs.myIdris</span>
</code></pre><p>To see all available Idris packages:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-comment"># On NixOS</span></span>
<span class="hljs-meta prompt_">$ </span><span class="language-bash">nix-env -qaPA nixos.idrisPackages</span>
<span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-comment"># On non-NixOS</span></span>
<span class="hljs-meta prompt_">$ </span><span class="language-bash">nix-env -qaPA nixpkgs.idrisPackages</span>
</code></pre><p>Similarly, entering a <code class="literal">nix-shell</code>:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">nix-shell -p <span class="hljs-string">'idrisPackages.with-packages (with idrisPackages; [ contrib pruviloj ])'</span></span>
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="starting-idris-with-library-support" class="title">Starting Idris with library support   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#starting-idris-with-library-support" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>To have access to these libraries in idris, call it with an argument <code class="literal">-p &lt;library name&gt;</code> for each library:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">nix-shell -p <span class="hljs-string">'idrisPackages.with-packages (with idrisPackages; [ contrib pruviloj ])'</span></span>
[nix-shell:~]$ idris -p contrib -p pruviloj
</code></pre><p>A listing of all available packages the Idris binary has access to is available via <code class="literal">--listlibs</code>:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">idris --listlibs</span>
00prelude-idx.ibc
pruviloj
base
contrib
prelude
00pruviloj-idx.ibc
00base-idx.ibc
00contrib-idx.ibc
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="building-an-idris-project-with-nix" class="title">Building an Idris project with Nix   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#building-an-idris-project-with-nix" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>As an example of how a Nix expression for an Idris package can be created, here is the one for <code class="literal">idrisPackages.yaml</code>:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ lib
, build-idris-package
, fetchFromGitHub
, contrib
, lightyear
}:
build-idris-package  {
  <span class="hljs-attr">name</span> = <span class="hljs-string">"yaml"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"2018-01-25"</span>;

  <span class="hljs-comment"># This is the .ipkg file that should be built, defaults to the package name</span>
  <span class="hljs-comment"># In this case it should build `Yaml.ipkg` instead of `yaml.ipkg`</span>
  <span class="hljs-comment"># This is only necessary because the yaml packages ipkg file is</span>
  <span class="hljs-comment"># different from its package name here.</span>
  <span class="hljs-attr">ipkgName</span> = <span class="hljs-string">"Yaml"</span>;
  <span class="hljs-comment"># Idris dependencies to provide for the build</span>
  <span class="hljs-attr">idrisDeps</span> = [ contrib lightyear ];

  <span class="hljs-attr">src</span> = fetchFromGitHub {
    <span class="hljs-attr">owner</span> = <span class="hljs-string">"Heather"</span>;
    <span class="hljs-attr">repo</span> = <span class="hljs-string">"Idris.Yaml"</span>;
    <span class="hljs-attr">rev</span> = <span class="hljs-string">"5afa51ffc839844862b8316faba3bafa15656db4"</span>;
    <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-h28F9EEPuvab6zrfeE+0k1XGQJGwINnsJEG8yjWIl7w="</span>;
  };

  <span class="hljs-attr">meta</span> = <span class="hljs-keyword">with</span> lib; {
    <span class="hljs-attr">description</span> = <span class="hljs-string">"Idris YAML lib"</span>;
    <span class="hljs-attr">homepage</span> = <span class="hljs-string">"https://github.com/Heather/Idris.Yaml"</span>;
    <span class="hljs-attr">license</span> = licenses.mit;
    <span class="hljs-attr">maintainers</span> = [ maintainers.brainrape ];
  };
}
</code></pre><p>Assuming this file is saved as <code class="literal">yaml.nix</code>, it’s buildable using</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">nix-build -E <span class="hljs-string">'(import &lt;nixpkgs&gt; {}).idrisPackages.callPackage ./yaml.nix {}'</span></span>
</code></pre><p>Or it’s possible to use</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">with</span> <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {};

{
  <span class="hljs-attr">yaml</span> = idrisPackages.callPackage ./yaml.nix {};
}
</code></pre><p>in another file (say <code class="literal">default.nix</code>) to be able to build it with</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">nix-build -A yaml</span>
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="passing-options-to-idris-commands" class="title">Passing options to <code class="literal">idris</code> commands   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#passing-options-to-idris-commands" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The <code class="literal">build-idris-package</code> function provides also optional input values to set additional options for the used <code class="literal">idris</code> commands.</p><p>Specifically, you can set <code class="literal">idrisBuildOptions</code>, <code class="literal">idrisTestOptions</code>, <code class="literal">idrisInstallOptions</code> and <code class="literal">idrisDocOptions</code> to provide additional options to the <code class="literal">idris</code> command respectively when building, testing, installing and generating docs for your package.</p><p>For example you could set</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">build-idris-package {
  <span class="hljs-attr">idrisBuildOptions</span> = [ <span class="hljs-string">"--log"</span> <span class="hljs-string">"1"</span> <span class="hljs-string">"--verbose"</span> ]

  ...
}
</code></pre><p>to require verbose output during <code class="literal">idris</code> build phase.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="ios" class="title" style="clear: both">iOS   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ios" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#deploying-a-proxy-component-wrapper-exposing-xcode">Deploying a proxy component wrapper exposing Xcode</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#building-an-ios-application">Building an iOS application</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#spawning-simulator-instances">Spawning simulator instances</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#troubleshooting">Troubleshooting</a> </span></dt> </dl></div><p>This component is basically a wrapper/workaround that makes it possible to
expose an Xcode installation as a Nix package by means of symlinking to the
relevant executables on the host system.</p><p>Since Xcode can’t be packaged with Nix, nor we can publish it as a Nix package
(because of its license) this is basically the only integration strategy
making it possible to do iOS application builds that integrate with other
components of the Nix ecosystem</p><p>The primary objective of this project is to use the Nix expression language to
specify how iOS apps can be built from source code, and to automatically spawn
iOS simulator instances for testing.</p><p>This component also makes it possible to use <a class="link" href="https://nixos.org/hydra" target="_top">Hydra</a>,
the Nix-based continuous integration server to regularly build iOS apps and to
do wireless ad-hoc installations of enterprise IPAs on iOS devices through
Hydra.</p><p>The Xcode build environment implements a number of features.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="deploying-a-proxy-component-wrapper-exposing-xcode" class="title">Deploying a proxy component wrapper exposing Xcode   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#deploying-a-proxy-component-wrapper-exposing-xcode" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The first use case is deploying a Nix package that provides symlinks to the Xcode
installation on the host system. This package can be used as a build input to
any build function implemented in the Nix expression language that requires
Xcode.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">let</span>
  <span class="hljs-attr">pkgs</span> = <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {};

  <span class="hljs-attr">xcodeenv</span> = <span class="hljs-built_in">import</span> ./xcodeenv {
    <span class="hljs-keyword">inherit</span> (pkgs) stdenv;
  };
<span class="hljs-keyword">in</span>
xcodeenv.composeXcodeWrapper {
  <span class="hljs-attr">version</span> = <span class="hljs-string">"9.2"</span>;
  <span class="hljs-attr">xcodeBaseDir</span> = <span class="hljs-string">"/Applications/Xcode.app"</span>;
}
</code></pre><p>By deploying the above expression with <code class="literal">nix-build</code> and inspecting its content
you will notice that several Xcode-related executables are exposed as a Nix
package:</p><pre><code class="programlisting bash hljs language-bash" data-highlighted="yes">$ <span class="hljs-built_in">ls</span> result/bin
lrwxr-xr-x  1 sander  staff  94  1 jan  1970 Simulator -&gt; /Applications/Xcode.app/Contents/Developer/Applications/Simulator.app/Contents/MacOS/Simulator
lrwxr-xr-x  1 sander  staff  17  1 jan  1970 codesign -&gt; /usr/bin/codesign
lrwxr-xr-x  1 sander  staff  17  1 jan  1970 security -&gt; /usr/bin/security
lrwxr-xr-x  1 sander  staff  21  1 jan  1970 xcode-select -&gt; /usr/bin/xcode-select
lrwxr-xr-x  1 sander  staff  61  1 jan  1970 xcodebuild -&gt; /Applications/Xcode.app/Contents/Developer/usr/bin/xcodebuild
lrwxr-xr-x  1 sander  staff  14  1 jan  1970 xcrun -&gt; /usr/bin/xcrun
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="building-an-ios-application" class="title">Building an iOS application   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#building-an-ios-application" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>We can build an iOS app executable for the simulator, or an IPA/xcarchive file
for release purposes, e.g. ad-hoc, enterprise or store installations, by
executing the <code class="literal">xcodeenv.buildApp {}</code> function:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">let</span>
  <span class="hljs-attr">pkgs</span> = <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {};

  <span class="hljs-attr">xcodeenv</span> = <span class="hljs-built_in">import</span> ./xcodeenv {
    <span class="hljs-keyword">inherit</span> (pkgs) stdenv;
  };
<span class="hljs-keyword">in</span>
xcodeenv.buildApp {
  <span class="hljs-attr">name</span> = <span class="hljs-string">"MyApp"</span>;
  <span class="hljs-attr">src</span> = ./myappsources;
  <span class="hljs-attr">sdkVersion</span> = <span class="hljs-string">"11.2"</span>;

  <span class="hljs-attr">target</span> = <span class="hljs-literal">null</span>; <span class="hljs-comment"># Corresponds to the name of the app by default</span>
  <span class="hljs-attr">configuration</span> = <span class="hljs-literal">null</span>; <span class="hljs-comment"># Release for release builds, Debug for debug builds</span>
  <span class="hljs-attr">scheme</span> = <span class="hljs-literal">null</span>; <span class="hljs-comment"># -scheme will correspond to the app name by default</span>
  <span class="hljs-attr">sdk</span> = <span class="hljs-literal">null</span>; <span class="hljs-comment"># null will set it to 'iphonesimulator` for simulator builds or `iphoneos` to real builds</span>
  <span class="hljs-attr">xcodeFlags</span> = <span class="hljs-string">""</span>;

  <span class="hljs-attr">release</span> = <span class="hljs-literal">true</span>;
  <span class="hljs-attr">certificateFile</span> = ./mycertificate.p12;
  <span class="hljs-attr">certificatePassword</span> = <span class="hljs-string">"secret"</span>;
  <span class="hljs-attr">provisioningProfile</span> = ./myprovisioning.profile;
  <span class="hljs-attr">signMethod</span> = <span class="hljs-string">"ad-hoc"</span>; <span class="hljs-comment"># 'enterprise' or 'store'</span>
  <span class="hljs-attr">generateIPA</span> = <span class="hljs-literal">true</span>;
  <span class="hljs-attr">generateXCArchive</span> = <span class="hljs-literal">false</span>;

  <span class="hljs-attr">enableWirelessDistribution</span> = <span class="hljs-literal">true</span>;
  <span class="hljs-attr">installURL</span> = <span class="hljs-string">"/installipa.php"</span>;
  <span class="hljs-attr">bundleId</span> = <span class="hljs-string">"mycompany.myapp"</span>;
  <span class="hljs-attr">appVersion</span> = <span class="hljs-string">"1.0"</span>;

  <span class="hljs-comment"># Supports all xcodewrapper parameters as well</span>
  <span class="hljs-attr">xcodeBaseDir</span> = <span class="hljs-string">"/Applications/Xcode.app"</span>;
}
</code></pre><p>The above function takes a variety of parameters:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>The <code class="literal">name</code> and <code class="literal">src</code> parameters are mandatory and specify the name of the app
and the location where the source code resides</p></li><li class="listitem"><p><code class="literal">sdkVersion</code> specifies which version of the iOS SDK to use.</p></li></ul></div><p>It also possible to adjust the <code class="literal">xcodebuild</code> parameters. This is only needed in
rare circumstances. In most cases the default values should suffice:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>Specifies which <code class="literal">xcodebuild</code> target to build. By default it takes the target
that has the same name as the app.</p></li><li class="listitem"><p>The <code class="literal">configuration</code> parameter can be overridden if desired. By default, it
will do a debug build for the simulator and a release build for real devices.</p></li><li class="listitem"><p>The <code class="literal">scheme</code> parameter specifies which <code class="literal">-scheme</code> parameter to propagate to
<code class="literal">xcodebuild</code>. By default, it corresponds to the app name.</p></li><li class="listitem"><p>The <code class="literal">sdk</code> parameter specifies which SDK to use. By default, it picks
<code class="literal">iphonesimulator</code> for simulator builds and <code class="literal">iphoneos</code> for release builds.</p></li><li class="listitem"><p>The <code class="literal">xcodeFlags</code> parameter specifies arbitrary command line parameters that
should be propagated to <code class="literal">xcodebuild</code>.</p></li></ul></div><p>By default, builds are carried out for the iOS simulator. To do release builds
(builds for real iOS devices), you must set the <code class="literal">release</code> parameter to <code class="literal">true</code>.
In addition, you need to set the following parameters:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">certificateFile</code> refers to a P12 certificate file.</p></li><li class="listitem"><p><code class="literal">certificatePassword</code> specifies the password of the P12 certificate.</p></li><li class="listitem"><p><code class="literal">provisioningProfile</code> refers to the provision profile needed to sign the app</p></li><li class="listitem"><p><code class="literal">signMethod</code> should refer to <code class="literal">ad-hoc</code> for signing the app with an ad-hoc
certificate, <code class="literal">enterprise</code> for enterprise certificates and <code class="literal">app-store</code> for App
store certificates.</p></li><li class="listitem"><p><code class="literal">generateIPA</code> specifies that we want to produce an IPA file (this is probably
what you want)</p></li><li class="listitem"><p><code class="literal">generateXCArchive</code> specifies that we want to produce an xcarchive file.</p></li></ul></div><p>When building IPA files on Hydra and when it is desired to allow iOS devices to
install IPAs by browsing to the Hydra build products page, you can enable the
<code class="literal">enableWirelessDistribution</code> parameter.</p><p>When enabled, you need to configure the following options:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>The <code class="literal">installURL</code> parameter refers to the URL of a PHP script that composes the
<code class="literal">itms-services://</code> URL allowing iOS devices to install the IPA file.</p></li><li class="listitem"><p><code class="literal">bundleId</code> refers to the bundle ID value of the app</p></li><li class="listitem"><p><code class="literal">appVersion</code> refers to the app’s version number</p></li></ul></div><p>To use wireless adhoc distributions, you must also install the corresponding
PHP script on a web server (see section: ‘Installing the PHP script for wireless
ad hoc installations from Hydra’ for more information).</p><p>In addition to the build parameters, you can also specify any parameters that
the <code class="literal">xcodeenv.composeXcodeWrapper {}</code> function takes. For example, the
<code class="literal">xcodeBaseDir</code> parameter can be overridden to refer to a different Xcode
version.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="spawning-simulator-instances" class="title">Spawning simulator instances   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#spawning-simulator-instances" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>In addition to building iOS apps, we can also automatically spawn simulator
instances:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">let</span>
  <span class="hljs-attr">pkgs</span> = <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {};

  <span class="hljs-attr">xcodeenv</span> = <span class="hljs-built_in">import</span> ./xcodeenv {
    <span class="hljs-keyword">inherit</span> (pkgs) stdenv;
  };
<span class="hljs-keyword">in</span>
xcode.simulateApp {
  <span class="hljs-attr">name</span> = <span class="hljs-string">"simulate"</span>;

  <span class="hljs-comment"># Supports all xcodewrapper parameters as well</span>
  <span class="hljs-attr">xcodeBaseDir</span> = <span class="hljs-string">"/Applications/Xcode.app"</span>;
}
</code></pre><p>The above expression produces a script that starts the simulator from the
provided Xcode installation. The script can be started as follows:</p><pre><code class="programlisting bash hljs language-bash" data-highlighted="yes">./result/bin/run-test-simulator
</code></pre><p>By default, the script will show an overview of UDID for all available simulator
instances and asks you to pick one. You can also provide a UDID as a
command-line parameter to launch an instance automatically:</p><pre><code class="programlisting bash hljs language-bash" data-highlighted="yes">./result/bin/run-test-simulator 5C93129D-CF39-4B1A-955F-15180C3BD4B8
</code></pre><p>You can also extend the simulator script to automatically deploy and launch an
app in the requested simulator instance:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">let</span>
  <span class="hljs-attr">pkgs</span> = <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {};

  <span class="hljs-attr">xcodeenv</span> = <span class="hljs-built_in">import</span> ./xcodeenv {
    <span class="hljs-keyword">inherit</span> (pkgs) stdenv;
  };
<span class="hljs-keyword">in</span>
xcode.simulateApp {
  <span class="hljs-attr">name</span> = <span class="hljs-string">"simulate"</span>;
  <span class="hljs-attr">bundleId</span> = <span class="hljs-string">"mycompany.myapp"</span>;
  <span class="hljs-attr">app</span> = xcode.buildApp {
    <span class="hljs-comment"># ...</span>
  };

  <span class="hljs-comment"># Supports all xcodewrapper parameters as well</span>
  <span class="hljs-attr">xcodeBaseDir</span> = <span class="hljs-string">"/Applications/Xcode.app"</span>;
}
</code></pre><p>By providing the result of an <code class="literal">xcode.buildApp {}</code> function and configuring the
app bundle id, the app gets deployed automatically and started.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="troubleshooting" class="title">Troubleshooting   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#troubleshooting" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>In some rare cases, it may happen that after a failure, changes are not picked
up. Most likely, this is caused by a derived data cache that Xcode maintains.
To wipe it you can run:</p><pre><code class="programlisting bash hljs language-bash" data-highlighted="yes">$ <span class="hljs-built_in">rm</span> -rf ~/Library/Developer/Xcode/DerivedData
</code></pre>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-language-java" class="title" style="clear: both">Java   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-language-java" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>Ant-based Java packages are typically built from source as follows:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">stdenv.mkDerivation {
  <span class="hljs-attr">name</span> = <span class="hljs-string">"..."</span>;
  <span class="hljs-attr">src</span> = fetchurl { ... };

  <span class="hljs-attr">nativeBuildInputs</span> = [ jdk ant ];

  <span class="hljs-attr">buildPhase</span> = <span class="hljs-string">"ant"</span>;
}
</code></pre><p>Note that <code class="literal">jdk</code> is an alias for the OpenJDK (self-built where available,
or pre-built via Zulu). Platforms with OpenJDK not (yet) in Nixpkgs
(<code class="literal">Aarch32</code>, <code class="literal">Aarch64</code>) point to the (unfree) <code class="literal">oraclejdk</code>.</p><p>JAR files that are intended to be used by other packages should be
installed in <code class="literal">$out/share/java</code>. JDKs have a stdenv setup hook that add
any JARs in the <code class="literal">share/java</code> directories of the build inputs to the
<code class="literal">CLASSPATH</code> environment variable. For instance, if the package <code class="literal">libfoo</code>
installs a JAR named <code class="literal">foo.jar</code> in its <code class="literal">share/java</code> directory, and
another package declares the attribute</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">buildInputs</span> = [ libfoo ];
<span class="hljs-attr">nativeBuildInputs</span> = [ jdk ];
</code></pre><p>then <code class="literal">CLASSPATH</code> will be set to
<code class="literal">/nix/store/...-libfoo/share/java/foo.jar</code>.</p><p>Private JARs should be installed in a location like
<code class="literal">$out/share/package-name</code>.</p><p>If your Java package provides a program, you need to generate a wrapper
script to run it using a JRE. You can use <code class="literal">makeWrapper</code> for this:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">nativeBuildInputs</span> = [ makeWrapper ];

<span class="hljs-attr">installPhase</span> = <span class="hljs-string">''
  mkdir -p $out/bin
  makeWrapper <span class="hljs-subst">${jre}</span>/bin/java $out/bin/foo \
    --add-flags "-cp $out/share/java/foo.jar org.foo.Main"
''</span>;
</code></pre><p>Since the introduction of the Java Platform Module System in Java 9,
Java distributions typically no longer ship with a general-purpose JRE:
instead, they allow generating a JRE with only the modules required for
your application(s). Because we can’t predict what modules will be
needed on a general-purpose system, the default jre package is the full
JDK. When building a minimal system/image, you can override the
<code class="literal">modules</code> parameter on <code class="literal">jre_minimal</code> to build a JRE with only the
modules relevant for you:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">let</span>
  <span class="hljs-attr">my_jre</span> = pkgs.jre_minimal.override {
    <span class="hljs-attr">modules</span> = [
      <span class="hljs-comment"># The modules used by 'something' and 'other' combined:</span>
      <span class="hljs-string">"java.base"</span>
      <span class="hljs-string">"java.logging"</span>
    ];
  };
  <span class="hljs-attr">something</span> = (pkgs.something.override { <span class="hljs-attr">jre</span> = my_jre; });
  <span class="hljs-attr">other</span> = (pkgs.other.override { <span class="hljs-attr">jre</span> = my_jre; });
<span class="hljs-keyword">in</span>
  ...
</code></pre><p>You can also specify what JDK your JRE should be based on, for example
selecting a ‘headless’ build to avoid including a link to GTK+:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">my_jre</span> = pkgs.jre_minimal.override {
  <span class="hljs-attr">jdk</span> = jdk11_headless;
};
</code></pre><p>Note all JDKs passthru <code class="literal">home</code>, so if your application requires
environment variables like <code class="literal">JAVA_HOME</code> being set, that can be done in a
generic fashion with the <code class="literal">--set</code> argument of <code class="literal">makeWrapper</code>:</p><pre><code class="programlisting bash hljs language-bash" data-highlighted="yes">--<span class="hljs-built_in">set</span> JAVA_HOME <span class="hljs-variable">${jdk.home}</span>
</code></pre><p>It is possible to use a different Java compiler than <code class="literal">javac</code> from the
OpenJDK. For instance, to use the GNU Java Compiler:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">nativeBuildInputs</span> = [ gcj ant ];
</code></pre><p>Here, Ant will automatically use <code class="literal">gij</code> (the GNU Java Runtime) instead of
the OpenJRE.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="language-javascript" class="title" style="clear: both">Javascript   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#language-javascript" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#javascript-introduction">Introduction</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#javascript-finding-examples">Getting unstuck / finding code examples</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#javascript-tools-overview">Tools overview</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#javascript-general-principles">General principles</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#javascript-packages-nixpkgs">Javascript packages inside nixpkgs</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#javascript-tool-specific">Tool specific instructions</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#javascript-outside-nixpkgs">Outside Nixpkgs</a> </span></dt> </dl></div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="javascript-introduction" class="title">Introduction   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#javascript-introduction" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>This contains instructions on how to package javascript applications.</p><p>The various tools available will be listed in the <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#javascript-tools-overview" title="Tools overview">tools-overview</a>. Some general principles for packaging will follow. Finally some tool specific instructions will be given.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="javascript-finding-examples" class="title">Getting unstuck / finding code examples   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#javascript-finding-examples" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>If you find you are lacking inspiration for packing javascript applications, the links below might prove useful. Searching online for prior art can be helpful if you are running into solved problems.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="javascript-finding-examples-github" class="title">Github   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#javascript-finding-examples-github" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>Searching Nix files for <code class="literal">mkYarnPackage</code>: <a class="link" href="https://github.com/search?q=mkYarnPackage+language%3ANix&amp;type=code" target="_top">https://github.com/search?q=mkYarnPackage+language%3ANix&amp;type=code</a></p></li><li class="listitem"><p>Searching just <code class="literal">flake.nix</code> files for <code class="literal">mkYarnPackage</code>: <a class="link" href="https://github.com/search?q=mkYarnPackage+path%3A**%2Fflake.nix&amp;type=code" target="_top">https://github.com/search?q=mkYarnPackage+path%3A**%2Fflake.nix&amp;type=code</a></p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="javascript-finding-examples-gitlab" class="title">Gitlab   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#javascript-finding-examples-gitlab" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>Searching Nix files for <code class="literal">mkYarnPackage</code>: <a class="link" href="https://gitlab.com/search?scope=blobs&amp;search=mkYarnPackage+extension%3Anix" target="_top">https://gitlab.com/search?scope=blobs&amp;search=mkYarnPackage+extension%3Anix</a></p></li><li class="listitem"><p>Searching just <code class="literal">flake.nix</code> files for <code class="literal">mkYarnPackage</code>: <a class="link" href="https://gitlab.com/search?scope=blobs&amp;search=mkYarnPackage+filename%3Aflake.nix" target="_top">https://gitlab.com/search?scope=blobs&amp;search=mkYarnPackage+filename%3Aflake.nix</a></p></li></ul></div>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="javascript-tools-overview" class="title">Tools overview   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#javascript-tools-overview" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="javascript-general-principles" class="title">General principles   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#javascript-general-principles" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The following principles are given in order of importance with potential exceptions.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="javascript-upstream-node-version" class="title">Try to use the same node version used upstream   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#javascript-upstream-node-version" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>It is often not documented which node version is used upstream, but if it is, try to use the same version when packaging.</p><p>This can be a problem if upstream is using the latest and greatest and you are trying to use an earlier version of node. Some cryptic errors regarding V8 may appear.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="javascript-upstream-package-manager" class="title">Try to respect the package manager originally used by upstream (and use the upstream lock file)   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#javascript-upstream-package-manager" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>A lock file (package-lock.json, yarn.lock…) is supposed to make reproducible installations of node_modules for each tool.</p><p>Guidelines of package managers, recommend to commit those lock files to the repos. If a particular lock file is present, it is a strong indication of which package manager is used upstream.</p><p>It’s better to try to use a Nix tool that understand the lock file. Using a different tool might give you hard to understand error because different packages have been installed. An example of problems that could arise can be found <a class="link" href="https://github.com/NixOS/nixpkgs/pull/126629" target="_top">here</a>. Upstream use NPM, but this is an attempt to package it with <code class="literal">yarn2nix</code> (that uses yarn.lock).</p><p>Using a different tool forces to commit a lock file to the repository. Those files are fairly large, so when packaging for nixpkgs, this approach does not scale well.</p><p>Exceptions to this rule are:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>When you encounter one of the bugs from a Nix tool. In each of the tool specific instructions, known problems will be detailed. If you have a problem with a particular tool, then it’s best to try another tool, even if this means you will have to recreate a lock file and commit it to nixpkgs. In general <code class="literal">yarn2nix</code> has less known problems and so a simple search in nixpkgs will reveal many yarn.lock files committed.</p></li><li class="listitem"><p>Some lock files contain particular version of a package that has been pulled off NPM for some reason. In that case, you can recreate upstream lock (by removing the original and <code class="literal">npm install</code>, <code class="literal">yarn</code>, …) and commit this to nixpkgs.</p></li><li class="listitem"><p>The only tool that supports workspaces (a feature of NPM that helps manage sub-directories with different package.json from a single top level package.json) is <code class="literal">yarn2nix</code>. If upstream has workspaces you should try <code class="literal">yarn2nix</code>.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="javascript-upstream-package-json" class="title">Try to use upstream package.json   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#javascript-upstream-package-json" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Exceptions to this rule are:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>Sometimes the upstream repo assumes some dependencies be installed globally. In that case you can add them manually to the upstream package.json (<code class="literal">yarn add xxx</code> or <code class="literal">npm install xxx</code>, …). Dependencies that are installed locally can be executed with <code class="literal">npx</code> for CLI tools. (e.g. <code class="literal">npx postcss ...</code>, this is how you can call those dependencies in the phases).</p></li><li class="listitem"><p>Sometimes there is a version conflict between some dependency requirements. In that case you can fix a version by removing the <code class="literal">^</code>.</p></li><li class="listitem"><p>Sometimes the script defined in the package.json does not work as is. Some scripts for example use CLI tools that might not be available, or cd in directory with a different package.json (for workspaces notably). In that case, it’s perfectly fine to look at what the particular script is doing and break this down in the phases. In the build script you can see <code class="literal">build:*</code> calling in turns several other build scripts like <code class="literal">build:ui</code> or <code class="literal">build:server</code>. If one of those fails, you can try to separate those into,</p><pre><code class="programlisting sh hljs language-bash" data-highlighted="yes">yarn build:ui
yarn build:server
<span class="hljs-comment"># OR</span>
npm run build:ui
npm run build:server
</code></pre><p>when you need to override a package.json. It’s nice to use the one from the upstream source and do some explicit override. Here is an example:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">patchedPackageJSON</span> = final.runCommand <span class="hljs-string">"package.json"</span> { } <span class="hljs-string">''
  <span class="hljs-subst">${jq}</span>/bin/jq '.version = "0.4.0" |
    .devDependencies."@jsdoc/cli" = "^0.2.5"
    <span class="hljs-subst">${sonar-src}</span>/package.json &gt; $out
''</span>;
</code></pre><p>You will still need to commit the modified version of the lock files, but at least the overrides are explicit for everyone to see.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="javascript-using-node_modules" class="title">Using node_modules directly   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#javascript-using-node_modules" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Each tool has an abstraction to just build the node_modules (dependencies) directory. You can always use the <code class="literal">stdenv.mkDerivation</code> with the node_modules to build the package (symlink the node_modules directory and then use the package build command). The node_modules abstraction can be also used to build some web framework frontends. For an example of this see how <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/servers/web-apps/plausible/default.nix" target="_top">plausible</a> is built. <code class="literal">mkYarnModules</code> to make the derivation containing node_modules. Then when building the frontend you can just symlink the node_modules directory.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="javascript-packages-nixpkgs" class="title">Javascript packages inside nixpkgs   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#javascript-packages-nixpkgs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/development/node-packages" target="_top">pkgs/development/node-packages</a> folder contains a generated collection of <a class="link" href="https://npmjs.com/" target="_top">NPM packages</a> that can be installed with the Nix package manager.</p><p>As a rule of thumb, the package set should only provide <span class="emphasis"><em>end user</em></span> software packages, such as command-line utilities. Libraries should only be added to the package set if there is a non-NPM package that requires it.</p><p>When it is desired to use NPM libraries in a development project, use the <code class="literal">node2nix</code> generator directly on the <code class="literal">package.json</code> configuration file of the project.</p><p>The package set provides support for the official stable Node.js versions. The latest stable LTS release in <code class="literal">nodePackages</code>, as well as the latest stable current release in <code class="literal">nodePackages_latest</code>.</p><p>If your package uses native addons, you need to examine what kind of native build system it uses. Here are some examples:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">node-gyp</code></p></li><li class="listitem"><p><code class="literal">node-gyp-builder</code></p></li><li class="listitem"><p><code class="literal">node-pre-gyp</code></p></li></ul></div><p>After you have identified the correct system, you need to override your package expression while adding in build system as a build input. For example, <code class="literal">dat</code> requires <code class="literal">node-gyp-build</code>, so we override its expression in <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/development/node-packages/overrides.nix" target="_top">pkgs/development/node-packages/overrides.nix</a>:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">    <span class="hljs-attr">dat</span> = prev.dat.override (oldAttrs: {
      <span class="hljs-attr">buildInputs</span> = [ final.node-gyp-build pkgs.libtool pkgs.autoconf pkgs.automake ];
      <span class="hljs-attr">meta</span> = oldAttrs.meta // { <span class="hljs-attr">broken</span> = since <span class="hljs-string">"12"</span>; };
    });
</code></pre><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="javascript-adding-or-updating-packages" class="title">Adding and Updating Javascript packages in nixpkgs   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#javascript-adding-or-updating-packages" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>To add a package from NPM to nixpkgs:</p><div class="orderedlist"><ol class="orderedlist " type="1"><li class="listitem"><p>Modify <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/development/node-packages/node-packages.json" target="_top">pkgs/development/node-packages/node-packages.json</a> to add, update or remove package entries to have it included in <code class="literal">nodePackages</code> and <code class="literal">nodePackages_latest</code>.</p></li><li class="listitem"><p>Run the script:</p><pre><code class="programlisting sh hljs language-bash" data-highlighted="yes">./pkgs/development/node-packages/generate.sh
</code></pre></li><li class="listitem"><p>Build your new package to test your changes:</p><pre><code class="programlisting sh hljs language-bash" data-highlighted="yes">nix-build -A nodePackages.&lt;new-or-updated-package&gt;
</code></pre><p>To build against the latest stable Current Node.js version (e.g. 18.x):</p><pre><code class="programlisting sh hljs language-bash" data-highlighted="yes">nix-build -A nodePackages_latest.&lt;new-or-updated-package&gt;
</code></pre><p>If the package doesn’t build, you may need to add an override as explained above.</p></li><li class="listitem"><p>If the package’s name doesn’t match any of the executables it provides, add an entry in <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/development/node-packages/main-programs.nix" target="_top">pkgs/development/node-packages/main-programs.nix</a>. This will be the case for all scoped packages, e.g., <code class="literal">@angular/cli</code>.</p></li><li class="listitem"><p>Add and commit all modified and generated files.</p></li></ol></div><p>For more information about the generation process, consult the <a class="link" href="https://github.com/svanderburg/node2nix" target="_top">README.md</a> file of the <code class="literal">node2nix</code> tool.</p><p>To update NPM packages in nixpkgs, run the same <code class="literal">generate.sh</code> script:</p><pre><code class="programlisting sh hljs language-bash" data-highlighted="yes">./pkgs/development/node-packages/generate.sh
</code></pre><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="javascript-git-error" class="title">Git protocol error   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#javascript-git-error" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Some packages may have Git dependencies from GitHub specified with <code class="literal">git://</code>.
GitHub has <a class="link" href="https://github.blog/2021-09-01-improving-git-protocol-security-github/#no-more-unauthenticated-git" target="_top">disabled unencrypted Git connections</a>, so you may see the following error when running the generate script:</p><pre><code class="programlisting hljs language-undefined" data-highlighted="yes">The unauthenticated git protocol on port 9418 is no longer supported
</code></pre><p>Use the following Git configuration to resolve the issue:</p><pre><code class="programlisting sh hljs language-bash" data-highlighted="yes">git config --global url.<span class="hljs-string">"https://github.com/"</span>.insteadOf git://github.com/
</code></pre>
</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="javascript-tool-specific" class="title">Tool specific instructions   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#javascript-tool-specific" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="javascript-buildNpmPackage" class="title">buildNpmPackage   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#javascript-buildNpmPackage" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><code class="literal">buildNpmPackage</code> allows you to package npm-based projects in Nixpkgs without the use of an auto-generated dependencies file (as used in <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#javascript-node2nix" title="node2nix">node2nix</a>). It works by utilizing npm’s cache functionality – creating a reproducible cache that contains the dependencies of a project, and pointing npm to it.</p><p>Here’s an example:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ lib, buildNpmPackage, fetchFromGitHub }:

buildNpmPackage <span class="hljs-keyword">rec</span> {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"flood"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"4.7.0"</span>;

  <span class="hljs-attr">src</span> = fetchFromGitHub {
    <span class="hljs-attr">owner</span> = <span class="hljs-string">"jesec"</span>;
    <span class="hljs-attr">repo</span> = pname;
    <span class="hljs-attr">rev</span> = <span class="hljs-string">"v<span class="hljs-subst">${version}</span>"</span>;
    <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-BR+ZGkBBfd0dSQqAvujsbgsEPFYw/ThrylxUbOksYxM="</span>;
  };

  <span class="hljs-attr">npmDepsHash</span> = <span class="hljs-string">"sha256-tuEfyePwlOy2/mOPdXbqJskO6IowvAP4DWg8xSZwbJw="</span>;

  <span class="hljs-comment"># The prepack script runs the build script, which we'd rather do in the build phase.</span>
  <span class="hljs-attr">npmPackFlags</span> = [ <span class="hljs-string">"--ignore-scripts"</span> ];

  <span class="hljs-attr">NODE_OPTIONS</span> = <span class="hljs-string">"--openssl-legacy-provider"</span>;

  <span class="hljs-attr">meta</span> = <span class="hljs-keyword">with</span> lib; {
    <span class="hljs-attr">description</span> = <span class="hljs-string">"A modern web UI for various torrent clients with a Node.js backend and React frontend"</span>;
    <span class="hljs-attr">homepage</span> = <span class="hljs-string">"https://flood.js.org"</span>;
    <span class="hljs-attr">license</span> = licenses.gpl3Only;
    <span class="hljs-attr">maintainers</span> = <span class="hljs-keyword">with</span> maintainers; [ winter ];
  };
}
</code></pre><p>In the default <code class="literal">installPhase</code> set by <code class="literal">buildNpmPackage</code>, it uses <code class="literal">npm pack --json --dry-run</code> to decide what files to install in <code class="literal">$out/lib/node_modules/$name/</code>, where <code class="literal">$name</code> is the <code class="literal">name</code> string defined in the package’s <code class="literal">package.json</code>. Additionally, the <code class="literal">bin</code> and <code class="literal">man</code> keys in the source’s <code class="literal">package.json</code> are used to decide what binaries and manpages are supposed to be installed. If these are not defined, <code class="literal">npm pack</code> may miss some files, and no binaries will be produced.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="javascript-buildNpmPackage-arguments" class="title">Arguments   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#javascript-buildNpmPackage-arguments" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">npmDepsHash</code>: The output hash of the dependencies for this project. Can be calculated in advance with <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#javascript-buildNpmPackage-prefetch-npm-deps" title="prefetch-npm-deps"><code class="literal">prefetch-npm-deps</code></a>.</p></li><li class="listitem"><p><code class="literal">makeCacheWritable</code>: Whether to make the cache writable prior to installing dependencies. Don’t set this unless npm tries to write to the cache directory, as it can slow down the build.</p></li><li class="listitem"><p><code class="literal">npmBuildScript</code>: The script to run to build the project. Defaults to <code class="literal">"build"</code>.</p></li><li class="listitem"><p><code class="literal">npmWorkspace</code>: The workspace directory within the project to build and install.</p></li><li class="listitem"><p><code class="literal">dontNpmBuild</code>: Option to disable running the build script. Set to <code class="literal">true</code> if the package does not have a build script. Defaults to <code class="literal">false</code>. Alternatively, setting <code class="literal">buildPhase</code> explicitly also disables this.</p></li><li class="listitem"><p><code class="literal">dontNpmInstall</code>: Option to disable running <code class="literal">npm install</code>. Defaults to <code class="literal">false</code>. Alternatively, setting <code class="literal">installPhase</code> explicitly also disables this.</p></li><li class="listitem"><p><code class="literal">npmFlags</code>: Flags to pass to all npm commands.</p></li><li class="listitem"><p><code class="literal">npmInstallFlags</code>: Flags to pass to <code class="literal">npm ci</code>.</p></li><li class="listitem"><p><code class="literal">npmBuildFlags</code>: Flags to pass to <code class="literal">npm run ${npmBuildScript}</code>.</p></li><li class="listitem"><p><code class="literal">npmPackFlags</code>: Flags to pass to <code class="literal">npm pack</code>.</p></li><li class="listitem"><p><code class="literal">npmPruneFlags</code>: Flags to pass to <code class="literal">npm prune</code>. Defaults to the value of <code class="literal">npmInstallFlags</code>.</p></li><li class="listitem"><p><code class="literal">makeWrapperArgs</code>: Flags to pass to <code class="literal">makeWrapper</code>, added to executable calling the generated <code class="literal">.js</code> with <code class="literal">node</code> as an interpreter. These scripts are defined in <code class="literal">package.json</code>.</p></li><li class="listitem"><p><code class="literal">nodejs</code>: The <code class="literal">nodejs</code> package to build against, using the corresponding <code class="literal">npm</code> shipped with that version of <code class="literal">node</code>. Defaults to <code class="literal">pkgs.nodejs</code>.</p></li><li class="listitem"><p><code class="literal">npmDeps</code>: The dependencies used to build the npm package. Especially useful to not have to recompute workspace depedencies.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="javascript-buildNpmPackage-prefetch-npm-deps" class="title">prefetch-npm-deps   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#javascript-buildNpmPackage-prefetch-npm-deps" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p><code class="literal">prefetch-npm-deps</code> is a Nixpkgs package that calculates the hash of the dependencies of an npm project ahead of time.</p><pre><code class="programlisting console hljs language-shell" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">ls</span></span>
package.json package-lock.json index.js
<span class="hljs-meta prompt_">$ </span><span class="language-bash">prefetch-npm-deps package-lock.json</span>
...
sha256-AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="javascript-buildNpmPackage-fetchNpmDeps" class="title">fetchNpmDeps   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#javascript-buildNpmPackage-fetchNpmDeps" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p><code class="literal">fetchNpmDeps</code> is a Nix function that requires the following mandatory arguments:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">src</code>: A directory / tarball with <code class="literal">package-lock.json</code> file</p></li><li class="listitem"><p><code class="literal">hash</code>: The output hash of the node dependencies defined in <code class="literal">package-lock.json</code>.</p></li></ul></div><p>It returns a derivation with all <code class="literal">package-lock.json</code> dependencies downloaded into <code class="literal">$out/</code>, usable as an npm cache.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="javascript-corepack" class="title">corepack   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#javascript-corepack" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>This package puts the corepack wrappers for pnpm and yarn in your PATH, and they will honor the <code class="literal">packageManager</code> setting in the <code class="literal">package.json</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="javascript-node2nix" class="title">node2nix   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#javascript-node2nix" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="javascript-node2nix-preparation" class="title">Preparation   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#javascript-node2nix-preparation" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>You will need to generate a Nix expression for the dependencies. Don’t forget the <code class="literal">-l package-lock.json</code> if there is a lock file. Most probably you will need the <code class="literal">--development</code> to include the <code class="literal">devDependencies</code></p><p>So the command will most likely be:</p><pre><code class="programlisting sh hljs language-bash" data-highlighted="yes">node2nix --development -l package-lock.json
</code></pre><p>See <code class="literal">node2nix</code> <a class="link" href="https://github.com/svanderburg/node2nix" target="_top">docs</a> for more info.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="javascript-node2nix-pitfalls" class="title">Pitfalls   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#javascript-node2nix-pitfalls" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>If upstream package.json does not have a “version” attribute, <code class="literal">node2nix</code> will crash. You will need to add it like shown in <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#javascript-upstream-package-json" title="Try to use upstream package.json">the package.json section</a>.</p></li><li class="listitem"><p><code class="literal">node2nix</code> has some <a class="link" href="https://github.com/svanderburg/node2nix/issues/238" target="_top">bugs</a> related to working with lock files from NPM distributed with <code class="literal">nodejs_16</code>.</p></li><li class="listitem"><p><code class="literal">node2nix</code> does not like missing packages from NPM. If you see something like <code class="literal">Cannot resolve version: vue-loader-v16@undefined</code> then you might want to try another tool. The package might have been pulled off of NPM.</p></li></ul></div>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="javascript-yarn2nix" class="title">yarn2nix   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#javascript-yarn2nix" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="javascript-yarn2nix-preparation" class="title">Preparation   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#javascript-yarn2nix-preparation" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>You will need at least a <code class="literal">yarn.lock</code> file. If upstream does not have one you need to generate it and reference it in your package definition.</p><p>If the downloaded files contain the <code class="literal">package.json</code> and <code class="literal">yarn.lock</code> files they can be used like this:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">offlineCache</span> = fetchYarnDeps {
  <span class="hljs-attr">yarnLock</span> = src + <span class="hljs-string">"/yarn.lock"</span>;
  <span class="hljs-attr">hash</span> = <span class="hljs-string">"...."</span>;
};
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="javascript-yarn2nix-mkYarnPackage" class="title">mkYarnPackage   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#javascript-yarn2nix-mkYarnPackage" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p><code class="literal">mkYarnPackage</code> will by default try to generate a binary. For package only generating static assets (Svelte, Vue, React, WebPack, …), you will need to explicitly override the build step with your instructions.</p><p>It’s important to use the <code class="literal">--offline</code> flag. For example if you script is <code class="literal">"build": "something"</code> in <code class="literal">package.json</code> use:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">buildPhase</span> = <span class="hljs-string">''
  export HOME=$(mktemp -d)
  yarn --offline build
''</span>;
</code></pre><p>The dist phase is also trying to build a binary, the only way to override it is with:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">distPhase</span> = <span class="hljs-string">"true"</span>;
</code></pre><p>The configure phase can sometimes fail because it makes many assumptions which may not always apply. One common override is:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">configurePhase</span> = <span class="hljs-string">''
  ln -s $node_modules node_modules
''</span>;
</code></pre><p>or if you need a writeable node_modules directory:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">configurePhase</span> = <span class="hljs-string">''
  cp -r $node_modules node_modules
  chmod +w node_modules
''</span>;
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="javascript-yarn2nix-mkYarnModules" class="title">mkYarnModules   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#javascript-yarn2nix-mkYarnModules" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>This will generate a derivation including the <code class="literal">node_modules</code> directory.
If you have to build a derivation for an integrated web framework (rails, phoenix…), this is probably the easiest way.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="javascript-mkYarnPackage-overriding-dependencies" class="title">Overriding dependency behavior   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#javascript-mkYarnPackage-overriding-dependencies" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>In the <code class="literal">mkYarnPackage</code> record the property <code class="literal">pkgConfig</code> can be used to override packages when you encounter problems building.</p><p>For instance, say your package is throwing errors when trying to invoke node-sass:</p><pre><code class="programlisting hljs language-bash" data-highlighted="yes">ENOENT: no such file or directory, scandir <span class="hljs-string">'/build/source/node_modules/node-sass/vendor'</span>
</code></pre><p>To fix this we will specify different versions of build inputs to use, as well as some post install steps to get the software built the way we want:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">mkYarnPackage <span class="hljs-keyword">rec</span> {
  <span class="hljs-attr">pkgConfig</span> = {
    <span class="hljs-attr">node-sass</span> = {
      <span class="hljs-attr">buildInputs</span> = <span class="hljs-keyword">with</span> final;[ python libsass pkg-config ];
      <span class="hljs-attr">postInstall</span> = <span class="hljs-string">''
        LIBSASS_EXT=auto yarn --offline run build
        rm build/config.gypi
      ''</span>;
    };
  };
}
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="javascript-yarn2nix-pitfalls" class="title">Pitfalls   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#javascript-yarn2nix-pitfalls" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>If version is missing from upstream package.json, yarn will silently install nothing. In that case, you will need to override package.json as shown in the <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#javascript-upstream-package-json" title="Try to use upstream package.json">package.json section</a></p></li><li class="listitem"><p>Having trouble with <code class="literal">node-gyp</code>? Try adding these lines to the <code class="literal">yarnPreBuild</code> steps:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">yarnPreBuild</span> = <span class="hljs-string">''
  mkdir -p $HOME/.node-gyp/<span class="hljs-subst">${nodejs.version}</span>
  echo 9 &gt; $HOME/.node-gyp/<span class="hljs-subst">${nodejs.version}</span>/installVersion
  ln -sfv <span class="hljs-subst">${nodejs}</span>/include $HOME/.node-gyp/<span class="hljs-subst">${nodejs.version}</span>
  export npm_config_nodedir=<span class="hljs-subst">${nodejs}</span>
''</span>;
</code></pre><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>The <code class="literal">echo 9</code> steps comes from this answer: <a class="link" href="https://stackoverflow.com/a/49139496" target="_top">https://stackoverflow.com/a/49139496</a></p></li><li class="listitem"><p>Exporting the headers in <code class="literal">npm_config_nodedir</code> comes from this issue: <a class="link" href="https://github.com/nodejs/node-gyp/issues/1191#issuecomment-301243919" target="_top">https://github.com/nodejs/node-gyp/issues/1191#issuecomment-301243919</a></p></li></ul></div></li></ul></div>
</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="javascript-outside-nixpkgs" class="title">Outside Nixpkgs   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#javascript-outside-nixpkgs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>There are some other tools available, which are written in the Nix language.
These that can’t be used inside Nixpkgs because they require <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ssec-import-from-derivation" title="Import From Derivation">Import From Derivation</a>, which is not allowed in Nixpkgs.</p><p>If you are packaging something outside Nixpkgs, consider the following:</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="javascript-npmlock2nix" class="title">npmlock2nix   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#javascript-npmlock2nix" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><a class="link" href="https://github.com/nix-community/npmlock2nix" target="_top">npmlock2nix</a> aims at building <code class="literal">node_modules</code> without code generation. It hasn’t reached v1 yet, the API might be subject to change.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="javascript-npmlock2nix-pitfalls" class="title">Pitfalls   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#javascript-npmlock2nix-pitfalls" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>There are some <a class="link" href="https://github.com/tweag/npmlock2nix/issues/45" target="_top">problems with npm v7</a>.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="javascript-nix-npm-buildpackage" class="title">nix-npm-buildpackage   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#javascript-nix-npm-buildpackage" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><a class="link" href="https://github.com/serokell/nix-npm-buildpackage" target="_top">nix-npm-buildpackage</a> aims at building <code class="literal">node_modules</code> without code generation. It hasn’t reached v1 yet, the API might change. It supports both <code class="literal">package-lock.json</code> and yarn.lock.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="javascript-nix-npm-buildpackage-pitfalls" class="title">Pitfalls   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#javascript-nix-npm-buildpackage-pitfalls" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>There are some <a class="link" href="https://github.com/serokell/nix-npm-buildpackage/issues/33" target="_top">problems with npm v7</a>.</p>
</div>

</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="lisp" class="title" style="clear: both">lisp-modules   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#lisp" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#lisp-overview">Overview</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#lisp-use-case-example">The 90% use case example</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#lisp-importing-packages-from-quicklisp">Importing packages from Quicklisp</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#lisp-defining-packages-inside">Defining packages manually inside Nixpkgs</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#lisp-defining-packages-outside">Defining packages manually outside Nixpkgs</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#lisp-overriding-package-attributes">Overriding package attributes</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#lisp-building-wrappers">Building Wrappers</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#lisp-adding-a-new-lisp">Adding a new Lisp</a> </span></dt> </dl></div><p>This document describes the Nixpkgs infrastructure for building Common Lisp
systems that use <a class="link" href="https://asdf.common-lisp.dev/" target="_top">ASDF</a> (Another System
Definition Facility). It lives in <code class="literal">pkgs/development/lisp-modules</code>.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="lisp-overview" class="title">Overview   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#lisp-overview" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The main entry point of the API are the Common Lisp implementation packages
themselves (e.g. <code class="literal">abcl</code>, <code class="literal">ccl</code>, <code class="literal">clasp-common-lisp</code>, <code class="literal">clisp</code>, <code class="literal">ecl</code>,
<code class="literal">sbcl</code>). They have the <code class="literal">pkgs</code> and <code class="literal">withPackages</code> attributes, which can be used
to discover available packages and to build wrappers, respectively.</p><p>The <code class="literal">pkgs</code> attribute set contains packages that were automatically
<a class="link" href="https://nixos.org/manual/nixpkgs/stable/#lisp-importing-packages-from-quicklisp" title="Importing packages from Quicklisp">imported</a> from Quicklisp, and any
other <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#lisp-defining-packages-inside" title="Defining packages manually inside Nixpkgs">manually defined</a> ones. Not every package
works for all the CL implementations (e.g. <code class="literal">nyxt</code> only makes sense for <code class="literal">sbcl</code>).</p><p>The <code class="literal">withPackages</code> function is of primary utility. It is used to build
<a class="link" href="https://nixos.org/manual/nixpkgs/stable/#lisp-building-wrappers" title="Building Wrappers">runnable wrappers</a>, with a pinned and pre-built
<a class="link" href="https://nixos.org/manual/nixpkgs/stable/#lisp-loading-asdf" title="Loading ASDF">ASDF FASL</a> available in the <code class="literal">ASDF</code> environment variable,
and <code class="literal">CL_SOURCE_REGISTRY</code>/<code class="literal">ASDF_OUTPUT_TRANSLATIONS</code> configured to
<a class="link" href="https://nixos.org/manual/nixpkgs/stable/#lisp-loading-systems" title="Loading systems">find the desired systems on runtime</a>.</p><p>In addition, Lisps have the <code class="literal">withOverrides</code> function, which can be used to
<a class="link" href="https://nixos.org/manual/nixpkgs/stable/#lisp-including-external-pkg-in-scope" title="Including an external package in scope">substitute</a> any package in the scope of
their <code class="literal">pkgs</code>. This will also be useful together with <code class="literal">overrideLispAttrs</code> when
<a class="link" href="https://nixos.org/manual/nixpkgs/stable/#lisp-dealing-with-slashy-systems" title="Dealing with slashy systems">dealing with slashy systems</a>, because they
should stay in the main package and be built by specifying the <code class="literal">systems</code>
argument to <code class="literal">build-asdf-system</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="lisp-use-case-example" class="title">The 90% use case example   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#lisp-use-case-example" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The most common way to use the library is to run ad-hoc wrappers like this:</p><p><code class="literal">nix-shell -p 'sbcl.withPackages (ps: with ps; [ alexandria ])'</code></p><p>Then, in a shell:</p><pre><code class="programlisting hljs language-bash" data-highlighted="yes">$ sbcl
* (load (sb-ext:posix-getenv <span class="hljs-string">"ASDF"</span>))
* (asdf:load-system <span class="hljs-string">'alexandria)
</span></code></pre><p>Also one can create a <code class="literal">pkgs.mkShell</code> environment in <code class="literal">shell.nix</code>/<code class="literal">flake.nix</code>:</p><pre><code class="programlisting hljs language-bash" data-highlighted="yes"><span class="hljs-built_in">let</span>
  sbcl<span class="hljs-string">' = sbcl.withPackages (ps: [ ps.alexandria ]);
in mkShell {
  packages = [ sbcl'</span> ];
}
</code></pre><p>Such a Lisp can be now used e.g. to compile your sources:</p><pre><code class="programlisting hljs language-bash" data-highlighted="yes">buildPhase = <span class="hljs-string">''</span>
  <span class="hljs-variable">${sbcl'}</span>/bin/sbcl --load my-build-file.lisp
<span class="hljs-string">''</span>
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="lisp-importing-packages-from-quicklisp" class="title">Importing packages from Quicklisp   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#lisp-importing-packages-from-quicklisp" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>To save some work of writing Nix expressions, there is a script that imports all
the packages distributed by Quicklisp into <code class="literal">imported.nix</code>. This works by parsing
its <code class="literal">releases.txt</code> and <code class="literal">systems.txt</code> files, which are published every couple of
months on <a class="link" href="https://beta.quicklisp.org/dist/quicklisp.txt" target="_top">quicklisp.org</a>.</p><p>The import process is implemented in the <code class="literal">import</code> directory as Common Lisp
code in the <code class="literal">org.lispbuilds.nix</code> ASDF system. To run the script, one can
execute <code class="literal">ql-import.lisp</code>:</p><pre><code class="programlisting hljs language-bash" data-highlighted="yes"><span class="hljs-built_in">cd</span> pkgs/development/lisp-modules
nix-shell --run <span class="hljs-string">'sbcl --script ql-import.lisp'</span>
</code></pre><p>The script will:</p><div class="orderedlist"><ol class="orderedlist compact" type="1"><li class="listitem"><p>Download the latest Quicklisp <code class="literal">systems.txt</code> and <code class="literal">releases.txt</code> files</p></li><li class="listitem"><p>Generate a temporary SQLite database of all QL systems in <code class="literal">packages.sqlite</code></p></li><li class="listitem"><p>Generate an <code class="literal">imported.nix</code> file from the database</p></li></ol></div><p>(The <code class="literal">packages.sqlite</code> file can be deleted at will, because it is regenerated
each time the script runs.)</p><p>The maintainer’s job is to:</p><div class="orderedlist"><ol class="orderedlist compact" type="1"><li class="listitem"><p>Re-run the <code class="literal">ql-import.lisp</code> script when there is a new Quicklisp release</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/stable/#lisp-quicklisp-adding-native-dependencies" title="Adding native dependencies">Add any missing native dependencies</a> in <code class="literal">ql.nix</code></p></li><li class="listitem"><p>For packages that still don’t build, <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#lisp-defining-packages-inside" title="Defining packages manually inside Nixpkgs">package them manually</a> in <code class="literal">packages.nix</code></p></li></ol></div><p>Also, the <code class="literal">imported.nix</code> file <span class="strong"><strong>must not be edited manually</strong></span>! It should only be
generated as described in this section (by running <code class="literal">ql-import.lisp</code>).</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="lisp-quicklisp-adding-native-dependencies" class="title">Adding native dependencies   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#lisp-quicklisp-adding-native-dependencies" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>The Quicklisp files contain ASDF dependency data, but don’t include native
library (CFFI) dependencies, and, in the case of ABCL, Java dependencies.</p><p>The <code class="literal">ql.nix</code> file contains a long list of overrides, where these dependencies
can be added.</p><p>Packages defined in <code class="literal">packages.nix</code> contain these dependencies naturally.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="lisp-quicklisp-trusting" class="title">Trusting <code class="literal">systems.txt</code> and <code class="literal">releases.txt</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#lisp-quicklisp-trusting" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>The previous implementation of <code class="literal">lisp-modules</code> didn’t fully trust the Quicklisp
data, because there were times where the dependencies specified were not
complete and caused broken builds. It instead used a <code class="literal">nix-shell</code> environment to
discover real dependencies by using the ASDF APIs.</p><p>The current implementation has chosen to trust this data, because it’s faster to
parse a text file than to build each system to generate its Nix file, and
because that way packages can be mass-imported. Because of that, there may come
a day where some packages will break, due to bugs in Quicklisp. In that case,
the fix could be a manual override in <code class="literal">packages.nix</code> and <code class="literal">ql.nix</code>.</p><p>A known fact is that Quicklisp doesn’t include dependencies on slashy systems in
its data. This is an example of a situation where such fixes were used, e.g. to
replace the <code class="literal">systems</code> attribute of the affected packages. (See the definition of
<code class="literal">iolib</code>).</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="lisp-quicklisp-quirks" class="title">Quirks   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#lisp-quicklisp-quirks" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>During Quicklisp import:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">+</code> in names is converted to <code class="literal">_plus{_,}</code>: <code class="literal">cl+ssl</code>-&gt;<code class="literal">cl_plus_ssl</code>, <code class="literal">alexandria+</code>-&gt;<code class="literal">alexandria_plus</code></p></li><li class="listitem"><p><code class="literal">.</code> in names is converted to <code class="literal">_dot_</code>: <code class="literal">iolib.base</code>-&gt;<code class="literal">iolib_dot_base</code></p></li><li class="listitem"><p>names starting with a number have a <code class="literal">_</code> prepended (<code class="literal">3d-vectors</code>-&gt;<code class="literal">_3d-vectors</code>)</p></li><li class="listitem"><p><code class="literal">_</code> in names is converted to <code class="literal">__</code> for reversibility</p></li></ul></div>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="lisp-defining-packages-inside" class="title">Defining packages manually inside Nixpkgs   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#lisp-defining-packages-inside" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Packages that for some reason are not in Quicklisp, and so cannot be
auto-imported, or don’t work straight from the import, are defined in the
<code class="literal">packages.nix</code> file.</p><p>In that file, use the <code class="literal">build-asdf-system</code> function, which is a wrapper around
<code class="literal">mkDerivation</code> for building ASDF systems. Various other hacks are present, such
as <code class="literal">build-with-compile-into-pwd</code> for systems which create files during
compilation (such as cl-unicode).</p><p>The <code class="literal">build-asdf-system</code> function is documented
<a class="link" href="https://nixos.org/manual/nixpkgs/stable/#lisp-defining-packages-outside" title="Defining packages manually outside Nixpkgs">here</a>. Also, <code class="literal">packages.nix</code> is full of
examples of how to use it.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="lisp-defining-packages-outside" class="title">Defining packages manually outside Nixpkgs   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#lisp-defining-packages-outside" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Lisp derivations (<code class="literal">abcl</code>, <code class="literal">sbcl</code> etc.) also export the <code class="literal">buildASDFSystem</code>
function, which is similar to <code class="literal">build-asdf-system</code> from <code class="literal">packages.nix</code>, but is
part of the public API.</p><p>It takes the following arguments:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">pname</code>: the package name</p></li><li class="listitem"><p><code class="literal">version</code>: the package version</p></li><li class="listitem"><p><code class="literal">src</code>: the package source</p></li><li class="listitem"><p><code class="literal">patches</code>: patches to apply to the source before build</p></li><li class="listitem"><p><code class="literal">nativeLibs</code>: native libraries used by CFFI and grovelling</p></li><li class="listitem"><p><code class="literal">javaLibs</code>: Java libraries for ABCL</p></li><li class="listitem"><p><code class="literal">lispLibs</code>: dependencies on other packages build with <code class="literal">buildASDFSystem</code></p></li><li class="listitem"><p><code class="literal">systems</code>: list of systems to build</p></li></ul></div><p>It can be used to define packages outside Nixpkgs, and, for example, add them
into the package scope with <code class="literal">withOverrides</code>.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="lisp-including-external-pkg-in-scope" class="title">Including an external package in scope   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#lisp-including-external-pkg-in-scope" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>A package defined outside Nixpkgs using <code class="literal">buildASDFSystem</code> can be woven into the
Nixpkgs-provided scope like this:</p><pre><code class="programlisting hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">let</span>
  <span class="hljs-attr">alexandria</span> = sbcl.buildASDFSystem <span class="hljs-keyword">rec</span> {
    <span class="hljs-attr">pname</span> = <span class="hljs-string">"alexandria"</span>;
    <span class="hljs-attr">version</span> = <span class="hljs-string">"1.4"</span>;
    <span class="hljs-attr">src</span> = fetchFromGitLab {
      <span class="hljs-attr">domain</span> = <span class="hljs-string">"gitlab.common-lisp.net"</span>;
      <span class="hljs-attr">owner</span> = <span class="hljs-string">"alexandria"</span>;
      <span class="hljs-attr">repo</span> = <span class="hljs-string">"alexandria"</span>;
      <span class="hljs-attr">rev</span> = <span class="hljs-string">"v<span class="hljs-subst">${version}</span>"</span>;
      <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-1Hzxt65dZvgOFIljjjlSGgKYkj+YBLwJCACi5DZsKmQ="</span>;
    };
  };
  sbcl' = sbcl.withOverrides (self: super: {
    <span class="hljs-keyword">inherit</span> alexandria;
  });
<span class="hljs-keyword">in</span> sbcl'.pkgs.alexandria
</code></pre>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="lisp-overriding-package-attributes" class="title">Overriding package attributes   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#lisp-overriding-package-attributes" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Packages export the <code class="literal">overrideLispAttrs</code> function, which can be used to build a
new package with different parameters.</p><p>Example of overriding <code class="literal">alexandria</code>:</p><pre><code class="programlisting hljs language-nix" data-highlighted="yes">sbcl.pkgs.alexandria.overrideLispAttrs (oldAttrs: <span class="hljs-keyword">rec</span> {
  <span class="hljs-attr">version</span> = <span class="hljs-string">"1.4"</span>;
  <span class="hljs-attr">src</span> = fetchFromGitLab {
    <span class="hljs-attr">domain</span> = <span class="hljs-string">"gitlab.common-lisp.net"</span>;
    <span class="hljs-attr">owner</span> = <span class="hljs-string">"alexandria"</span>;
    <span class="hljs-attr">repo</span> = <span class="hljs-string">"alexandria"</span>;
    <span class="hljs-attr">rev</span> = <span class="hljs-string">"v<span class="hljs-subst">${version}</span>"</span>;
    <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-1Hzxt65dZvgOFIljjjlSGgKYkj+YBLwJCACi5DZsKmQ="</span>;
  };
})
</code></pre><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="lisp-dealing-with-slashy-systems" class="title">Dealing with slashy systems   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#lisp-dealing-with-slashy-systems" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Slashy (secondary) systems should not exist in their own packages! Instead, they
should be included in the parent package as an extra entry in the <code class="literal">systems</code>
argument to the <code class="literal">build-asdf-system</code>/<code class="literal">buildASDFSystem</code> functions.</p><p>The reason is that ASDF searches for a secondary system in the <code class="literal">.asd</code> of the
parent package. Thus, having them separate would cause either one of them not to
load cleanly, because one will contains FASLs of itself but not the other, and
vice versa.</p><p>To package slashy systems, use <code class="literal">overrideLispAttrs</code>, like so:</p><pre><code class="programlisting hljs language-nix" data-highlighted="yes">ecl.pkgs.alexandria.overrideLispAttrs (oldAttrs: {
  <span class="hljs-attr">systems</span> = oldAttrs.systems ++ [ <span class="hljs-string">"alexandria/tests"</span> ];
  <span class="hljs-attr">lispLibs</span> = oldAttrs.lispLibs ++ [ ecl.pkgs.rt ];
})
</code></pre><p>See the <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#lisp-including-external-pkg-in-scope" title="Including an external package in scope">respective section</a> on using
<code class="literal">withOverrides</code> for how to weave it back into <code class="literal">ecl.pkgs</code>.</p><p>Note that sometimes the slashy systems might not only have more dependencies
than the main one, but create a circular dependency between <code class="literal">.asd</code>
files. Unfortunately, in this case an adhoc solution becomes necessary.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="lisp-building-wrappers" class="title">Building Wrappers   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#lisp-building-wrappers" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Wrappers can be built using the <code class="literal">withPackages</code> function of Common Lisp
implementations (<code class="literal">abcl</code>, <code class="literal">ecl</code>, <code class="literal">sbcl</code> etc.):</p><pre><code class="programlisting hljs language-bash" data-highlighted="yes">nix-shell -p <span class="hljs-string">'sbcl.withPackages (ps: [ ps.alexandria ps.bordeaux-threads ])'</span>
</code></pre><p>Such a wrapper can then be used like this:</p><pre><code class="programlisting hljs language-bash" data-highlighted="yes">$ sbcl
* (load (sb-ext:posix-getenv <span class="hljs-string">"ASDF"</span>))
* (asdf:load-system <span class="hljs-string">'alexandria)
* (asdf:load-system '</span>bordeaux-threads)
</code></pre><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="lisp-loading-asdf" class="title">Loading ASDF   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#lisp-loading-asdf" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>For best results, avoid calling <code class="literal">(require 'asdf)</code> When using the
library-generated wrappers.</p><p>Use <code class="literal">(load (ext:getenv "ASDF"))</code> instead, supplying your implementation’s way of
getting an environment variable for <code class="literal">ext:getenv</code>. This will load the
(pre-compiled to FASL) Nixpkgs-provided version of ASDF.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="lisp-loading-systems" class="title">Loading systems   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#lisp-loading-systems" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>There, you can use <code class="literal">asdf:load-system</code>. This works by setting the right
values for the <code class="literal">CL_SOURCE_REGISTRY</code>/<code class="literal">ASDF_OUTPUT_TRANSLATIONS</code> environment
variables, so that systems are found in the Nix store and pre-compiled FASLs are
loaded.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="lisp-adding-a-new-lisp" class="title">Adding a new Lisp   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#lisp-adding-a-new-lisp" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The function <code class="literal">wrapLisp</code> is used to wrap Common Lisp implementations. It adds the
<code class="literal">pkgs</code>, <code class="literal">withPackages</code>, <code class="literal">withOverrides</code> and <code class="literal">buildASDFSystem</code> attributes to the
derivation.</p><p><code class="literal">wrapLisp</code> takes these arguments:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">pkg</code>: the Lisp package</p></li><li class="listitem"><p><code class="literal">faslExt</code>: Implementation-specific extension for FASL files</p></li><li class="listitem"><p><code class="literal">program</code>: The name of executable file in <code class="literal">${pkg}/bin/</code> (Default: <code class="literal">pkg.pname</code>)</p></li><li class="listitem"><p><code class="literal">flags</code>: A list of flags to always pass to <code class="literal">program</code> (Default: <code class="literal">[]</code>)</p></li><li class="listitem"><p><code class="literal">asdf</code>: The ASDF version to use (Default: <code class="literal">pkgs.asdf_3_3</code>)</p></li><li class="listitem"><p><code class="literal">packageOverrides</code>: Package overrides config (Default: <code class="literal">(self: super: {})</code>)</p></li></ul></div><p>This example wraps CLISP:</p><pre><code class="programlisting hljs language-nix" data-highlighted="yes">wrapLisp {
  <span class="hljs-attr">pkg</span> = clisp;
  <span class="hljs-attr">faslExt</span> = <span class="hljs-string">"fas"</span>;
  <span class="hljs-attr">flags</span> = [<span class="hljs-string">"-E"</span> <span class="hljs-string">"UTF8"</span>];
}
</code></pre>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="users-guide-to-lua-infrastructure" class="title" style="clear: both">User’s Guide to Lua Infrastructure   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#users-guide-to-lua-infrastructure" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#using-lua">Using Lua</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#developing-with-lua">Developing with Lua</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#lua-reference">Lua Reference</a> </span></dt> </dl></div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="using-lua" class="title">Using Lua   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#using-lua" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="overview-of-lua" class="title">Overview of Lua   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#overview-of-lua" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Several versions of the Lua interpreter are available: luajit, lua 5.1, 5.2, 5.3.
The attribute <code class="literal">lua</code> refers to the default interpreter, it is also possible to refer to specific versions, e.g. <code class="literal">lua5_2</code> refers to Lua 5.2.</p><p>Lua libraries are in separate sets, with one set per interpreter version.</p><p>The interpreters have several common attributes. One of these attributes is
<code class="literal">pkgs</code>, which is a package set of Lua libraries for this specific
interpreter. E.g., the <code class="literal">busted</code> package corresponding to the default interpreter
is <code class="literal">lua.pkgs.busted</code>, and the lua 5.2 version is <code class="literal">lua5_2.pkgs.busted</code>.
The main package set contains aliases to these package sets, e.g.
<code class="literal">luaPackages</code> refers to <code class="literal">lua5_1.pkgs</code> and <code class="literal">lua52Packages</code> to
<code class="literal">lua5_2.pkgs</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="installing-lua-and-packages" class="title">Installing Lua and packages   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#installing-lua-and-packages" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="lua-environment-defined-in-separate-.nix-file" class="title">Lua environment defined in separate <code class="literal">.nix</code> file   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#lua-environment-defined-in-separate-.nix-file" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Create a file, e.g. <code class="literal">build.nix</code>, with the following expression</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">with</span> <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {};

lua5_2.withPackages (ps: <span class="hljs-keyword">with</span> ps; [ busted luafilesystem ])
</code></pre><p>and install it in your profile with</p><pre><code class="programlisting shell hljs language-shell" data-highlighted="yes">nix-env -if build.nix
</code></pre><p>Now you can use the Lua interpreter, as well as the extra packages (<code class="literal">busted</code>,
<code class="literal">luafilesystem</code>) that you added to the environment.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="lua-environment-defined-in-.confignixpkgsconfig.nix" class="title">Lua environment defined in <code class="literal">~/.config/nixpkgs/config.nix</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#lua-environment-defined-in-.confignixpkgsconfig.nix" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>If you prefer to, you could also add the environment as a package override to the Nixpkgs set, e.g.
using <code class="literal">config.nix</code>,</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ <span class="hljs-comment"># ...</span>

  <span class="hljs-attr">packageOverrides</span> = pkgs: <span class="hljs-keyword">with</span> pkgs; {
    <span class="hljs-attr">myLuaEnv</span> = lua5_2.withPackages (ps: <span class="hljs-keyword">with</span> ps; [ busted luafilesystem ]);
  };
}
</code></pre><p>and install it in your profile with</p><pre><code class="programlisting shell hljs language-shell" data-highlighted="yes">nix-env -iA nixpkgs.myLuaEnv
</code></pre><p>The environment is installed by referring to the attribute, and considering
the <code class="literal">nixpkgs</code> channel was used.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="lua-environment-defined-in-etcnixosconfiguration.nix" class="title">Lua environment defined in <code class="literal">/etc/nixos/configuration.nix</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#lua-environment-defined-in-etcnixosconfiguration.nix" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>For the sake of completeness, here’s another example how to install the environment system-wide.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ <span class="hljs-comment"># ...</span>

  environment.<span class="hljs-attr">systemPackages</span> = <span class="hljs-keyword">with</span> pkgs; [
    (lua.withPackages(ps: <span class="hljs-keyword">with</span> ps; [ busted luafilesystem ]))
  ];
}
</code></pre>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="how-to-override-a-lua-package-using-overlays" class="title">How to override a Lua package using overlays?   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#how-to-override-a-lua-package-using-overlays" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Use the following overlay template:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">final: prev:
{

  <span class="hljs-attr">lua</span> = prev.lua.override {
    <span class="hljs-attr">packageOverrides</span> = luaself: luaprev: {

      <span class="hljs-attr">luarocks-nix</span> = luaprev.luarocks-nix.overrideAttrs(oa: {
        <span class="hljs-attr">pname</span> = <span class="hljs-string">"luarocks-nix"</span>;
        <span class="hljs-attr">src</span> = /home/my_luarocks/repository;
      });
  };

  <span class="hljs-attr">luaPackages</span> = lua.pkgs;
}
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="temporary-lua-environment-with-nix-shell" class="title">Temporary Lua environment with <code class="literal">nix-shell</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#temporary-lua-environment-with-nix-shell" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>There are two methods for loading a shell with Lua packages. The first and recommended method
is to create an environment with <code class="literal">lua.buildEnv</code> or <code class="literal">lua.withPackages</code> and load that. E.g.</p><pre><code class="programlisting sh hljs language-bash" data-highlighted="yes">$ nix-shell -p <span class="hljs-string">'lua.withPackages(ps: with ps; [ busted luafilesystem ])'</span>
</code></pre><p>opens a shell from which you can launch the interpreter</p><pre><code class="programlisting sh hljs language-bash" data-highlighted="yes">[nix-shell:~] lua
</code></pre><p>The other method, which is not recommended, does not create an environment and requires you to list the packages directly,</p><pre><code class="programlisting sh hljs language-bash" data-highlighted="yes">$ nix-shell -p lua.pkgs.busted lua.pkgs.luafilesystem
</code></pre><p>Again, it is possible to launch the interpreter from the shell.
The Lua interpreter has the attribute <code class="literal">pkgs</code> which contains all Lua libraries for that specific interpreter.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="developing-with-lua" class="title">Developing with Lua   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#developing-with-lua" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Now that you know how to get a working Lua environment with Nix, it is time
to go forward and start actually developing with Lua. There are two ways to
package lua software, either it is on luarocks and most of it can be taken care
of by the luarocks2nix converter or the packaging has to be done manually.
Let’s present the luarocks way first and the manual one in a second time.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="packaging-a-library-on-luarocks" class="title">Packaging a library on luarocks   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#packaging-a-library-on-luarocks" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><a class="link" href="https://luarocks.org/" target="_top">Luarocks.org</a> is the main repository of lua packages.
The site proposes two types of packages, the <code class="literal">rockspec</code> and the <code class="literal">src.rock</code>
(equivalent of a <a class="link" href="https://github.com/luarocks/luarocks/wiki/Rockspec-format" target="_top">rockspec</a> but with the source).</p><p>Luarocks-based packages are generated in <a class="link" href="https://github.com/NixOS/nixpkgs/tree/master/pkgs/development/lua-modules/generated-packages.nix" target="_top">pkgs/development/lua-modules/generated-packages.nix</a> from
the whitelist maintainers/scripts/luarocks-packages.csv and updated by running
the package <code class="literal">luarocks-packages-updater</code>:</p><pre><code class="programlisting sh hljs language-bash" data-highlighted="yes">
nix-shell -p luarocks-packages-updater --run luarocks-packages-updater
</code></pre><p><a class="link" href="https://github.com/nix-community/luarocks" target="_top">luarocks2nix</a> is a tool capable of generating nix derivations from both rockspec and src.rock (and favors the src.rock).
The automation only goes so far though and some packages need to be customized.
These customizations go in <a class="link" href="https://github.com/NixOS/nixpkgs/tree/master/pkgs/development/lua-modules/overrides.nix" target="_top">pkgs/development/lua-modules/overrides.nix</a>.
For instance if the rockspec defines <code class="literal">external_dependencies</code>, these need to be manually added to the overrides.nix.</p><p>You can try converting luarocks packages to nix packages with the command <code class="literal">nix-shell -p luarocks-nix</code> and then <code class="literal">luarocks nix PKG_NAME</code>.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="packaging-a-library-manually" class="title">Packaging a library manually   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#packaging-a-library-manually" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>You can develop your package as you usually would, just don’t forget to wrap it
within a <code class="literal">toLuaModule</code> call, for instance</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">mynewlib</span> = toLuaModule ( stdenv.mkDerivation { ... });
</code></pre><p>There is also the <code class="literal">buildLuaPackage</code> function that can be used when lua modules
are not packaged for luarocks. You can see a few examples at <code class="literal">pkgs/top-level/lua-packages.nix</code>.</p>
</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="lua-reference" class="title">Lua Reference   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#lua-reference" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="lua-interpreters" class="title">Lua interpreters   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#lua-interpreters" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Versions 5.1, 5.2, 5.3 and 5.4 of the lua interpreter are available as
respectively <code class="literal">lua5_1</code>, <code class="literal">lua5_2</code>, <code class="literal">lua5_3</code> and <code class="literal">lua5_4</code>. Luajit is available too.
The Nix expressions for the interpreters can be found in <code class="literal">pkgs/development/interpreters/lua-5</code>.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="attributes-on-lua-interpreters-packages" class="title">Attributes on lua interpreters packages   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#attributes-on-lua-interpreters-packages" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Each interpreter has the following attributes:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">interpreter</code>. Alias for <code class="literal">${pkgs.lua}/bin/lua</code>.</p></li><li class="listitem"><p><code class="literal">buildEnv</code>. Function to build lua interpreter environments with extra packages bundled together. See section <span class="emphasis"><em>lua.buildEnv function</em></span> for usage and documentation.</p></li><li class="listitem"><p><code class="literal">withPackages</code>. Simpler interface to <code class="literal">buildEnv</code>.</p></li><li class="listitem"><p><code class="literal">pkgs</code>. Set of Lua packages for that specific interpreter. The package set can be modified by overriding the interpreter and passing <code class="literal">packageOverrides</code>.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="buildluarockspackage-function" class="title"><code class="literal">buildLuarocksPackage</code> function   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#buildluarockspackage-function" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>The <code class="literal">buildLuarocksPackage</code> function is implemented in <code class="literal">pkgs/development/interpreters/lua-5/build-luarocks-package.nix</code>
The following is an example:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">luaposix</span> = buildLuarocksPackage {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"luaposix"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"34.0.4-1"</span>;

  <span class="hljs-attr">src</span> = fetchurl {
    <span class="hljs-attr">url</span>    = <span class="hljs-string">"https://raw.githubusercontent.com/rocks-moonscript-org/moonrocks-mirror/master/luaposix-34.0.4-1.src.rock"</span>;
    <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-4mLJG8n4m6y4Fqd0meUDfsOb9RHSR0qa/KD5KCwrNXs="</span>;
  };
  <span class="hljs-attr">disabled</span> = (luaOlder <span class="hljs-string">"5.1"</span>) || (luaAtLeast <span class="hljs-string">"5.4"</span>);
  <span class="hljs-attr">propagatedBuildInputs</span> = [ bit32 lua std_normalize ];

  <span class="hljs-attr">meta</span> = <span class="hljs-keyword">with</span> lib; {
    <span class="hljs-attr">homepage</span> = <span class="hljs-string">"https://github.com/luaposix/luaposix/"</span>;
    <span class="hljs-attr">description</span> = <span class="hljs-string">"Lua bindings for POSIX"</span>;
    <span class="hljs-attr">maintainers</span> = <span class="hljs-keyword">with</span> maintainers; [ vyp lblasc ];
    license.<span class="hljs-attr">fullName</span> = <span class="hljs-string">"MIT/X11"</span>;
  };
};
</code></pre><p>The <code class="literal">buildLuarocksPackage</code> delegates most tasks to luarocks:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>it adds <code class="literal">luarocks</code> as an unpacker for <code class="literal">src.rock</code> files (zip files really).</p></li><li class="listitem"><p><code class="literal">configurePhase</code> writes a temporary luarocks configuration file which location
is exported via the environment variable <code class="literal">LUAROCKS_CONFIG</code>.</p></li><li class="listitem"><p>the <code class="literal">buildPhase</code> does nothing.</p></li><li class="listitem"><p><code class="literal">installPhase</code> calls <code class="literal">luarocks make --deps-mode=none --tree $out</code> to build and
install the package</p></li><li class="listitem"><p>In the <code class="literal">postFixup</code> phase, the <code class="literal">wrapLuaPrograms</code> bash function is called to
wrap all programs in the <code class="literal">$out/bin/*</code> directory to include <code class="literal">$PATH</code>
environment variable and add dependent libraries to script’s <code class="literal">LUA_PATH</code> and
<code class="literal">LUA_CPATH</code>.</p></li></ul></div><p>By default <code class="literal">meta.platforms</code> is set to the same value as the interpreter unless overridden otherwise.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="buildluaapplication-function" class="title"><code class="literal">buildLuaApplication</code> function   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#buildluaapplication-function" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>The <code class="literal">buildLuaApplication</code> function is practically the same as <code class="literal">buildLuaPackage</code>.
The difference is that <code class="literal">buildLuaPackage</code> by default prefixes the names of the packages with the version of the interpreter.
Because with an application we’re not interested in multiple version the prefix is dropped.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="lua.withpackages-function" class="title">lua.withPackages function   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#lua.withpackages-function" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>The <code class="literal">lua.withPackages</code> takes a function as an argument that is passed the set of lua packages and returns the list of packages to be included in the environment.
Using the <code class="literal">withPackages</code> function, the previous example for the luafilesystem environment can be written like this:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">with</span> <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {};

lua.withPackages (ps: [ps.luafilesystem])
</code></pre><p><code class="literal">withPackages</code> passes the correct package set for the specific interpreter version as an argument to the function. In the above example, <code class="literal">ps</code> equals <code class="literal">luaPackages</code>.
But you can also easily switch to using <code class="literal">lua5_2</code>:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">with</span> <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {};

lua5_2.withPackages (ps: [ps.lua])
</code></pre><p>Now, <code class="literal">ps</code> is set to <code class="literal">lua52Packages</code>, matching the version of the interpreter.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="possible-todos" class="title">Possible Todos   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#possible-todos" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>export/use version specific variables such as <code class="literal">LUA_PATH_5_2</code>/<code class="literal">LUAROCKS_CONFIG_5_2</code></p></li><li class="listitem"><p>let luarocks check for dependencies via exporting the different rocktrees in temporary config</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="lua-contributing-guidelines" class="title">Lua Contributing guidelines   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#lua-contributing-guidelines" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Following rules should be respected:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>Make sure libraries build for all Lua interpreters.</p></li><li class="listitem"><p>Commit names of Lua libraries should reflect that they are Lua libraries, so write for example <code class="literal">luaPackages.luafilesystem: 1.11 -&gt; 1.12</code>.</p></li></ul></div>
</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="maven" class="title" style="clear: both">Maven   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#maven" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#maven-buildmavenpackage">Building a package using <code class="literal">maven.buildMavenPackage</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#maven-mvn2nix">Manually using <code class="literal">mvn2nix</code></a> </span></dt> </dl></div><p>Maven is a well-known build tool for the Java ecosystem however it has some challenges when integrating into the Nix build system.</p><p>The following provides a list of common patterns with how to package a Maven project (or any JVM language that can export to Maven) as a Nix package.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="maven-buildmavenpackage" class="title">Building a package using <code class="literal">maven.buildMavenPackage</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#maven-buildmavenpackage" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Consider the following package:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ lib, fetchFromGitHub, jre, makeWrapper, maven }:

maven.buildMavenPackage <span class="hljs-keyword">rec</span> {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"jd-cli"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"1.2.1"</span>;

  <span class="hljs-attr">src</span> = fetchFromGitHub {
    <span class="hljs-attr">owner</span> = <span class="hljs-string">"intoolswetrust"</span>;
    <span class="hljs-attr">repo</span> = pname;
    <span class="hljs-attr">rev</span> = <span class="hljs-string">"<span class="hljs-subst">${pname}</span>-<span class="hljs-subst">${version}</span>"</span>;
    <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-rRttA5H0A0c44loBzbKH7Waoted3IsOgxGCD2VM0U/Q="</span>;
  };

  <span class="hljs-attr">mvnHash</span> = <span class="hljs-string">"sha256-kLpjMj05uC94/5vGMwMlFzLKNFOKeyNvq/vmB6pHTAo="</span>;

  <span class="hljs-attr">nativeBuildInputs</span> = [ makeWrapper ];

  <span class="hljs-attr">installPhase</span> = <span class="hljs-string">''
    mkdir -p $out/bin $out/share/jd-cli
    install -Dm644 jd-cli/target/jd-cli.jar $out/share/jd-cli

    makeWrapper <span class="hljs-subst">${jre}</span>/bin/java $out/bin/jd-cli \
      --add-flags "-jar $out/share/jd-cli/jd-cli.jar"
  ''</span>;

  <span class="hljs-attr">meta</span> = <span class="hljs-keyword">with</span> lib; {
    <span class="hljs-attr">description</span> = <span class="hljs-string">"Simple command line wrapper around JD Core Java Decompiler project"</span>;
    <span class="hljs-attr">homepage</span> = <span class="hljs-string">"https://github.com/intoolswetrust/jd-cli"</span>;
    <span class="hljs-attr">license</span> = licenses.gpl3Plus;
    <span class="hljs-attr">maintainers</span> = <span class="hljs-keyword">with</span> maintainers; [ majiir ];
  };
}:
</code></pre><p>This package calls <code class="literal">maven.buildMavenPackage</code> to do its work. The primary difference from <code class="literal">stdenv.mkDerivation</code> is the <code class="literal">mvnHash</code> variable, which is a hash of all of the Maven dependencies.</p><div class="tip"><h3 class="title">Tip</h3><p>After setting <code class="literal">maven.buildMavenPackage</code>, we then do standard Java <code class="literal">.jar</code> installation by saving the <code class="literal">.jar</code> to <code class="literal">$out/share/java</code> and then making a wrapper which allows executing that file; see <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#sec-language-java" title="Java">the section called “Java”</a> for additional generic information about packaging Java applications.</p></div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="stable-maven-plugins" class="title">Stable Maven plugins   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#stable-maven-plugins" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Maven defines default versions for its core plugins, e.g. <code class="literal">maven-compiler-plugin</code>. If your project does not override these versions, an upgrade of Maven will change the version of the used plugins, and therefore the derivation and hash.</p><p>When <code class="literal">maven</code> is upgraded, <code class="literal">mvnHash</code> for the derivation must be updated as well: otherwise, the project will be built on the derivation of old plugins, and fail because the requested plugins are missing.</p><p>This clearly prevents automatic upgrades of Maven: a manual effort must be made throughout nixpkgs by any maintainer wishing to push the upgrades.</p><p>To make sure that your package does not add extra manual effort when upgrading Maven, explicitly define versions for all plugins. You can check if this is the case by adding the following plugin to your (parent) POM:</p><pre><code class="programlisting xml hljs language-bash" data-highlighted="yes">&lt;plugin&gt;
  &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
  &lt;artifactId&gt;maven-enforcer-plugin&lt;/artifactId&gt;
  &lt;version&gt;3.3.0&lt;/version&gt;
  &lt;executions&gt;
    &lt;execution&gt;
      &lt;<span class="hljs-built_in">id</span>&gt;enforce-plugin-versions&lt;/id&gt;
      &lt;goals&gt;
        &lt;goal&gt;enforce&lt;/goal&gt;
      &lt;/goals&gt;
      &lt;configuration&gt;
        &lt;rules&gt;
          &lt;requirePluginVersions /&gt;
        &lt;/rules&gt;
      &lt;/configuration&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
&lt;/plugin&gt;
</code></pre>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="maven-mvn2nix" class="title">Manually using <code class="literal">mvn2nix</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#maven-mvn2nix" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><div class="warning"><h3 class="title">Warning</h3><p>This way is no longer recommended; see <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#maven-buildmavenpackage" title="Building a package using maven.buildMavenPackage">the section called “Building a package using <code class="literal">maven.buildMavenPackage</code>”</a> for the simpler and preferred way.</p></div><p>For the purposes of this example let’s consider a very basic Maven project with the following <code class="literal">pom.xml</code> with a single dependency on <a class="link" href="https://github.com/vdurmont/emoji-java" target="_top">emoji-java</a>.</p><pre><code class="programlisting xml hljs language-bash" data-highlighted="yes">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;
&lt;project xmlns=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span> xmlns:xsi=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
        xsi:schemaLocation=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;io.github.fzakaria&lt;/groupId&gt;
  &lt;artifactId&gt;maven-demo&lt;/artifactId&gt;
  &lt;version&gt;1.0&lt;/version&gt;
  &lt;packaging&gt;jar&lt;/packaging&gt;
  &lt;name&gt;NixOS Maven Demo&lt;/name&gt;

  &lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;com.vdurmont&lt;/groupId&gt;
        &lt;artifactId&gt;emoji-java&lt;/artifactId&gt;
        &lt;version&gt;5.1.1&lt;/version&gt;
      &lt;/dependency&gt;
  &lt;/dependencies&gt;
&lt;/project&gt;
</code></pre><p>Our main class file will be very simple:</p><pre><code class="programlisting java hljs language-nix" data-highlighted="yes"><span class="hljs-built_in">import</span> com.vdurmont.emoji.EmojiParser;

public class Main {
  public static void main(String[] args) {
    String <span class="hljs-attr">str</span> = <span class="hljs-string">"NixOS :grinning: is super cool :smiley:!"</span>;
    String <span class="hljs-attr">result</span> = EmojiParser.parseToUnicode(str);
    System.out.println(result);
  }
}
</code></pre><p>You find this demo project at <a class="link" href="https://github.com/fzakaria/nixos-maven-example" target="_top">https://github.com/fzakaria/nixos-maven-example</a>.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="solving-for-dependencies" class="title">Solving for dependencies   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#solving-for-dependencies" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="buildmaven-with-nixosmvn2nix-maven-plugin" class="title">buildMaven with NixOS/mvn2nix-maven-plugin   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#buildmaven-with-nixosmvn2nix-maven-plugin" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p><code class="literal">buildMaven</code> is an alternative method that tries to follow similar patterns of other programming languages by generating a lock file. It relies on the maven plugin <a class="link" href="https://github.com/NixOS/mvn2nix-maven-plugin" target="_top">mvn2nix-maven-plugin</a>.</p><p>First you generate a <code class="literal">project-info.json</code> file using the maven plugin.</p><div class="blockquote"><blockquote class="blockquote"><p>This should be executed in the project’s source repository or be told which <code class="literal">pom.xml</code> to execute with.</p></blockquote></div><pre><code class="programlisting bash hljs language-bash" data-highlighted="yes"><span class="hljs-comment"># run this step within the project's source repository</span>
❯ mvn org.nixos.mvn2nix:mvn2nix-maven-plugin:mvn2nix

❯ <span class="hljs-built_in">cat</span> project-info.json | jq | <span class="hljs-built_in">head</span>
{
  <span class="hljs-string">"project"</span>: {
    <span class="hljs-string">"artifactId"</span>: <span class="hljs-string">"maven-demo"</span>,
    <span class="hljs-string">"groupId"</span>: <span class="hljs-string">"org.nixos"</span>,
    <span class="hljs-string">"version"</span>: <span class="hljs-string">"1.0"</span>,
    <span class="hljs-string">"classifier"</span>: <span class="hljs-string">""</span>,
    <span class="hljs-string">"extension"</span>: <span class="hljs-string">"jar"</span>,
    <span class="hljs-string">"dependencies"</span>: [
      {
        <span class="hljs-string">"artifactId"</span>: <span class="hljs-string">"maven-resources-plugin"</span>,
</code></pre><p>This file is then given to the <code class="literal">buildMaven</code> function, and it returns 2 attributes.</p><p><span class="strong"><strong><code class="literal">repo</code></strong></span>:
A Maven repository that is a symlink farm of all the dependencies found in the <code class="literal">project-info.json</code></p><p><span class="strong"><strong><code class="literal">build</code></strong></span>:
A simple derivation that runs through <code class="literal">mvn compile</code> &amp; <code class="literal">mvn package</code> to build the JAR. You may use this as inspiration for more complicated derivations.</p><p>Here is an <a class="link" href="https://github.com/fzakaria/nixos-maven-example/blob/main/build-maven-repository.nix" target="_top">example</a> of building the Maven repository</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ pkgs ? <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; { } }:
<span class="hljs-keyword">with</span> pkgs;
(buildMaven ./project-info.json).repo
</code></pre><p>The benefit over the <span class="emphasis"><em>double invocation</em></span> as we will see below, is that the <span class="emphasis"><em>/nix/store</em></span> entry is a <span class="emphasis"><em>linkFarm</em></span> of every package, so that changes to your dependency set doesn’t involve downloading everything from scratch.</p><pre><code class="programlisting bash hljs language-bash" data-highlighted="yes">❯ tree $(nix-build --no-out-link build-maven-repository.nix) | <span class="hljs-built_in">head</span>
/nix/store/g87va52nkc8jzbmi1aqdcf2f109r4dvn-maven-repository
├── antlr
│&nbsp;&nbsp; └── antlr
│&nbsp;&nbsp;     └── 2.7.2
│&nbsp;&nbsp;         ├── antlr-2.7.2.jar -&gt; /nix/store/d027c8f2cnmj5yrynpbq2s6wmc9cb559-antlr-2.7.2.jar
│&nbsp;&nbsp;         └── antlr-2.7.2.pom -&gt; /nix/store/mv42fc5gizl8h5g5vpywz1nfiynmzgp2-antlr-2.7.2.pom
├── avalon-framework
│&nbsp;&nbsp; └── avalon-framework
│&nbsp;&nbsp;     └── 4.1.3
│&nbsp;&nbsp;         ├── avalon-framework-4.1.3.jar -&gt; /nix/store/iv5fp3955w3nq28ff9xfz86wvxbiw6n9-avalon-framework-4.1.3.jar
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="double-invocation" class="title">Double Invocation   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#double-invocation" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><div class="note"><h3 class="title">Note</h3><p>This pattern is the simplest but may cause unnecessary rebuilds due to the output hash changing.</p></div><p>The double invocation is a <span class="emphasis"><em>simple</em></span> way to get around the problem that <code class="literal">nix-build</code> may be sandboxed and have no Internet connectivity.</p><p>It treats the entire Maven repository as a single source to be downloaded, relying on Maven’s dependency resolution to satisfy the output hash. This is similar to fetchers like <code class="literal">fetchgit</code>, except it has to run a Maven build to determine what to download.</p><p>The first step will be to build the Maven project as a fixed-output derivation in order to collect the Maven repository – below is an <a class="link" href="https://github.com/fzakaria/nixos-maven-example/blob/main/double-invocation-repository.nix" target="_top">example</a>.</p><div class="note"><h3 class="title">Note</h3><p>Traditionally the Maven repository is at <code class="literal">~/.m2/repository</code>. We will override this to be the <code class="literal">$out</code> directory.</p></div><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ lib, stdenv, maven }:
stdenv.mkDerivation {
  <span class="hljs-attr">name</span> = <span class="hljs-string">"maven-repository"</span>;
  <span class="hljs-attr">buildInputs</span> = [ maven ];
  <span class="hljs-attr">src</span> = ./.; <span class="hljs-comment"># or fetchFromGitHub, cleanSourceWith, etc</span>
  <span class="hljs-attr">buildPhase</span> = <span class="hljs-string">''
    mvn package -Dmaven.repo.local=$out
  ''</span>;

  <span class="hljs-comment"># keep only *.{pom,jar,sha1,nbm} and delete all ephemeral files with lastModified timestamps inside</span>
  <span class="hljs-attr">installPhase</span> = <span class="hljs-string">''
    find $out -type f \
      -name \*.lastUpdated -or \
      -name resolver-status.properties -or \
      -name _remote.repositories \
      -delete
  ''</span>;

  <span class="hljs-comment"># don't do any fixup</span>
  <span class="hljs-attr">dontFixup</span> = <span class="hljs-literal">true</span>;
  <span class="hljs-attr">outputHashAlgo</span> = <span class="hljs-string">"sha256"</span>;
  <span class="hljs-attr">outputHashMode</span> = <span class="hljs-string">"recursive"</span>;
  <span class="hljs-comment"># replace this with the correct SHA256</span>
  <span class="hljs-attr">outputHash</span> = lib.fakeSha256;
}
</code></pre><p>The build will fail, and tell you the expected <code class="literal">outputHash</code> to place. When you’ve set the hash, the build will return with a <code class="literal">/nix/store</code> entry whose contents are the full Maven repository.</p><div class="warning"><h3 class="title">Warning</h3><p>Some additional files are deleted that would cause the output hash to change potentially on subsequent runs.</p></div><pre><code class="programlisting bash hljs language-bash" data-highlighted="yes">❯ tree $(nix-build --no-out-link double-invocation-repository.nix) | <span class="hljs-built_in">head</span>
/nix/store/8kicxzp98j68xyi9gl6jda67hp3c54fq-maven-repository
├── backport-util-concurrent
│&nbsp;&nbsp; └── backport-util-concurrent
│&nbsp;&nbsp;     └── 3.1
│&nbsp;&nbsp;         ├── backport-util-concurrent-3.1.pom
│&nbsp;&nbsp;         └── backport-util-concurrent-3.1.pom.sha1
├── classworlds
│&nbsp;&nbsp; └── classworlds
│&nbsp;&nbsp;     ├── 1.1
│&nbsp;&nbsp;     │&nbsp;&nbsp; ├── classworlds-1.1.jar
</code></pre><p>If your package uses <span class="emphasis"><em>SNAPSHOT</em></span> dependencies or <span class="emphasis"><em>version ranges</em></span>; there is a strong likelihood that over-time your output hash will change since the resolved dependencies may change. Hence this method is less recommended then using <code class="literal">buildMaven</code>.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="building-a-jar" class="title">Building a JAR   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#building-a-jar" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Regardless of which strategy is chosen above, the step to build the derivation is the same.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ stdenv, maven, callPackage }:
<span class="hljs-comment"># pick a repository derivation, here we will use buildMaven</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">repository</span> = callPackage ./build-maven-repository.nix { };
<span class="hljs-keyword">in</span> stdenv.mkDerivation <span class="hljs-keyword">rec</span> {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"maven-demo"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"1.0"</span>;

  <span class="hljs-attr">src</span> = <span class="hljs-built_in">builtins</span>.fetchTarball <span class="hljs-string">"https://github.com/fzakaria/nixos-maven-example/archive/main.tar.gz"</span>;
  <span class="hljs-attr">buildInputs</span> = [ maven ];

  <span class="hljs-attr">buildPhase</span> = <span class="hljs-string">''
    echo "Using repository <span class="hljs-subst">${repository}</span>"
    mvn --offline -Dmaven.repo.local=<span class="hljs-subst">${repository}</span> package;
  ''</span>;

  <span class="hljs-attr">installPhase</span> = <span class="hljs-string">''
    install -Dm644 target/<span class="hljs-subst">${pname}</span>-<span class="hljs-subst">${version}</span>.jar $out/share/java
  ''</span>;
}
</code></pre><div class="tip"><h3 class="title">Tip</h3><p>We place the library in <code class="literal">$out/share/java</code> since JDK package has a <span class="emphasis"><em>stdenv setup hook</em></span> that adds any JARs in the <code class="literal">share/java</code> directories of the build inputs to the CLASSPATH environment.</p></div><pre><code class="programlisting bash hljs language-bash" data-highlighted="yes">❯ tree $(nix-build --no-out-link build-jar.nix)
/nix/store/7jw3xdfagkc2vw8wrsdv68qpsnrxgvky-maven-demo-1.0
└── share
    └── java
        └── maven-demo-1.0.jar

2 directories, 1 file
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="runnable-jar" class="title">Runnable JAR   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#runnable-jar" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>The previous example builds a <code class="literal">jar</code> file but that’s not a file one can run.</p><p>You need to use it with <code class="literal">java -jar $out/share/java/output.jar</code> and make sure to provide the required dependencies on the classpath.</p><p>The following explains how to use <code class="literal">makeWrapper</code> in order to make the derivation produce an executable that will run the JAR file you created.</p><p>We will use the same repository we built above (either <span class="emphasis"><em>double invocation</em></span> or <span class="emphasis"><em>buildMaven</em></span>) to setup a CLASSPATH for our JAR.</p><p>The following two methods are more suited to Nix then building an <a class="link" href="https://imagej.net/Uber-JAR" target="_top">UberJar</a> which may be the more traditional approach.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="classpath" class="title">CLASSPATH   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#classpath" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>This method is ideal if you are providing a derivation for <span class="emphasis"><em>nixpkgs</em></span> and don’t want to patch the project’s <code class="literal">pom.xml</code>.</p><p>We will read the Maven repository and flatten it to a single list. This list will then be concatenated with the <span class="emphasis"><em>CLASSPATH</em></span> separator to create the full classpath.</p><p>We make sure to provide this classpath to the <code class="literal">makeWrapper</code>.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ stdenv, maven, callPackage, makeWrapper, jre }:
<span class="hljs-keyword">let</span>
  <span class="hljs-attr">repository</span> = callPackage ./build-maven-repository.nix { };
<span class="hljs-keyword">in</span> stdenv.mkDerivation <span class="hljs-keyword">rec</span> {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"maven-demo"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"1.0"</span>;

  <span class="hljs-attr">src</span> = <span class="hljs-built_in">builtins</span>.fetchTarball
    <span class="hljs-string">"https://github.com/fzakaria/nixos-maven-example/archive/main.tar.gz"</span>;
  <span class="hljs-attr">nativeBuildInputs</span> = [ makeWrapper ];
  <span class="hljs-attr">buildInputs</span> = [ maven ];

  <span class="hljs-attr">buildPhase</span> = <span class="hljs-string">''
    echo "Using repository <span class="hljs-subst">${repository}</span>"
    mvn --offline -Dmaven.repo.local=<span class="hljs-subst">${repository}</span> package;
  ''</span>;

  <span class="hljs-attr">installPhase</span> = <span class="hljs-string">''
    mkdir -p $out/bin

    classpath=$(find <span class="hljs-subst">${repository}</span> -name "*.jar" -printf ':%h/%f');
    install -Dm644 target/<span class="hljs-subst">${pname}</span>-<span class="hljs-subst">${version}</span>.jar $out/share/java
    # create a wrapper that will automatically set the classpath
    # this should be the paths from the dependency derivation
    makeWrapper <span class="hljs-subst">${jre}</span>/bin/java $out/bin/<span class="hljs-subst">${pname}</span> \
          --add-flags "-classpath $out/share/java/<span class="hljs-subst">${pname}</span>-<span class="hljs-subst">${version}</span>.jar:<span class="hljs-char escape_">''$</span>{classpath#:}" \
          --add-flags "Main"
  ''</span>;
}
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="manifest-file-via-maven-plugin" class="title">MANIFEST file via Maven Plugin   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#manifest-file-via-maven-plugin" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>This method is ideal if you are the project owner and want to change your <code class="literal">pom.xml</code> to set the CLASSPATH within it.</p><p>Augment the <code class="literal">pom.xml</code> to create a JAR with the following manifest:</p><pre><code class="programlisting xml hljs language-bash" data-highlighted="yes">&lt;build&gt;
  &lt;plugins&gt;
    &lt;plugin&gt;
        &lt;artifactId&gt;maven-jar-plugin&lt;/artifactId&gt;
        &lt;configuration&gt;
            &lt;archive&gt;
                &lt;manifest&gt;
                    &lt;addClasspath&gt;<span class="hljs-literal">true</span>&lt;/addClasspath&gt;
                    &lt;classpathPrefix&gt;../../repository/&lt;/classpathPrefix&gt;
                    &lt;classpathLayoutType&gt;repository&lt;/classpathLayoutType&gt;
                    &lt;mainClass&gt;Main&lt;/mainClass&gt;
                &lt;/manifest&gt;
                &lt;manifestEntries&gt;
                    &lt;Class-Path&gt;.&lt;/Class-Path&gt;
                &lt;/manifestEntries&gt;
            &lt;/archive&gt;
        &lt;/configuration&gt;
    &lt;/plugin&gt;
  &lt;/plugins&gt;
&lt;/build&gt;
</code></pre><p>The above plugin instructs the JAR to look for the necessary dependencies in the <code class="literal">lib/</code> relative folder. The layout of the folder is also in the <span class="emphasis"><em>maven repository</em></span> style.</p><pre><code class="programlisting bash hljs language-bash" data-highlighted="yes">❯ unzip -q -c $(nix-build --no-out-link runnable-jar.nix)/share/java/maven-demo-1.0.jar META-INF/MANIFEST.MF

Manifest-Version: 1.0
Archiver-Version: Plexus Archiver
Built-By: nixbld
Class-Path: . ../../repository/com/vdurmont/emoji-java/5.1.1/emoji-jav
 a-5.1.1.jar ../../repository/org/json/json/20170516/json-20170516.jar
Created-By: Apache Maven 3.6.3
Build-Jdk: 1.8.0_265
Main-Class: Main
</code></pre><p>We will modify the derivation above to add a symlink to our repository so that it’s accessible to our JAR during the <code class="literal">installPhase</code>.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ stdenv, maven, callPackage, makeWrapper, jre }:
<span class="hljs-comment"># pick a repository derivation, here we will use buildMaven</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">repository</span> = callPackage ./build-maven-repository.nix { };
<span class="hljs-keyword">in</span> stdenv.mkDerivation <span class="hljs-keyword">rec</span> {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"maven-demo"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"1.0"</span>;

  <span class="hljs-attr">src</span> = <span class="hljs-built_in">builtins</span>.fetchTarball
    <span class="hljs-string">"https://github.com/fzakaria/nixos-maven-example/archive/main.tar.gz"</span>;
  <span class="hljs-attr">nativeBuildInputs</span> = [ makeWrapper ];
  <span class="hljs-attr">buildInputs</span> = [ maven ];

  <span class="hljs-attr">buildPhase</span> = <span class="hljs-string">''
    echo "Using repository <span class="hljs-subst">${repository}</span>"
    mvn --offline -Dmaven.repo.local=<span class="hljs-subst">${repository}</span> package;
  ''</span>;

  <span class="hljs-attr">installPhase</span> = <span class="hljs-string">''
    mkdir -p $out/bin

    # create a symbolic link for the repository directory
    ln -s <span class="hljs-subst">${repository}</span> $out/repository

    install -Dm644 target/<span class="hljs-subst">${pname}</span>-<span class="hljs-subst">${version}</span>.jar $out/share/java
    # create a wrapper that will automatically set the classpath
    # this should be the paths from the dependency derivation
    makeWrapper <span class="hljs-subst">${jre}</span>/bin/java $out/bin/<span class="hljs-subst">${pname}</span> \
          --add-flags "-jar $out/share/java/<span class="hljs-subst">${pname}</span>-<span class="hljs-subst">${version}</span>.jar"
  ''</span>;
}
</code></pre><div class="note"><h3 class="title">Note</h3><p>Our script produces a dependency on <code class="literal">jre</code> rather than <code class="literal">jdk</code> to restrict the runtime closure necessary to run the application.</p></div><p>This will give you an executable shell-script that launches your JAR with all the dependencies available.</p><pre><code class="programlisting bash hljs language-bash" data-highlighted="yes">❯ tree $(nix-build --no-out-link runnable-jar.nix)
/nix/store/8d4c3ibw8ynsn01ibhyqmc1zhzz75s26-maven-demo-1.0
├── bin
│&nbsp;&nbsp; └── maven-demo
├── repository -&gt; /nix/store/g87va52nkc8jzbmi1aqdcf2f109r4dvn-maven-repository
└── share
    └── java
        └── maven-demo-1.0.jar

❯ $(nix-build --no-out-link --option tarball-ttl 1 runnable-jar.nix)/bin/maven-demo
NixOS 😀 is super cool 😃!
</code></pre>
</div>

</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="nim" class="title" style="clear: both">Nim   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#nim" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#nim-overview">Overview</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#nim-program-packages-in-nixpkgs">Nim program packages in Nixpkgs</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#nim-library-packages-in-nixpkgs">Nim library packages in Nixpkgs</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#buildnimpackage-parameters"><code class="literal">buildNimPackage</code> parameters</a> </span></dt> </dl></div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="nim-overview" class="title">Overview   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#nim-overview" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The Nim compiler, a builder function, and some packaged libraries are available
in Nixpkgs. Until now each compiler release has been effectively backwards
compatible so only the latest version is available.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="nim-program-packages-in-nixpkgs" class="title">Nim program packages in Nixpkgs   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#nim-program-packages-in-nixpkgs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Nim programs can be built using <code class="literal">nimPackages.buildNimPackage</code>. In the
case of packages not containing exported library code the attribute
<code class="literal">nimBinOnly</code> should be set to <code class="literal">true</code>.</p><p>The following example shows a Nim program that depends only on Nim libraries:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ lib, nimPackages, fetchFromGitHub }:

nimPackages.buildNimPackage (finalAttrs: {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"ttop"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"1.0.1"</span>;
  <span class="hljs-attr">nimBinOnly</span> = <span class="hljs-literal">true</span>;

  <span class="hljs-attr">src</span> = fetchFromGitHub {
    <span class="hljs-attr">owner</span> = <span class="hljs-string">"inv2004"</span>;
    <span class="hljs-attr">repo</span> = <span class="hljs-string">"ttop"</span>;
    <span class="hljs-attr">rev</span> = <span class="hljs-string">"v<span class="hljs-subst">${finalAttrs.version}</span>"</span>;
    <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-x4Uczksh6p3XX/IMrOFtBxIleVHdAPX9e8n32VAUTC4="</span>;
  };

  <span class="hljs-attr">buildInputs</span> = <span class="hljs-keyword">with</span> nimPackages; [ asciigraph illwill parsetoml zippy ];

})
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="nim-library-packages-in-nixpkgs" class="title">Nim library packages in Nixpkgs   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#nim-library-packages-in-nixpkgs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Nim libraries can also be built using <code class="literal">nimPackages.buildNimPackage</code>, but
often the product of a fetcher is sufficient to satisfy a dependency.
The <code class="literal">fetchgit</code>, <code class="literal">fetchFromGitHub</code>, and <code class="literal">fetchNimble</code> functions yield an
output that can be discovered during the <code class="literal">configurePhase</code> of <code class="literal">buildNimPackage</code>.</p><p>Nim library packages are listed in
<a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/top-level/nim-packages.nix" target="_top">pkgs/top-level/nim-packages.nix</a> and implemented at
<a class="link" href="https://github.com/NixOS/nixpkgs/tree/master/pkgs/development/nim-packages" target="_top">pkgs/development/nim-packages</a>.</p><p>The following example shows a Nim library that propagates a dependency on a
non-Nim package:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ lib, buildNimPackage, fetchNimble, SDL2 }:

buildNimPackage (finalAttrs: {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"sdl2"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"2.0.4"</span>;
  <span class="hljs-attr">src</span> = fetchNimble {
    <span class="hljs-keyword">inherit</span> (finalAttrs) pname version;
    <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-Vtcj8goI4zZPQs2TbFoBFlcR5UqDtOldaXSH/+/xULk="</span>;
  };
  <span class="hljs-attr">propagatedBuildInputs</span> = [ SDL2 ];
})
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="buildnimpackage-parameters" class="title"><code class="literal">buildNimPackage</code> parameters   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#buildnimpackage-parameters" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>All parameters from <code class="literal">stdenv.mkDerivation</code> function are still supported. The
following are specific to <code class="literal">buildNimPackage</code>:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><code class="literal">nimBinOnly ? false</code>: If <code class="literal">true</code> then build only the programs listed in
the Nimble file in the packages sources.</p></li><li class="listitem"><p><code class="literal">nimbleFile</code>: Specify the Nimble file location of the package being built
rather than discover the file at build-time.</p></li><li class="listitem"><p><code class="literal">nimRelease ? true</code>: Build the package in <span class="emphasis"><em>release</em></span> mode.</p></li><li class="listitem"><p><code class="literal">nimDefines ? []</code>: A list of Nim defines. Key-value tuples are not supported.</p></li><li class="listitem"><p><code class="literal">nimFlags ? []</code>: A list of command line arguments to pass to the Nim compiler.
Use this to specify defines with arguments in the form of <code class="literal">-d:${name}=${value}</code>.</p></li><li class="listitem"><p><code class="literal">nimDoc</code> ? false`: Build and install HTML documentation.</p></li><li class="listitem"><p><code class="literal">buildInputs</code> ? []: The packages listed here will be searched for <code class="literal">*.nimble</code>
files which are used to populate the Nim library path. Otherwise the standard
behavior is in effect.</p></li></ul></div>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-language-ocaml" class="title" style="clear: both">OCaml   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-language-ocaml" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-language-ocaml-user-guide">User guide</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-language-ocaml-packaging">Packaging guide</a> </span></dt> </dl></div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-language-ocaml-user-guide" class="title">User guide   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-language-ocaml-user-guide" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>OCaml libraries are available in attribute sets of the form <code class="literal">ocaml-ng.ocamlPackages_X_XX</code> where X is to be replaced with the desired compiler version. For example, ocamlgraph compiled with OCaml 4.12 can be found in <code class="literal">ocaml-ng.ocamlPackages_4_12.ocamlgraph</code>. The compiler itself is also located in this set, under the name <code class="literal">ocaml</code>.</p><p>If you don’t care about the exact compiler version, <code class="literal">ocamlPackages</code> is a top-level alias pointing to a recent version of OCaml.</p><p>OCaml applications are usually available top-level, and not inside <code class="literal">ocamlPackages</code>. Notable exceptions are build tools that must be built with the same compiler version as the compiler you intend to use like <code class="literal">dune</code> or <code class="literal">ocaml-lsp</code>.</p><p>To open a shell able to build a typical OCaml project, put the dependencies in <code class="literal">buildInputs</code> and add <code class="literal">ocamlPackages.ocaml</code> and <code class="literal">ocamlPackages.findlib</code> to <code class="literal">nativeBuildInputs</code> at least.
For example:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">let</span>
 <span class="hljs-attr">pkgs</span> = <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {};
 <span class="hljs-comment"># choose the ocaml version you want to use</span>
 <span class="hljs-attr">ocamlPackages</span> = pkgs.ocaml-ng.ocamlPackages_4_12;
<span class="hljs-keyword">in</span>
pkgs.mkShell {
  <span class="hljs-comment"># build tools</span>
  <span class="hljs-attr">nativeBuildInputs</span> = <span class="hljs-keyword">with</span> ocamlPackages; [ ocaml findlib dune_2 ocaml-lsp ];
  <span class="hljs-comment"># dependencies</span>
  <span class="hljs-attr">buildInputs</span> = <span class="hljs-keyword">with</span> ocamlPackages; [ ocamlgraph ];
}
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-language-ocaml-packaging" class="title">Packaging guide   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-language-ocaml-packaging" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>OCaml libraries should be installed in <code class="literal">$(out)/lib/ocaml/${ocaml.version}/site-lib/</code>. Such directories are automatically added to the <code class="literal">$OCAMLPATH</code> environment variable when building another package that depends on them or when opening a <code class="literal">nix-shell</code>.</p><p>Given that most of the OCaml ecosystem is now built with dune, nixpkgs includes a convenience build support function called <code class="literal">buildDunePackage</code> that will build an OCaml package using dune, OCaml and findlib and any additional dependencies provided as <code class="literal">buildInputs</code> or <code class="literal">propagatedBuildInputs</code>.</p><p>Here is a simple package example.</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>It defines an (optional) attribute <code class="literal">minimalOCamlVersion</code> (see note below)
that will be used to throw a descriptive evaluation error if building with
an older OCaml is attempted.</p></li><li class="listitem"><p>It uses the <code class="literal">fetchFromGitHub</code> fetcher to get its source.</p></li><li class="listitem"><p>It also accept <code class="literal">duneVersion</code> parameter (valid value are <code class="literal">"1"</code>, <code class="literal">"2"</code>, and
<code class="literal">"3"</code>). The recommended practice it to set only if you don’t want the default
value and/or it depends on something else like package version. You might see
a not-supported argument <code class="literal">useDune2</code>. The behavior was <code class="literal">useDune2 = true;</code> =&gt;
<code class="literal">duneVersion = "2";</code> and <code class="literal">useDune2 = false;</code> =&gt; <code class="literal">duneVersion = "1";</code>. It was
used at the time when dune3 didn’t existed.</p></li><li class="listitem"><p>It sets the optional <code class="literal">doCheck</code> attribute such that tests will be run with
<code class="literal">dune runtest -p angstrom</code> after the build (<code class="literal">dune build -p angstrom</code>) is
complete, but only if the Ocaml version is at at least <code class="literal">"4.05"</code>.</p></li><li class="listitem"><p>It uses the package <code class="literal">ocaml-syntax-shims</code> as a build input, <code class="literal">alcotest</code> and
<code class="literal">ppx_let</code> as check inputs (because they are needed to run the tests), and
<code class="literal">bigstringaf</code> and <code class="literal">result</code> as propagated build inputs (thus they will also be
available to libraries depending on this library).</p></li><li class="listitem"><p>The library will be installed using the <code class="literal">angstrom.install</code> file that dune
generates.</p></li></ul></div><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ lib,
  fetchFromGitHub,
  buildDunePackage,
  ocaml,
  ocaml-syntax-shims,
  alcotest,
  result,
  bigstringaf,
  ppx_let }:

buildDunePackage <span class="hljs-keyword">rec</span> {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"angstrom"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"0.15.0"</span>;

  <span class="hljs-attr">minimalOCamlVersion</span> = <span class="hljs-string">"4.04"</span>;

  <span class="hljs-attr">src</span> = fetchFromGitHub {
    <span class="hljs-attr">owner</span>  = <span class="hljs-string">"inhabitedtype"</span>;
    <span class="hljs-attr">repo</span>   = pname;
    <span class="hljs-attr">rev</span>    = version;
    <span class="hljs-attr">hash</span>   = <span class="hljs-string">"sha256-MK8o+iPGANEhrrTc1Kz9LBilx2bDPQt7Pp5P2libucI="</span>;
  };

  <span class="hljs-attr">checkInputs</span> = [ alcotest ppx_let ];
  <span class="hljs-attr">buildInputs</span> = [ ocaml-syntax-shims ];
  <span class="hljs-attr">propagatedBuildInputs</span> = [ bigstringaf result ];
  <span class="hljs-attr">doCheck</span> = lib.versionAtLeast ocaml.version <span class="hljs-string">"4.05"</span>;

  <span class="hljs-attr">meta</span> = {
    <span class="hljs-attr">homepage</span> = <span class="hljs-string">"https://github.com/inhabitedtype/angstrom"</span>;
    <span class="hljs-attr">description</span> = <span class="hljs-string">"OCaml parser combinators built for speed and memory efficiency"</span>;
    <span class="hljs-attr">license</span> = lib.licenses.bsd3;
    <span class="hljs-attr">maintainers</span> = <span class="hljs-keyword">with</span> lib.maintainers; [ sternenseemann ];
  };
</code></pre><p>Here is a second example, this time using a source archive generated with <code class="literal">dune-release</code>. It is a good idea to use this archive when it is available as it will usually contain substituted variables such as a <code class="literal">%%VERSION%%</code> field. This library does not depend on any other OCaml library and no tests are run after building it.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ lib, fetchurl, buildDunePackage }:

buildDunePackage <span class="hljs-keyword">rec</span> {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"wtf8"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"1.0.2"</span>;

  <span class="hljs-attr">minimalOCamlVersion</span> = <span class="hljs-string">"4.02"</span>;

  <span class="hljs-attr">src</span> = fetchurl {
    <span class="hljs-attr">url</span> = <span class="hljs-string">"https://github.com/flowtype/ocaml-<span class="hljs-subst">${pname}</span>/releases/download/v<span class="hljs-subst">${version}</span>/<span class="hljs-subst">${pname}</span>-v<span class="hljs-subst">${version}</span>.tbz"</span>;
    <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-d5/3KUBAWRj8tntr4RkJ74KWW7wvn/B/m1nx0npnzyc="</span>;
  };

  <span class="hljs-attr">meta</span> = <span class="hljs-keyword">with</span> lib; {
    <span class="hljs-attr">homepage</span> = <span class="hljs-string">"https://github.com/flowtype/ocaml-wtf8"</span>;
    <span class="hljs-attr">description</span> = <span class="hljs-string">"WTF-8 is a superset of UTF-8 that allows unpaired surrogates."</span>;
    <span class="hljs-attr">license</span> = licenses.mit;
    <span class="hljs-attr">maintainers</span> = [ maintainers.eqyiel ];
  };
}
</code></pre><p>Note about <code class="literal">minimalOCamlVersion</code>.  A deprecated version of this argument was
spelled <code class="literal">minimumOCamlVersion</code>; setting the old attribute wrongly modifies the
derivation hash and is therefore inappropriate. As a technical dept, currently
packaged libraries may still use the old spelling: maintainers are invited to
fix this when updating packages. Massive renaming is strongly discouraged as it
would be challenging to review, difficult to test, and will cause unnecessary
rebuild.</p><p>The build will automatically fail if two distinct versions of the same library
are added to <code class="literal">buildInputs</code> (which usually happens transitively because of
<code class="literal">propagatedBuildInputs</code>). Set <code class="literal">dontDetectOcamlConflicts</code> to true to disable this
behavior.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-octave" class="title" style="clear: both">Octave   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-octave" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-octave-introduction">Introduction</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-octave-structure">Structure</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-octave-packaging">Packaging Octave Packages</a> </span></dt> </dl></div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-octave-introduction" class="title">Introduction   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-octave-introduction" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Octave is a modular scientific programming language and environment.
A majority of the packages supported by Octave from their <a class="link" href="https://octave.sourceforge.io/packages.php" target="_top">website</a> are packaged in nixpkgs.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-octave-structure" class="title">Structure   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-octave-structure" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>All Octave add-on packages are available in two ways:</p><div class="orderedlist"><ol class="orderedlist compact" type="1"><li class="listitem"><p>Under the top-level <code class="literal">Octave</code> attribute, <code class="literal">octave.pkgs</code>.</p></li><li class="listitem"><p>As a top-level attribute, <code class="literal">octavePackages</code>.</p></li></ol></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-octave-packaging" class="title">Packaging Octave Packages   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-octave-packaging" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Nixpkgs provides a function <code class="literal">buildOctavePackage</code>, a generic package builder function for any Octave package that complies with the Octave’s current packaging format.</p><p>All Octave packages are defined in <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/top-level/octave-packages.nix" target="_top">pkgs/top-level/octave-packages.nix</a> rather than <code class="literal">pkgs/all-packages.nix</code>.
Each package is defined in their own file in the <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/development/octave-modules" target="_top">pkgs/development/octave-modules</a> directory.
Octave packages are made available through <code class="literal">all-packages.nix</code> through both the attribute <code class="literal">octavePackages</code> and <code class="literal">octave.pkgs</code>.
You can test building an Octave package as follows:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">nix-build -A octavePackages.symbolic</span>
</code></pre><p>To install it into your user profile, run this command from the root of the repository:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">nix-env -f. -iA octavePackages.symbolic</span>
</code></pre><p>You can build Octave with packages by using the <code class="literal">withPackages</code> passed-through function.</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">nix-shell -p <span class="hljs-string">'octave.withPackages (ps: with ps; [ symbolic ])'</span></span>
</code></pre><p>This will also work in a <code class="literal">shell.nix</code> file.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ pkgs ? <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; { }}:

pkgs.mkShell {
  <span class="hljs-attr">nativeBuildInputs</span> = <span class="hljs-keyword">with</span> pkgs; [
    (octave.withPackages (opkgs: <span class="hljs-keyword">with</span> opkgs; [ symbolic ]))
  ];
}
</code></pre><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="sssec-buildOctavePackage-steps" class="title"><code class="literal">buildOctavePackage</code> Steps   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sssec-buildOctavePackage-steps" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>The <code class="literal">buildOctavePackage</code> does several things to make sure things work properly.</p><div class="orderedlist"><ol class="orderedlist compact" type="1"><li class="listitem"><p>Sets the environment variable <code class="literal">OCTAVE_HISTFILE</code> to <code class="literal">/dev/null</code> during package compilation so that the commands run through the Octave interpreter directly are not logged.</p></li><li class="listitem"><p>Skips the configuration step, because the packages are stored as gzipped tarballs, which Octave itself handles directly.</p></li><li class="listitem"><p>Change the hierarchy of the tarball so that only a single directory is at the top-most level of the tarball.</p></li><li class="listitem"><p>Use Octave itself to run the <code class="literal">pkg build</code> command, which unzips the tarball, extracts the necessary files written in Octave, and compiles any code written in C++ or Fortran, and places the fully compiled artifact in <code class="literal">$out</code>.</p></li></ol></div><p><code class="literal">buildOctavePackage</code> is built on top of <code class="literal">stdenv</code> in a standard way, allowing most things to be customized.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="sssec-octave-handling-dependencies" class="title">Handling Dependencies   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sssec-octave-handling-dependencies" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>In Octave packages, there are four sets of dependencies that can be specified:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">nativeBuildInputs</code></span></dt><dd><p>Just like other packages, <code class="literal">nativeBuildInputs</code> is intended for architecture-dependent build-time-only dependencies.</p></dd><dt><span class="term"><code class="literal">buildInputs</code></span></dt><dd><p>Like other packages, <code class="literal">buildInputs</code> is intended for architecture-independent build-time-only dependencies.</p></dd><dt><span class="term"><code class="literal">propagatedBuildInputs</code></span></dt><dd><p>Similar to other packages, <code class="literal">propagatedBuildInputs</code> is intended for packages that are required for both building and running of the package.
See <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/development/octave-modules/symbolic/default.nix" target="_top">Symbolic</a> for how this works and why it is needed.</p></dd><dt><span class="term"><code class="literal">requiredOctavePackages</code></span></dt><dd><p>This is a special dependency that ensures the specified Octave packages are dependent on others, and are made available simultaneously when loading them in Octave.</p></dd></dl></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="sssec-installing-octave-packages" class="title">Installing Octave Packages   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sssec-installing-octave-packages" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>By default, the <code class="literal">buildOctavePackage</code> function does <span class="emphasis"><em>not</em></span> install the requested package into Octave for use.
The function will only build the requested package.
This is due to Octave maintaining an text-based database about which packages are installed where.
To this end, when all the requested packages have been built, the Octave package and all its add-on packages are put together into an environment, similar to Python.</p><div class="orderedlist"><ol class="orderedlist compact" type="1"><li class="listitem"><p>First, all the Octave binaries are wrapped with the environment variable <code class="literal">OCTAVE_SITE_INITFILE</code> set to a file in <code class="literal">$out</code>, which is required for Octave to be able to find the non-standard package database location.</p></li><li class="listitem"><p>Because of the way <code class="literal">buildEnv</code> works, all tarballs that are present (which should be all Octave packages to install) should be removed.</p></li><li class="listitem"><p>The path down to the default install location of Octave packages is recreated so that Nix-operated Octave can install the packages.</p></li><li class="listitem"><p>Install the packages into the <code class="literal">$out</code> environment while writing package entries to the database file.
This database file is unique for each different (according to Nix) environment invocation.</p></li><li class="listitem"><p>Rewrite the Octave-wide startup file to read from the list of packages installed in that particular environment.</p></li><li class="listitem"><p>Wrap any programs that are required by the Octave packages so that they work with all the paths defined within the environment.</p></li></ol></div>
</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-language-perl" class="title" style="clear: both">Perl   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-language-perl" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-perl-running">Running Perl programs on the shell</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-perl-packaging">Packaging Perl programs</a> </span></dt> </dl></div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-perl-running" class="title">Running Perl programs on the shell   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-perl-running" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>When executing a Perl script, it is possible you get an error such as <code class="literal">./myscript.pl: bad interpreter: /usr/bin/perl: no such file or directory</code>. This happens when the script expects Perl to be installed at <code class="literal">/usr/bin/perl</code>, which is not the case when using Perl from nixpkgs. You can fix the script by changing the first line to:</p><pre><code class="programlisting perl hljs language-shell" data-highlighted="yes"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/usr/bin/env perl</span>
</code></pre><p>to take the Perl installation from the <code class="literal">PATH</code> environment variable, or invoke Perl directly with:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">perl ./myscript.pl</span>
</code></pre><p>When the script is using a Perl library that is not installed globally, you might get an error such as <code class="literal">Can't locate DB_File.pm in @INC (you may need to install the DB_File module)</code>. In that case, you can use <code class="literal">nix-shell</code> to start an ad-hoc shell with that library installed, for instance:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">nix-shell -p perl perlPackages.DBFile --run ./myscript.pl</span>
</code></pre><p>If you are always using the script in places where <code class="literal">nix-shell</code> is available, you can embed the <code class="literal">nix-shell</code> invocation in the shebang like this:</p><pre><code class="programlisting perl hljs language-shell" data-highlighted="yes"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/usr/bin/env nix-shell</span>
<span class="hljs-meta prompt_">#</span><span class="language-bash">! nix-shell -i perl -p perl perlPackages.DBFile</span>
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-perl-packaging" class="title">Packaging Perl programs   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-perl-packaging" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Nixpkgs provides a function <code class="literal">buildPerlPackage</code>, a generic package builder function for any Perl package that has a standard <code class="literal">Makefile.PL</code>. It’s implemented in <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/development/perl-modules/generic" target="_top">pkgs/development/perl-modules/generic</a>.</p><p>Perl packages from CPAN are defined in <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/top-level/perl-packages.nix" target="_top">pkgs/top-level/perl-packages.nix</a> rather than <code class="literal">pkgs/all-packages.nix</code>. Most Perl packages are so straight-forward to build that they are defined here directly, rather than having a separate function for each package called from <code class="literal">perl-packages.nix</code>. However, more complicated packages should be put in a separate file, typically in <code class="literal">pkgs/development/perl-modules</code>. Here is an example of the former:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">ClassC3</span> = buildPerlPackage <span class="hljs-keyword">rec</span> {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"Class-C3"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"0.21"</span>;
  <span class="hljs-attr">src</span> = fetchurl {
    <span class="hljs-attr">url</span> = <span class="hljs-string">"mirror://cpan/authors/id/F/FL/FLORA/<span class="hljs-subst">${pname}</span>-<span class="hljs-subst">${version}</span>.tar.gz"</span>;
    <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-/5GE5xHT0uYGOQxroqj6LMU7CtKn2s6vMVoSXxL4iK4="</span>;
  };
};
</code></pre><p>Note the use of <code class="literal">mirror://cpan/</code>, and the <code class="literal">pname</code> and <code class="literal">version</code> in the URL definition to ensure that the <code class="literal">pname</code> attribute is consistent with the source that we’re actually downloading. Perl packages are made available in <code class="literal">all-packages.nix</code> through the variable <code class="literal">perlPackages</code>. For instance, if you have a package that needs <code class="literal">ClassC3</code>, you would typically write</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">foo</span> = <span class="hljs-built_in">import</span> ../path/to/foo.nix {
  <span class="hljs-keyword">inherit</span> stdenv fetchurl ...;
  <span class="hljs-keyword">inherit</span> (perlPackages) ClassC3;
};
</code></pre><p>in <code class="literal">all-packages.nix</code>. You can test building a Perl package as follows:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">nix-build -A perlPackages.ClassC3</span>
</code></pre><p>To install it with <code class="literal">nix-env</code> instead: <code class="literal">nix-env -f. -iA perlPackages.ClassC3</code>.</p><p>So what does <code class="literal">buildPerlPackage</code> do? It does the following:</p><div class="orderedlist"><ol class="orderedlist compact" type="1"><li class="listitem"><p>In the configure phase, it calls <code class="literal">perl Makefile.PL</code> to generate a Makefile. You can set the variable <code class="literal">makeMakerFlags</code> to pass flags to <code class="literal">Makefile.PL</code></p></li><li class="listitem"><p>It adds the contents of the <code class="literal">PERL5LIB</code> environment variable to <code class="literal">#! .../bin/perl</code> line of Perl scripts as <code class="literal">-Idir</code> flags. This ensures that a script can find its dependencies. (This can cause this shebang line to become too long for Darwin to handle; see the note below.)</p></li><li class="listitem"><p>In the fixup phase, it writes the propagated build inputs (<code class="literal">propagatedBuildInputs</code>) to the file <code class="literal">$out/nix-support/propagated-user-env-packages</code>. <code class="literal">nix-env</code> recursively installs all packages listed in this file when you install a package that has it. This ensures that a Perl package can find its dependencies.</p></li></ol></div><p><code class="literal">buildPerlPackage</code> is built on top of <code class="literal">stdenv</code>, so everything can be customised in the usual way. For instance, the <code class="literal">BerkeleyDB</code> module has a <code class="literal">preConfigure</code> hook to generate a configuration file used by <code class="literal">Makefile.PL</code>:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ buildPerlPackage, fetchurl, db }:

buildPerlPackage <span class="hljs-keyword">rec</span> {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"BerkeleyDB"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"0.36"</span>;

  <span class="hljs-attr">src</span> = fetchurl {
    <span class="hljs-attr">url</span> = <span class="hljs-string">"mirror://cpan/authors/id/P/PM/PMQS/<span class="hljs-subst">${pname}</span>-<span class="hljs-subst">${version}</span>.tar.gz"</span>;
    <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-4Y+HGgGQqcOfdiKcFIyMrWBEccVNVAMDBWZlFTMorh8="</span>;
  };

  <span class="hljs-attr">preConfigure</span> = <span class="hljs-string">''
    echo "LIB = <span class="hljs-subst">${db.out}</span>/lib" &gt; config.in
    echo "INCLUDE = <span class="hljs-subst">${db.dev}</span>/include" &gt;&gt; config.in
  ''</span>;
}
</code></pre><p>Dependencies on other Perl packages can be specified in the <code class="literal">buildInputs</code> and <code class="literal">propagatedBuildInputs</code> attributes. If something is exclusively a build-time dependency, use <code class="literal">buildInputs</code>; if it’s (also) a runtime dependency, use <code class="literal">propagatedBuildInputs</code>. For instance, this builds a Perl module that has runtime dependencies on a bunch of other modules:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">ClassC3Componentised</span> = buildPerlPackage <span class="hljs-keyword">rec</span> {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"Class-C3-Componentised"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"1.0004"</span>;
  <span class="hljs-attr">src</span> = fetchurl {
    <span class="hljs-attr">url</span> = <span class="hljs-string">"mirror://cpan/authors/id/A/AS/ASH/<span class="hljs-subst">${pname}</span>-<span class="hljs-subst">${version}</span>.tar.gz"</span>;
    <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-ASO9rV/FzJYZ0BH572Fxm2ZrFLMZLFATJng1NuU4FHc="</span>;
  };
  <span class="hljs-attr">propagatedBuildInputs</span> = [
    ClassC3 ClassInspector TestException MROCompat
  ];
};
</code></pre><p>On Darwin, if a script has too many <code class="literal">-Idir</code> flags in its first line (its “shebang line”), it will not run. This can be worked around by calling the <code class="literal">shortenPerlShebang</code> function from the <code class="literal">postInstall</code> phase:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ lib, stdenv, buildPerlPackage, fetchurl, shortenPerlShebang }:

<span class="hljs-attr">ImageExifTool</span> = buildPerlPackage {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"Image-ExifTool"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"12.50"</span>;

  <span class="hljs-attr">src</span> = fetchurl {
    <span class="hljs-attr">url</span> = <span class="hljs-string">"https://exiftool.org/<span class="hljs-subst">${pname}</span>-<span class="hljs-subst">${version}</span>.tar.gz"</span>;
    <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-vOhB/FwQMC8PPvdnjDvxRpU6jAZcC6GMQfc0AH4uwKg="</span>;
  };

  <span class="hljs-attr">nativeBuildInputs</span> = lib.optional stdenv.isDarwin shortenPerlShebang;
  <span class="hljs-attr">postInstall</span> = lib.optionalString stdenv.isDarwin <span class="hljs-string">''
    shortenPerlShebang $out/bin/exiftool
  ''</span>;
};
</code></pre><p>This will remove the <code class="literal">-I</code> flags from the shebang line, rewrite them in the <code class="literal">use lib</code> form, and put them on the next line instead. This function can be given any number of Perl scripts as arguments; it will modify them in-place.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="ssec-generation-from-CPAN" class="title">Generation from CPAN   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-generation-from-CPAN" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Nix expressions for Perl packages can be generated (almost) automatically from CPAN. This is done by the program <code class="literal">nix-generate-from-cpan</code>, which can be installed as follows:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">nix-env -f <span class="hljs-string">"&lt;nixpkgs&gt;"</span> -iA nix-generate-from-cpan</span>
</code></pre><p>Substitute <code class="literal">&lt;nixpkgs&gt;</code> by the path of a nixpkgs clone to use the latest version.</p><p>This program takes a Perl module name, looks it up on CPAN, fetches and unpacks the corresponding package, and prints a Nix expression on standard output. For example:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">nix-generate-from-cpan XML::Simple</span>
  XMLSimple = buildPerlPackage rec {
    pname = "XML-Simple";
    version = "2.22";
    src = fetchurl {
      url = "mirror://cpan/authors/id/G/GR/GRANTM/XML-Simple-2.22.tar.gz";
      hash = "sha256-uUUO8i6pZErl1q2ghtxDAPoQW+BQogMOvU79KMGY60k=";
    };
    propagatedBuildInputs = [ XMLNamespaceSupport XMLSAX XMLSAXExpat ];
    meta = {
      description = "An API for simple XML files";
      license = with lib.licenses; [ artistic1 gpl1Plus ];
    };
  };
</code></pre><p>The output can be pasted into <code class="literal">pkgs/top-level/perl-packages.nix</code> or wherever else you need it.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="ssec-perl-cross-compilation" class="title">Cross-compiling modules   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-perl-cross-compilation" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Nixpkgs has experimental support for cross-compiling Perl modules. In many cases, it will just work out of the box, even for modules with native extensions. Sometimes, however, the Makefile.PL for a module may (indirectly) import a native module. In that case, you will need to make a stub for that module that will satisfy the Makefile.PL and install it into <code class="literal">lib/perl5/site_perl/cross_perl/${perl.version}</code>. See the <code class="literal">postInstall</code> for <code class="literal">DBI</code> for an example.</p>
</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-php" class="title" style="clear: both">PHP   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-php" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-php-user-guide">User Guide</a> </span></dt> </dl></div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-php-user-guide" class="title">User Guide   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-php-user-guide" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="ssec-php-user-guide-overview" class="title">Overview   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-php-user-guide-overview" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Several versions of PHP are available on Nix, each of which having a
wide variety of extensions and libraries available.</p><p>The different versions of PHP that nixpkgs provides are located under
attributes named based on major and minor version number; e.g.,
<code class="literal">php81</code> is PHP 8.1.</p><p>Only versions of PHP that are supported by upstream for the entirety
of a given NixOS release will be included in that release of
NixOS. See <a class="link" href="https://www.php.net/supported-versions.php" target="_top">PHP Supported
Versions</a>.</p><p>The attribute <code class="literal">php</code> refers to the version of PHP considered most
stable and thoroughly tested in nixpkgs for any given release of
NixOS - not necessarily the latest major release from upstream.</p><p>All available PHP attributes are wrappers around their respective
binary PHP package and provide commonly used extensions this way. The
real PHP 8.1 package, i.e. the unwrapped one, is available as
<code class="literal">php81.unwrapped</code>; see the next section for more details.</p><p>Interactive tools built on PHP are put in <code class="literal">php.packages</code>; composer is
for example available at <code class="literal">php.packages.composer</code>.</p><p>Most extensions that come with PHP, as well as some popular
third-party ones, are available in <code class="literal">php.extensions</code>; for example, the
opcache extension shipped with PHP is available at
<code class="literal">php.extensions.opcache</code> and the third-party ImageMagick extension at
<code class="literal">php.extensions.imagick</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="ssec-php-user-guide-installing-with-extensions" class="title">Installing PHP with extensions   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-php-user-guide-installing-with-extensions" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>A PHP package with specific extensions enabled can be built using
<code class="literal">php.withExtensions</code>. This is a function which accepts an anonymous
function as its only argument; the function should accept two named
parameters: <code class="literal">enabled</code> - a list of currently enabled extensions and
<code class="literal">all</code> - the set of all extensions, and return a list of wanted
extensions. For example, a PHP package with all default extensions and
ImageMagick enabled:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">php.withExtensions ({ enabled, all }:
  enabled ++ [ all.imagick ])
</code></pre><p>To exclude some, but not all, of the default extensions, you can
filter the <code class="literal">enabled</code> list like this:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">php.withExtensions ({ enabled, all }:
  (lib.filter (e: e != php.extensions.opcache) enabled)
  ++ [ all.imagick ])
</code></pre><p>To build your list of extensions from the ground up, you can
ignore <code class="literal">enabled</code>:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">php.withExtensions ({ all, ... }: <span class="hljs-keyword">with</span> all; [ imagick opcache ])
</code></pre><p><code class="literal">php.withExtensions</code> provides extensions by wrapping a minimal php
base package, providing a <code class="literal">php.ini</code> file listing all extensions to be
loaded. You can access this package through the <code class="literal">php.unwrapped</code>
attribute; useful if you, for example, need access to the <code class="literal">dev</code>
output. The generated <code class="literal">php.ini</code> file can be accessed through the
<code class="literal">php.phpIni</code> attribute.</p><p>If you want a PHP build with extra configuration in the <code class="literal">php.ini</code>
file, you can use <code class="literal">php.buildEnv</code>. This function takes two named and
optional parameters: <code class="literal">extensions</code> and <code class="literal">extraConfig</code>. <code class="literal">extensions</code>
takes an extension specification equivalent to that of
<code class="literal">php.withExtensions</code>, <code class="literal">extraConfig</code> a string of additional <code class="literal">php.ini</code>
configuration parameters. For example, a PHP package with the opcache
and ImageMagick extensions enabled, and <code class="literal">memory_limit</code> set to <code class="literal">256M</code>:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">php.buildEnv {
  <span class="hljs-attr">extensions</span> = { all, ... }: <span class="hljs-keyword">with</span> all; [ imagick opcache ];
  <span class="hljs-attr">extraConfig</span> = <span class="hljs-string">"memory_limit=256M"</span>;
}
</code></pre><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="ssec-php-user-guide-installing-with-extensions-phpfpm" class="title">Example setup for <code class="literal">phpfpm</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-php-user-guide-installing-with-extensions-phpfpm" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>You can use the previous examples in a <code class="literal">phpfpm</code> pool called <code class="literal">foo</code> as
follows:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">let</span>
  <span class="hljs-attr">myPhp</span> = php.withExtensions ({ all, ... }: <span class="hljs-keyword">with</span> all; [ imagick opcache ]);
<span class="hljs-keyword">in</span> {
  services.phpfpm.pools.<span class="hljs-string">"foo"</span>.<span class="hljs-attr">phpPackage</span> = myPhp;
};
</code></pre><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">let</span>
  <span class="hljs-attr">myPhp</span> = php.buildEnv {
    <span class="hljs-attr">extensions</span> = { all, ... }: <span class="hljs-keyword">with</span> all; [ imagick opcache ];
    <span class="hljs-attr">extraConfig</span> = <span class="hljs-string">"memory_limit=256M"</span>;
  };
<span class="hljs-keyword">in</span> {
  services.phpfpm.pools.<span class="hljs-string">"foo"</span>.<span class="hljs-attr">phpPackage</span> = myPhp;
};
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="ssec-php-user-guide-installing-with-extensions-nix-shell" class="title">Example usage with <code class="literal">nix-shell</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-php-user-guide-installing-with-extensions-nix-shell" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>This brings up a temporary environment that contains a PHP interpreter
with the extensions <code class="literal">imagick</code> and <code class="literal">opcache</code> enabled:</p><pre><code class="programlisting sh hljs language-bash" data-highlighted="yes">nix-shell -p <span class="hljs-string">'php.withExtensions ({ all, ... }: with all; [ imagick opcache ])'</span>
</code></pre>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="ssec-php-user-guide-installing-packages-with-extensions" class="title">Installing PHP packages with extensions   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-php-user-guide-installing-packages-with-extensions" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>All interactive tools use the PHP package you get them from, so all
packages at <code class="literal">php.packages.*</code> use the <code class="literal">php</code> package with its default
extensions. Sometimes this default set of extensions isn’t enough and
you may want to extend it. A common case of this is the <code class="literal">composer</code>
package: a project may depend on certain extensions and <code class="literal">composer</code>
won’t work with that project unless those extensions are loaded.</p><p>Example of building <code class="literal">composer</code> with additional extensions:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">(php.withExtensions ({ all, enabled }:
  enabled ++ (<span class="hljs-keyword">with</span> all; [ imagick redis ]))
).packages.composer
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="ssec-php-user-guide-overriding-packages" class="title">Overriding PHP packages   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-php-user-guide-overriding-packages" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><code class="literal">php-packages.nix</code> form a scope, allowing us to override the packages defined
within. For example, to apply a patch to a <code class="literal">mysqlnd</code> extension, you can
pass an overlay-style function to <code class="literal">php</code>’s <code class="literal">packageOverrides</code> argument:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">php.override {
  <span class="hljs-attr">packageOverrides</span> = final: prev: {
    <span class="hljs-attr">extensions</span> = prev.extensions // {
      <span class="hljs-attr">mysqlnd</span> = prev.extensions.mysqlnd.overrideAttrs (attrs: {
        <span class="hljs-attr">patches</span> = attrs.patches <span class="hljs-literal">or</span> [] ++ [
          …
        ];
      });
    };
  };
}
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="ssec-building-php-projects" class="title">Building PHP projects   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-building-php-projects" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>With <a class="link" href="https://getcomposer.org/" target="_top">Composer</a>, you can effectively build PHP
projects by streamlining dependency management. As the de-facto standard
dependency manager for PHP, Composer enables you to declare and manage the
libraries your project relies on, ensuring a more organized and efficient
development process.</p><p>Composer is not a package manager in the same sense as <code class="literal">Yum</code> or <code class="literal">Apt</code> are. Yes,
it deals with “packages” or libraries, but it manages them on a per-project
basis, installing them in a directory (e.g. <code class="literal">vendor</code>) inside your project. By
default, it does not install anything globally. This idea is not new and
Composer is strongly inspired by node’s <code class="literal">npm</code> and ruby’s <code class="literal">bundler</code>.</p><p>Currently, there is no other PHP tool that offers the same functionality as
Composer. Consequently, incorporating a helper in Nix to facilitate building
such applications is a logical choice.</p><p>In a Composer project, dependencies are defined in a <code class="literal">composer.json</code> file,
while their specific versions are locked in a <code class="literal">composer.lock</code> file. Some
Composer-based projects opt to include this <code class="literal">composer.lock</code> file in their source
code, while others choose not to.</p><p>In Nix, there are multiple approaches to building a Composer-based project.</p><p>One such method is the <code class="literal">php.buildComposerProject</code> helper function, which serves
as a wrapper around <code class="literal">mkDerivation</code>.</p><p>Using this function, you can build a PHP project that includes both a
<code class="literal">composer.json</code> and <code class="literal">composer.lock</code> file. If the project specifies binaries
using the <code class="literal">bin</code> attribute in <code class="literal">composer.json</code>, these binaries will be
automatically linked and made accessible in the derivation. In this context,
“binaries” refer to PHP scripts that are intended to be executable.</p><p>To use the helper effectively, add the <code class="literal">vendorHash</code> attribute, which
enables the wrapper to handle the heavy lifting.</p><p>Internally, the helper operates in three stages:</p><div class="orderedlist"><ol class="orderedlist compact" type="1"><li class="listitem"><p>It constructs a <code class="literal">composerRepository</code> attribute derivation by creating a
composer repository on the filesystem containing dependencies specified in
<code class="literal">composer.json</code>. This process uses the function
<code class="literal">php.mkComposerRepository</code> which in turn uses the
<code class="literal">php.composerHooks.composerRepositoryHook</code> hook. Internally this function uses
a custom
<a class="link" href="https://github.com/nix-community/composer-local-repo-plugin" target="_top">Composer plugin</a> to
generate the repository.</p></li><li class="listitem"><p>The resulting <code class="literal">composerRepository</code> derivation is then used by the
<code class="literal">php.composerHooks.composerInstallHook</code> hook, which is responsible for
creating the final <code class="literal">vendor</code> directory.</p></li><li class="listitem"><p>Any “binary” specified in the <code class="literal">composer.json</code> are linked and made accessible
in the derivation.</p></li></ol></div><p>As the autoloader optimization can be activated directly within the
<code class="literal">composer.json</code> file, we do not enable any autoloader optimization flags.</p><p>To customize the PHP version, you can specify the <code class="literal">php</code> attribute. Similarly, if
you wish to modify the Composer version, use the <code class="literal">composer</code> attribute. It is
important to note that both attributes should be of the <code class="literal">derivation</code> type.</p><p>Here’s an example of working code example using <code class="literal">php.buildComposerProject</code>:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ php, fetchFromGitHub }:

php.buildComposerProject (finalAttrs: {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"php-app"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"1.0.0"</span>;

  <span class="hljs-attr">src</span> = fetchFromGitHub {
    <span class="hljs-attr">owner</span> = <span class="hljs-string">"git-owner"</span>;
    <span class="hljs-attr">repo</span> = <span class="hljs-string">"git-repo"</span>;
    <span class="hljs-attr">rev</span> = finalAttrs.version;
    <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-VcQRSss2dssfkJ+iUb5qT+FJ10GHiFDzySigcmuVI+8="</span>;
  };

  <span class="hljs-comment"># PHP version containing the `ast` extension enabled</span>
  <span class="hljs-attr">php</span> = php.buildEnv {
    <span class="hljs-attr">extensions</span> = ({ enabled, all }: enabled ++ (<span class="hljs-keyword">with</span> all; [
      ast
    ]));
  };

  <span class="hljs-comment"># The composer vendor hash</span>
  <span class="hljs-attr">vendorHash</span> = <span class="hljs-string">"sha256-86s/F+/5cBAwBqZ2yaGRM5rTGLmou5//aLRK5SA0WiQ="</span>;

  <span class="hljs-comment"># If the composer.lock file is missing from the repository, add it:</span>
  <span class="hljs-comment"># composerLock = ./path/to/composer.lock;</span>
})
</code></pre><p>In case the file <code class="literal">composer.lock</code> is missing from the repository, it is possible
to specify it using the <code class="literal">composerLock</code> attribute.</p><p>The other method is to use all these methods and hooks individually. This has
the advantage of building a PHP library within another derivation very easily
when necessary.</p><p>Here’s a working code example to build a PHP library using <code class="literal">mkDerivation</code> and
separate functions and hooks:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ stdenvNoCC, fetchFromGitHub, php }:

stdenvNoCC.mkDerivation (finalAttrs:
<span class="hljs-keyword">let</span>
  <span class="hljs-attr">src</span> = fetchFromGitHub {
    <span class="hljs-attr">owner</span> = <span class="hljs-string">"git-owner"</span>;
    <span class="hljs-attr">repo</span> = <span class="hljs-string">"git-repo"</span>;
    <span class="hljs-attr">rev</span> = finalAttrs.version;
    <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-VcQRSss2dssfkJ+iUb5qT+FJ10GHiFDzySigcmuVI+8="</span>;
  };
<span class="hljs-keyword">in</span> {
  <span class="hljs-keyword">inherit</span> src;
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"php-app"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"1.0.0"</span>;

  <span class="hljs-attr">buildInputs</span> = [ php ];

  <span class="hljs-attr">nativeBuildInputs</span> = [
    php.packages.composer
    <span class="hljs-comment"># This hook will use the attribute `composerRepository`</span>
    php.composerHooks.composerInstallHook
  ];

  <span class="hljs-attr">composerRepository</span> = php.mkComposerRepository {
    <span class="hljs-keyword">inherit</span> (finalAttrs) src;
    <span class="hljs-comment"># Specifying a custom composer.lock since it is not present in the sources.</span>
    <span class="hljs-attr">composerLock</span> = ./composer.lock;
    <span class="hljs-comment"># The composer vendor hash</span>
    <span class="hljs-attr">vendorHash</span> = <span class="hljs-string">"sha256-86s/F+/5cBAwBqZ2yaGRM5rTGLmou5//aLRK5SA0WiQ="</span>;
  };
})
</code></pre>
</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-pkg-config" class="title" style="clear: both">pkg-config   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-pkg-config" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#pkg-config-writing-packages">Writing packages providing pkg-config modules</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-pkg-config-usage">Accessing packages via pkg-config module name</a> </span></dt> </dl></div><p><span class="emphasis"><em>pkg-config</em></span> is a unified interface for declaring and querying built C/C++ libraries.</p><p>Nixpkgs provides a couple of facilities for working with this tool.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="pkg-config-writing-packages" class="title">Writing packages providing pkg-config modules   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#pkg-config-writing-packages" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Packages should set <code class="literal">meta.pkgConfigModules</code> with the list of package config modules they provide.
They should also use <code class="literal">testers.testMetaPkgConfig</code> to check that the final built package matches that list.
Additionally, the <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#validatepkgconfig" target="_top"><code class="literal">validatePkgConfig</code> setup hook</a>, will do extra checks on to-be-installed pkg-config modules.</p><p>A good example of all these things is zlib:</p><pre><code class="programlisting hljs language-nix" data-highlighted="yes">{ pkg-config, testers, ... }:

stdenv.mkDerivation (finalAttrs: {
  ...

  <span class="hljs-attr">nativeBuildInputs</span> = [ pkg-config validatePkgConfig ];

  passthru.tests.<span class="hljs-attr">pkg-config</span> = testers.testMetaPkgConfig finalAttrs.finalPackage;

  <span class="hljs-attr">meta</span> = {
    ...
    <span class="hljs-attr">pkgConfigModules</span> = [ <span class="hljs-string">"zlib"</span> ];
  };
})
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-pkg-config-usage" class="title">Accessing packages via pkg-config module name   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-pkg-config-usage" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="sec-pkg-config-usage-internal" class="title">Within Nixpkgs   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-pkg-config-usage-internal" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>A <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#setup-hook-pkg-config" title="pkg-config">setup hook</a> is bundled in the <code class="literal">pkg-config</code> package to bring a derivation’s declared build inputs into the environment.
This will populate environment variables like <code class="literal">PKG_CONFIG_PATH</code>, <code class="literal">PKG_CONFIG_PATH_FOR_BUILD</code>, and <code class="literal">PKG_CONFIG_PATH_HOST</code> based on:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>how <code class="literal">pkg-config</code> itself is depended upon</p></li><li class="listitem"><p>how other dependencies are depended upon</p></li></ul></div><p>For more details see the section on <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ssec-stdenv-dependencies" title="Specifying dependencies">specifying dependencies in general</a>.</p><p>Normal pkg-config commands to look up dependencies by name will then work with those environment variables defined by the hook.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="sec-pkg-config-usage-external" class="title">Externally   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-pkg-config-usage-external" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>The <code class="literal">defaultPkgConfigPackages</code> package set is a set of aliases, named after the modules they provide.
This is meant to be used by language-to-nix integrations.
Hand-written packages should use the normal Nixpkgs attribute name instead.</p>
</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="python" class="title" style="clear: both">Python   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#python" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#reference">Reference</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#user-guide">User Guide</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#faq">FAQ</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#contributing">Contributing</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#python-package-set-maintenance">Package set maintenance</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#python-cpython-update-schedule">CPython Update Schedule</a> </span></dt> </dl></div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="reference" class="title">Reference   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#reference" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="interpreters" class="title">Interpreters   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#interpreters" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><div class="informaltable"><table class="informaltable" border="1"><colgroup><col align="left"><col align="left"><col align="left"></colgroup><thead><tr><th align="left">Package</th><th align="left">Aliases</th><th align="left">Interpreter</th></tr></thead><tbody><tr><td align="left">python27</td><td align="left">python2, python</td><td align="left">CPython 2.7</td></tr><tr><td align="left">python38</td><td align="left"></td><td align="left">CPython 3.8</td></tr><tr><td align="left">python39</td><td align="left"></td><td align="left">CPython 3.9</td></tr><tr><td align="left">python310</td><td align="left"></td><td align="left">CPython 3.10</td></tr><tr><td align="left">python311</td><td align="left">python3</td><td align="left">CPython 3.11</td></tr><tr><td align="left">python312</td><td align="left"></td><td align="left">CPython 3.12</td></tr><tr><td align="left">python313</td><td align="left"></td><td align="left">CPython 3.13</td></tr><tr><td align="left">pypy27</td><td align="left">pypy2, pypy</td><td align="left">PyPy2.7</td></tr><tr><td align="left">pypy39</td><td align="left">pypy3</td><td align="left">PyPy 3.9</td></tr></tbody></table></div><p>The Nix expressions for the interpreters can be found in
<code class="literal">pkgs/development/interpreters/python</code>.</p><p>All packages depending on any Python interpreter get appended
<code class="literal">out/{python.sitePackages}</code> to <code class="literal">$PYTHONPATH</code> if such directory
exists.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="missing-tkinter-module-standard-library" class="title">Missing <code class="literal">tkinter</code> module standard library   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#missing-tkinter-module-standard-library" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>To reduce closure size the <code class="literal">Tkinter</code>/<code class="literal">tkinter</code> is available as a separate package, <code class="literal">pythonPackages.tkinter</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="attributes-on-interpreters-packages" class="title">Attributes on interpreters packages   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#attributes-on-interpreters-packages" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Each interpreter has the following attributes:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">libPrefix</code>. Name of the folder in <code class="literal">${python}/lib/</code> for corresponding interpreter.</p></li><li class="listitem"><p><code class="literal">interpreter</code>. Alias for <code class="literal">${python}/bin/${executable}</code>.</p></li><li class="listitem"><p><code class="literal">buildEnv</code>. Function to build python interpreter environments with extra packages bundled together. See <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#python.buildenv-function" title="python.buildEnv function">the section called “<code class="literal">python.buildEnv</code> function”</a> for usage and documentation.</p></li><li class="listitem"><p><code class="literal">withPackages</code>. Simpler interface to <code class="literal">buildEnv</code>. See <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#python.withpackages-function" title="python.withPackages function">the section called “<code class="literal">python.withPackages</code> function”</a> for usage and documentation.</p></li><li class="listitem"><p><code class="literal">sitePackages</code>. Alias for <code class="literal">lib/${libPrefix}/site-packages</code>.</p></li><li class="listitem"><p><code class="literal">executable</code>. Name of the interpreter executable, e.g. <code class="literal">python3.10</code>.</p></li><li class="listitem"><p><code class="literal">pkgs</code>. Set of Python packages for that specific interpreter. The package set can be modified by overriding the interpreter and passing <code class="literal">packageOverrides</code>.</p></li></ul></div>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="building-packages-and-applications" class="title">Building packages and applications   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#building-packages-and-applications" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Python libraries and applications that use <code class="literal">setuptools</code> or
<code class="literal">distutils</code> are typically built with respectively the <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#buildpythonpackage-function" title="buildPythonPackage function"><code class="literal">buildPythonPackage</code></a> and
<a class="link" href="https://nixos.org/manual/nixpkgs/stable/#buildpythonapplication-function" title="buildPythonApplication function"><code class="literal">buildPythonApplication</code></a> functions. These two functions also support installing a <code class="literal">wheel</code>.</p><p>All Python packages reside in <code class="literal">pkgs/top-level/python-packages.nix</code> and all
applications elsewhere. In case a package is used as both a library and an
application, then the package should be in <code class="literal">pkgs/top-level/python-packages.nix</code>
since only those packages are made available for all interpreter versions. The
preferred location for library expressions is in
<code class="literal">pkgs/development/python-modules</code>. It is important that these packages are
called from <code class="literal">pkgs/top-level/python-packages.nix</code> and not elsewhere, to guarantee
the right version of the package is built.</p><p>Based on the packages defined in <code class="literal">pkgs/top-level/python-packages.nix</code> an
attribute set is created for each available Python interpreter. The available
sets are</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">pkgs.python27Packages</code></p></li><li class="listitem"><p><code class="literal">pkgs.python3Packages</code></p></li><li class="listitem"><p><code class="literal">pkgs.python38Packages</code></p></li><li class="listitem"><p><code class="literal">pkgs.python39Packages</code></p></li><li class="listitem"><p><code class="literal">pkgs.python310Packages</code></p></li><li class="listitem"><p><code class="literal">pkgs.python311Packages</code></p></li><li class="listitem"><p><code class="literal">pkgs.python312Packages</code></p></li><li class="listitem"><p><code class="literal">pkgs.python313Packages</code></p></li><li class="listitem"><p><code class="literal">pkgs.pypyPackages</code></p></li></ul></div><p>and the aliases</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">pkgs.python2Packages</code> pointing to <code class="literal">pkgs.python27Packages</code></p></li><li class="listitem"><p><code class="literal">pkgs.python3Packages</code> pointing to <code class="literal">pkgs.python311Packages</code></p></li><li class="listitem"><p><code class="literal">pkgs.pythonPackages</code> pointing to <code class="literal">pkgs.python2Packages</code></p></li></ul></div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="buildpythonpackage-function" class="title"><code class="literal">buildPythonPackage</code> function   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#buildpythonpackage-function" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>The <code class="literal">buildPythonPackage</code> function is implemented in
<code class="literal">pkgs/development/interpreters/python/mk-python-derivation.nix</code>
using setup hooks.</p><p>The following is an example:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ lib
, buildPythonPackage
, fetchPypi

<span class="hljs-comment"># build-system</span>
, setuptools-scm

<span class="hljs-comment"># dependencies</span>
, attrs
, pluggy
, py
, setuptools
, six

<span class="hljs-comment"># tests</span>
, hypothesis
 }:

buildPythonPackage <span class="hljs-keyword">rec</span> {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"pytest"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"3.3.1"</span>;
  <span class="hljs-attr">pyproject</span> = <span class="hljs-literal">true</span>;

  <span class="hljs-attr">src</span> = fetchPypi {
    <span class="hljs-keyword">inherit</span> pname version;
    <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-z4Q23FnYaVNG/NOrKW3kZCXsqwDWQJbOvnn7Ueyy65M="</span>;
  };

  <span class="hljs-attr">postPatch</span> = <span class="hljs-string">''
    # don't test bash builtins
    rm testing/test_argcomplete.py
  ''</span>;

  <span class="hljs-attr">nativeBuildInputs</span> = [
    setuptools-scm
  ];

  <span class="hljs-attr">propagatedBuildInputs</span> = [
    attrs
    py
    setuptools
    six
    pluggy
  ];

  <span class="hljs-attr">nativeCheckInputs</span> = [
    hypothesis
  ];

  <span class="hljs-attr">meta</span> = <span class="hljs-keyword">with</span> lib; {
    <span class="hljs-attr">changelog</span> = <span class="hljs-string">"https://github.com/pytest-dev/pytest/releases/tag/<span class="hljs-subst">${version}</span>"</span>;
    <span class="hljs-attr">description</span> = <span class="hljs-string">"Framework for writing tests"</span>;
    <span class="hljs-attr">homepage</span> = <span class="hljs-string">"https://github.com/pytest-dev/pytest"</span>;
    <span class="hljs-attr">license</span> = licenses.mit;
    <span class="hljs-attr">maintainers</span> = <span class="hljs-keyword">with</span> maintainers; [ domenkozar lovek323 madjar lsix ];
  };
}
</code></pre><p>The <code class="literal">buildPythonPackage</code> mainly does four things:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>In the <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#build-phase" title="The build phase"><code class="literal">buildPhase</code></a>, it calls <code class="literal">${python.pythonOnBuildForHost.interpreter} setup.py bdist_wheel</code> to
build a wheel binary zipfile.</p></li><li class="listitem"><p>In the <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ssec-install-phase" title="The install phase"><code class="literal">installPhase</code></a>, it installs the wheel file using <code class="literal">pip install *.whl</code>.</p></li><li class="listitem"><p>In the <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-postFixup" title="postFixup"><code class="literal">postFixup</code></a> phase, the <code class="literal">wrapPythonPrograms</code> bash function is called to
wrap all programs in the <code class="literal">$out/bin/*</code> directory to include <code class="literal">$PATH</code>
environment variable and add dependent libraries to script’s <code class="literal">sys.path</code>.</p></li><li class="listitem"><p>In the <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ssec-installCheck-phase" title="The installCheck phase"><code class="literal">installCheck</code></a> phase, <code class="literal">${python.interpreter} setup.py test</code> is run.</p></li></ul></div><p>By default tests are run because <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-doCheck" title="doCheck"><code class="literal">doCheck = true</code></a>. Test dependencies, like
e.g. the test runner, should be added to <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-nativeCheckInputs" title="nativeCheckInputs"><code class="literal">nativeCheckInputs</code></a>.</p><p>By default <code class="literal">meta.platforms</code> is set to the same value
as the interpreter unless overridden otherwise.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h6 id="buildpythonpackage-parameters" class="title"><code class="literal">buildPythonPackage</code> parameters   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#buildpythonpackage-parameters" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h6>  </div> </div></div><p>All parameters from <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#sec-using-stdenv" title="Using stdenv"><code class="literal">stdenv.mkDerivation</code></a> function are still supported. The
following are specific to <code class="literal">buildPythonPackage</code>:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">catchConflicts ? true</code>: If <code class="literal">true</code>, abort package build if a package name
appears more than once in dependency tree. Default is <code class="literal">true</code>.</p></li><li class="listitem"><p><code class="literal">disabled ? false</code>: If <code class="literal">true</code>, package is not built for the particular Python
interpreter version.</p></li><li class="listitem"><p><code class="literal">dontWrapPythonPrograms ? false</code>: Skip wrapping of Python programs.</p></li><li class="listitem"><p><code class="literal">permitUserSite ? false</code>: Skip setting the <code class="literal">PYTHONNOUSERSITE</code> environment
variable in wrapped programs.</p></li><li class="listitem"><p><code class="literal">pyproject</code>: Whether the pyproject format should be used. When set to <code class="literal">true</code>,
<code class="literal">pypaBuildHook</code> will be used, and you can add the required build dependencies
from <code class="literal">build-system.requires</code> to <code class="literal">nativeBuildInputs</code>. Note that the pyproject
format falls back to using <code class="literal">setuptools</code>, so you can use <code class="literal">pyproject = true</code>
even if the package only has a <code class="literal">setup.py</code>. When set to <code class="literal">false</code>, you can
use the existing [hooks](#setup-hooks0 or provide your own logic to build the
package. This can be useful for packages that don’t support the pyproject
format. When unset, the legacy <code class="literal">setuptools</code> hooks are used for backwards
compatibility.</p></li><li class="listitem"><p><code class="literal">makeWrapperArgs ? []</code>: A list of strings. Arguments to be passed to
<a class="link" href="https://nixos.org/manual/nixpkgs/stable/#fun-makeWrapper" title="makeWrapper &lt;executable&gt; &lt;wrapperfile&gt; &lt;args&gt;"><code class="literal">makeWrapper</code></a>, which wraps generated binaries. By default, the arguments to
<a class="link" href="https://nixos.org/manual/nixpkgs/stable/#fun-makeWrapper" title="makeWrapper &lt;executable&gt; &lt;wrapperfile&gt; &lt;args&gt;"><code class="literal">makeWrapper</code></a> set <code class="literal">PATH</code> and <code class="literal">PYTHONPATH</code> environment variables before calling
the binary. Additional arguments here can allow a developer to set environment
variables which will be available when the binary is run. For example,
<code class="literal">makeWrapperArgs = ["--set FOO BAR" "--set BAZ QUX"]</code>.</p></li><li class="listitem"><p><code class="literal">namePrefix</code>: Prepends text to <code class="literal">${name}</code> parameter. In case of libraries, this
defaults to <code class="literal">"python3.8-"</code> for Python 3.8, etc., and in case of applications to <code class="literal">""</code>.</p></li><li class="listitem"><p><code class="literal">pipInstallFlags ? []</code>: A list of strings. Arguments to be passed to <code class="literal">pip install</code>. To pass options to <code class="literal">python setup.py install</code>, use
<code class="literal">--install-option</code>. E.g., <code class="literal">pipInstallFlags=["--install-option='--cpp_implementation'"]</code>.</p></li><li class="listitem"><p><code class="literal">pipBuildFlags ? []</code>: A list of strings. Arguments to be passed to <code class="literal">pip wheel</code>.</p></li><li class="listitem"><p><code class="literal">pypaBuildFlags ? []</code>: A list of strings. Arguments to be passed to <code class="literal">python -m build --wheel</code>.</p></li><li class="listitem"><p><code class="literal">pythonPath ? []</code>: List of packages to be added into <code class="literal">$PYTHONPATH</code>. Packages
in <code class="literal">pythonPath</code> are not propagated (contrary to <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-propagatedBuildInputs" title="propagatedBuildInputs"><code class="literal">propagatedBuildInputs</code></a>).</p></li><li class="listitem"><p><code class="literal">preShellHook</code>: Hook to execute commands before <code class="literal">shellHook</code>.</p></li><li class="listitem"><p><code class="literal">postShellHook</code>: Hook to execute commands after <code class="literal">shellHook</code>.</p></li><li class="listitem"><p><code class="literal">removeBinByteCode ? true</code>: Remove bytecode from <code class="literal">/bin</code>. Bytecode is only
created when the filenames end with <code class="literal">.py</code>.</p></li><li class="listitem"><p><code class="literal">setupPyGlobalFlags ? []</code>: List of flags passed to <code class="literal">setup.py</code> command.</p></li><li class="listitem"><p><code class="literal">setupPyBuildFlags ? []</code>: List of flags passed to <code class="literal">setup.py build_ext</code> command.</p></li></ul></div><p>The <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#sec-using-stdenv" title="Using stdenv"><code class="literal">stdenv.mkDerivation</code></a> function accepts various parameters for describing
build inputs (see “Specifying dependencies”). The following are of special
interest for Python packages, either because these are primarily used, or
because their behaviour is different:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">nativeBuildInputs ? []</code>: Build-time only dependencies. Typically executables
as well as the items listed in <code class="literal">setup_requires</code>.</p></li><li class="listitem"><p><code class="literal">buildInputs ? []</code>: Build and/or run-time dependencies that need to be
compiled for the host machine. Typically non-Python libraries which are being
linked.</p></li><li class="listitem"><p><code class="literal">nativeCheckInputs ? []</code>: Dependencies needed for running the <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ssec-check-phase" title="The check phase"><code class="literal">checkPhase</code></a>. These
are added to <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-nativeBuildInputs" title="nativeBuildInputs"><code class="literal">nativeBuildInputs</code></a> when <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-doCheck" title="doCheck"><code class="literal">doCheck = true</code></a>. Items listed in
<code class="literal">tests_require</code> go here.</p></li><li class="listitem"><p><code class="literal">propagatedBuildInputs ? []</code>: Aside from propagating dependencies,
<code class="literal">buildPythonPackage</code> also injects code into and wraps executables with the
paths included in this list. Items listed in <code class="literal">install_requires</code> go here.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h6 id="overriding-python-packages" class="title">Overriding Python packages   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#overriding-python-packages" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h6>  </div> </div></div><p>The <code class="literal">buildPythonPackage</code> function has a <code class="literal">overridePythonAttrs</code> method that can be
used to override the package. In the following example we create an environment
where we have the <code class="literal">blaze</code> package using an older version of <code class="literal">pandas</code>. We
override first the Python interpreter and pass <code class="literal">packageOverrides</code> which contains
the overrides for packages in the package set.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">with</span> <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {};

(<span class="hljs-keyword">let</span>
  <span class="hljs-attr">python</span> = <span class="hljs-keyword">let</span>
    <span class="hljs-attr">packageOverrides</span> = self: super: {
      <span class="hljs-attr">pandas</span> = super.pandas.overridePythonAttrs(old: <span class="hljs-keyword">rec</span> {
        <span class="hljs-attr">version</span> = <span class="hljs-string">"0.19.1"</span>;
        <span class="hljs-attr">src</span> =  fetchPypi {
          <span class="hljs-attr">pname</span> = <span class="hljs-string">"pandas"</span>;
          <span class="hljs-keyword">inherit</span> version;
          <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-JQn+rtpy/OA2deLszSKEuxyttqBzcAil50H+JDHUdCE="</span>;
        };
      });
    };
  <span class="hljs-keyword">in</span> pkgs.python3.override {<span class="hljs-keyword">inherit</span> packageOverrides; <span class="hljs-attr">self</span> = python;};

<span class="hljs-keyword">in</span> python.withPackages(ps: [ ps.blaze ])).env
</code></pre><p>The next example shows a non trivial overriding of the <code class="literal">blas</code> implementation to
be used through out all of the Python package set:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">python3MyBlas</span> = pkgs.python3.override {
  <span class="hljs-attr">packageOverrides</span> = self: super: {
    <span class="hljs-comment"># We need toPythonModule for the package set to evaluate this</span>
    <span class="hljs-attr">blas</span> = super.toPythonModule(super.pkgs.blas.override {
      <span class="hljs-attr">blasProvider</span> = super.pkgs.mkl;
    });
    <span class="hljs-attr">lapack</span> = super.toPythonModule(super.pkgs.lapack.override {
      <span class="hljs-attr">lapackProvider</span> = super.pkgs.mkl;
    });
  };
};
</code></pre><p>This is particularly useful for numpy and scipy users who want to gain speed with other blas implementations.
Note that using <code class="literal">scipy = super.scipy.override { blas = super.pkgs.mkl; };</code> will likely result in
compilation issues, because scipy dependencies need to use the same blas implementation as well.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="buildpythonapplication-function" class="title"><code class="literal">buildPythonApplication</code> function   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#buildpythonapplication-function" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>The <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#buildpythonapplication-function" title="buildPythonApplication function"><code class="literal">buildPythonApplication</code></a> function is practically the same as
<a class="link" href="https://nixos.org/manual/nixpkgs/stable/#buildpythonpackage-function" title="buildPythonPackage function"><code class="literal">buildPythonPackage</code></a>. The main purpose of this function is to build a Python
package where one is interested only in the executables, and not importable
modules. For that reason, when adding this package to a <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#python.buildenv-function" title="python.buildEnv function"><code class="literal">python.buildEnv</code></a>, the
modules won’t be made available.</p><p>Another difference is that <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#buildpythonpackage-function" title="buildPythonPackage function"><code class="literal">buildPythonPackage</code></a> by default prefixes the names of
the packages with the version of the interpreter. Because this is irrelevant for
applications, the prefix is omitted.</p><p>When packaging a Python application with <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#buildpythonapplication-function" title="buildPythonApplication function"><code class="literal">buildPythonApplication</code></a>, it should be
called with <code class="literal">callPackage</code> and passed <code class="literal">python3</code> or <code class="literal">python3Packages</code> (possibly
specifying an interpreter version), like this:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ lib
, python3Packages
, fetchPypi
}:

python3Packages.buildPythonApplication <span class="hljs-keyword">rec</span> {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"luigi"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"2.7.9"</span>;
  <span class="hljs-attr">pyproject</span> = <span class="hljs-literal">true</span>;

  <span class="hljs-attr">src</span> = fetchPypi {
    <span class="hljs-keyword">inherit</span> pname version;
    <span class="hljs-attr">hash</span>  = <span class="hljs-string">"sha256-Pe229rT0aHwA98s+nTHQMEFKZPo/yw6sot8MivFDvAw="</span>;
  };

  <span class="hljs-attr">nativeBuildInputs</span> = [
    python3Packages.setuptools
    python3Packages.wheel
  ];

  <span class="hljs-attr">propagatedBuildInputs</span> = [
    python3Packages.tornado
    python3Packages.python-daemon
  ];

  <span class="hljs-attr">meta</span> = <span class="hljs-keyword">with</span> lib; {
    <span class="hljs-comment"># ...</span>
  };
}
</code></pre><p>This is then added to <code class="literal">all-packages.nix</code> just as any other application would be.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">luigi</span> = callPackage ../applications/networking/cluster/luigi { };
</code></pre><p>Since the package is an application, a consumer doesn’t need to care about
Python versions or modules, which is why they don’t go in <code class="literal">python3Packages</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="topythonapplication-function" class="title"><code class="literal">toPythonApplication</code> function   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#topythonapplication-function" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>A distinction is made between applications and libraries, however, sometimes a
package is used as both. In this case the package is added as a library to
<code class="literal">python-packages.nix</code> and as an application to <code class="literal">all-packages.nix</code>. To reduce
duplication the <code class="literal">toPythonApplication</code> can be used to convert a library to an
application.</p><p>The Nix expression shall use <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#buildpythonpackage-function" title="buildPythonPackage function"><code class="literal">buildPythonPackage</code></a> and be called from
<code class="literal">python-packages.nix</code>. A reference shall be created from <code class="literal">all-packages.nix</code> to
the attribute in <code class="literal">python-packages.nix</code>, and the <code class="literal">toPythonApplication</code> shall be
applied to the reference:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">youtube-dl</span> = <span class="hljs-keyword">with</span> python3Packages; toPythonApplication youtube-dl;
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="topythonmodule-function" class="title"><code class="literal">toPythonModule</code> function   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#topythonmodule-function" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>In some cases, such as bindings, a package is created using
<a class="link" href="https://nixos.org/manual/nixpkgs/stable/#sec-using-stdenv" title="Using stdenv"><code class="literal">stdenv.mkDerivation</code></a> and added as attribute in <code class="literal">all-packages.nix</code>. The Python
bindings should be made available from <code class="literal">python-packages.nix</code>. The
<code class="literal">toPythonModule</code> function takes a derivation and makes certain Python-specific
modifications.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">opencv</span> = toPythonModule (pkgs.opencv.override {
  <span class="hljs-attr">enablePython</span> = <span class="hljs-literal">true</span>;
  <span class="hljs-attr">pythonPackages</span> = self;
});
</code></pre><p>Do pay attention to passing in the right Python version!</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="python.buildenv-function" class="title"><code class="literal">python.buildEnv</code> function   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#python.buildenv-function" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Python environments can be created using the low-level <code class="literal">pkgs.buildEnv</code> function.
This example shows how to create an environment that has the Pyramid Web Framework.
Saving the following as <code class="literal">default.nix</code></p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">with</span> <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {};

python3.buildEnv.override {
  <span class="hljs-attr">extraLibs</span> = [ python3Packages.pyramid ];
  <span class="hljs-attr">ignoreCollisions</span> = <span class="hljs-literal">true</span>;
}
</code></pre><p>and running <code class="literal">nix-build</code> will create</p><pre><code class="programlisting hljs language-bash" data-highlighted="yes">/nix/store/cf1xhjwzmdki7fasgr4kz6di72ykicl5-python-2.7.8-env
</code></pre><p>with wrapped binaries in <code class="literal">bin/</code>.</p><p>You can also use the <code class="literal">env</code> attribute to create local environments with needed
packages installed. This is somewhat comparable to <code class="literal">virtualenv</code>. For example,
running <code class="literal">nix-shell</code> with the following <code class="literal">shell.nix</code></p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">with</span> <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {};

(python3.buildEnv.override {
  <span class="hljs-attr">extraLibs</span> = <span class="hljs-keyword">with</span> python3Packages; [
    numpy
    requests
  ];
}).env
</code></pre><p>will drop you into a shell where Python will have the
specified packages in its path.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h6 id="python.buildenv-arguments" class="title"><code class="literal">python.buildEnv</code> arguments   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#python.buildenv-arguments" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h6>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">extraLibs</code>: List of packages installed inside the environment.</p></li><li class="listitem"><p><code class="literal">postBuild</code>: Shell command executed after the build of environment.</p></li><li class="listitem"><p><code class="literal">ignoreCollisions</code>: Ignore file collisions inside the environment (default is <code class="literal">false</code>).</p></li><li class="listitem"><p><code class="literal">permitUserSite</code>: Skip setting the <code class="literal">PYTHONNOUSERSITE</code> environment variable in
wrapped binaries in the environment.</p></li></ul></div>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="python.withpackages-function" class="title"><code class="literal">python.withPackages</code> function   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#python.withpackages-function" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>The <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#python.withpackages-function" title="python.withPackages function"><code class="literal">python.withPackages</code></a> function provides a simpler interface to the <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#python.buildenv-function" title="python.buildEnv function"><code class="literal">python.buildEnv</code></a> functionality.
It takes a function as an argument that is passed the set of python packages and returns the list
of the packages to be included in the environment. Using the <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#python.withpackages-function" title="python.withPackages function"><code class="literal">withPackages</code></a> function, the previous
example for the Pyramid Web Framework environment can be written like this:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">with</span> <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {};

python.withPackages (ps: [ ps.pyramid ])
</code></pre><p><a class="link" href="https://nixos.org/manual/nixpkgs/stable/#python.withpackages-function" title="python.withPackages function"><code class="literal">withPackages</code></a> passes the correct package set for the specific interpreter
version as an argument to the function. In the above example, <code class="literal">ps</code> equals
<code class="literal">pythonPackages</code>. But you can also easily switch to using python3:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">with</span> <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {};

python3.withPackages (ps: [ ps.pyramid ])
</code></pre><p>Now, <code class="literal">ps</code> is set to <code class="literal">python3Packages</code>, matching the version of the interpreter.</p><p>As <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#python.withpackages-function" title="python.withPackages function"><code class="literal">python.withPackages</code></a> uses <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#python.buildenv-function" title="python.buildEnv function"><code class="literal">python.buildEnv</code></a> under the hood, it also
supports the <code class="literal">env</code> attribute. The <code class="literal">shell.nix</code> file from the previous section can
thus be also written like this:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">with</span> <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {};

(python3.withPackages (ps: <span class="hljs-keyword">with</span> ps; [
  numpy
  requests
])).env
</code></pre><p>In contrast to <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#python.buildenv-function" title="python.buildEnv function"><code class="literal">python.buildEnv</code></a>, <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#python.withpackages-function" title="python.withPackages function"><code class="literal">python.withPackages</code></a> does not support the
more advanced options such as <code class="literal">ignoreCollisions = true</code> or <code class="literal">postBuild</code>. If you
need them, you have to use <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#python.buildenv-function" title="python.buildEnv function"><code class="literal">python.buildEnv</code></a>.</p><p>Python 2 namespace packages may provide <code class="literal">__init__.py</code> that collide. In that case
<a class="link" href="https://nixos.org/manual/nixpkgs/stable/#python.buildenv-function" title="python.buildEnv function"><code class="literal">python.buildEnv</code></a> should be used with <code class="literal">ignoreCollisions = true</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="setup-hooks" class="title">Setup hooks   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#setup-hooks" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>The following are setup hooks specifically for Python packages. Most of these
are used in <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#buildpythonpackage-function" title="buildPythonPackage function"><code class="literal">buildPythonPackage</code></a>.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">eggUnpackhook</code> to move an egg to the correct folder so it can be installed
with the <code class="literal">eggInstallHook</code></p></li><li class="listitem"><p><code class="literal">eggBuildHook</code> to skip building for eggs.</p></li><li class="listitem"><p><code class="literal">eggInstallHook</code> to install eggs.</p></li><li class="listitem"><p><code class="literal">pipBuildHook</code> to build a wheel using <code class="literal">pip</code> and PEP 517. Note a build system
(e.g. <code class="literal">setuptools</code> or <code class="literal">flit</code>) should still be added as <code class="literal">nativeBuildInput</code>.</p></li><li class="listitem"><p><code class="literal">pypaBuildHook</code> to build a wheel using
<a class="link" href="https://pypa-build.readthedocs.io/en/latest/index.html" target="_top"><code class="literal">pypa/build</code></a> and
PEP 517/518. Note a build system (e.g. <code class="literal">setuptools</code> or <code class="literal">flit</code>) should still
be added as <code class="literal">nativeBuildInput</code>.</p></li><li class="listitem"><p><code class="literal">pipInstallHook</code> to install wheels.</p></li><li class="listitem"><p><code class="literal">pytestCheckHook</code> to run tests with <code class="literal">pytest</code>. See <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#using-pytestcheckhook" title="Using pytestCheckHook">example usage</a>.</p></li><li class="listitem"><p><code class="literal">pythonCatchConflictsHook</code> to check whether a Python package is not already existing.</p></li><li class="listitem"><p><code class="literal">pythonImportsCheckHook</code> to check whether importing the listed modules works.</p></li><li class="listitem"><p><code class="literal">pythonRelaxDepsHook</code> will relax Python dependencies restrictions for the package.
See <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#using-pythonrelaxdepshook" title="Using pythonRelaxDepsHook">example usage</a>.</p></li><li class="listitem"><p><code class="literal">pythonRemoveBinBytecode</code> to remove bytecode from the <code class="literal">/bin</code> folder.</p></li><li class="listitem"><p><code class="literal">setuptoolsBuildHook</code> to build a wheel using <code class="literal">setuptools</code>.</p></li><li class="listitem"><p><code class="literal">setuptoolsCheckHook</code> to run tests with <code class="literal">python setup.py test</code>.</p></li><li class="listitem"><p><code class="literal">sphinxHook</code> to build documentation and manpages using Sphinx.</p></li><li class="listitem"><p><code class="literal">venvShellHook</code> to source a Python 3 <code class="literal">venv</code> at the <code class="literal">venvDir</code> location. A
<code class="literal">venv</code> is created if it does not yet exist. <code class="literal">postVenvCreation</code> can be used to
to run commands only after venv is first created.</p></li><li class="listitem"><p><code class="literal">wheelUnpackHook</code> to move a wheel to the correct folder so it can be installed
with the <code class="literal">pipInstallHook</code>.</p></li><li class="listitem"><p><code class="literal">unittestCheckHook</code> will run tests with <code class="literal">python -m unittest discover</code>. See <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#using-unittestcheckhook" title="Using unittestCheckHook">example usage</a>.</p></li></ul></div>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="development-mode" class="title">Development mode   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#development-mode" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Development or editable mode is supported. To develop Python packages
<a class="link" href="https://nixos.org/manual/nixpkgs/stable/#buildpythonpackage-function" title="buildPythonPackage function"><code class="literal">buildPythonPackage</code></a> has additional logic inside <code class="literal">shellPhase</code> to run <code class="literal">pip install -e . --prefix $TMPDIR/</code>for the package.</p><p>Warning: <code class="literal">shellPhase</code> is executed only if <code class="literal">setup.py</code> exists.</p><p>Given a <code class="literal">default.nix</code>:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">with</span> <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {};

python3Packages.buildPythonPackage {
  <span class="hljs-attr">name</span> = <span class="hljs-string">"myproject"</span>;
  <span class="hljs-attr">buildInputs</span> = <span class="hljs-keyword">with</span> python3Packages; [ pyramid ];

  <span class="hljs-attr">src</span> = ./.;
}
</code></pre><p>Running <code class="literal">nix-shell</code> with no arguments should give you the environment in which
the package would be built with <code class="literal">nix-build</code>.</p><p>Shortcut to setup environments with C headers/libraries and Python packages:</p><pre><code class="programlisting shell hljs language-shell" data-highlighted="yes">nix-shell -p python3Packages.pyramid zlib libjpeg git
</code></pre><div class="note"><h3 class="title">Note</h3><p>There is a boolean value <code class="literal">lib.inNixShell</code> set to <code class="literal">true</code> if nix-shell is invoked.</p></div>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="user-guide" class="title">User Guide   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#user-guide" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="using-python" class="title">Using Python   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#using-python" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="overview" class="title">Overview   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#overview" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Several versions of the Python interpreter are available on Nix, as well as a
high amount of packages. The attribute <code class="literal">python3</code> refers to the default
interpreter, which is currently CPython 3.11. The attribute <code class="literal">python</code> refers to
CPython 2.7 for backwards-compatibility. It is also possible to refer to
specific versions, e.g. <code class="literal">python311</code> refers to CPython 3.11, and <code class="literal">pypy</code> refers to
the default PyPy interpreter.</p><p>Python is used a lot, and in different ways. This affects also how it is
packaged. In the case of Python on Nix, an important distinction is made between
whether the package is considered primarily an application, or whether it should
be used as a library, i.e., of primary interest are the modules in
<code class="literal">site-packages</code> that should be importable.</p><p>In the Nixpkgs tree Python applications can be found throughout, depending on
what they do, and are called from the main package set. Python libraries,
however, are in separate sets, with one set per interpreter version.</p><p>The interpreters have several common attributes. One of these attributes is
<code class="literal">pkgs</code>, which is a package set of Python libraries for this specific
interpreter. E.g., the <code class="literal">toolz</code> package corresponding to the default interpreter
is <code class="literal">python3.pkgs.toolz</code>, and the CPython 3.11 version is <code class="literal">python311.pkgs.toolz</code>.
The main package set contains aliases to these package sets, e.g.
<code class="literal">pythonPackages</code> refers to <code class="literal">python.pkgs</code> and <code class="literal">python311Packages</code> to
<code class="literal">python311.pkgs</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="installing-python-and-packages" class="title">Installing Python and packages   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#installing-python-and-packages" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>The Nix and NixOS manuals explain how packages are generally installed. In the
case of Python and Nix, it is important to make a distinction between whether the
package is considered an application or a library.</p><p>Applications on Nix are typically installed into your user profile imperatively
using <code class="literal">nix-env -i</code>, and on NixOS declaratively by adding the package name to
<code class="literal">environment.systemPackages</code> in <code class="literal">/etc/nixos/configuration.nix</code>. Dependencies
such as libraries are automatically installed and should not be installed
explicitly.</p><p>The same goes for Python applications. Python applications can be installed in
your profile, and will be wrapped to find their exact library dependencies,
without impacting other applications or polluting your user environment.</p><p>But Python libraries you would like to use for development cannot be installed,
at least not individually, because they won’t be able to find each other
resulting in import errors. Instead, it is possible to create an environment
with <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#python.buildenv-function" title="python.buildEnv function"><code class="literal">python.buildEnv</code></a> or <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#python.withpackages-function" title="python.withPackages function"><code class="literal">python.withPackages</code></a> where the interpreter and other
executables are wrapped to be able to find each other and all of the modules.</p><p>In the following examples we will start by creating a simple, ad-hoc environment
with a nix-shell that has <code class="literal">numpy</code> and <code class="literal">toolz</code> in Python 3.11; then we will create
a re-usable environment in a single-file Python script; then we will create a
full Python environment for development with this same environment.</p><p>Philosophically, this should be familiar to users who are used to a <code class="literal">venv</code> style
of development: individual projects create their own Python environments without
impacting the global environment or each other.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="ad-hoc-temporary-python-environment-with-nix-shell" class="title">Ad-hoc temporary Python environment with <code class="literal">nix-shell</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ad-hoc-temporary-python-environment-with-nix-shell" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>The simplest way to start playing with the way nix wraps and sets up Python
environments is with <code class="literal">nix-shell</code> at the cmdline. These environments create a
temporary shell session with a Python and a <span class="emphasis"><em>precise</em></span> list of packages (plus
their runtime dependencies), with no other Python packages in the Python
interpreter’s scope.</p><p>To create a Python 3.11 session with <code class="literal">numpy</code> and <code class="literal">toolz</code> available, run:</p><pre><code class="programlisting sh hljs language-bash" data-highlighted="yes">$ nix-shell -p <span class="hljs-string">'python311.withPackages(ps: with ps; [ numpy toolz ])'</span>
</code></pre><p>By default <code class="literal">nix-shell</code> will start a <code class="literal">bash</code> session with this interpreter in our
<code class="literal">PATH</code>, so if we then run:</p><pre><code class="programlisting Python console hljs language-shell" data-highlighted="yes">[nix-shell:~/src/nixpkgs]$ python3
Python 3.11.3 (main, Apr  4 2023, 22:36:41) [GCC 12.2.0] on linux
Type "help", "copyright", "credits" or "license" for more information.
<span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; import numpy; import toolz</span>
</code></pre><p>Note that no other modules are in scope, even if they were imperatively
installed into our user environment as a dependency of a Python application:</p><pre><code class="programlisting Python console hljs language-shell" data-highlighted="yes"><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; import requests</span>
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
ModuleNotFoundError: No module named 'requests'
</code></pre><p>We can add as many additional modules onto the <code class="literal">nix-shell</code> as we need, and we
will still get 1 wrapped Python interpreter. We can start the interpreter
directly like so:</p><pre><code class="programlisting sh hljs language-bash" data-highlighted="yes">$ nix-shell -p <span class="hljs-string">"python311.withPackages (ps: with ps; [ numpy toolz requests ])"</span> --run python3
this derivation will be built:
  /nix/store/r19yf5qgfiakqlhkgjahbg3zg79549n4-python3-3.11.2-env.drv
building <span class="hljs-string">'/nix/store/r19yf5qgfiakqlhkgjahbg3zg79549n4-python3-3.11.2-env.drv'</span>...
created 273 symlinks <span class="hljs-keyword">in</span> user environment
Python 3.11.2 (main, Feb  7 2023, 13:52:42) [GCC 12.2.0] on linux
Type <span class="hljs-string">"help"</span>, <span class="hljs-string">"copyright"</span>, <span class="hljs-string">"credits"</span> or <span class="hljs-string">"license"</span> <span class="hljs-keyword">for</span> more information.
&gt;&gt;&gt; import requests
&gt;&gt;&gt;
</code></pre><p>Notice that this time it built a new Python environment, which now includes
<code class="literal">requests</code>. Building an environment just creates wrapper scripts that expose the
selected dependencies to the interpreter while re-using the actual modules. This
means if any other env has installed <code class="literal">requests</code> or <code class="literal">numpy</code> in a different
context, we don’t need to recompile them – we just recompile the wrapper script
that sets up an interpreter pointing to them. This matters much more for “big”
modules like <code class="literal">pytorch</code> or <code class="literal">tensorflow</code>.</p><p>Module names usually match their names on <a class="link" href="https://pypi.org/" target="_top">pypi.org</a>, but
you can use the <a class="link" href="https://nixos.org/nixos/packages.html" target="_top">Nixpkgs search website</a>
to find them as well (along with non-python packages).</p><p>At this point we can create throwaway experimental Python environments with
arbitrary dependencies. This is a good way to get a feel for how the Python
interpreter and dependencies work in Nix and NixOS, but to do some actual
development, we’ll want to make it a bit more persistent.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h6 id="running-python-scripts-and-using-nix-shell-as-shebang" class="title">Running Python scripts and using <code class="literal">nix-shell</code> as shebang   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#running-python-scripts-and-using-nix-shell-as-shebang" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h6>  </div> </div></div><p>Sometimes, we have a script whose header looks like this:</p><pre><code class="programlisting python hljs language-nix" data-highlighted="yes"><span class="hljs-comment">#!/usr/bin/env python3</span>
<span class="hljs-built_in">import</span> numpy as np
<span class="hljs-attr">a</span> = np.array([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>])
<span class="hljs-attr">b</span> = np.array([<span class="hljs-number">3</span>,<span class="hljs-number">4</span>])
print(f<span class="hljs-string">"The dot product of {a} and {b} is: {np.dot(a, b)}"</span>)
</code></pre><p>Executing this script requires a <code class="literal">python3</code> that has <code class="literal">numpy</code>. Using what we learned
in the previous section, we could startup a shell and just run it like so:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">nix-shell -p <span class="hljs-string">'python311.withPackages (ps: with ps; [ numpy ])'</span> --run <span class="hljs-string">'python3 foo.py'</span></span>
The dot product of [1 2] and [3 4] is: 11
</code></pre><p>But if we maintain the script ourselves, and if there are more dependencies, it
may be nice to encode those dependencies in source to make the script re-usable
without that bit of knowledge. That can be done by using <code class="literal">nix-shell</code> as a
<a class="link" href="https://en.wikipedia.org/wiki/Shebang_(Unix)" target="_top">shebang</a>, like so:</p><pre><code class="programlisting python hljs language-nix" data-highlighted="yes"><span class="hljs-comment">#!/usr/bin/env nix-shell</span>
<span class="hljs-comment">#!nix-shell -i python3 -p "python3.withPackages(ps: [ ps.numpy ])"</span>
<span class="hljs-built_in">import</span> numpy as np
<span class="hljs-attr">a</span> = np.array([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>])
<span class="hljs-attr">b</span> = np.array([<span class="hljs-number">3</span>,<span class="hljs-number">4</span>])
print(f<span class="hljs-string">"The dot product of {a} and {b} is: {np.dot(a, b)}"</span>)
</code></pre><p>Then we execute it, without requiring any environment setup at all!</p><pre><code class="programlisting sh hljs language-bash" data-highlighted="yes">$ ./foo.py
The dot product of [1 2] and [3 4] is: 11
</code></pre><p>If the dependencies are not available on the host where <code class="literal">foo.py</code> is executed, it
will build or download them from a Nix binary cache prior to starting up, prior
that it is executed on a machine with a multi-user nix installation.</p><p>This provides a way to ship a self bootstrapping Python script, akin to a
statically linked binary, where it can be run on any machine (provided nix is
installed) without having to assume that <code class="literal">numpy</code> is installed globally on the
system.</p><p>By default it is pulling the import checkout of Nixpkgs itself from our nix
channel, which is nice as it cache aligns with our other package builds, but we
can make it fully reproducible by pinning the <code class="literal">nixpkgs</code> import:</p><pre><code class="programlisting python hljs language-shell" data-highlighted="yes"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/usr/bin/env nix-shell</span>
<span class="hljs-meta prompt_">#</span><span class="language-bash">!nix-shell -i python3 -p <span class="hljs-string">"python3.withPackages (ps: [ ps.numpy ])"</span></span>
<span class="hljs-meta prompt_">#</span><span class="language-bash">!nix-shell -I nixpkgs=https://github.com/NixOS/nixpkgs/archive/e51209796c4262bfb8908e3d6d72302fe4e96f5f.tar.gz</span>
import numpy as np
a = np.array([1,2])
b = np.array([3,4])
print(f"The dot product of {a} and {b} is: {np.dot(a, b)}")
</code></pre><p>This will execute with the exact same versions of Python 3.10, numpy, and system
dependencies a year from now as it does today, because it will always use
exactly git commit <code class="literal">e51209796c4262bfb8908e3d6d72302fe4e96f5f</code> of Nixpkgs for all
of the package versions.</p><p>This is also a great way to ensure the script executes identically on different
servers.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h6 id="load-environment-from-.nix-expression" class="title">Load environment from <code class="literal">.nix</code> expression   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#load-environment-from-.nix-expression" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h6>  </div> </div></div><p>We’ve now seen how to create an ad-hoc temporary shell session, and how to
create a single script with Python dependencies, but in the course of normal
development we’re usually working in an entire package repository.</p><p>As explained <a class="link" href="https://nixos.org/manual/nix/stable/command-ref/nix-shell" target="_top">in the <code class="literal">nix-shell</code> section</a> of the Nix manual, <code class="literal">nix-shell</code> can also load an expression from a <code class="literal">.nix</code> file.
Say we want to have Python 3.11, <code class="literal">numpy</code> and <code class="literal">toolz</code>, like before,
in an environment. We can add a <code class="literal">shell.nix</code> file describing our dependencies:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">with</span> <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {};
(python311.withPackages (ps: <span class="hljs-keyword">with</span> ps; [
  numpy
  toolz
])).env
</code></pre><p>And then at the command line, just typing <code class="literal">nix-shell</code> produces the same
environment as before. In a normal project, we’ll likely have many more
dependencies; this can provide a way for developers to share the environments
with each other and with CI builders.</p><p>What’s happening here?</p><div class="orderedlist"><ol class="orderedlist compact" type="1"><li class="listitem"><p>We begin with importing the Nix Packages collections. <code class="literal">import &lt;nixpkgs&gt;</code>
imports the <code class="literal">&lt;nixpkgs&gt;</code> function, <code class="literal">{}</code> calls it and the <code class="literal">with</code> statement
brings all attributes of <code class="literal">nixpkgs</code> in the local scope. These attributes form
the main package set.</p></li><li class="listitem"><p>Then we create a Python 3.11 environment with the <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#python.withpackages-function" title="python.withPackages function"><code class="literal">withPackages</code></a> function, as before.</p></li><li class="listitem"><p>The <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#python.withpackages-function" title="python.withPackages function"><code class="literal">withPackages</code></a> function expects us to provide a function as an argument
that takes the set of all Python packages and returns a list of packages to
include in the environment. Here, we select the packages <code class="literal">numpy</code> and <code class="literal">toolz</code>
from the package set.</p></li></ol></div><p>To combine this with <code class="literal">mkShell</code> you can:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">with</span> <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {};
<span class="hljs-keyword">let</span>
  <span class="hljs-attr">pythonEnv</span> = python311.withPackages (ps: [
    ps.numpy
    ps.toolz
  ]);
<span class="hljs-keyword">in</span> mkShell {
  <span class="hljs-attr">packages</span> = [
    pythonEnv

    black
    mypy

    libffi
    openssl
  ];
}
</code></pre><p>This will create a unified environment that has not just our Python interpreter
and its Python dependencies, but also tools like <code class="literal">black</code> or <code class="literal">mypy</code> and libraries
like <code class="literal">libffi</code> the <code class="literal">openssl</code> in scope. This is generic and can span any number of
tools or languages across the Nixpkgs ecosystem.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h6 id="installing-environments-globally-on-the-system" class="title">Installing environments globally on the system   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#installing-environments-globally-on-the-system" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h6>  </div> </div></div><p>Up to now, we’ve been creating environments scoped to an ad-hoc shell session,
or a single script, or a single project. This is generally advisable, as it
avoids pollution across contexts.</p><p>However, sometimes we know we will often want a Python with some basic packages,
and want this available without having to enter into a shell or build context.
This can be useful to have things like vim/emacs editors and plugins or shell
tools “just work” without having to set them up, or when running other software
that expects packages to be installed globally.</p><p>To create your own custom environment, create a file in <code class="literal">~/.config/nixpkgs/overlays/</code>
that looks like this:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-comment"># ~/.config/nixpkgs/overlays/myEnv.nix</span>
self: super: {
  <span class="hljs-attr">myEnv</span> = super.buildEnv {
    <span class="hljs-attr">name</span> = <span class="hljs-string">"myEnv"</span>;
    <span class="hljs-attr">paths</span> = [
      <span class="hljs-comment"># A Python 3 interpreter with some packages</span>
      (self.python3.withPackages (
        ps: <span class="hljs-keyword">with</span> ps; [
          pyflakes
          pytest
          black
        ]
      ))

      <span class="hljs-comment"># Some other packages we'd like as part of this env</span>
      self.mypy
      self.black
      self.ripgrep
      self.tmux
    ];
  };
}
</code></pre><p>You can then build and install this to your profile with:</p><pre><code class="programlisting sh hljs language-bash" data-highlighted="yes">nix-env -iA myEnv
</code></pre><p>One limitation of this is that you can only have 1 Python env installed
globally, since they conflict on the <code class="literal">python</code> to load out of your <code class="literal">PATH</code>.</p><p>If you get a conflict or prefer to keep the setup clean, you can have <code class="literal">nix-env</code>
atomically <span class="emphasis"><em>uninstall</em></span> all other imperatively installed packages and replace
your profile with just <code class="literal">myEnv</code> by using the <code class="literal">--replace</code> flag.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h6 id="environment-defined-in-etcnixosconfiguration.nix" class="title">Environment defined in <code class="literal">/etc/nixos/configuration.nix</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#environment-defined-in-etcnixosconfiguration.nix" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h6>  </div> </div></div><p>For the sake of completeness, here’s how to install the environment system-wide
on NixOS.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ <span class="hljs-comment"># ...</span>

  environment.<span class="hljs-attr">systemPackages</span> = <span class="hljs-keyword">with</span> pkgs; [
    (python310.withPackages(ps: <span class="hljs-keyword">with</span> ps; [ numpy toolz ]))
  ];
}
</code></pre>
</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="developing-with-python" class="title">Developing with Python   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#developing-with-python" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Above, we were mostly just focused on use cases and what to do to get started
creating working Python environments in nix.</p><p>Now that you know the basics to be up and running, it is time to take a step
back and take a deeper look at how Python packages are packaged on Nix. Then,
we will look at how you can use development mode with your code.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="python-library-packages-in-nixpkgs" class="title">Python library packages in Nixpkgs   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#python-library-packages-in-nixpkgs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>With Nix all packages are built by functions. The main function in Nix for
building Python libraries is <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#buildpythonpackage-function" title="buildPythonPackage function"><code class="literal">buildPythonPackage</code></a>. Let’s see how we can build the
<code class="literal">toolz</code> package.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ lib
, buildPythonPackage
, fetchPypi
, setuptools
, wheel
}:

buildPythonPackage <span class="hljs-keyword">rec</span> {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"toolz"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"0.10.0"</span>;
  <span class="hljs-attr">pyproject</span> = <span class="hljs-literal">true</span>;

  <span class="hljs-attr">src</span> = fetchPypi {
    <span class="hljs-keyword">inherit</span> pname version;
    <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-CP3V73yWSArRHBLUct4hrNMjWZlvaaUlkpm1QP66RWA="</span>;
  };

  <span class="hljs-attr">nativeBuildInputs</span> = [
    setuptools
    wheel
  ];

  <span class="hljs-comment"># has no tests</span>
  <span class="hljs-attr">doCheck</span> = <span class="hljs-literal">false</span>;

  <span class="hljs-attr">pythonImportsCheck</span> = [
    <span class="hljs-string">"toolz.itertoolz"</span>
    <span class="hljs-string">"toolz.functoolz"</span>
    <span class="hljs-string">"toolz.dicttoolz"</span>
  ];

  <span class="hljs-attr">meta</span> = <span class="hljs-keyword">with</span> lib; {
    <span class="hljs-attr">changelog</span> = <span class="hljs-string">"https://github.com/pytoolz/toolz/releases/tag/<span class="hljs-subst">${version}</span>"</span>;
    <span class="hljs-attr">homepage</span> = <span class="hljs-string">"https://github.com/pytoolz/toolz"</span>;
    <span class="hljs-attr">description</span> = <span class="hljs-string">"List processing tools and functional utilities"</span>;
    <span class="hljs-attr">license</span> = licenses.bsd3;
    <span class="hljs-attr">maintainers</span> = <span class="hljs-keyword">with</span> maintainers; [ fridh ];
  };
}
</code></pre><p>What happens here? The function <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#buildpythonpackage-function" title="buildPythonPackage function"><code class="literal">buildPythonPackage</code></a> is called and as argument
it accepts a set. In this case the set is a recursive set, <code class="literal">rec</code>. One of the
arguments is the name of the package, which consists of a basename (generally
following the name on PyPi) and a version. Another argument, <code class="literal">src</code> specifies the
source, which in this case is fetched from PyPI using the helper function
<code class="literal">fetchPypi</code>. The argument <code class="literal">doCheck</code> is used to set whether tests should be run
when building the package. Since there are no tests, we rely on <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#using-pythonimportscheck" title="Using pythonImportsCheck"><code class="literal">pythonImportsCheck</code></a>
to test whether the package can be imported. Furthermore, we specify some meta
information. The output of the function is a derivation.</p><p>An expression for <code class="literal">toolz</code> can be found in the Nixpkgs repository. As explained
in the introduction of this Python section, a derivation of <code class="literal">toolz</code> is available
for each interpreter version, e.g. <code class="literal">python311.pkgs.toolz</code> refers to the <code class="literal">toolz</code>
derivation corresponding to the CPython 3.11 interpreter.</p><p>The above example works when you’re directly working on
<code class="literal">pkgs/top-level/python-packages.nix</code> in the Nixpkgs repository. Often though,
you will want to test a Nix expression outside of the Nixpkgs tree.</p><p>The following expression creates a derivation for the <code class="literal">toolz</code> package,
and adds it along with a <code class="literal">numpy</code> package to a Python environment.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">with</span> <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {};

( <span class="hljs-keyword">let</span>
    <span class="hljs-attr">my_toolz</span> = python311.pkgs.buildPythonPackage <span class="hljs-keyword">rec</span> {
      <span class="hljs-attr">pname</span> = <span class="hljs-string">"toolz"</span>;
      <span class="hljs-attr">version</span> = <span class="hljs-string">"0.10.0"</span>;
      <span class="hljs-attr">pyproject</span> = <span class="hljs-literal">true</span>;

      <span class="hljs-attr">src</span> = fetchPypi {
        <span class="hljs-keyword">inherit</span> pname version;
        <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-CP3V73yWSArRHBLUct4hrNMjWZlvaaUlkpm1QP66RWA="</span>;
      };

      <span class="hljs-attr">nativeBuildInputs</span> = [
        python311.pkgs.setuptools
        python311.pkgs.wheel
      ];

      <span class="hljs-comment"># has no tests</span>
      <span class="hljs-attr">doCheck</span> = <span class="hljs-literal">false</span>;

      <span class="hljs-attr">meta</span> = {
        <span class="hljs-attr">homepage</span> = <span class="hljs-string">"https://github.com/pytoolz/toolz/"</span>;
        <span class="hljs-attr">description</span> = <span class="hljs-string">"List processing tools and functional utilities"</span>;
        <span class="hljs-comment"># [...]</span>
      };
    };

  <span class="hljs-keyword">in</span> python311.withPackages (ps: <span class="hljs-keyword">with</span> ps; [
    numpy
    my_toolz
  ])
).env
</code></pre><p>Executing <code class="literal">nix-shell</code> will result in an environment in which you can use
Python 3.11 and the <code class="literal">toolz</code> package. As you can see we had to explicitly mention
for which Python version we want to build a package.</p><p>So, what did we do here? Well, we took the Nix expression that we used earlier
to build a Python environment, and said that we wanted to include our own
version of <code class="literal">toolz</code>, named <code class="literal">my_toolz</code>. To introduce our own package in the scope
of <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#python.withpackages-function" title="python.withPackages function"><code class="literal">withPackages</code></a> we used a <code class="literal">let</code> expression. You can see that we used
<code class="literal">ps.numpy</code> to select numpy from the nixpkgs package set (<code class="literal">ps</code>). We did not take
<code class="literal">toolz</code> from the Nixpkgs package set this time, but instead took our own version
that we introduced with the <code class="literal">let</code> expression.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="handling-dependencies" class="title">Handling dependencies   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#handling-dependencies" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Our example, <code class="literal">toolz</code>, does not have any dependencies on other Python packages or
system libraries. According to the manual, <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#buildpythonpackage-function" title="buildPythonPackage function"><code class="literal">buildPythonPackage</code></a> uses the
arguments <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-buildInputs" title="buildInputs"><code class="literal">buildInputs</code></a> and <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-propagatedBuildInputs" title="propagatedBuildInputs"><code class="literal">propagatedBuildInputs</code></a> to specify dependencies. If
something is exclusively a build-time dependency, then the dependency should be
included in <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-buildInputs" title="buildInputs"><code class="literal">buildInputs</code></a>, but if it is (also) a runtime dependency, then it
should be added to <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-propagatedBuildInputs" title="propagatedBuildInputs"><code class="literal">propagatedBuildInputs</code></a>. Test dependencies are considered
build-time dependencies and passed to <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-nativeCheckInputs" title="nativeCheckInputs"><code class="literal">nativeCheckInputs</code></a>.</p><p>The following example shows which arguments are given to <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#buildpythonpackage-function" title="buildPythonPackage function"><code class="literal">buildPythonPackage</code></a> in
order to build <a class="link" href="https://github.com/blaze/datashape" target="_top"><code class="literal">datashape</code></a>.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ lib
, buildPythonPackage
, fetchPypi

<span class="hljs-comment"># build dependencies</span>
, setuptools, wheel

<span class="hljs-comment"># dependencies</span>
, numpy, multipledispatch, python-dateutil

<span class="hljs-comment"># tests</span>
, pytest
}:

buildPythonPackage <span class="hljs-keyword">rec</span> {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"datashape"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"0.4.7"</span>;
  <span class="hljs-attr">pyproject</span> = <span class="hljs-literal">true</span>;

  <span class="hljs-attr">src</span> = fetchPypi {
    <span class="hljs-keyword">inherit</span> pname version;
    <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-FLLvdm1MllKrgTGC6Gb0k0deZeVYvtCCLji/B7uhong="</span>;
  };

  <span class="hljs-attr">nativeBuildInputs</span> = [
    setuptools
    wheel
  ];

  <span class="hljs-attr">propagatedBuildInputs</span> = [
    multipledispatch
    numpy
    python-dateutil
  ];

  <span class="hljs-attr">nativeCheckInputs</span> = [
    pytest
  ];

  <span class="hljs-attr">meta</span> = <span class="hljs-keyword">with</span> lib; {
    <span class="hljs-attr">changelog</span> = <span class="hljs-string">"https://github.com/blaze/datashape/releases/tag/<span class="hljs-subst">${version}</span>"</span>;
    <span class="hljs-attr">homepage</span> = <span class="hljs-string">"https://github.com/ContinuumIO/datashape"</span>;
    <span class="hljs-attr">description</span> = <span class="hljs-string">"A data description language"</span>;
    <span class="hljs-attr">license</span> = licenses.bsd2;
    <span class="hljs-attr">maintainers</span> = <span class="hljs-keyword">with</span> maintainers; [ fridh ];
  };
}
</code></pre><p>We can see several runtime dependencies, <code class="literal">numpy</code>, <code class="literal">multipledispatch</code>, and
<code class="literal">python-dateutil</code>. Furthermore, we have <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-nativeCheckInputs" title="nativeCheckInputs"><code class="literal">nativeCheckInputs</code></a> with <code class="literal">pytest</code>.
<code class="literal">pytest</code> is a test runner and is only used during the <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ssec-check-phase" title="The check phase"><code class="literal">checkPhase</code></a> and is
therefore not added to <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-propagatedBuildInputs" title="propagatedBuildInputs"><code class="literal">propagatedBuildInputs</code></a>.</p><p>In the previous case we had only dependencies on other Python packages to consider.
Occasionally you have also system libraries to consider. E.g., <code class="literal">lxml</code> provides
Python bindings to <code class="literal">libxml2</code> and <code class="literal">libxslt</code>. These libraries are only required
when building the bindings and are therefore added as <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-buildInputs" title="buildInputs"><code class="literal">buildInputs</code></a>.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ lib
, buildPythonPackage
, fetchPypi
, setuptools
, wheel
, libxml2
, libxslt
}:

buildPythonPackage <span class="hljs-keyword">rec</span> {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"lxml"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"3.4.4"</span>;
  <span class="hljs-attr">pyproject</span> = <span class="hljs-literal">true</span>;

  <span class="hljs-attr">src</span> = fetchPypi {
    <span class="hljs-keyword">inherit</span> pname version;
    <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-s9NiusRxFydHzaNRMjjxFcvWxfi45jGb9ql6eJJyQJk="</span>;
  };

  <span class="hljs-attr">nativeBuildInputs</span> = [
    setuptools
    wheel
  ];

  <span class="hljs-attr">buildInputs</span> = [
    libxml2
    libxslt
  ];

  <span class="hljs-attr">meta</span> = <span class="hljs-keyword">with</span> lib; {
    <span class="hljs-attr">changelog</span> = <span class="hljs-string">"https://github.com/lxml/lxml/releases/tag/lxml-<span class="hljs-subst">${version}</span>"</span>;
    <span class="hljs-attr">description</span> = <span class="hljs-string">"Pythonic binding for the libxml2 and libxslt libraries"</span>;
    <span class="hljs-attr">homepage</span> = <span class="hljs-string">"https://lxml.de"</span>;
    <span class="hljs-attr">license</span> = licenses.bsd3;
    <span class="hljs-attr">maintainers</span> = <span class="hljs-keyword">with</span> maintainers; [ sjourdois ];
  };
}
</code></pre><p>In this example <code class="literal">lxml</code> and Nix are able to work out exactly where the relevant
files of the dependencies are. This is not always the case.</p><p>The example below shows bindings to The Fastest Fourier Transform in the West,
commonly known as FFTW. On Nix we have separate packages of FFTW for the
different types of floats (<code class="literal">"single"</code>, <code class="literal">"double"</code>, <code class="literal">"long-double"</code>). The
bindings need all three types, and therefore we add all three as <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-buildInputs" title="buildInputs"><code class="literal">buildInputs</code></a>.
The bindings don’t expect to find each of them in a different folder, and
therefore we have to set <code class="literal">LDFLAGS</code> and <code class="literal">CFLAGS</code>.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ lib
, buildPythonPackage
, fetchPypi

<span class="hljs-comment"># build dependencies</span>
, setuptools
, wheel

<span class="hljs-comment"># dependencies</span>
, fftw
, fftwFloat
, fftwLongDouble
, numpy
, scipy
}:

buildPythonPackage <span class="hljs-keyword">rec</span> {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"pyFFTW"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"0.9.2"</span>;
  <span class="hljs-attr">pyproject</span> = <span class="hljs-literal">true</span>;

  <span class="hljs-attr">src</span> = fetchPypi {
    <span class="hljs-keyword">inherit</span> pname version;
    <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-9ru2r6kwhUCaskiFoaPNuJCfCVoUL01J40byvRt4kHQ="</span>;
  };

  <span class="hljs-attr">nativeBuildInputs</span> = [
    setuptools
    wheel
  ];

  <span class="hljs-attr">buildInputs</span> = [
    fftw
    fftwFloat
    fftwLongDouble
  ];

  <span class="hljs-attr">propagatedBuildInputs</span> = [
    numpy
    scipy
  ];

  <span class="hljs-attr">preConfigure</span> = <span class="hljs-string">''
    export LDFLAGS="-L<span class="hljs-subst">${fftw.dev}</span>/lib -L<span class="hljs-subst">${fftwFloat.out}</span>/lib -L<span class="hljs-subst">${fftwLongDouble.out}</span>/lib"
    export CFLAGS="-I<span class="hljs-subst">${fftw.dev}</span>/include -I<span class="hljs-subst">${fftwFloat.dev}</span>/include -I<span class="hljs-subst">${fftwLongDouble.dev}</span>/include"
  ''</span>;

  <span class="hljs-comment"># Tests cannot import pyfftw. pyfftw works fine though.</span>
  <span class="hljs-attr">doCheck</span> = <span class="hljs-literal">false</span>;

  <span class="hljs-attr">meta</span> = <span class="hljs-keyword">with</span> lib; {
    <span class="hljs-attr">changelog</span> = <span class="hljs-string">"https://github.com/pyFFTW/pyFFTW/releases/tag/v<span class="hljs-subst">${version}</span>"</span>;
    <span class="hljs-attr">description</span> = <span class="hljs-string">"A pythonic wrapper around FFTW, the FFT library, presenting a unified interface for all the supported transforms"</span>;
    <span class="hljs-attr">homepage</span> = <span class="hljs-string">"http://hgomersall.github.com/pyFFTW"</span>;
    <span class="hljs-attr">license</span> = <span class="hljs-keyword">with</span> licenses; [ bsd2 bsd3 ];
    <span class="hljs-attr">maintainers</span> = <span class="hljs-keyword">with</span> maintainers; [ fridh ];
  };
}
</code></pre><p>Note also the line <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-doCheck" title="doCheck"><code class="literal">doCheck = false;</code></a>, we explicitly disabled running the test-suite.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="testing-python-packages" class="title">Testing Python Packages   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#testing-python-packages" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>It is highly encouraged to have testing as part of the package build. This
helps to avoid situations where the package was able to build and install,
but is not usable at runtime. Currently, all packages will use the <code class="literal">test</code>
command provided by the setup.py (i.e. <code class="literal">python setup.py test</code>). However,
this is currently deprecated https://github.com/pypa/setuptools/pull/1878
and your package should provide its own <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ssec-check-phase" title="The check phase"><code class="literal">checkPhase</code></a>.</p><div class="note"><h3 class="title">Note</h3><p>The <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ssec-check-phase" title="The check phase"><code class="literal">checkPhase</code></a> for python maps to the <code class="literal">installCheckPhase</code> on a
normal derivation. This is due to many python packages not behaving well
to the pre-installed version of the package. Version info, and natively
compiled extensions generally only exist in the install directory, and
thus can cause issues when a test suite asserts on that behavior.</p></div><div class="note"><h3 class="title">Note</h3><p>Tests should only be disabled if they don’t agree with nix
(e.g. external dependencies, network access, flakey tests), however,
as many tests should be enabled as possible. Failing tests can still be
a good indication that the package is not in a valid state.</p></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="using-pytest" class="title">Using pytest   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#using-pytest" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Pytest is the most common test runner for python repositories. A trivial
test run would be:</p><pre><code class="programlisting hljs language-bash" data-highlighted="yes">  nativeCheckInputs = [ pytest ];
  checkPhase = <span class="hljs-string">''</span>
    runHook preCheck

    pytest

    runHook postCheck
  <span class="hljs-string">''</span>;
</code></pre><p>However, many repositories’ test suites do not translate well to nix’s build
sandbox, and will generally need many tests to be disabled.</p><p>To filter tests using pytest, one can do the following:</p><pre><code class="programlisting hljs language-bash" data-highlighted="yes">  nativeCheckInputs = [ pytest ];
  <span class="hljs-comment"># avoid tests which need additional data or touch network</span>
  checkPhase = <span class="hljs-string">''</span>
    runHook preCheck

    pytest tests/ --ignore=tests/integration -k <span class="hljs-string">'not download and not update'</span> --ignore=tests/test_failing.py

    runHook postCheck
  <span class="hljs-string">''</span>;
</code></pre><p><code class="literal">--ignore</code> will tell pytest to ignore that file or directory from being
collected as part of a test run. This is useful is a file uses a package
which is not available in nixpkgs, thus skipping that test file is much
easier than having to create a new package.</p><p><code class="literal">-k</code> is used to define a predicate for test names. In this example, we are
filtering out tests which contain <code class="literal">download</code> or <code class="literal">update</code> in their test case name.
Only one <code class="literal">-k</code> argument is allowed, and thus a long predicate should be concatenated
with “\” and wrapped to the next line.</p><div class="note"><h3 class="title">Note</h3><p>In pytest==6.0.1, the use of “\” to continue a line (e.g. <code class="literal">-k 'not download \'</code>) has
been removed, in this case, it’s recommended to use <code class="literal">pytestCheckHook</code>.</p></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="using-pytestcheckhook" class="title">Using pytestCheckHook   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#using-pytestcheckhook" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p><code class="literal">pytestCheckHook</code> is a convenient hook which will substitute the setuptools
<code class="literal">test</code> command for a <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ssec-check-phase" title="The check phase"><code class="literal">checkPhase</code></a> which runs <code class="literal">pytest</code>. This is also beneficial
when a package may need many items disabled to run the test suite.</p><p>Using the example above, the analogous <code class="literal">pytestCheckHook</code> usage would be:</p><pre><code class="programlisting hljs language-nix" data-highlighted="yes">  <span class="hljs-attr">nativeCheckInputs</span> = [
    pytestCheckHook
  ];

  <span class="hljs-comment"># requires additional data</span>
  <span class="hljs-attr">pytestFlagsArray</span> = [
    <span class="hljs-string">"tests/"</span>
    <span class="hljs-string">"--ignore=tests/integration"</span>
  ];

  <span class="hljs-attr">disabledTests</span> = [
    <span class="hljs-comment"># touches network</span>
    <span class="hljs-string">"download"</span>
    <span class="hljs-string">"update"</span>
  ];

  <span class="hljs-attr">disabledTestPaths</span> = [
    <span class="hljs-string">"tests/test_failing.py"</span>
  ];
</code></pre><p>This is especially useful when tests need to be conditionally disabled,
for example:</p><pre><code class="programlisting hljs language-nix" data-highlighted="yes">  <span class="hljs-attr">disabledTests</span> = [
    <span class="hljs-comment"># touches network</span>
    <span class="hljs-string">"download"</span>
    <span class="hljs-string">"update"</span>
  ] ++ lib.optionals (pythonAtLeast <span class="hljs-string">"3.8"</span>) [
    <span class="hljs-comment"># broken due to python3.8 async changes</span>
    <span class="hljs-string">"async"</span>
  ] ++ lib.optionals stdenv.isDarwin [
    <span class="hljs-comment"># can fail when building with other packages</span>
    <span class="hljs-string">"socket"</span>
  ];
</code></pre><p>Trying to concatenate the related strings to disable tests in a regular
<a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ssec-check-phase" title="The check phase"><code class="literal">checkPhase</code></a> would be much harder to read. This also enables us to comment on
why specific tests are disabled.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="using-pythonimportscheck" class="title">Using pythonImportsCheck   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#using-pythonimportscheck" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Although unit tests are highly preferred to validate correctness of a package, not
all packages have test suites that can be run easily, and some have none at all.
To help ensure the package still works, <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#using-pythonimportscheck" title="Using pythonImportsCheck"><code class="literal">pythonImportsCheck</code></a> can attempt to import
the listed modules.</p><pre><code class="programlisting hljs language-nix" data-highlighted="yes">  <span class="hljs-attr">pythonImportsCheck</span> = [
    <span class="hljs-string">"requests"</span>
    <span class="hljs-string">"urllib"</span>
  ];
</code></pre><p>roughly translates to:</p><pre><code class="programlisting hljs language-bash" data-highlighted="yes">  postCheck = <span class="hljs-string">''</span>
    PYTHONPATH=<span class="hljs-variable">$out</span>/<span class="hljs-variable">${python.sitePackages}</span>:<span class="hljs-variable">$PYTHONPATH</span>
    python -c <span class="hljs-string">"import requests; import urllib"</span>
  <span class="hljs-string">''</span>;
</code></pre><p>However, this is done in its own phase, and not dependent on whether <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-doCheck" title="doCheck"><code class="literal">doCheck = true;</code></a>.</p><p>This can also be useful in verifying that the package doesn’t assume commonly
present packages (e.g. <code class="literal">setuptools</code>).</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="using-pythonrelaxdepshook" class="title">Using pythonRelaxDepsHook   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#using-pythonrelaxdepshook" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>It is common for upstream to specify a range of versions for its package
dependencies. This makes sense, since it ensures that the package will be built
with a subset of packages that is well tested. However, this commonly causes
issues when packaging in Nixpkgs, because the dependencies that this package
may need are too new or old for the package to build correctly. We also cannot
package multiple versions of the same package since this may cause conflicts
in <code class="literal">PYTHONPATH</code>.</p><p>One way to side step this issue is to relax the dependencies. This can be done
by either removing the package version range or by removing the package
declaration entirely. This can be done using the <code class="literal">pythonRelaxDepsHook</code> hook. For
example, given the following <code class="literal">requirements.txt</code> file:</p><pre><code class="programlisting hljs language-shell" data-highlighted="yes">pkg1&lt;1.0
pkg2
<span class="hljs-meta prompt_">pkg3&gt;</span><span class="language-bash">=1.0,&lt;=2.0</span>
</code></pre><p>we can do:</p><pre><code class="programlisting hljs language-nix" data-highlighted="yes">  <span class="hljs-attr">nativeBuildInputs</span> = [
    pythonRelaxDepsHook
  ];
  <span class="hljs-attr">pythonRelaxDeps</span> = [
    <span class="hljs-string">"pkg1"</span>
    <span class="hljs-string">"pkg3"</span>
  ];
  <span class="hljs-attr">pythonRemoveDeps</span> = [
    <span class="hljs-string">"pkg2"</span>
  ];
</code></pre><p>which would result in the following <code class="literal">requirements.txt</code> file:</p><pre><code class="programlisting hljs language-undefined" data-highlighted="yes">pkg1
pkg3
</code></pre><p>Another option is to pass <code class="literal">true</code>, that will relax/remove all dependencies, for
example:</p><pre><code class="programlisting hljs language-nix" data-highlighted="yes">  <span class="hljs-attr">nativeBuildInputs</span> = [ pythonRelaxDepsHook ];
  <span class="hljs-attr">pythonRelaxDeps</span> = <span class="hljs-literal">true</span>;
</code></pre><p>which would result in the following <code class="literal">requirements.txt</code> file:</p><pre><code class="programlisting hljs language-undefined" data-highlighted="yes">pkg1
pkg2
pkg3
</code></pre><p>In general you should always use <code class="literal">pythonRelaxDeps</code>, because <code class="literal">pythonRemoveDeps</code>
will convert build errors into runtime errors. However <code class="literal">pythonRemoveDeps</code> may
still be useful in exceptional cases, and also to remove dependencies wrongly
declared by upstream (for example, declaring <code class="literal">black</code> as a runtime dependency
instead of a dev dependency).</p><p>Keep in mind that while the examples above are done with <code class="literal">requirements.txt</code>,
<code class="literal">pythonRelaxDepsHook</code> works by modifying the resulting wheel file, so it should
work with any of the <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#setup-hooks" title="Setup hooks">existing hooks</a>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="using-unittestcheckhook" class="title">Using unittestCheckHook   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#using-unittestcheckhook" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p><code class="literal">unittestCheckHook</code> is a hook which will substitute the setuptools <code class="literal">test</code> command for a <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ssec-check-phase" title="The check phase"><code class="literal">checkPhase</code></a> which runs <code class="literal">python -m unittest discover</code>:</p><pre><code class="programlisting hljs language-nix" data-highlighted="yes">  <span class="hljs-attr">nativeCheckInputs</span> = [
    unittestCheckHook
  ];

  <span class="hljs-attr">unittestFlagsArray</span> = [
    <span class="hljs-string">"-s"</span> <span class="hljs-string">"tests"</span> <span class="hljs-string">"-v"</span>
  ];
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="using-sphinxhook" class="title">Using sphinxHook   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#using-sphinxhook" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>The <code class="literal">sphinxHook</code> is a helpful tool to build documentation and manpages
using the popular Sphinx documentation generator.
It is setup to automatically find common documentation source paths and
render them using the default <code class="literal">html</code> style.</p><pre><code class="programlisting hljs language-nix" data-highlighted="yes">  <span class="hljs-attr">outputs</span> = [
    <span class="hljs-string">"out"</span>
    <span class="hljs-string">"doc"</span>
  ];

  <span class="hljs-attr">nativeBuildInputs</span> = [
    sphinxHook
  ];
</code></pre><p>The hook will automatically build and install the artifact into the
<code class="literal">doc</code> output, if it exists. It also provides an automatic diversion
for the artifacts of the <code class="literal">man</code> builder into the <code class="literal">man</code> target.</p><pre><code class="programlisting hljs language-nix" data-highlighted="yes">  <span class="hljs-attr">outputs</span> = [
    <span class="hljs-string">"out"</span>
    <span class="hljs-string">"doc"</span>
    <span class="hljs-string">"man"</span>
  ];

  <span class="hljs-comment"># Use multiple builders</span>
  <span class="hljs-attr">sphinxBuilders</span> = [
    <span class="hljs-string">"singlehtml"</span>
    <span class="hljs-string">"man"</span>
  ];
</code></pre><p>Overwrite <code class="literal">sphinxRoot</code> when the hook is unable to find your
documentation source root.</p><pre><code class="programlisting hljs language-nix" data-highlighted="yes">  <span class="hljs-comment"># Configure sphinxRoot for uncommon paths</span>
  <span class="hljs-attr">sphinxRoot</span> = <span class="hljs-string">"weird/docs/path"</span>;
</code></pre><p>The hook is also available to packages outside the python ecosystem by
referencing it using <code class="literal">sphinxHook</code> from top-level.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="develop-local-package" class="title">Develop local package   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#develop-local-package" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>As a Python developer you’re likely aware of <a class="link" href="http://setuptools.readthedocs.io/en/latest/setuptools.html#development-mode" target="_top">development mode</a>
(<code class="literal">python setup.py develop</code>); instead of installing the package this command
creates a special link to the project code. That way, you can run updated code
without having to reinstall after each and every change you make. Development
mode is also available. Let’s see how you can use it.</p><p>In the previous Nix expression the source was fetched from a url. We can also
refer to a local source instead using <code class="literal">src = ./path/to/source/tree;</code></p><p>If we create a <code class="literal">shell.nix</code> file which calls <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#buildpythonpackage-function" title="buildPythonPackage function"><code class="literal">buildPythonPackage</code></a>, and if <code class="literal">src</code>
is a local source, and if the local source has a <code class="literal">setup.py</code>, then development
mode is activated.</p><p>In the following example, we create a simple environment that has a Python 3.11
version of our package in it, as well as its dependencies and other packages we
like to have in the environment, all specified with <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-propagatedBuildInputs" title="propagatedBuildInputs"><code class="literal">propagatedBuildInputs</code></a>.
Indeed, we can just add any package we like to have in our environment to
<a class="link" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-propagatedBuildInputs" title="propagatedBuildInputs"><code class="literal">propagatedBuildInputs</code></a>.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">with</span> <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {};
<span class="hljs-keyword">with</span> python311Packages;

buildPythonPackage <span class="hljs-keyword">rec</span> {
  <span class="hljs-attr">name</span> = <span class="hljs-string">"mypackage"</span>;
  <span class="hljs-attr">src</span> = ./path/to/package/source;
  <span class="hljs-attr">propagatedBuildInputs</span> = [
    pytest
    numpy
    pkgs.libsndfile
  ];
}
</code></pre><p>It is important to note that due to how development mode is implemented on Nix
it is not possible to have multiple packages simultaneously in development mode.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="organising-your-packages" class="title">Organising your packages   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#organising-your-packages" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>So far we discussed how you can use Python on Nix, and how you can develop with
it. We’ve looked at how you write expressions to package Python packages, and we
looked at how you can create environments in which specified packages are
available.</p><p>At some point you’ll likely have multiple packages which you would
like to be able to use in different projects. In order to minimise unnecessary
duplication we now look at how you can maintain a repository with your
own packages. The important functions here are <code class="literal">import</code> and <code class="literal">callPackage</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="including-a-derivation-using-callpackage" class="title">Including a derivation using <code class="literal">callPackage</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#including-a-derivation-using-callpackage" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Earlier we created a Python environment using <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#python.withpackages-function" title="python.withPackages function"><code class="literal">withPackages</code></a>, and included the
<code class="literal">toolz</code> package via a <code class="literal">let</code> expression.
Let’s split the package definition from the environment definition.</p><p>We first create a function that builds <code class="literal">toolz</code> in <code class="literal">~/path/to/toolz/release.nix</code></p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ lib
, buildPythonPackage
, fetchPypi
, setuptools
, wheel
}:

buildPythonPackage <span class="hljs-keyword">rec</span> {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"toolz"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"0.10.0"</span>;
  <span class="hljs-attr">pyproject</span> = <span class="hljs-literal">true</span>;

  <span class="hljs-attr">src</span> = fetchPypi {
    <span class="hljs-keyword">inherit</span> pname version;
    <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-CP3V73yWSArRHBLUct4hrNMjWZlvaaUlkpm1QP66RWA="</span>;
  };

  <span class="hljs-attr">nativeBuildInputs</span> = [
    setuptools
    wheel
  ];

  <span class="hljs-attr">meta</span> = <span class="hljs-keyword">with</span> lib; {
    <span class="hljs-attr">changelog</span> = <span class="hljs-string">"https://github.com/pytoolz/toolz/releases/tag/<span class="hljs-subst">${version}</span>"</span>;
    <span class="hljs-attr">homepage</span> = <span class="hljs-string">"https://github.com/pytoolz/toolz/"</span>;
    <span class="hljs-attr">description</span> = <span class="hljs-string">"List processing tools and functional utilities"</span>;
    <span class="hljs-attr">license</span> = licenses.bsd3;
    <span class="hljs-attr">maintainers</span> = <span class="hljs-keyword">with</span> maintainers; [ fridh ];
  };
}
</code></pre><p>It takes an argument <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#buildpythonpackage-function" title="buildPythonPackage function"><code class="literal">buildPythonPackage</code></a>. We now call this function using
<code class="literal">callPackage</code> in the definition of our environment</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">with</span> <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {};

( <span class="hljs-keyword">let</span>
    <span class="hljs-attr">toolz</span> = callPackage /path/to/toolz/release.nix {
      <span class="hljs-attr">buildPythonPackage</span> = python310
Packages.buildPythonPackage;
    };
  <span class="hljs-keyword">in</span> python310.withPackages (ps: [
    ps.numpy
    toolz
  ])
).env
</code></pre><p>Important to remember is that the Python version for which the package is made
depends on the <code class="literal">python</code> derivation that is passed to <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#buildpythonpackage-function" title="buildPythonPackage function"><code class="literal">buildPythonPackage</code></a>. Nix
tries to automatically pass arguments when possible, which is why generally you
don’t explicitly define which <code class="literal">python</code> derivation should be used. In the above
example we use <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#buildpythonpackage-function" title="buildPythonPackage function"><code class="literal">buildPythonPackage</code></a> that is part of the set <code class="literal">python3Packages</code>,
and in this case the <code class="literal">python3</code> interpreter is automatically used.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="faq" class="title">FAQ   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#faq" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="how-to-solve-circular-dependencies" class="title">How to solve circular dependencies?   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#how-to-solve-circular-dependencies" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Consider the packages <code class="literal">A</code> and <code class="literal">B</code> that depend on each other. When packaging <code class="literal">B</code>,
a solution is to override package <code class="literal">A</code> not to depend on <code class="literal">B</code> as an input. The same
should also be done when packaging <code class="literal">A</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="how-to-override-a-python-package" class="title">How to override a Python package?   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#how-to-override-a-python-package" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>We can override the interpreter and pass <code class="literal">packageOverrides</code>. In the following
example we rename the <code class="literal">pandas</code> package and build it.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">with</span> <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {};

(<span class="hljs-keyword">let</span>
  <span class="hljs-attr">python</span> = <span class="hljs-keyword">let</span>
    <span class="hljs-attr">packageOverrides</span> = self: super: {
      <span class="hljs-attr">pandas</span> = super.pandas.overridePythonAttrs(old: {<span class="hljs-attr">name="foo";});</span>
    };
  <span class="hljs-keyword">in</span> pkgs.python310.override {
    <span class="hljs-keyword">inherit</span> packageOverrides;
  };

<span class="hljs-keyword">in</span> python.withPackages (ps: [
  ps.pandas
])).env
</code></pre><p>Using <code class="literal">nix-build</code> on this expression will build an environment that contains the
package <code class="literal">pandas</code> but with the new name <code class="literal">foo</code>.</p><p>All packages in the package set will use the renamed package. A typical use case
is to switch to another version of a certain package. For example, in the
Nixpkgs repository we have multiple versions of <code class="literal">django</code> and <code class="literal">scipy</code>. In the
following example we use a different version of <code class="literal">scipy</code> and create an
environment that uses it. All packages in the Python package set will now use
the updated <code class="literal">scipy</code> version.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">with</span> <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {};

( <span class="hljs-keyword">let</span>
    <span class="hljs-attr">packageOverrides</span> = self: super: {
      <span class="hljs-attr">scipy</span> = super.scipy_0_17;
    };
  <span class="hljs-keyword">in</span> (pkgs.python310.override {
    <span class="hljs-keyword">inherit</span> packageOverrides;
  }).withPackages (ps: [
    ps.blaze
  ])
).env
</code></pre><p>The requested package <code class="literal">blaze</code> depends on <code class="literal">pandas</code> which itself depends on <code class="literal">scipy</code>.</p><p>If you want the whole of Nixpkgs to use your modifications, then you can use
<code class="literal">overlays</code> as explained in this manual. In the following example we build a
<code class="literal">inkscape</code> using a different version of <code class="literal">numpy</code>.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">let</span>
  <span class="hljs-attr">pkgs</span> = <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {};
  <span class="hljs-attr">newpkgs</span> = <span class="hljs-built_in">import</span> pkgs.path { <span class="hljs-attr">overlays</span> = [ (self: super: {
    <span class="hljs-attr">python310</span> = <span class="hljs-keyword">let</span>
      <span class="hljs-attr">packageOverrides</span> = python-self: python-super: {
        <span class="hljs-attr">numpy</span> = python-super.numpy_1_18;
      };
    <span class="hljs-keyword">in</span> super.python310.override {<span class="hljs-keyword">inherit</span> packageOverrides;};
  } ) ]; };
<span class="hljs-keyword">in</span> newpkgs.inkscape
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="python-setup.py-bdist_wheel-cannot-create-.whl" class="title"><code class="literal">python setup.py bdist_wheel</code> cannot create .whl   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#python-setup.py-bdist_wheel-cannot-create-.whl" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Executing <code class="literal">python setup.py bdist_wheel</code> in a <code class="literal">nix-shell</code>fails with</p><pre><code class="programlisting hljs language-undefined" data-highlighted="yes">ValueError: ZIP does not support timestamps before 1980
</code></pre><p>This is because files from the Nix store (which have a timestamp of the UNIX
epoch of January 1, 1970) are included in the .ZIP, but .ZIP archives follow the
DOS convention of counting timestamps from 1980.</p><p>The command <code class="literal">bdist_wheel</code> reads the <code class="literal">SOURCE_DATE_EPOCH</code> environment variable,
which <code class="literal">nix-shell</code> sets to 1. Unsetting this variable or giving it a value
corresponding to 1980 or later enables building wheels.</p><p>Use 1980 as timestamp:</p><pre><code class="programlisting shell hljs language-shell" data-highlighted="yes">nix-shell --run "SOURCE_DATE_EPOCH=315532800 python3 setup.py bdist_wheel"
</code></pre><p>or the current time:</p><pre><code class="programlisting shell hljs language-shell" data-highlighted="yes">nix-shell --run "SOURCE_DATE_EPOCH=$(date +%s) python3 setup.py bdist_wheel"
</code></pre><p>or unset <code class="literal">SOURCE_DATE_EPOCH</code>:</p><pre><code class="programlisting shell hljs language-shell" data-highlighted="yes">nix-shell --run "unset SOURCE_DATE_EPOCH; python3 setup.py bdist_wheel"
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="install_data-data_files-problems" class="title"><code class="literal">install_data</code> / <code class="literal">data_files</code> problems   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#install_data-data_files-problems" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>If you get the following error:</p><pre><code class="programlisting hljs language-bash" data-highlighted="yes">could not create <span class="hljs-string">'/nix/store/6l1bvljpy8gazlsw2aw9skwwp4pmvyxw-python-2.7.8/etc'</span>:
Permission denied
</code></pre><p>This is a <a class="link" href="https://github.com/pypa/setuptools/issues/130" target="_top">known bug</a> in
<code class="literal">setuptools</code>. Setuptools <code class="literal">install_data</code> does not respect <code class="literal">--prefix</code>. An example
of such package using the feature is <code class="literal">pkgs/tools/X11/xpra/default.nix</code>.</p><p>As workaround install it as an extra <code class="literal">preInstall</code> step:</p><pre><code class="programlisting shell hljs language-shell" data-highlighted="yes"><span class="hljs-meta prompt_">$</span><span class="language-bash">{python.pythonOnBuildForHost.interpreter} setup.py install_data --install-dir=<span class="hljs-variable">$out</span> --root=<span class="hljs-variable">$out</span></span>
sed -i '/ = data\_files/d' setup.py
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="rationale-of-non-existent-global-site-packages" class="title">Rationale of non-existent global site-packages   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#rationale-of-non-existent-global-site-packages" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>On most operating systems a global <code class="literal">site-packages</code> is maintained. This however
becomes problematic if you want to run multiple Python versions or have multiple
versions of certain libraries for your projects. Generally, you would solve such
issues by creating virtual environments using <code class="literal">virtualenv</code>.</p><p>On Nix each package has an isolated dependency tree which, in the case of
Python, guarantees the right versions of the interpreter and libraries or
packages are available. There is therefore no need to maintain a global <code class="literal">site-packages</code>.</p><p>If you want to create a Python environment for development, then the recommended
method is to use <code class="literal">nix-shell</code>, either with or without the <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#python.buildenv-function" title="python.buildEnv function"><code class="literal">python.buildEnv</code></a>
function.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="how-to-consume-python-modules-using-pip-in-a-virtual-environment-like-i-am-used-to-on-other-operating-systems" class="title">How to consume Python modules using pip in a virtual environment like I am used to on other Operating Systems?   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#how-to-consume-python-modules-using-pip-in-a-virtual-environment-like-i-am-used-to-on-other-operating-systems" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>While this approach is not very idiomatic from Nix perspective, it can still be
useful when dealing with pre-existing projects or in situations where it’s not
feasible or desired to write derivations for all required dependencies.</p><p>This is an example of a <code class="literal">default.nix</code> for a <code class="literal">nix-shell</code>, which allows to consume
a virtual environment created by <code class="literal">venv</code>, and install Python modules through
<code class="literal">pip</code> the traditional way.</p><p>Create this <code class="literal">default.nix</code> file, together with a <code class="literal">requirements.txt</code> and
execute <code class="literal">nix-shell</code>.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">with</span> <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; { };

<span class="hljs-keyword">let</span>
  <span class="hljs-attr">pythonPackages</span> = python3Packages;
<span class="hljs-keyword">in</span> pkgs.mkShell <span class="hljs-keyword">rec</span> {
  <span class="hljs-attr">name</span> = <span class="hljs-string">"impurePythonEnv"</span>;
  <span class="hljs-attr">venvDir</span> = <span class="hljs-string">"./.venv"</span>;
  <span class="hljs-attr">buildInputs</span> = [
    <span class="hljs-comment"># A Python interpreter including the 'venv' module is required to bootstrap</span>
    <span class="hljs-comment"># the environment.</span>
    pythonPackages.python

    <span class="hljs-comment"># This executes some shell code to initialize a venv in $venvDir before</span>
    <span class="hljs-comment"># dropping into the shell</span>
    pythonPackages.venvShellHook

    <span class="hljs-comment"># Those are dependencies that we would like to use from nixpkgs, which will</span>
    <span class="hljs-comment"># add them to PYTHONPATH and thus make them accessible from within the venv.</span>
    pythonPackages.numpy
    pythonPackages.requests

    <span class="hljs-comment"># In this particular example, in order to compile any binary extensions they may</span>
    <span class="hljs-comment"># require, the Python modules listed in the hypothetical requirements.txt need</span>
    <span class="hljs-comment"># the following packages to be installed locally:</span>
    taglib
    openssl
    git
    libxml2
    libxslt
    libzip
    zlib
  ];

  <span class="hljs-comment"># Run this command, only after creating the virtual environment</span>
  <span class="hljs-attr">postVenvCreation</span> = <span class="hljs-string">''
    unset SOURCE_DATE_EPOCH
    pip install -r requirements.txt
  ''</span>;

  <span class="hljs-comment"># Now we can execute any commands within the virtual environment.</span>
  <span class="hljs-comment"># This is optional and can be left out to run pip manually.</span>
  <span class="hljs-attr">postShellHook</span> = <span class="hljs-string">''
    # allow pip to install wheels
    unset SOURCE_DATE_EPOCH
  ''</span>;

}
</code></pre><p>In case the supplied venvShellHook is insufficient, or when Python 2 support is
needed, you can define your own shell hook and adapt to your needs like in the
following example:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">with</span> <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; { };

<span class="hljs-keyword">let</span>
  <span class="hljs-attr">venvDir</span> = <span class="hljs-string">"./.venv"</span>;
  <span class="hljs-attr">pythonPackages</span> = python3Packages;
<span class="hljs-keyword">in</span> pkgs.mkShell <span class="hljs-keyword">rec</span> {
  <span class="hljs-attr">name</span> = <span class="hljs-string">"impurePythonEnv"</span>;
  <span class="hljs-attr">buildInputs</span> = [
    pythonPackages.python
    <span class="hljs-comment"># Needed when using python 2.7</span>
    <span class="hljs-comment"># pythonPackages.virtualenv</span>
    <span class="hljs-comment"># ...</span>
  ];

  <span class="hljs-comment"># This is very close to how venvShellHook is implemented, but</span>
  <span class="hljs-comment"># adapted to use 'virtualenv'</span>
  <span class="hljs-attr">shellHook</span> = <span class="hljs-string">''
    SOURCE_DATE_EPOCH=$(date +%s)

    if [ -d "<span class="hljs-subst">${venvDir}</span>" ]; then
      echo "Skipping venv creation, '<span class="hljs-subst">${venvDir}</span>' already exists"
    else
      echo "Creating new venv environment in path: '<span class="hljs-subst">${venvDir}</span>'"
      # Note that the module venv was only introduced in python 3, so for 2.7
      # this needs to be replaced with a call to virtualenv
      <span class="hljs-subst">${pythonPackages.python.interpreter}</span> -m venv "<span class="hljs-subst">${venvDir}</span>"
    fi

    # Under some circumstances it might be necessary to add your virtual
    # environment to PYTHONPATH, which you can do here too;
    # PYTHONPATH=$PWD/<span class="hljs-subst">${venvDir}</span>/<span class="hljs-subst">${pythonPackages.python.sitePackages}</span>/:$PYTHONPATH

    source "<span class="hljs-subst">${venvDir}</span>/bin/activate"

    # As in the previous example, this is optional.
    pip install -r requirements.txt
  ''</span>;
}
</code></pre><p>Note that the <code class="literal">pip install</code> is an imperative action. So every time <code class="literal">nix-shell</code>
is executed it will attempt to download the Python modules listed in
requirements.txt. However these will be cached locally within the <code class="literal">virtualenv</code>
folder and not downloaded again.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="how-to-override-a-python-package-from-configuration.nix" class="title">How to override a Python package from <code class="literal">configuration.nix</code>?   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#how-to-override-a-python-package-from-configuration.nix" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>If you need to change a package’s attribute(s) from <code class="literal">configuration.nix</code> you could do:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">  nixpkgs.config.<span class="hljs-attr">packageOverrides</span> = super: {
    <span class="hljs-attr">python3</span> = super.python3.override {
      <span class="hljs-attr">packageOverrides</span> = python-self: python-super: {
        <span class="hljs-attr">twisted</span> = python-super.twisted.overridePythonAttrs (oldAttrs: {
          <span class="hljs-attr">src</span> = super.fetchPypi {
            <span class="hljs-attr">pname</span> = <span class="hljs-string">"Twisted"</span>;
            <span class="hljs-attr">version</span> = <span class="hljs-string">"19.10.0"</span>;
            <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-c5S6fycq5yKnTz2Wnc9Zm8TvCTvDkgOHSKSQ8XJKUV0="</span>;
            <span class="hljs-attr">extension</span> = <span class="hljs-string">"tar.bz2"</span>;
          };
        });
      };
    };
  };
</code></pre><p><code class="literal">python3Packages.twisted</code> is now globally overridden.
All packages and also all NixOS services that reference <code class="literal">twisted</code>
(such as <code class="literal">services.buildbot-worker</code>) now use the new definition.
Note that <code class="literal">python-super</code> refers to the old package set and <code class="literal">python-self</code>
to the new, overridden version.</p><p>To modify only a Python package set instead of a whole Python derivation, use
this snippet:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">  <span class="hljs-attr">myPythonPackages</span> = python3Packages.override {
    <span class="hljs-attr">overrides</span> = self: super: {
      <span class="hljs-attr">twisted</span> = ...;
    };
  }
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="how-to-override-a-python-package-using-overlays" class="title">How to override a Python package using overlays?   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#how-to-override-a-python-package-using-overlays" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Use the following overlay template:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">self: super: {
  <span class="hljs-attr">python</span> = super.python.override {
    <span class="hljs-attr">packageOverrides</span> = python-self: python-super: {
      <span class="hljs-attr">twisted</span> = python-super.twisted.overrideAttrs (oldAttrs: {
        <span class="hljs-attr">src</span> = super.fetchPypi {
          <span class="hljs-attr">pname</span> = <span class="hljs-string">"Twisted"</span>;
          <span class="hljs-attr">version</span> = <span class="hljs-string">"19.10.0"</span>;
          <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-c5S6fycq5yKnTz2Wnc9Zm8TvCTvDkgOHSKSQ8XJKUV0="</span>;
          <span class="hljs-attr">extension</span> = <span class="hljs-string">"tar.bz2"</span>;
        };
      });
    };
  };
}
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="how-to-override-a-python-package-for-all-python-versions-using-extensions" class="title">How to override a Python package for all Python versions using extensions?   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#how-to-override-a-python-package-for-all-python-versions-using-extensions" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>The following overlay overrides the call to <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#buildpythonpackage-function" title="buildPythonPackage function"><code class="literal">buildPythonPackage</code></a> for the
<code class="literal">foo</code> package for all interpreters by appending a Python extension to the
<code class="literal">pythonPackagesExtensions</code> list of extensions.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">final: prev: {
  <span class="hljs-attr">pythonPackagesExtensions</span> = prev.pythonPackagesExtensions ++ [
    (
      python-final: python-prev: {
        <span class="hljs-attr">foo</span> = python-prev.foo.overridePythonAttrs (oldAttrs: {
          ...
        });
      }
    )
  ];
}
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="how-to-use-intels-mkl-with-numpy-and-scipy" class="title">How to use Intel’s MKL with numpy and scipy?   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#how-to-use-intels-mkl-with-numpy-and-scipy" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>MKL can be configured using an overlay. See the section “<a class="link" href="https://nixos.org/manual/nixpkgs/stable/#sec-overlays-alternatives-blas-lapack" title="BLAS/LAPACK">Using overlays to
configure alternatives</a>”.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="what-inputs-do-setup_requires-install_requires-and-tests_require-map-to" class="title">What inputs do <code class="literal">setup_requires</code>, <code class="literal">install_requires</code> and <code class="literal">tests_require</code> map to?   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#what-inputs-do-setup_requires-install_requires-and-tests_require-map-to" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>In a <code class="literal">setup.py</code> or <code class="literal">setup.cfg</code> it is common to declare dependencies:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">setup_requires</code> corresponds to <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-nativeBuildInputs" title="nativeBuildInputs"><code class="literal">nativeBuildInputs</code></a></p></li><li class="listitem"><p><code class="literal">install_requires</code> corresponds to <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-propagatedBuildInputs" title="propagatedBuildInputs"><code class="literal">propagatedBuildInputs</code></a></p></li><li class="listitem"><p><code class="literal">tests_require</code> corresponds to <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-nativeCheckInputs" title="nativeCheckInputs"><code class="literal">nativeCheckInputs</code></a></p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="optimizations" class="title">How to enable interpreter optimizations?   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#optimizations" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>The Python interpreters are by default not built with optimizations enabled, because
the builds are in that case not reproducible. To enable optimizations, override the
interpreter of interest, e.g using</p><pre><code class="programlisting hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">let</span>
  <span class="hljs-attr">pkgs</span> = <span class="hljs-built_in">import</span> ./. {};
  <span class="hljs-attr">mypython</span> = pkgs.python3.override {
    <span class="hljs-attr">enableOptimizations</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-attr">reproducibleBuild</span> = <span class="hljs-literal">false</span>;
    <span class="hljs-attr">self</span> = mypython;
  };
<span class="hljs-keyword">in</span> mypython
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="python-optional-dependencies" class="title">How to add optional dependencies?   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#python-optional-dependencies" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Some packages define optional dependencies for additional features. With
<code class="literal">setuptools</code> this is called <code class="literal">extras_require</code> and <code class="literal">flit</code> calls it
<code class="literal">extras-require</code>, while PEP 621 calls these <code class="literal">optional-dependencies</code>. A
method for supporting this is by declaring the extras of a package in its
<code class="literal">passthru</code>, e.g. in case of the package <code class="literal">dask</code></p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">passthru.<span class="hljs-attr">optional-dependencies</span> = {
  <span class="hljs-attr">complete</span> = [ distributed ];
};
</code></pre><p>and letting the package requiring the extra add the list to its dependencies</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">propagatedBuildInputs</span> = [
  ...
] ++ dask.optional-dependencies.complete;
</code></pre><p>Note this method is preferred over adding parameters to builders, as that can
result in packages depending on different variants and thereby causing
collisions.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="tools" class="title">How to contribute a Python package to nixpkgs?   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#tools" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Packages inside nixpkgs must use the <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#buildpythonpackage-function" title="buildPythonPackage function"><code class="literal">buildPythonPackage</code></a> or <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#buildpythonapplication-function" title="buildPythonApplication function"><code class="literal">buildPythonApplication</code></a> function directly,
because we can only provide security support for non-vendored dependencies.</p><p>We recommend <a class="link" href="https://github.com/nix-community/nix-init" target="_top">nix-init</a> for creating new python packages within nixpkgs,
as it already prefetches the source, parses dependencies for common formats and prefills most things in <code class="literal">meta</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="deterministic-builds" class="title">Are Python interpreters built deterministically?   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#deterministic-builds" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>The Python interpreters are now built deterministically. Minor modifications had
to be made to the interpreters in order to generate deterministic bytecode. This
has security implications and is relevant for those using Python in a
<code class="literal">nix-shell</code>.</p><p>When the environment variable <code class="literal">DETERMINISTIC_BUILD</code> is set, all bytecode will
have timestamp 1. The <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#buildpythonpackage-function" title="buildPythonPackage function"><code class="literal">buildPythonPackage</code></a> function sets <code class="literal">DETERMINISTIC_BUILD=1</code>
and <a class="link" href="https://docs.python.org/3.11/using/cmdline.html#envvar-PYTHONHASHSEED" target="_top">PYTHONHASHSEED=0</a>.
Both are also exported in <code class="literal">nix-shell</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="automatic-tests" class="title">How to provide automatic tests to Python packages?   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#automatic-tests" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>It is recommended to test packages as part of the build process.
Source distributions (<code class="literal">sdist</code>) often include test files, but not always.</p><p>By default the command <code class="literal">python setup.py test</code> is run as part of the
<a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ssec-check-phase" title="The check phase"><code class="literal">checkPhase</code></a>, but often it is necessary to pass a custom <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ssec-check-phase" title="The check phase"><code class="literal">checkPhase</code></a>. An
example of such a situation is when <code class="literal">py.test</code> is used.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="common-issues" class="title">Common issues   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#common-issues" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>Non-working tests can often be deselected. By default <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#buildpythonpackage-function" title="buildPythonPackage function"><code class="literal">buildPythonPackage</code></a>
runs <code class="literal">python setup.py test</code>. which is deprecated. Most Python modules however
do follow the standard test protocol where the pytest runner can be used
instead. <code class="literal">pytest</code> supports the <code class="literal">-k</code> and <code class="literal">--ignore</code> parameters to ignore test
methods or classes as well as whole files. For <code class="literal">pytestCheckHook</code> these are
conveniently exposed as <code class="literal">disabledTests</code> and <code class="literal">disabledTestPaths</code> respectively.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">buildPythonPackage {
  <span class="hljs-comment"># ...</span>
  <span class="hljs-attr">nativeCheckInputs</span> = [
    pytestCheckHook
  ];

  <span class="hljs-attr">disabledTests</span> = [
    <span class="hljs-string">"function_name"</span>
    <span class="hljs-string">"other_function"</span>
  ];

  <span class="hljs-attr">disabledTestPaths</span> = [
    <span class="hljs-string">"this/file.py"</span>
  ];
}
</code></pre></li><li class="listitem"><p>Tests that attempt to access <code class="literal">$HOME</code> can be fixed by using the following
work-around before running tests (e.g. <code class="literal">preCheck</code>): <code class="literal">export HOME=$(mktemp -d)</code></p></li></ul></div>
</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="contributing" class="title">Contributing   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#contributing" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="contributing-guidelines" class="title">Contributing guidelines   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#contributing-guidelines" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>The following rules are desired to be respected:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>Python libraries are called from <code class="literal">python-packages.nix</code> and packaged with
<a class="link" href="https://nixos.org/manual/nixpkgs/stable/#buildpythonpackage-function" title="buildPythonPackage function"><code class="literal">buildPythonPackage</code></a>. The expression of a library should be in
<code class="literal">pkgs/development/python-modules/&lt;name&gt;/default.nix</code>.</p></li><li class="listitem"><p>Python applications live outside of <code class="literal">python-packages.nix</code> and are packaged
with <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#buildpythonapplication-function" title="buildPythonApplication function"><code class="literal">buildPythonApplication</code></a>.</p></li><li class="listitem"><p>Make sure libraries build for all Python interpreters.</p></li><li class="listitem"><p>By default we enable tests. Make sure the tests are found and, in the case of
libraries, are passing for all interpreters. If certain tests fail they can be
disabled individually. Try to avoid disabling the tests altogether. In any
case, when you disable tests, leave a comment explaining why.</p></li><li class="listitem"><p>Commit names of Python libraries should reflect that they are Python
libraries, so write for example <code class="literal">python311Packages.numpy: 1.11 -&gt; 1.12</code>.
It is highly recommended to specify the current default version to enable
automatic build by ofborg.</p></li><li class="listitem"><p>Attribute names in <code class="literal">python-packages.nix</code> as well as <code class="literal">pname</code>s should match the
library’s name on PyPI, but be normalized according to <a class="link" href="https://www.python.org/dev/peps/pep-0503/#normalized-names" target="_top">PEP
0503</a>. This means
that characters should be converted to lowercase and <code class="literal">.</code> and <code class="literal">_</code> should be
replaced by a single <code class="literal">-</code> (foo-bar-baz instead of Foo__Bar.baz).
If necessary, <code class="literal">pname</code> has to be given a different value within <code class="literal">fetchPypi</code>.</p></li><li class="listitem"><p>Packages from sources such as GitHub and GitLab that do not exist on PyPI
should not use a name that is already used on PyPI. When possible, they should
use the package repository name prefixed with the owner (e.g. organization) name
and using a <code class="literal">-</code> as delimiter.</p></li><li class="listitem"><p>Attribute names in <code class="literal">python-packages.nix</code> should be sorted alphanumerically to
avoid merge conflicts and ease locating attributes.</p></li></ul></div>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="python-package-set-maintenance" class="title">Package set maintenance   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#python-package-set-maintenance" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The whole Python package set has a lot of packages that do not see regular
updates, because they either are a very fragile component in the Python
ecosystem, like for example the <code class="literal">hypothesis</code> package, or packages that have
no maintainer, so maintenance falls back to the package set maintainers.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="python-package-bulk-updates" class="title">Updating packages in bulk   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#python-package-bulk-updates" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>There is a tool to update alot of python libraries in bulk, it exists at
<code class="literal">maintainers/scripts/update-python-libraries</code> with this repository.</p><p>It can quickly update minor or major versions for all packages selected
and create update commits, and supports the <code class="literal">fetchPypi</code>, <code class="literal">fetchurl</code> and
<code class="literal">fetchFromGitHub</code> fetchers. When updating lots of packages that are
hosted on GitHub, exporting a <code class="literal">GITHUB_API_TOKEN</code> is highly recommended.</p><p>Updating packages in bulk leads to lots of breakages, which is why a
stabilization period on the <code class="literal">python-unstable</code> branch is required.</p><p>If a package is fragile and often breaks during these bulks updates, it
may be reasonable to set <code class="literal">passthru.skipBulkUpdate = true</code> in the
derivation. This decision should not be made on a whim and should
always be supported by a qualifying comment.</p><p>Once the branch is sufficiently stable it should normally be merged
into the <code class="literal">staging</code> branch.</p><p>An exemplary call to update all python libraries between minor versions
would be:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">maintainers/scripts/update-python-libraries --target minor --commit --use-pkgs-prefix pkgs/development/python-modules/**/default.nix</span>
</code></pre>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="python-cpython-update-schedule" class="title">CPython Update Schedule   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#python-cpython-update-schedule" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>With <a class="link" href="https://www.python.org/dev/peps/pep-0602/" target="_top">PEP 602</a>, CPython now
follows a yearly release cadence. In nixpkgs, all supported interpreters
are made available, but only the most recent two
interpreters package sets are built; this is a compromise between being
the latest interpreter, and what the majority of the Python packages support.</p><p>New CPython interpreters are released in October. Generally, it takes some
time for the majority of active Python projects to support the latest stable
interpreter. To help ease the migration for Nixpkgs users
between Python interpreters the schedule below will be used:</p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col align="left"><col align="left"></colgroup><thead><tr><th align="left">When</th><th align="left">Event</th></tr></thead><tbody><tr><td align="left">After YY.11 Release</td><td align="left">Bump CPython package set window. The latest and previous latest stable should now be built.</td></tr><tr><td align="left">After YY.05 Release</td><td align="left">Bump default CPython interpreter to latest stable.</td></tr></tbody></table></div><p>In practice, this means that the Python community will have had a stable interpreter
for ~2 months before attempting to update the package set. And this will
allow for ~7 months for Python applications to support the latest interpreter.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-language-qt" class="title" style="clear: both">Qt   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-language-qt" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#qt-default-nix">Nix expression for a Qt package (default.nix)</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#qt-runtime-dependencies">Locating runtime dependencies</a> </span></dt> </dl></div><p>Writing Nix expressions for Qt libraries and applications is largely similar as for other C++ software.
This section assumes some knowledge of the latter.</p><p>The major caveat with Qt applications is that Qt uses a plugin system to load additional modules at runtime,
from a list of well-known locations. In Nixpkgs, we patch QtCore to instead use an environment variable,
and wrap Qt applications to set it to the right paths. This effectively makes the runtime dependencies
pure and explicit at build-time, at the cost of introducing an extra indirection.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="qt-default-nix" class="title">Nix expression for a Qt package (default.nix)   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#qt-default-nix" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ stdenv, lib, qtbase, wrapQtAppsHook }:

stdenv.mkDerivation {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"myapp"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"1.0"</span>;

  <span class="hljs-attr">buildInputs</span> = [ qtbase ];
  <span class="hljs-attr">nativeBuildInputs</span> = [ wrapQtAppsHook ];
}
</code></pre><p>It is important to import Qt modules directly, that is: <code class="literal">qtbase</code>, <code class="literal">qtdeclarative</code>, etc. <span class="emphasis"><em>Do not</em></span> import Qt package sets such as <code class="literal">qt5</code> because the Qt versions of dependencies may not be coherent, causing build and runtime failures.</p><p>Additionally all Qt packages must include <code class="literal">wrapQtAppsHook</code> in <code class="literal">nativeBuildInputs</code>, or you must explicitly set <code class="literal">dontWrapQtApps</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="qt-runtime-dependencies" class="title">Locating runtime dependencies   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#qt-runtime-dependencies" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Qt applications must be wrapped to find runtime dependencies.
Include <code class="literal">wrapQtAppsHook</code> in <code class="literal">nativeBuildInputs</code>:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ stdenv, wrapQtAppsHook }:

stdenv.mkDerivation {
  <span class="hljs-comment"># ...</span>
  <span class="hljs-attr">nativeBuildInputs</span> = [ wrapQtAppsHook ];
}
</code></pre><p>Add entries to <code class="literal">qtWrapperArgs</code> are to modify the wrappers created by
<code class="literal">wrapQtAppsHook</code>:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ stdenv, wrapQtAppsHook }:

stdenv.mkDerivation {
  <span class="hljs-comment"># ...</span>
  <span class="hljs-attr">nativeBuildInputs</span> = [ wrapQtAppsHook ];
  <span class="hljs-attr">qtWrapperArgs</span> = [ <span class="hljs-string">''--prefix PATH : /path/to/bin''</span> ];
}
</code></pre><p>The entries are passed as arguments to <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#fun-wrapProgram" title="wrapProgram &lt;executable&gt; &lt;makeWrapperArgs&gt;">wrapProgram</a>.</p><p>Set <code class="literal">dontWrapQtApps</code> to stop applications from being wrapped automatically.
Wrap programs manually with <code class="literal">wrapQtApp</code>, using the syntax of
<a class="link" href="https://nixos.org/manual/nixpkgs/stable/#fun-wrapProgram" title="wrapProgram &lt;executable&gt; &lt;makeWrapperArgs&gt;">wrapProgram</a>:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ stdenv, lib, wrapQtAppsHook }:

stdenv.mkDerivation {
  <span class="hljs-comment"># ...</span>
  <span class="hljs-attr">nativeBuildInputs</span> = [ wrapQtAppsHook ];
  <span class="hljs-attr">dontWrapQtApps</span> = <span class="hljs-literal">true</span>;
  <span class="hljs-attr">preFixup</span> = <span class="hljs-string">''
      wrapQtApp "$out/bin/myapp" --prefix PATH : /path/to/bin
  ''</span>;
}
</code></pre><div class="note"><h3 class="title">Note</h3><p><code class="literal">wrapQtAppsHook</code> ignores files that are non-ELF executables.
This means that scripts won’t be automatically wrapped so you’ll need to manually wrap them as previously mentioned.
An example of when you’d always need to do this is with Python applications that use PyQt.</p></div>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="r" class="title" style="clear: both">R   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#r" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#installation">Installation</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#rstudio">RStudio</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#updating-the-package-set">Updating the package set</a> </span></dt> </dl></div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="installation" class="title">Installation   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#installation" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Define an environment for R that contains all the libraries that you’d like to
use by adding the following snippet to your $HOME/.config/nixpkgs/config.nix file:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{
    <span class="hljs-attr">packageOverrides</span> = super: <span class="hljs-keyword">let</span> <span class="hljs-attr">self</span> = super.pkgs; <span class="hljs-keyword">in</span>
    {

        <span class="hljs-attr">rEnv</span> = super.rWrapper.override {
            <span class="hljs-attr">packages</span> = <span class="hljs-keyword">with</span> self.rPackages; [
                devtools
                ggplot2
                reshape2
                yaml
                optparse
                ];
        };
    };
}
</code></pre><p>Then you can use <code class="literal">nix-env -f "&lt;nixpkgs&gt;" -iA rEnv</code> to install it into your user
profile. The set of available libraries can be discovered by running the
command <code class="literal">nix-env -f "&lt;nixpkgs&gt;" -qaP -A rPackages</code>. The first column from that
output is the name that has to be passed to rWrapper in the code snipped above.</p><p>However, if you’d like to add a file to your project source to make the
environment available for other contributors, you can create a <code class="literal">default.nix</code>
file like so:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">with</span> <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {};
{
  <span class="hljs-attr">myProject</span> = stdenv.mkDerivation {
    <span class="hljs-attr">name</span> = <span class="hljs-string">"myProject"</span>;
    <span class="hljs-attr">version</span> = <span class="hljs-string">"1"</span>;
    <span class="hljs-attr">src</span> = <span class="hljs-keyword">if</span> lib.inNixShell <span class="hljs-keyword">then</span> <span class="hljs-literal">null</span> <span class="hljs-keyword">else</span> nix;

    <span class="hljs-attr">buildInputs</span> = <span class="hljs-keyword">with</span> rPackages; [
      R
      ggplot2
      knitr
    ];
  };
}
</code></pre><p>and then run <code class="literal">nix-shell .</code> to be dropped into a shell with those packages
available.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="rstudio" class="title">RStudio   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#rstudio" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>RStudio uses a standard set of packages and ignores any custom R
environments or installed packages you may have.  To create a custom
environment, see <code class="literal">rstudioWrapper</code>, which functions similarly to
<code class="literal">rWrapper</code>:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{
    <span class="hljs-attr">packageOverrides</span> = super: <span class="hljs-keyword">let</span> <span class="hljs-attr">self</span> = super.pkgs; <span class="hljs-keyword">in</span>
    {

        <span class="hljs-attr">rstudioEnv</span> = super.rstudioWrapper.override {
            <span class="hljs-attr">packages</span> = <span class="hljs-keyword">with</span> self.rPackages; [
                dplyr
                ggplot2
                reshape2
                ];
        };
    };
}
</code></pre><p>Then like above, <code class="literal">nix-env -f "&lt;nixpkgs&gt;" -iA rstudioEnv</code> will install
this into your user profile.</p><p>Alternatively, you can create a self-contained <code class="literal">shell.nix</code> without the need to
modify any configuration files:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ pkgs ? <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {}
}:

pkgs.rstudioWrapper.override {
  <span class="hljs-attr">packages</span> = <span class="hljs-keyword">with</span> pkgs.rPackages; [ dplyr ggplot2 reshape2 ];
}

</code></pre><p>Executing <code class="literal">nix-shell</code> will then drop you into an environment equivalent to the
one above. If you need additional packages just add them to the list and
re-enter the shell.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="updating-the-package-set" class="title">Updating the package set   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#updating-the-package-set" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>There is a script and associated environment for regenerating the package
sets and synchronising the rPackages tree to the current CRAN and matching
BIOC release. These scripts are found in the <code class="literal">pkgs/development/r-modules</code>
directory and executed as follows:</p><pre><code class="programlisting bash hljs language-bash" data-highlighted="yes">nix-shell generate-shell.nix

Rscript generate-r-packages.R cran  &gt; cran-packages.nix.new
<span class="hljs-built_in">mv</span> cran-packages.nix.new cran-packages.nix

Rscript generate-r-packages.R bioc  &gt; bioc-packages.nix.new
<span class="hljs-built_in">mv</span> bioc-packages.nix.new bioc-packages.nix

Rscript generate-r-packages.R bioc-annotation &gt; bioc-annotation-packages.nix.new
<span class="hljs-built_in">mv</span> bioc-annotation-packages.nix.new bioc-annotation-packages.nix

Rscript generate-r-packages.R bioc-experiment &gt; bioc-experiment-packages.nix.new
<span class="hljs-built_in">mv</span> bioc-experiment-packages.nix.new bioc-experiment-packages.nix
</code></pre><p><code class="literal">generate-r-packages.R &lt;repo&gt;</code> reads  <code class="literal">&lt;repo&gt;-packages.nix</code>, therefore
the renaming.</p><p>Some packages require overrides to specify external dependencies or other
patches and special requirements. These overrides are specified in the
<code class="literal">pkgs/development/r-modules/default.nix</code> file. As the <code class="literal">*-packages.nix</code>
contents are automatically generated it should not be edited and broken
builds should be addressed using overrides.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-language-ruby" class="title" style="clear: both">Ruby   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-language-ruby" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#using-ruby">Using Ruby</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#developing-with-ruby">Developing with Ruby</a> </span></dt> </dl></div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="using-ruby" class="title">Using Ruby   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#using-ruby" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Several versions of Ruby interpreters are available on Nix, as well as over 250 gems and many applications written in Ruby. The attribute <code class="literal">ruby</code> refers to the default Ruby interpreter, which is currently MRI 2.6. It’s also possible to refer to specific versions, e.g. <code class="literal">ruby_2_y</code>, <code class="literal">jruby</code>, or <code class="literal">mruby</code>.</p><p>In the Nixpkgs tree, Ruby packages can be found throughout, depending on what they do, and are called from the main package set. Ruby gems, however are separate sets, and there’s one default set for each interpreter (currently MRI only).</p><p>There are two main approaches for using Ruby with gems. One is to use a specifically locked <code class="literal">Gemfile</code> for an application that has very strict dependencies. The other is to depend on the common gems, which we’ll explain further down, and rely on them being updated regularly.</p><p>The interpreters have common attributes, namely <code class="literal">gems</code>, and <code class="literal">withPackages</code>. So you can refer to <code class="literal">ruby.gems.nokogiri</code>, or <code class="literal">ruby_2_7.gems.nokogiri</code> to get the Nokogiri gem already compiled and ready to use.</p><p>Since not all gems have executables like <code class="literal">nokogiri</code>, it’s usually more convenient to use the <code class="literal">withPackages</code> function like this: <code class="literal">ruby.withPackages (p: with p; [ nokogiri ])</code>. This will also make sure that the Ruby in your environment will be able to find the gem and it can be used in your Ruby code (for example via <code class="literal">ruby</code> or <code class="literal">irb</code> executables) via <code class="literal">require "nokogiri"</code> as usual.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="temporary-ruby-environment-with-nix-shell" class="title">Temporary Ruby environment with <code class="literal">nix-shell</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#temporary-ruby-environment-with-nix-shell" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Rather than having a single Ruby environment shared by all Ruby development projects on a system, Nix allows you to create separate environments per project. <code class="literal">nix-shell</code> gives you the possibility to temporarily load another environment akin to a combined <code class="literal">chruby</code> or <code class="literal">rvm</code> and <code class="literal">bundle exec</code>.</p><p>There are two methods for loading a shell with Ruby packages. The first and recommended method is to create an environment with <code class="literal">ruby.withPackages</code> and load that.</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">nix-shell -p <span class="hljs-string">"ruby.withPackages (ps: with ps; [ nokogiri pry ])"</span></span>
</code></pre><p>The other method, which is not recommended, is to create an environment and list all the packages directly.</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">nix-shell -p ruby.gems.nokogiri ruby.gems.pry</span>
</code></pre><p>Again, it’s possible to launch the interpreter from the shell. The Ruby interpreter has the attribute <code class="literal">gems</code> which contains all Ruby gems for that specific interpreter.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="load-ruby-environment-from-.nix-expression" class="title">Load Ruby environment from <code class="literal">.nix</code> expression   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#load-ruby-environment-from-.nix-expression" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>As explained <a class="link" href="https://nixos.org/manual/nix/stable/command-ref/nix-shell" target="_top">in the <code class="literal">nix-shell</code> section</a> of the Nix manual, <code class="literal">nix-shell</code> can also load an expression from a <code class="literal">.nix</code> file.
Say we want to have Ruby 2.6, <code class="literal">nokogori</code>, and <code class="literal">pry</code>. Consider a <code class="literal">shell.nix</code> file with:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">with</span> <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {};
ruby.withPackages (ps: <span class="hljs-keyword">with</span> ps; [ nokogiri pry ])
</code></pre><p>What’s happening here?</p><div class="orderedlist"><ol class="orderedlist compact" type="1"><li class="listitem"><p>We begin with importing the Nix Packages collections. <code class="literal">import &lt;nixpkgs&gt;</code> imports the <code class="literal">&lt;nixpkgs&gt;</code> function, <code class="literal">{}</code> calls it and the <code class="literal">with</code> statement brings all attributes of <code class="literal">nixpkgs</code> in the local scope. These attributes form the main package set.</p></li><li class="listitem"><p>Then we create a Ruby environment with the <code class="literal">withPackages</code> function.</p></li><li class="listitem"><p>The <code class="literal">withPackages</code> function expects us to provide a function as an argument that takes the set of all ruby gems and returns a list of packages to include in the environment. Here, we select the packages <code class="literal">nokogiri</code> and <code class="literal">pry</code> from the package set.</p></li></ol></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="execute-command-with---run" class="title">Execute command with <code class="literal">--run</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#execute-command-with---run" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>A convenient flag for <code class="literal">nix-shell</code> is <code class="literal">--run</code>. It executes a command in the <code class="literal">nix-shell</code>. We can e.g. directly open a <code class="literal">pry</code> REPL:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">nix-shell -p <span class="hljs-string">"ruby.withPackages (ps: with ps; [ nokogiri pry ])"</span> --run <span class="hljs-string">"pry"</span></span>
</code></pre><p>Or immediately require <code class="literal">nokogiri</code> in pry:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">nix-shell -p <span class="hljs-string">"ruby.withPackages (ps: with ps; [ nokogiri pry ])"</span> --run <span class="hljs-string">"pry -rnokogiri"</span></span>
</code></pre><p>Or run a script using this environment:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">nix-shell -p <span class="hljs-string">"ruby.withPackages (ps: with ps; [ nokogiri pry ])"</span> --run <span class="hljs-string">"ruby example.rb"</span></span>
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="using-nix-shell-as-shebang" class="title">Using <code class="literal">nix-shell</code> as shebang   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#using-nix-shell-as-shebang" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>In fact, for the last case, there is a more convenient method. You can add a <a class="link" href="https://en.wikipedia.org/wiki/Shebang_(Unix)" target="_top">shebang</a> to your script specifying which dependencies <code class="literal">nix-shell</code> needs. With the following shebang, you can just execute <code class="literal">./example.rb</code>, and it will run with all dependencies.</p><pre><code class="programlisting ruby hljs language-bash" data-highlighted="yes"><span class="hljs-meta">#! /usr/bin/env nix-shell</span>
<span class="hljs-comment">#! nix-shell -i ruby -p "ruby.withPackages (ps: with ps; [ nokogiri rest-client ])"</span>

require <span class="hljs-string">'nokogiri'</span>
require <span class="hljs-string">'rest-client'</span>

body = RestClient.get(<span class="hljs-string">'http://example.com'</span>).body
puts Nokogiri::HTML(body).at(<span class="hljs-string">'h1'</span>).text
</code></pre>
</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="developing-with-ruby" class="title">Developing with Ruby   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#developing-with-ruby" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="using-an-existing-gemfile" class="title">Using an existing Gemfile   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#using-an-existing-gemfile" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>In most cases, you’ll already have a <code class="literal">Gemfile.lock</code> listing all your dependencies. This can be used to generate a <code class="literal">gemset.nix</code> which is used to fetch the gems and combine them into a single environment. The reason why you need to have a separate file for this, is that Nix requires you to have a checksum for each input to your build. Since the <code class="literal">Gemfile.lock</code> that <code class="literal">bundler</code> generates doesn’t provide us with checksums, we have to first download each gem, calculate its SHA256, and store it in this separate file.</p><p>So the steps from having just a <code class="literal">Gemfile</code> to a <code class="literal">gemset.nix</code> are:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">bundle lock</span>
<span class="hljs-meta prompt_">$ </span><span class="language-bash">bundix</span>
</code></pre><p>If you already have a <code class="literal">Gemfile.lock</code>, you can run <code class="literal">bundix</code> and it will work the same.</p><p>To update the gems in your <code class="literal">Gemfile.lock</code>, you may use the <code class="literal">bundix -l</code> flag, which will create a new <code class="literal">Gemfile.lock</code> in case the <code class="literal">Gemfile</code> has a more recent time of modification.</p><p>Once the <code class="literal">gemset.nix</code> is generated, it can be used in a <code class="literal">bundlerEnv</code> derivation. Here is an example you could use for your <code class="literal">shell.nix</code>:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-comment"># ...</span>
<span class="hljs-keyword">let</span>
  <span class="hljs-attr">gems</span> = bundlerEnv {
    <span class="hljs-attr">name</span> = <span class="hljs-string">"gems-for-some-project"</span>;
    <span class="hljs-attr">gemdir</span> = ./.;
  };
<span class="hljs-keyword">in</span> mkShell { <span class="hljs-attr">packages</span> = [ gems gems.wrappedRuby ]; }
</code></pre><p>With this file in your directory, you can run <code class="literal">nix-shell</code> to build and use the gems. The important parts here are <code class="literal">bundlerEnv</code> and <code class="literal">wrappedRuby</code>.</p><p>The <code class="literal">bundlerEnv</code> is a wrapper over all the gems in your gemset. This means that all the <code class="literal">/lib</code> and <code class="literal">/bin</code> directories will be available, and the executables of all gems (even of indirect dependencies) will end up in your <code class="literal">$PATH</code>. The <code class="literal">wrappedRuby</code> provides you with all executables that come with Ruby itself, but wrapped so they can easily find the gems in your gemset.</p><p>One common issue that you might have is that you have Ruby 2.6, but also <code class="literal">bundler</code> in your gemset. That leads to a conflict for <code class="literal">/bin/bundle</code> and <code class="literal">/bin/bundler</code>. You can resolve this by wrapping either your Ruby or your gems in a <code class="literal">lowPrio</code> call. So in order to give the <code class="literal">bundler</code> from your gemset priority, it would be used like this:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-comment"># ...</span>
mkShell { <span class="hljs-attr">buildInputs</span> = [ gems (lowPrio gems.wrappedRuby) ]; }
</code></pre><p>Sometimes a Gemfile references other files. Such as <code class="literal">.ruby-version</code> or vendored gems. When copying the Gemfile to the nix store we need to copy those files alongside. This can be done using <code class="literal">extraConfigPaths</code>. For example:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">  <span class="hljs-attr">gems</span> = bundlerEnv {
    <span class="hljs-attr">name</span> = <span class="hljs-string">"gems-for-some-project"</span>;
    <span class="hljs-attr">gemdir</span> = ./.;
    <span class="hljs-attr">extraConfigPaths</span> = [ <span class="hljs-string">"<span class="hljs-subst">${./.}</span>/.ruby-version"</span> ];
  };
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="gem-specific-configurations-and-workarounds" class="title">Gem-specific configurations and workarounds   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#gem-specific-configurations-and-workarounds" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>In some cases, especially if the gem has native extensions, you might need to modify the way the gem is built.</p><p>This is done via a common configuration file that includes all of the workarounds for each gem.</p><p>This file lives at <code class="literal">/pkgs/development/ruby-modules/gem-config/default.nix</code>, since it already contains a lot of entries, it should be pretty easy to add the modifications you need for your needs.</p><p>In the meanwhile, or if the modification is for a private gem, you can also add the configuration to only your own environment.</p><p>Two places that allow this modification are the <code class="literal">ruby</code> derivation, or <code class="literal">bundlerEnv</code>.</p><p>Here’s the <code class="literal">ruby</code> one:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ pg_version ? <span class="hljs-string">"10"</span>, pkgs ? <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; { } }:
<span class="hljs-keyword">let</span>
  <span class="hljs-attr">myRuby</span> = pkgs.ruby.override {
    <span class="hljs-attr">defaultGemConfig</span> = pkgs.defaultGemConfig // {
      <span class="hljs-attr">pg</span> = attrs: {
        <span class="hljs-attr">buildFlags</span> =
        [ <span class="hljs-string">"--with-pg-config=<span class="hljs-subst">${pkgs.<span class="hljs-string">"postgresql_<span class="hljs-subst">${pg_version}</span>"</span>}</span>/bin/pg_config"</span> ];
      };
    };
  };
<span class="hljs-keyword">in</span> myRuby.withPackages (ps: <span class="hljs-keyword">with</span> ps; [ pg ])
</code></pre><p>And an example with <code class="literal">bundlerEnv</code>:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ pg_version ? <span class="hljs-string">"10"</span>, pkgs ? <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; { } }:
<span class="hljs-keyword">let</span>
  <span class="hljs-attr">gems</span> = pkgs.bundlerEnv {
    <span class="hljs-attr">name</span> = <span class="hljs-string">"gems-for-some-project"</span>;
    <span class="hljs-attr">gemdir</span> = ./.;
    <span class="hljs-attr">gemConfig</span> = pkgs.defaultGemConfig // {
      <span class="hljs-attr">pg</span> = attrs: {
        <span class="hljs-attr">buildFlags</span> =
        [ <span class="hljs-string">"--with-pg-config=<span class="hljs-subst">${pkgs.<span class="hljs-string">"postgresql_<span class="hljs-subst">${pg_version}</span>"</span>}</span>/bin/pg_config"</span> ];
      };
    };
  };
<span class="hljs-keyword">in</span> mkShell { <span class="hljs-attr">buildInputs</span> = [ gems gems.wrappedRuby ]; }
</code></pre><p>And finally via overlays:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ pg_version ? <span class="hljs-string">"10"</span> }:
<span class="hljs-keyword">let</span>
  <span class="hljs-attr">pkgs</span> = <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {
    <span class="hljs-attr">overlays</span> = [
      (self: super: {
        <span class="hljs-attr">defaultGemConfig</span> = super.defaultGemConfig // {
          <span class="hljs-attr">pg</span> = attrs: {
            <span class="hljs-attr">buildFlags</span> = [
              <span class="hljs-string">"--with-pg-config=<span class="hljs-subst">${
                pkgs.<span class="hljs-string">"postgresql_<span class="hljs-subst">${pg_version}</span>"</span>
              }</span>/bin/pg_config"</span>
            ];
          };
        };
      })
    ];
  };
<span class="hljs-keyword">in</span> pkgs.ruby.withPackages (ps: <span class="hljs-keyword">with</span> ps; [ pg ])
</code></pre><p>Then we can get whichever postgresql version we desire and the <code class="literal">pg</code> gem will always reference it correctly:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">nix-shell --argstr pg_version 9_4 --run <span class="hljs-string">'ruby -rpg -e "puts PG.library_version"'</span></span>
90421
<span class="hljs-meta prompt_">
$ </span><span class="language-bash">nix-shell --run <span class="hljs-string">'ruby -rpg -e "puts PG.library_version"'</span></span>
100007
</code></pre><p>Of course for this use-case one could also use overlays since the configuration for <code class="literal">pg</code> depends on the <code class="literal">postgresql</code> alias, but for demonstration purposes this has to suffice.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="ruby-platform-specif-gems" class="title">Platform-specific gems   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ruby-platform-specif-gems" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Right now, bundix has some issues with pre-built, platform-specific gems: <a class="link" href="https://github.com/nix-community/bundix/pull/68" target="_top">bundix PR #68</a>.
Until this is solved, you can tell bundler to not use platform-specific gems and instead build them from source each time:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>globally (will be set in <code class="literal">~/.config/.bundle/config</code>):</p></li></ul></div><pre><code class="programlisting shell hljs language-shell" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">bundle config <span class="hljs-built_in">set</span> force_ruby_platform <span class="hljs-literal">true</span></span>
</code></pre><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>locally (will be set in <code class="literal">&lt;project-root&gt;/.bundle/config</code>):</p></li></ul></div><pre><code class="programlisting shell hljs language-shell" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">bundle config <span class="hljs-built_in">set</span> --<span class="hljs-built_in">local</span> force_ruby_platform <span class="hljs-literal">true</span></span>
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="adding-a-gem-to-the-default-gemset" class="title">Adding a gem to the default gemset   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#adding-a-gem-to-the-default-gemset" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Now that you know how to get a working Ruby environment with Nix, it’s time to go forward and start actually developing with Ruby. We will first have a look at how Ruby gems are packaged on Nix. Then, we will look at how you can use development mode with your code.</p><p>All gems in the standard set are automatically generated from a single <code class="literal">Gemfile</code>. The dependency resolution is done with <code class="literal">bundler</code> and makes it more likely that all gems are compatible to each other.</p><p>In order to add a new gem to nixpkgs, you can put it into the <code class="literal">/pkgs/development/ruby-modules/with-packages/Gemfile</code> and run <code class="literal">./maintainers/scripts/update-ruby-packages</code>.</p><p>To test that it works, you can then try using the gem with:</p><pre><code class="programlisting shell hljs language-shell" data-highlighted="yes">NIX_PATH=nixpkgs=$PWD nix-shell -p "ruby.withPackages (ps: with ps; [ name-of-your-gem ])"
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="packaging-applications" class="title">Packaging applications   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#packaging-applications" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>A common task is to add a ruby executable to nixpkgs, popular examples would be <code class="literal">chef</code>, <code class="literal">jekyll</code>, or <code class="literal">sass</code>. A good way to do that is to use the <code class="literal">bundlerApp</code> function, that allows you to make a package that only exposes the listed executables, otherwise the package may cause conflicts through common paths like <code class="literal">bin/rake</code> or <code class="literal">bin/bundler</code> that aren’t meant to be used.</p><p>The absolute easiest way to do that is to write a <code class="literal">Gemfile</code> along these lines:</p><pre><code class="programlisting ruby hljs language-bash" data-highlighted="yes"><span class="hljs-built_in">source</span> <span class="hljs-string">'https://rubygems.org'</span> <span class="hljs-keyword">do</span>
  gem <span class="hljs-string">'mdl'</span>
end
</code></pre><p>If you want to package a specific version, you can use the standard Gemfile syntax for that, e.g. <code class="literal">gem 'mdl', '0.5.0'</code>, but if you want the latest stable version anyway, it’s easier to update by running the <code class="literal">bundle lock</code> and <code class="literal">bundix</code> steps again.</p><p>Now you can also make a <code class="literal">default.nix</code> that looks like this:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ bundlerApp }:

bundlerApp {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"mdl"</span>;
  <span class="hljs-attr">gemdir</span> = ./.;
  <span class="hljs-attr">exes</span> = [ <span class="hljs-string">"mdl"</span> ];
}
</code></pre><p>All that’s left to do is to generate the corresponding <code class="literal">Gemfile.lock</code> and <code class="literal">gemset.nix</code> as described above in the <code class="literal">Using an existing Gemfile</code> section.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="packaging-executables-that-require-wrapping" class="title">Packaging executables that require wrapping   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#packaging-executables-that-require-wrapping" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Sometimes your app will depend on other executables at runtime, and tries to find it through the <code class="literal">PATH</code> environment variable.</p><p>In this case, you can provide a <code class="literal">postBuild</code> hook to <code class="literal">bundlerApp</code> that wraps the gem in another script that prefixes the <code class="literal">PATH</code>.</p><p>Of course you could also make a custom <code class="literal">gemConfig</code> if you know exactly how to patch it, but it’s usually much easier to maintain with a simple wrapper so the patch doesn’t have to be adjusted for each version.</p><p>Here’s another example:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ lib, bundlerApp, makeWrapper, git, gnutar, gzip }:

bundlerApp {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"r10k"</span>;
  <span class="hljs-attr">gemdir</span> = ./.;
  <span class="hljs-attr">exes</span> = [ <span class="hljs-string">"r10k"</span> ];

  <span class="hljs-attr">nativeBuildInputs</span> = [ makeWrapper ];

  <span class="hljs-attr">postBuild</span> = <span class="hljs-string">''
    wrapProgram $out/bin/r10k --prefix PATH : <span class="hljs-subst">${lib.makeBinPath [ git gnutar gzip ]}</span>
  ''</span>;
}
</code></pre>
</div>

</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="rust" class="title" style="clear: both">Rust   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#rust" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#compiling-rust-applications-with-cargo"><code class="literal">buildRustPackage</code>: Compiling Rust applications with Cargo</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#compiling-rust-crates-using-nix-instead-of-cargo"><code class="literal">buildRustCrate</code>: Compiling Rust crates using Nix instead of Cargo</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#using-community-maintained-rust-toolchains">Using community maintained Rust toolchains</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#using-git-bisect-on-the-rust-compiler">Using <code class="literal">git bisect</code> on the Rust compiler</a> </span></dt> </dl></div><p>To install the rust compiler and cargo put</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">environment.<span class="hljs-attr">systemPackages</span> = [
  rustc
  cargo
];
</code></pre><p>into your <code class="literal">configuration.nix</code> or bring them into scope with <code class="literal">nix-shell -p rustc cargo</code>.</p><p>For other versions such as daily builds (beta and nightly),
use either <code class="literal">rustup</code> from nixpkgs (which will manage the rust installation in your home directory),
or use <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#using-community-maintained-rust-toolchains" title="Using community maintained Rust toolchains">community maintained Rust toolchains</a>.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="compiling-rust-applications-with-cargo" class="title"><code class="literal">buildRustPackage</code>: Compiling Rust applications with Cargo   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#compiling-rust-applications-with-cargo" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Rust applications are packaged by using the <code class="literal">buildRustPackage</code> helper from <code class="literal">rustPlatform</code>:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ lib, fetchFromGitHub, rustPlatform }:

rustPlatform.buildRustPackage <span class="hljs-keyword">rec</span> {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"ripgrep"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"12.1.1"</span>;

  <span class="hljs-attr">src</span> = fetchFromGitHub {
    <span class="hljs-attr">owner</span> = <span class="hljs-string">"BurntSushi"</span>;
    <span class="hljs-attr">repo</span> = pname;
    <span class="hljs-attr">rev</span> = version;
    <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-+s5RBC3XSgb8omTbUNLywZnP6jSxZBKSS1BmXOjRF8M="</span>;
  };

  <span class="hljs-attr">cargoHash</span> = <span class="hljs-string">"sha256-jtBw4ahSl88L0iuCXxQgZVm1EcboWRJMNtjxLVTtzts="</span>;

  <span class="hljs-attr">meta</span> = <span class="hljs-keyword">with</span> lib; {
    <span class="hljs-attr">description</span> = <span class="hljs-string">"A fast line-oriented regex search tool, similar to ag and ack"</span>;
    <span class="hljs-attr">homepage</span> = <span class="hljs-string">"https://github.com/BurntSushi/ripgrep"</span>;
    <span class="hljs-attr">license</span> = licenses.unlicense;
    <span class="hljs-attr">maintainers</span> = [];
  };
}
</code></pre><p><code class="literal">buildRustPackage</code> requires either the <code class="literal">cargoSha256</code> or the
<code class="literal">cargoHash</code> attribute which is computed over all crate sources of this
package. <code class="literal">cargoHash256</code> is used for traditional Nix SHA-256 hashes,
such as the one in the example above. <code class="literal">cargoHash</code> should instead be
used for <a class="link" href="https://www.w3.org/TR/SRI/" target="_top">SRI</a> hashes. For example:</p><p>Exception: If the application has cargo <code class="literal">git</code> dependencies, the <code class="literal">cargoHash</code>/<code class="literal">cargoSha256</code>
approach will not work, and you will need to copy the <code class="literal">Cargo.lock</code> file of the application
to nixpkgs and continue with the next section for specifying the options of the<code class="literal">cargoLock</code>
section.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">  <span class="hljs-attr">cargoHash</span> = <span class="hljs-string">"sha256-l1vL2ZdtDRxSGvP0X/l3nMw8+6WF67KPutJEzUROjg8="</span>;
</code></pre><p>Both types of hashes are permitted when contributing to nixpkgs. The
Cargo hash is obtained by inserting a fake checksum into the
expression and building the package once. The correct checksum can
then be taken from the failed build. A fake hash can be used for
<code class="literal">cargoSha256</code> as follows:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">  <span class="hljs-attr">cargoSha256</span> = lib.fakeSha256;
</code></pre><p>For <code class="literal">cargoHash</code> you can use:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">  <span class="hljs-attr">cargoHash</span> = lib.fakeHash;
</code></pre><p>Per the instructions in the <a class="link" href="https://doc.rust-lang.org/cargo/guide/cargo-toml-vs-cargo-lock.html" target="_top">Cargo Book</a>
best practices guide, Rust applications should always commit the <code class="literal">Cargo.lock</code>
file in git to ensure a reproducible build. However, a few packages do not, and
Nix depends on this file, so if it is missing you can use <code class="literal">cargoPatches</code> to
apply it in the <code class="literal">patchPhase</code>. Consider sending a PR upstream with a note to the
maintainer describing why it’s important to include in the application.</p><p>The fetcher will verify that the <code class="literal">Cargo.lock</code> file is in sync with the <code class="literal">src</code>
attribute, and fail the build if not. It will also will compress the vendor
directory into a tar.gz archive.</p><p>The tarball with vendored dependencies contains a directory with the
package’s <code class="literal">name</code>, which is normally composed of <code class="literal">pname</code> and
<code class="literal">version</code>. This means that the vendored dependencies hash
(<code class="literal">cargoSha256</code>/<code class="literal">cargoHash</code>) is dependent on the package name and
version. The <code class="literal">cargoDepsName</code> attribute can be used to use another name
for the directory of vendored dependencies. For example, the hash can
be made invariant to the version by setting <code class="literal">cargoDepsName</code> to
<code class="literal">pname</code>:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">rustPlatform.buildRustPackage <span class="hljs-keyword">rec</span> {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"broot"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"1.2.0"</span>;

  <span class="hljs-attr">src</span> = fetchCrate {
    <span class="hljs-keyword">inherit</span> pname version;
    <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-aDQA4A5mScX9or3Lyiv/5GyAehidnpKKE0grhbP1Ctc="</span>;
  };

  <span class="hljs-attr">cargoHash</span> = <span class="hljs-string">"sha256-tbrTbutUs5aPSV+yE0IBUZAAytgmZV7Eqxia7g+9zRs="</span>;
  <span class="hljs-attr">cargoDepsName</span> = pname;

  <span class="hljs-comment"># ...</span>
}
</code></pre><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="importing-a-cargo.lock-file" class="title">Importing a <code class="literal">Cargo.lock</code> file   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#importing-a-cargo.lock-file" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Using <code class="literal">cargoSha256</code> or <code class="literal">cargoHash</code> is tedious when using
<code class="literal">buildRustPackage</code> within a project, since it requires that the hash
is updated after every change to <code class="literal">Cargo.lock</code>. Therefore,
<code class="literal">buildRustPackage</code> also supports vendoring dependencies directly from
a <code class="literal">Cargo.lock</code> file using the <code class="literal">cargoLock</code> argument. For example:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">rustPlatform.buildRustPackage {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"myproject"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"1.0.0"</span>;

  <span class="hljs-attr">cargoLock</span> = {
    <span class="hljs-attr">lockFile</span> = ./Cargo.lock;
  };

  <span class="hljs-comment"># ...</span>
}
</code></pre><p>This will retrieve the dependencies using fixed-output derivations from
the specified lockfile.</p><p>One caveat is that <code class="literal">Cargo.lock</code> cannot be patched in the <code class="literal">patchPhase</code>
because it runs after the dependencies have already been fetched. If
you need to patch or generate the lockfile you can alternatively set
<code class="literal">cargoLock.lockFileContents</code> to a string of its contents:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">rustPlatform.buildRustPackage {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"myproject"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"1.0.0"</span>;

  <span class="hljs-attr">cargoLock</span> = <span class="hljs-keyword">let</span>
    <span class="hljs-attr">fixupLockFile</span> = path: f (<span class="hljs-built_in">builtins</span>.readFile path);
  <span class="hljs-keyword">in</span> {
    <span class="hljs-attr">lockFileContents</span> = fixupLockFile ./Cargo.lock;
  };

  <span class="hljs-comment"># ...</span>
}
</code></pre><p>Note that setting <code class="literal">cargoLock.lockFile</code> or <code class="literal">cargoLock.lockFileContents</code>
doesn’t add a <code class="literal">Cargo.lock</code> to your <code class="literal">src</code>, and a <code class="literal">Cargo.lock</code> is still
required to build a rust package. A simple fix is to use:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">postPatch</span> = <span class="hljs-string">''
  ln -s <span class="hljs-subst">${./Cargo.lock}</span> Cargo.lock
''</span>;
</code></pre><p>The output hash of each dependency that uses a git source must be
specified in the <code class="literal">outputHashes</code> attribute. For example:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">rustPlatform.buildRustPackage <span class="hljs-keyword">rec</span> {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"myproject"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"1.0.0"</span>;

  <span class="hljs-attr">cargoLock</span> = {
    <span class="hljs-attr">lockFile</span> = ./Cargo.lock;
    <span class="hljs-attr">outputHashes</span> = {
      <span class="hljs-string">"finalfusion-0.14.0"</span> = <span class="hljs-string">"17f4bsdzpcshwh74w5z119xjy2if6l2wgyjy56v621skr2r8y904"</span>;
    };
  };

  <span class="hljs-comment"># ...</span>
}
</code></pre><p>If you do not specify an output hash for a git dependency, building
the package will fail and inform you of which crate needs to be
added. To find the correct hash, you can first use <code class="literal">lib.fakeSha256</code> or
<code class="literal">lib.fakeHash</code> as a stub hash. Building the package (and thus the
vendored dependencies) will then inform you of the correct hash.</p><p>For usage outside nixpkgs, <code class="literal">allowBuiltinFetchGit</code> could be used to
avoid having to specify <code class="literal">outputHashes</code>. For example:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">rustPlatform.buildRustPackage <span class="hljs-keyword">rec</span> {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"myproject"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"1.0.0"</span>;

  <span class="hljs-attr">cargoLock</span> = {
    <span class="hljs-attr">lockFile</span> = ./Cargo.lock;
    <span class="hljs-attr">allowBuiltinFetchGit</span> = <span class="hljs-literal">true</span>;
  };

  <span class="hljs-comment"># ...</span>
}
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="cargo-features" class="title">Cargo features   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#cargo-features" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>You can disable default features using <code class="literal">buildNoDefaultFeatures</code>, and
extra features can be added with <code class="literal">buildFeatures</code>.</p><p>If you want to use different features for check phase, you can use
<code class="literal">checkNoDefaultFeatures</code> and <code class="literal">checkFeatures</code>. They are only passed to
<code class="literal">cargo test</code> and not <code class="literal">cargo build</code>. If left unset, they default to
<code class="literal">buildNoDefaultFeatures</code> and <code class="literal">buildFeatures</code>.</p><p>For example:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">rustPlatform.buildRustPackage <span class="hljs-keyword">rec</span> {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"myproject"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"1.0.0"</span>;

  <span class="hljs-attr">buildNoDefaultFeatures</span> = <span class="hljs-literal">true</span>;
  <span class="hljs-attr">buildFeatures</span> = [ <span class="hljs-string">"color"</span> <span class="hljs-string">"net"</span> ];

  <span class="hljs-comment"># disable network features in tests</span>
  <span class="hljs-attr">checkFeatures</span> = [ <span class="hljs-string">"color"</span> ];

  <span class="hljs-comment"># ...</span>
}
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="cross-compilation" class="title">Cross compilation   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#cross-compilation" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>By default, Rust packages are compiled for the host platform, just like any
other package is.  The <code class="literal">--target</code> passed to rust tools is computed from this.
By default, it takes the <code class="literal">stdenv.hostPlatform.config</code> and replaces components
where they are known to differ. But there are ways to customize the argument:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>To choose a different target by name, define
<code class="literal">stdenv.hostPlatform.rustc.config</code> as that name (a string), and that
name will be used instead.</p><p>For example:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {
  <span class="hljs-attr">crossSystem</span> = (<span class="hljs-built_in">import</span> &lt;nixpkgs/lib&gt;).systems.examples.armhf-embedded // {
    rustc.<span class="hljs-attr">config</span> = <span class="hljs-string">"thumbv7em-none-eabi"</span>;
  };
}
</code></pre><p>will result in:</p><pre><code class="programlisting shell hljs language-shell" data-highlighted="yes">--target thumbv7em-none-eabi
</code></pre></li><li class="listitem"><p>To pass a completely custom target, define
<code class="literal">stdenv.hostPlatform.rustc.config</code> with its name, and
<code class="literal">stdenv.hostPlatform.rustc.platform</code> with the value.  The value will be
serialized to JSON in a file called
<code class="literal">${stdenv.hostPlatform.rustc.config}.json</code>, and the path of that file
will be used instead.</p><p>For example:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {
  <span class="hljs-attr">crossSystem</span> = (<span class="hljs-built_in">import</span> &lt;nixpkgs/lib&gt;).systems.examples.armhf-embedded // {
    rustc.<span class="hljs-attr">config</span> = <span class="hljs-string">"thumb-crazy"</span>;
    rustc.<span class="hljs-attr">platform</span> = { <span class="hljs-attr">foo</span> = <span class="hljs-string">""</span>; <span class="hljs-attr">bar</span> = <span class="hljs-string">""</span>; };
  };
}
</code></pre><p>will result in:</p><pre><code class="programlisting shell hljs language-shell" data-highlighted="yes">--target /nix/store/asdfasdfsadf-thumb-crazy.json # contains {"foo":"","bar":""}
</code></pre></li></ul></div><p>Note that currently custom targets aren’t compiled with <code class="literal">std</code>, so <code class="literal">cargo test</code>
will fail. This can be ignored by adding <code class="literal">doCheck = false;</code> to your derivation.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="running-package-tests" class="title">Running package tests   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#running-package-tests" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>When using <code class="literal">buildRustPackage</code>, the <code class="literal">checkPhase</code> is enabled by default and runs
<code class="literal">cargo test</code> on the package to build. To make sure that we don’t compile the
sources twice and to actually test the artifacts that will be used at runtime,
the tests will be ran in the <code class="literal">release</code> mode by default.</p><p>However, in some cases the test-suite of a package doesn’t work properly in the
<code class="literal">release</code> mode. For these situations, the mode for <code class="literal">checkPhase</code> can be changed like
so:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">rustPlatform.buildRustPackage {
  <span class="hljs-comment">/* ... */</span>
  <span class="hljs-attr">checkType</span> = <span class="hljs-string">"debug"</span>;
}
</code></pre><p>Please note that the code will be compiled twice here: once in <code class="literal">release</code> mode
for the <code class="literal">buildPhase</code>, and again in <code class="literal">debug</code> mode for the <code class="literal">checkPhase</code>.</p><p>Test flags, e.g., <code class="literal">--package foo</code>, can be passed to <code class="literal">cargo test</code> via the
<code class="literal">cargoTestFlags</code> attribute.</p><p>Another attribute, called <code class="literal">checkFlags</code>, is used to pass arguments to the test
binary itself, as stated
<a class="link" href="https://doc.rust-lang.org/cargo/commands/cargo-test.html" target="_top">here</a>.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="tests-relying-on-the-structure-of-the-target-directory" class="title">Tests relying on the structure of the <code class="literal">target/</code> directory   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#tests-relying-on-the-structure-of-the-target-directory" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Some tests may rely on the structure of the <code class="literal">target/</code> directory. Those tests
are likely to fail because we use <code class="literal">cargo --target</code> during the build. This means that
the artifacts
<a class="link" href="https://doc.rust-lang.org/cargo/guide/build-cache.html" target="_top">are stored in <code class="literal">target/&lt;architecture&gt;/release/</code></a>,
rather than in <code class="literal">target/release/</code>.</p><p>This can only be worked around by patching the affected tests accordingly.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="disabling-package-tests" class="title">Disabling package-tests   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#disabling-package-tests" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>In some instances, it may be necessary to disable testing altogether (with <code class="literal">doCheck = false;</code>):</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>If no tests exist – the <code class="literal">checkPhase</code> should be explicitly disabled to skip
unnecessary build steps to speed up the build.</p></li><li class="listitem"><p>If tests are highly impure (e.g. due to network usage).</p></li></ul></div><p>There will obviously be some corner-cases not listed above where it’s sensible to disable tests.
The above are just guidelines, and exceptions may be granted on a case-by-case basis.</p><p>However, please check if it’s possible to disable a problematic subset of the
test suite and leave a comment explaining your reasoning.</p><p>This can be achieved with <code class="literal">--skip</code> in <code class="literal">checkFlags</code>:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">rustPlatform.buildRustPackage {
  <span class="hljs-comment">/* ... */</span>
  <span class="hljs-attr">checkFlags</span> = [
    <span class="hljs-comment"># reason for disabling test</span>
    <span class="hljs-string">"--skip=example::tests:example_test"</span>
  ];
}
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="using-cargo-nextest" class="title">Using <code class="literal">cargo-nextest</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#using-cargo-nextest" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Tests can be run with <a class="link" href="https://github.com/nextest-rs/nextest" target="_top">cargo-nextest</a>
by setting <code class="literal">useNextest = true</code>. The same options still apply, but nextest
accepts a different set of arguments and the settings might need to be
adapted to be compatible with cargo-nextest.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">rustPlatform.buildRustPackage {
  <span class="hljs-comment">/* ... */</span>
  <span class="hljs-attr">useNextest</span> = <span class="hljs-literal">true</span>;
}
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="setting-test-threads" class="title">Setting <code class="literal">test-threads</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#setting-test-threads" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p><code class="literal">buildRustPackage</code> will use parallel test threads by default,
sometimes it may be necessary to disable this so the tests run consecutively.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">rustPlatform.buildRustPackage {
  <span class="hljs-comment">/* ... */</span>
  <span class="hljs-attr">dontUseCargoParallelTests</span> = <span class="hljs-literal">true</span>;
}
</code></pre>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="building-a-package-in-debug-mode" class="title">Building a package in <code class="literal">debug</code> mode   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#building-a-package-in-debug-mode" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>By default, <code class="literal">buildRustPackage</code> will use <code class="literal">release</code> mode for builds. If a package
should be built in <code class="literal">debug</code> mode, it can be configured like so:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">rustPlatform.buildRustPackage {
  <span class="hljs-comment">/* ... */</span>
  <span class="hljs-attr">buildType</span> = <span class="hljs-string">"debug"</span>;
}
</code></pre><p>In this scenario, the <code class="literal">checkPhase</code> will be ran in <code class="literal">debug</code> mode as well.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="custom-buildinstall-procedures" class="title">Custom <code class="literal">build</code>/<code class="literal">install</code>-procedures   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#custom-buildinstall-procedures" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Some packages may use custom scripts for building/installing, e.g. with a <code class="literal">Makefile</code>.
In these cases, it’s recommended to override the <code class="literal">buildPhase</code>/<code class="literal">installPhase</code>/<code class="literal">checkPhase</code>.</p><p>Otherwise, some steps may fail because of the modified directory structure of <code class="literal">target/</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="building-a-crate-with-an-absent-or-out-of-date-cargo.lock-file" class="title">Building a crate with an absent or out-of-date Cargo.lock file   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#building-a-crate-with-an-absent-or-out-of-date-cargo.lock-file" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p><code class="literal">buildRustPackage</code> needs a <code class="literal">Cargo.lock</code> file to get all dependencies in the
source code in a reproducible way. If it is missing or out-of-date one can use
the <code class="literal">cargoPatches</code> attribute to update or add it.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">rustPlatform.buildRustPackage <span class="hljs-keyword">rec</span> {
  (...)
  <span class="hljs-attr">cargoPatches</span> = [
    <span class="hljs-comment"># a patch file to add/update Cargo.lock in the source code</span>
    ./add-Cargo.lock.patch
  ];
}
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="compiling-non-rust-packages-that-include-rust-code" class="title">Compiling non-Rust packages that include Rust code   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#compiling-non-rust-packages-that-include-rust-code" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Several non-Rust packages incorporate Rust code for performance- or
security-sensitive parts. <code class="literal">rustPlatform</code> exposes several functions and
hooks that can be used to integrate Cargo in non-Rust packages.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="vendoring-of-dependencies" class="title">Vendoring of dependencies   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#vendoring-of-dependencies" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Since network access is not allowed in sandboxed builds, Rust crate
dependencies need to be retrieved using a fetcher. <code class="literal">rustPlatform</code>
provides the <code class="literal">fetchCargoTarball</code> fetcher, which vendors all
dependencies of a crate. For example, given a source path <code class="literal">src</code>
containing <code class="literal">Cargo.toml</code> and <code class="literal">Cargo.lock</code>, <code class="literal">fetchCargoTarball</code>
can be used as follows:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">cargoDeps</span> = rustPlatform.fetchCargoTarball {
  <span class="hljs-keyword">inherit</span> src;
  <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-BoHIN/519Top1NUBjpB/oEMqi86Omt3zTQcXFWqrek0="</span>;
};
</code></pre><p>The <code class="literal">src</code> attribute is required, as well as a hash specified through
one of the <code class="literal">hash</code> attribute. The following optional attributes can
also be used:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">name</code>: the name that is used for the dependencies tarball.  If
<code class="literal">name</code> is not specified, then the name <code class="literal">cargo-deps</code> will be used.</p></li><li class="listitem"><p><code class="literal">sourceRoot</code>: when the <code class="literal">Cargo.lock</code>/<code class="literal">Cargo.toml</code> are in a
subdirectory, <code class="literal">sourceRoot</code> specifies the relative path to these
files.</p></li><li class="listitem"><p><code class="literal">patches</code>: patches to apply before vendoring. This is useful when
the <code class="literal">Cargo.lock</code>/<code class="literal">Cargo.toml</code> files need to be patched before
vendoring.</p></li></ul></div><p>If a <code class="literal">Cargo.lock</code> file is available, you can alternatively use the
<code class="literal">importCargoLock</code> function. In contrast to <code class="literal">fetchCargoTarball</code>, this
function does not require a hash (unless git dependencies are used)
and fetches every dependency as a separate fixed-output derivation.
<code class="literal">importCargoLock</code> can be used as follows:</p><pre><code class="programlisting hljs language-nix" data-highlighted="yes"><span class="hljs-attr">cargoDeps</span> = rustPlatform.importCargoLock {
  <span class="hljs-attr">lockFile</span> = ./Cargo.lock;
};
</code></pre><p>If the <code class="literal">Cargo.lock</code> file includes git dependencies, then their output
hashes need to be specified since they are not available through the
lock file. For example:</p><pre><code class="programlisting hljs language-nix" data-highlighted="yes"><span class="hljs-attr">cargoDeps</span> = rustPlatform.importCargoLock {
  <span class="hljs-attr">lockFile</span> = ./Cargo.lock;
  <span class="hljs-attr">outputHashes</span> = {
    <span class="hljs-string">"rand-0.8.3"</span> = <span class="hljs-string">"0ya2hia3cn31qa8894s3av2s8j5bjwb6yq92k0jsnlx7jid0jwqa"</span>;
  };
};
</code></pre><p>If you do not specify an output hash for a git dependency, building
<code class="literal">cargoDeps</code> will fail and inform you of which crate needs to be
added. To find the correct hash, you can first use <code class="literal">lib.fakeSha256</code> or
<code class="literal">lib.fakeHash</code> as a stub hash. Building <code class="literal">cargoDeps</code> will then inform
you of the correct hash.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="hooks" class="title">Hooks   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#hooks" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p><code class="literal">rustPlatform</code> provides the following hooks to automate Cargo builds:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">cargoSetupHook</code>: configure Cargo to use dependencies vendored
through <code class="literal">fetchCargoTarball</code>. This hook uses the <code class="literal">cargoDeps</code>
environment variable to find the vendored dependencies. If a project
already vendors its dependencies, the variable <code class="literal">cargoVendorDir</code> can
be used instead. When the <code class="literal">Cargo.toml</code>/<code class="literal">Cargo.lock</code> files are not in
<code class="literal">sourceRoot</code>, then the optional <code class="literal">cargoRoot</code> is used to specify the
Cargo root directory relative to <code class="literal">sourceRoot</code>.</p></li><li class="listitem"><p><code class="literal">cargoBuildHook</code>: use Cargo to build a crate. If the crate to be
built is a crate in e.g. a Cargo workspace, the relative path to the
crate to build can be set through the optional <code class="literal">buildAndTestSubdir</code>
environment variable. Features can be specified with
<code class="literal">cargoBuildNoDefaultFeatures</code> and <code class="literal">cargoBuildFeatures</code>. Additional
Cargo build flags can be passed through <code class="literal">cargoBuildFlags</code>.</p></li><li class="listitem"><p><code class="literal">maturinBuildHook</code>: use <a class="link" href="https://github.com/PyO3/maturin" target="_top">Maturin</a>
to build a Python wheel. Similar to <code class="literal">cargoBuildHook</code>, the optional
variable <code class="literal">buildAndTestSubdir</code> can be used to build a crate in a
Cargo workspace. Additional Maturin flags can be passed through
<code class="literal">maturinBuildFlags</code>.</p></li><li class="listitem"><p><code class="literal">cargoCheckHook</code>: run tests using Cargo. The build type for checks
can be set using <code class="literal">cargoCheckType</code>. Features can be specified with
<code class="literal">cargoCheckNoDefaultFeatures</code> and <code class="literal">cargoCheckFeatures</code>. Additional
flags can be passed to the tests using <code class="literal">checkFlags</code> and
<code class="literal">checkFlagsArray</code>. By default, tests are run in parallel. This can
be disabled by setting <code class="literal">dontUseCargoParallelTests</code>.</p></li><li class="listitem"><p><code class="literal">cargoNextestHook</code>: run tests using
<a class="link" href="https://github.com/nextest-rs/nextest" target="_top">cargo-nextest</a>. The same
options for <code class="literal">cargoCheckHook</code> also applies to <code class="literal">cargoNextestHook</code>.</p></li><li class="listitem"><p><code class="literal">cargoInstallHook</code>: install binaries and static/shared libraries
that were built using <code class="literal">cargoBuildHook</code>.</p></li><li class="listitem"><p><code class="literal">bindgenHook</code>: for crates which use <code class="literal">bindgen</code> as a build dependency, lets
<code class="literal">bindgen</code> find <code class="literal">libclang</code> and <code class="literal">libclang</code> find the libraries in <code class="literal">buildInputs</code>.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="examples" class="title">Examples   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#examples" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="python-package-using-setuptools-rust" class="title">Python package using <code class="literal">setuptools-rust</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#python-package-using-setuptools-rust" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>For Python packages using <code class="literal">setuptools-rust</code>, you can use
<code class="literal">fetchCargoTarball</code> and <code class="literal">cargoSetupHook</code> to retrieve and set up Cargo
dependencies. The build itself is then performed by
<code class="literal">buildPythonPackage</code>.</p><p>The following example outlines how the <code class="literal">tokenizers</code> Python package is
built. Since the Python package is in the <code class="literal">source/bindings/python</code>
directory of the <code class="literal">tokenizers</code> project’s source archive, we use
<code class="literal">sourceRoot</code> to point the tooling to this directory:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ fetchFromGitHub
, buildPythonPackage
, cargo
, rustPlatform
, rustc
, setuptools-rust
}:

buildPythonPackage <span class="hljs-keyword">rec</span> {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"tokenizers"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"0.10.0"</span>;

  <span class="hljs-attr">src</span> = fetchFromGitHub {
    <span class="hljs-attr">owner</span> = <span class="hljs-string">"huggingface"</span>;
    <span class="hljs-attr">repo</span> = pname;
    <span class="hljs-attr">rev</span> = <span class="hljs-string">"python-v<span class="hljs-subst">${version}</span>"</span>;
    <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-rQ2hRV52naEf6PvRsWVCTN7B1oXAQGmnpJw4iIdhamw="</span>;
  };

  <span class="hljs-attr">cargoDeps</span> = rustPlatform.fetchCargoTarball {
    <span class="hljs-keyword">inherit</span> src sourceRoot;
    <span class="hljs-attr">name</span> = <span class="hljs-string">"<span class="hljs-subst">${pname}</span>-<span class="hljs-subst">${version}</span>"</span>;
    <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-miW//pnOmww2i6SOGbkrAIdc/JMDT4FJLqdMFojZeoY="</span>;
  };

  <span class="hljs-attr">sourceRoot</span> = <span class="hljs-string">"<span class="hljs-subst">${src.name}</span>/bindings/python"</span>;

  <span class="hljs-attr">nativeBuildInputs</span> = [
    cargo
    rustPlatform.cargoSetupHook
    rustc
    setuptools-rust
  ];

  <span class="hljs-comment"># ...</span>
}
</code></pre><p>In some projects, the Rust crate is not in the main Python source
directory.  In such cases, the <code class="literal">cargoRoot</code> attribute can be used to
specify the crate’s directory relative to <code class="literal">sourceRoot</code>. In the
following example, the crate is in <code class="literal">src/rust</code>, as specified in the
<code class="literal">cargoRoot</code> attribute. Note that we also need to specify the correct
path for <code class="literal">fetchCargoTarball</code>.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">
{ buildPythonPackage
, fetchPypi
, rustPlatform
, setuptools-rust
, openssl
}:

buildPythonPackage <span class="hljs-keyword">rec</span> {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"cryptography"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"3.4.2"</span>; <span class="hljs-comment"># Also update the hash in vectors.nix</span>

  <span class="hljs-attr">src</span> = fetchPypi {
    <span class="hljs-keyword">inherit</span> pname version;
    <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-xGDilsjLOnls3MfVbGKnj80KCUCczZxlis5PmHzpNcQ="</span>;
  };

  <span class="hljs-attr">cargoDeps</span> = rustPlatform.fetchCargoTarball {
    <span class="hljs-keyword">inherit</span> src;
    <span class="hljs-attr">sourceRoot</span> = <span class="hljs-string">"<span class="hljs-subst">${pname}</span>-<span class="hljs-subst">${version}</span>/<span class="hljs-subst">${cargoRoot}</span>"</span>;
    <span class="hljs-attr">name</span> = <span class="hljs-string">"<span class="hljs-subst">${pname}</span>-<span class="hljs-subst">${version}</span>"</span>;
    <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-PS562W4L1NimqDV2H0jl5vYhL08H9est/pbIxSdYVfo="</span>;
  };

  <span class="hljs-attr">cargoRoot</span> = <span class="hljs-string">"src/rust"</span>;

  <span class="hljs-comment"># ...</span>
}
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="python-package-using-maturin" class="title">Python package using <code class="literal">maturin</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#python-package-using-maturin" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>Python packages that use <a class="link" href="https://github.com/PyO3/maturin" target="_top">Maturin</a>
can be built with <code class="literal">fetchCargoTarball</code>, <code class="literal">cargoSetupHook</code>, and
<code class="literal">maturinBuildHook</code>. For example, the following (partial) derivation
builds the <code class="literal">retworkx</code> Python package. <code class="literal">fetchCargoTarball</code> and
<code class="literal">cargoSetupHook</code> are used to fetch and set up the crate dependencies.
<code class="literal">maturinBuildHook</code> is used to perform the build.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ lib
, buildPythonPackage
, rustPlatform
, fetchFromGitHub
}:

buildPythonPackage <span class="hljs-keyword">rec</span> {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"retworkx"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"0.6.0"</span>;

  <span class="hljs-attr">src</span> = fetchFromGitHub {
    <span class="hljs-attr">owner</span> = <span class="hljs-string">"Qiskit"</span>;
    <span class="hljs-attr">repo</span> = <span class="hljs-string">"retworkx"</span>;
    <span class="hljs-attr">rev</span> = version;
    <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-11n30ldg3y3y6qxg3hbj837pnbwjkqw3nxq6frds647mmmprrd20="</span>;
  };

  <span class="hljs-attr">cargoDeps</span> = rustPlatform.fetchCargoTarball {
    <span class="hljs-keyword">inherit</span> src;
    <span class="hljs-attr">name</span> = <span class="hljs-string">"<span class="hljs-subst">${pname}</span>-<span class="hljs-subst">${version}</span>"</span>;
    <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-heOBK8qi2nuc/Ib+I/vLzZ1fUUD/G/KTw9d7M4Hz5O0="</span>;
  };

  <span class="hljs-attr">format</span> = <span class="hljs-string">"pyproject"</span>;

  <span class="hljs-attr">nativeBuildInputs</span> = <span class="hljs-keyword">with</span> rustPlatform; [ cargoSetupHook maturinBuildHook ];

  <span class="hljs-comment"># ...</span>
}
</code></pre>
</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="compiling-rust-crates-using-nix-instead-of-cargo" class="title"><code class="literal">buildRustCrate</code>: Compiling Rust crates using Nix instead of Cargo   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#compiling-rust-crates-using-nix-instead-of-cargo" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="simple-operation" class="title">Simple operation   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#simple-operation" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>When run, <code class="literal">cargo build</code> produces a file called <code class="literal">Cargo.lock</code>,
containing pinned versions of all dependencies. Nixpkgs contains a
tool called <code class="literal">crate2Nix</code> (<code class="literal">nix-shell -p crate2nix</code>), which can be
used to turn a <code class="literal">Cargo.lock</code> into a Nix expression.  That Nix
expression calls <code class="literal">rustc</code> directly (hence bypassing Cargo), and can
be used to compile a crate and all its dependencies.</p><p>See <a class="link" href="https://github.com/kolloch/crate2nix#known-restrictions" target="_top"><code class="literal">crate2nix</code>’s documentation</a>
for instructions on how to use it.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="handling-external-dependencies" class="title">Handling external dependencies   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#handling-external-dependencies" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Some crates require external libraries. For crates from
<a class="link" href="https://crates.io/" target="_top">crates.io</a>, such libraries can be specified in
<code class="literal">defaultCrateOverrides</code> package in nixpkgs itself.</p><p>Starting from that file, one can add more overrides, to add features
or build inputs by overriding the hello crate in a separate file.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">with</span> <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {};
((<span class="hljs-built_in">import</span> ./hello.nix).hello {}).override {
  <span class="hljs-attr">crateOverrides</span> = defaultCrateOverrides // {
    <span class="hljs-attr">hello</span> = attrs: { <span class="hljs-attr">buildInputs</span> = [ openssl ]; };
  };
}
</code></pre><p>Here, <code class="literal">crateOverrides</code> is expected to be a attribute set, where the
key is the crate name without version number and the value a function.
The function gets all attributes passed to <code class="literal">buildRustCrate</code> as first
argument and returns a set that contains all attribute that should be
overwritten.</p><p>For more complicated cases, such as when parts of the crate’s
derivation depend on the crate’s version, the <code class="literal">attrs</code> argument of
the override above can be read, as in the following example, which
patches the derivation:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">with</span> <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {};
((<span class="hljs-built_in">import</span> ./hello.nix).hello {}).override {
  <span class="hljs-attr">crateOverrides</span> = defaultCrateOverrides // {
    <span class="hljs-attr">hello</span> = attrs: lib.optionalAttrs (lib.versionAtLeast attrs.version <span class="hljs-string">"1.0"</span>)  {
      <span class="hljs-attr">postPatch</span> = <span class="hljs-string">''
        substituteInPlace lib/zoneinfo.rs \
          --replace "/usr/share/zoneinfo" "<span class="hljs-subst">${tzdata}</span>/share/zoneinfo"
      ''</span>;
    };
  };
}
</code></pre><p>Another situation is when we want to override a nested
dependency. This actually works in the exact same way, since the
<code class="literal">crateOverrides</code> parameter is forwarded to the crate’s
dependencies. For instance, to override the build inputs for crate
<code class="literal">libc</code> in the example above, where <code class="literal">libc</code> is a dependency of the main
crate, we could do:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">with</span> <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {};
((<span class="hljs-built_in">import</span> hello.nix).hello {}).override {
  <span class="hljs-attr">crateOverrides</span> = defaultCrateOverrides // {
    <span class="hljs-attr">libc</span> = attrs: { <span class="hljs-attr">buildInputs</span> = []; };
  };
}
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="options-and-phases-configuration" class="title">Options and phases configuration   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#options-and-phases-configuration" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Actually, the overrides introduced in the previous section are more
general. A number of other parameters can be overridden:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>The version of <code class="literal">rustc</code> used to compile the crate:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">(hello {}).override { <span class="hljs-attr">rust</span> = pkgs.rust; };
</code></pre></li><li class="listitem"><p>Whether to build in release mode or debug mode (release mode by
default):</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">(hello {}).override { <span class="hljs-attr">release</span> = <span class="hljs-literal">false</span>; };
</code></pre></li><li class="listitem"><p>Whether to print the commands sent to <code class="literal">rustc</code> when building
(equivalent to <code class="literal">--verbose</code> in cargo:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">(hello {}).override { <span class="hljs-attr">verbose</span> = <span class="hljs-literal">false</span>; };
</code></pre></li><li class="listitem"><p>Extra arguments to be passed to <code class="literal">rustc</code>:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">(hello {}).override { <span class="hljs-attr">extraRustcOpts</span> = <span class="hljs-string">"-Z debuginfo=2"</span>; };
</code></pre></li><li class="listitem"><p>Phases, just like in any other derivation, can be specified using
the following attributes: <code class="literal">preUnpack</code>, <code class="literal">postUnpack</code>, <code class="literal">prePatch</code>,
<code class="literal">patches</code>, <code class="literal">postPatch</code>, <code class="literal">preConfigure</code> (in the case of a Rust crate,
this is run before calling the “build” script), <code class="literal">postConfigure</code>
(after the “build” script),<code class="literal">preBuild</code>, <code class="literal">postBuild</code>, <code class="literal">preInstall</code> and
<code class="literal">postInstall</code>. As an example, here is how to create a new module
before running the build script:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">(hello {}).override {
  <span class="hljs-attr">preConfigure</span> = <span class="hljs-string">''
     echo "pub const PATH=\"<span class="hljs-subst">${hi.out}</span>\";" &gt;&gt; src/path.rs"
  ''</span>;
};
</code></pre></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="setting-up-nix-shell" class="title">Setting Up <code class="literal">nix-shell</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#setting-up-nix-shell" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Oftentimes you want to develop code from within <code class="literal">nix-shell</code>. Unfortunately
<code class="literal">buildRustCrate</code> does not support common <code class="literal">nix-shell</code> operations directly
(see <a class="link" href="https://github.com/NixOS/nixpkgs/issues/37945" target="_top">this issue</a>)
so we will use <code class="literal">stdenv.mkDerivation</code> instead.</p><p>Using the example <code class="literal">hello</code> project above, we want to do the following:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>Have access to <code class="literal">cargo</code> and <code class="literal">rustc</code></p></li><li class="listitem"><p>Have the <code class="literal">openssl</code> library available to a crate through it’s <span class="emphasis"><em>normal</em></span>
compilation mechanism (<code class="literal">pkg-config</code>).</p></li></ul></div><p>A typical <code class="literal">shell.nix</code> might look like:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">with</span> <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {};

stdenv.mkDerivation {
  <span class="hljs-attr">name</span> = <span class="hljs-string">"rust-env"</span>;
  <span class="hljs-attr">nativeBuildInputs</span> = [
    rustc cargo

    <span class="hljs-comment"># Example Build-time Additional Dependencies</span>
    pkg-config
  ];
  <span class="hljs-attr">buildInputs</span> = [
    <span class="hljs-comment"># Example Run-time Additional Dependencies</span>
    openssl
  ];

  <span class="hljs-comment"># Set Environment Variables</span>
  <span class="hljs-attr">RUST_BACKTRACE</span> = <span class="hljs-number">1</span>;
}
</code></pre><p>You should now be able to run the following:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">nix-shell --pure</span>
<span class="hljs-meta prompt_">$ </span><span class="language-bash">cargo build</span>
<span class="hljs-meta prompt_">$ </span><span class="language-bash">cargo <span class="hljs-built_in">test</span></span>
</code></pre>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="using-community-maintained-rust-toolchains" class="title">Using community maintained Rust toolchains   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#using-community-maintained-rust-toolchains" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><div class="note"><h3 class="title">Note</h3><p>The following projects cannot be used within Nixpkgs since <a class="link" href="https://nixos.org/manual/nix/unstable/language/import-from-derivation" target="_top">Import From Derivation</a> (IFD) is disallowed in Nixpkgs.
To package things that require Rust nightly, <code class="literal">RUSTC_BOOTSTRAP = true;</code> can sometimes be used as a hack.</p></div><p>There are two community maintained approaches to Rust toolchain management:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><a class="link" href="https://github.com/oxalica/rust-overlay" target="_top">oxalica’s Rust overlay</a></p></li><li class="listitem"><p><a class="link" href="https://github.com/nix-community/fenix" target="_top">fenix</a></p></li></ul></div><p>Despite their names, both projects provides a similar set of packages and overlays under different APIs.</p><p>Oxalica’s overlay allows you to select a particular Rust version without you providing a hash or a flake input,
but comes with a larger git repository than fenix.</p><p>Fenix also provides rust-analyzer nightly in addition to the Rust toolchains.</p><p>Both oxalica’s overlay and fenix better integrate with nix and cache optimizations.
Because of this and ergonomics, either of those community projects
should be preferred to the Mozilla’s Rust overlay (<a class="link" href="https://github.com/mozilla/nixpkgs-mozilla" target="_top">nixpkgs-mozilla</a>).</p><p>The following documentation demonstrates examples using fenix and oxalica’s Rust overlay
with <code class="literal">nix-shell</code> and building derivations. More advanced usages like flake usage
are documented in their own repositories.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="using-rust-nightly-with-nix-shell" class="title">Using Rust nightly with <code class="literal">nix-shell</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#using-rust-nightly-with-nix-shell" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Here is a simple <code class="literal">shell.nix</code> that provides Rust nightly (default profile) using fenix:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">with</span> <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; { };
<span class="hljs-keyword">let</span>
  <span class="hljs-attr">fenix</span> = callPackage
    (fetchFromGitHub {
      <span class="hljs-attr">owner</span> = <span class="hljs-string">"nix-community"</span>;
      <span class="hljs-attr">repo</span> = <span class="hljs-string">"fenix"</span>;
      <span class="hljs-comment"># commit from: 2023-03-03</span>
      <span class="hljs-attr">rev</span> = <span class="hljs-string">"e2ea04982b892263c4d939f1cc3bf60a9c4deaa1"</span>;
      <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-AsOim1A8KKtMWIxG+lXh5Q4P2bhOZjoUhFWJ1EuZNNk="</span>;
    })
    { };
<span class="hljs-keyword">in</span>
mkShell {
  <span class="hljs-attr">name</span> = <span class="hljs-string">"rust-env"</span>;
  <span class="hljs-attr">nativeBuildInputs</span> = [
    <span class="hljs-comment"># Note: to use stable, just replace `default` with `stable`</span>
    fenix.default.toolchain

    <span class="hljs-comment"># Example Build-time Additional Dependencies</span>
    pkg-config
  ];
  <span class="hljs-attr">buildInputs</span> = [
    <span class="hljs-comment"># Example Run-time Additional Dependencies</span>
    openssl
  ];

  <span class="hljs-comment"># Set Environment Variables</span>
  <span class="hljs-attr">RUST_BACKTRACE</span> = <span class="hljs-number">1</span>;
}
</code></pre><p>Save this to <code class="literal">shell.nix</code>, then run:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">rustc --version</span>
rustc 1.69.0-nightly (13471d3b2 2023-03-02)
</code></pre><p>To see that you are using nightly.</p><p>Oxalica’s Rust overlay has more complete examples of <code class="literal">shell.nix</code> (and cross compilation) under its
<a class="link" href="https://github.com/oxalica/rust-overlay/tree/e53e8853aa7b0688bc270e9e6a681d22e01cf299/examples" target="_top"><code class="literal">examples</code> directory</a>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="using-rust-nightly-in-a-derivation-with-buildrustpackage" class="title">Using Rust nightly in a derivation with <code class="literal">buildRustPackage</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#using-rust-nightly-in-a-derivation-with-buildrustpackage" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>You can also use Rust nightly to build rust packages using <code class="literal">makeRustPlatform</code>.
The below snippet demonstrates invoking <code class="literal">buildRustPackage</code> with a Rust toolchain from oxalica’s overlay:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">with</span> <span class="hljs-built_in">import</span> &lt;nixpkgs&gt;
{
  <span class="hljs-attr">overlays</span> = [
    (<span class="hljs-built_in">import</span> (fetchTarball <span class="hljs-string">"https://github.com/oxalica/rust-overlay/archive/master.tar.gz"</span>))
  ];
};
<span class="hljs-keyword">let</span>
  <span class="hljs-attr">rustPlatform</span> = makeRustPlatform {
    <span class="hljs-attr">cargo</span> = rust-bin.stable.latest.minimal;
    <span class="hljs-attr">rustc</span> = rust-bin.stable.latest.minimal;
  };
<span class="hljs-keyword">in</span>

rustPlatform.buildRustPackage <span class="hljs-keyword">rec</span> {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"ripgrep"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"12.1.1"</span>;

  <span class="hljs-attr">src</span> = fetchFromGitHub {
    <span class="hljs-attr">owner</span> = <span class="hljs-string">"BurntSushi"</span>;
    <span class="hljs-attr">repo</span> = <span class="hljs-string">"ripgrep"</span>;
    <span class="hljs-attr">rev</span> = version;
    <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-+s5RBC3XSgb8omTbUNLywZnP6jSxZBKSS1BmXOjRF8M="</span>;
  };

  <span class="hljs-attr">cargoHash</span> = <span class="hljs-string">"sha256-l1vL2ZdtDRxSGvP0X/l3nMw8+6WF67KPutJEzUROjg8="</span>;

  <span class="hljs-attr">doCheck</span> = <span class="hljs-literal">false</span>;

  <span class="hljs-attr">meta</span> = <span class="hljs-keyword">with</span> lib; {
    <span class="hljs-attr">description</span> = <span class="hljs-string">"A fast line-oriented regex search tool, similar to ag and ack"</span>;
    <span class="hljs-attr">homepage</span> = <span class="hljs-string">"https://github.com/BurntSushi/ripgrep"</span>;
    <span class="hljs-attr">license</span> = <span class="hljs-keyword">with</span> licenses; [ mit unlicense ];
    <span class="hljs-attr">maintainers</span> = <span class="hljs-keyword">with</span> maintainers; [];
  };
}
</code></pre><p>Follow the below steps to try that snippet.</p><div class="orderedlist"><ol class="orderedlist compact" type="1"><li class="listitem"><p>save the above snippet as <code class="literal">default.nix</code> in that directory</p></li><li class="listitem"><p>cd into that directory and run <code class="literal">nix-build</code></p></li></ol></div><p>Fenix also has examples with <code class="literal">buildRustPackage</code>,
<a class="link" href="https://github.com/ipetkov/crane" target="_top">crane</a>,
<a class="link" href="https://github.com/nix-community/naersk" target="_top">naersk</a>,
and cross compilation in its <a class="link" href="https://github.com/nix-community/fenix#examples" target="_top">Examples</a> section.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="using-git-bisect-on-the-rust-compiler" class="title">Using <code class="literal">git bisect</code> on the Rust compiler   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#using-git-bisect-on-the-rust-compiler" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Sometimes an upgrade of the Rust compiler (<code class="literal">rustc</code>) will break a
downstream package.  In these situations, being able to <code class="literal">git bisect</code>
the <code class="literal">rustc</code> version history to find the offending commit is quite
useful.  Nixpkgs makes it easy to do this.</p><p>First, roll back your nixpkgs to a commit in which its <code class="literal">rustc</code> used
<span class="emphasis"><em>the most recent one which doesn’t have the problem.</em></span>  You’ll need
to do this because of <code class="literal">rustc</code>’s extremely aggressive
version-pinning.</p><p>Next, add the following overlay, updating the Rust version to the
one in your rolled-back nixpkgs, and replacing <code class="literal">/git/scratch/rust</code>
with the path into which you have <code class="literal">git clone</code>d the <code class="literal">rustc</code> git
repository:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"> (final: prev: <span class="hljs-comment">/*lib.optionalAttrs prev.stdenv.targetPlatform.isAarch64*/</span> {
   <span class="hljs-attr">rust_1_72</span> =
     lib.updateManyAttrsByPath [{
       <span class="hljs-attr">path</span> = [ <span class="hljs-string">"packages"</span> <span class="hljs-string">"stable"</span> ];
       <span class="hljs-attr">update</span> = old: old.overrideScope(final: prev: {
         <span class="hljs-attr">rustc</span> = prev.rustc.overrideAttrs (_: {
           <span class="hljs-attr">src</span> = lib.cleanSource /git/scratch/rust;
           <span class="hljs-comment"># do *not* put passthru.isReleaseTarball=true here</span>
         });
       });
     }]
       prev.rust_1_72;
 })
</code></pre><p>If the problem you’re troubleshooting only manifests when
cross-compiling you can uncomment the <code class="literal">lib.optionalAttrs</code> in the
example above, and replace <code class="literal">isAarch64</code> with the target that is
having problems.  This will speed up your bisect quite a bit, since
the host compiler won’t need to be rebuilt.</p><p>Now, you can start a <code class="literal">git bisect</code> in the directory where you checked
out the <code class="literal">rustc</code> source code.  It is recommended to select the
endpoint commits by searching backwards from <code class="literal">origin/master</code> for the
<span class="emphasis"><em>commits which added the release notes for the versions in
question.</em></span>  If you set the endpoints to commits on the release
branches (i.e. the release tags), git-bisect will often get confused
by the complex merge-commit structures it will need to traverse.</p><p>The command loop you’ll want to use for bisecting looks like this:</p><pre><code class="programlisting bash hljs language-bash" data-highlighted="yes">git bisect {good,bad}  <span class="hljs-comment"># depending on result of last build</span>
git submodule update --init
CARGO_NET_OFFLINE=<span class="hljs-literal">false</span> cargo vendor \
  --<span class="hljs-built_in">sync</span> ./src/tools/cargo/Cargo.toml \
  --<span class="hljs-built_in">sync</span> ./src/tools/rust-analyzer/Cargo.toml \
  --<span class="hljs-built_in">sync</span> ./compiler/rustc_codegen_cranelift/Cargo.toml \
  --<span class="hljs-built_in">sync</span> ./src/bootstrap/Cargo.toml
nix-build <span class="hljs-variable">$NIXPKGS</span> -A package-broken-by-rust-changes
</code></pre><p>The <code class="literal">git submodule update --init</code> and <code class="literal">cargo vendor</code> commands above
require network access, so they can’t be performed from within the
<code class="literal">rustc</code> derivation, unfortunately.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="swift" class="title" style="clear: both">Swift   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#swift" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-swift-module-search-paths">Module search paths</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-swift-core-libraries">Core libraries</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-swift-packaging-with-swiftpm">Packaging with SwiftPM</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-swift-considerations-for-custom-build-tools">Considerations for custom build tools</a> </span></dt> </dl></div><p>The Swift compiler is provided by the <code class="literal">swift</code> package:</p><pre><code class="programlisting sh hljs language-bash" data-highlighted="yes"><span class="hljs-comment"># Compile and link a simple executable.</span>
nix-shell -p swift --run <span class="hljs-string">'swiftc -'</span> &lt;&lt;&lt; <span class="hljs-string">'print("Hello world!")'</span>
<span class="hljs-comment"># Run it!</span>
./main
</code></pre><p>The <code class="literal">swift</code> package also provides the <code class="literal">swift</code> command, with some caveats:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>Swift Package Manager (SwiftPM) is packaged separately as <code class="literal">swiftpm</code>. If you
need functionality like <code class="literal">swift build</code>, <code class="literal">swift run</code>, <code class="literal">swift test</code>, you must
also add the <code class="literal">swiftpm</code> package to your closure.</p></li><li class="listitem"><p>On Darwin, the <code class="literal">swift repl</code> command requires an Xcode installation. This is
because it uses the system LLDB debugserver, which has special entitlements.</p></li></ul></div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-swift-module-search-paths" class="title">Module search paths   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-swift-module-search-paths" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Like other toolchains in Nixpkgs, the Swift compiler executables are wrapped
to help Swift find your application’s dependencies in the Nix store. These
wrappers scan the <code class="literal">buildInputs</code> of your package derivation for specific
directories where Swift modules are placed by convention, and automatically
add those directories to the Swift compiler search paths.</p><p>Swift follows different conventions depending on the platform. The wrappers
look for the following directories:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>On Darwin platforms: <code class="literal">lib/swift/macosx</code>
(If not targeting macOS, replace <code class="literal">macosx</code> with the Xcode platform name.)</p></li><li class="listitem"><p>On other platforms: <code class="literal">lib/swift/linux/x86_64</code>
(Where <code class="literal">linux</code> and <code class="literal">x86_64</code> are from lowercase <code class="literal">uname -sm</code>.)</p></li><li class="listitem"><p>For convenience, Nixpkgs also adds <code class="literal">lib/swift</code> to the search path.
This can save a bit of work packaging Swift modules, because many Nix builds
will produce output for just one target any way.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-swift-core-libraries" class="title">Core libraries   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-swift-core-libraries" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>In addition to the standard library, the Swift toolchain contains some
additional ‘core libraries’ that, on Apple platforms, are normally distributed
as part of the OS or Xcode. These are packaged separately in Nixpkgs, and can
be found (for use in <code class="literal">buildInputs</code>) as:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">swiftPackages.Dispatch</code></p></li><li class="listitem"><p><code class="literal">swiftPackages.Foundation</code></p></li><li class="listitem"><p><code class="literal">swiftPackages.XCTest</code></p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-swift-packaging-with-swiftpm" class="title">Packaging with SwiftPM   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-swift-packaging-with-swiftpm" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Nixpkgs includes a small helper <code class="literal">swiftpm2nix</code> that can fetch your SwiftPM
dependencies for you, when you need to write a Nix expression to package your
application.</p><p>The first step is to run the generator:</p><pre><code class="programlisting sh hljs language-bash" data-highlighted="yes"><span class="hljs-built_in">cd</span> /path/to/my/project
<span class="hljs-comment"># Enter a Nix shell with the required tools.</span>
nix-shell -p swift swiftpm swiftpm2nix
<span class="hljs-comment"># First, make sure the workspace is up-to-date.</span>
swift package resolve
<span class="hljs-comment"># Now generate the Nix code.</span>
swiftpm2nix
</code></pre><p>This produces some files in a directory <code class="literal">nix</code>, which will be part of your Nix
expression. The next step is to write that expression:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ stdenv, swift, swiftpm, swiftpm2nix, fetchFromGitHub }:

<span class="hljs-keyword">let</span>
  <span class="hljs-comment"># Pass the generated files to the helper.</span>
  <span class="hljs-attr">generated</span> = swiftpm2nix.helpers ./nix;
<span class="hljs-keyword">in</span>

stdenv.mkDerivation <span class="hljs-keyword">rec</span> {
  <span class="hljs-attr">pname</span> = <span class="hljs-string">"myproject"</span>;
  <span class="hljs-attr">version</span> = <span class="hljs-string">"0.0.0"</span>;

  <span class="hljs-attr">src</span> = fetchFromGitHub {
    <span class="hljs-attr">owner</span> = <span class="hljs-string">"nixos"</span>;
    <span class="hljs-attr">repo</span> = pname;
    <span class="hljs-attr">rev</span> = version;
    <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA="</span>;
  };

  <span class="hljs-comment"># Including SwiftPM as a nativeBuildInput provides a buildPhase for you.</span>
  <span class="hljs-comment"># This by default performs a release build using SwiftPM, essentially:</span>
  <span class="hljs-comment">#   swift build -c release</span>
  <span class="hljs-attr">nativeBuildInputs</span> = [ swift swiftpm ];

  <span class="hljs-comment"># The helper provides a configure snippet that will prepare all dependencies</span>
  <span class="hljs-comment"># in the correct place, where SwiftPM expects them.</span>
  <span class="hljs-attr">configurePhase</span> = generated.configure;

  <span class="hljs-attr">installPhase</span> = <span class="hljs-string">''
    # This is a special function that invokes swiftpm to find the location
    # of the binaries it produced.
    binPath="$(swiftpmBinPath)"
    # Now perform any installation steps.
    mkdir -p $out/bin
    cp $binPath/myproject $out/bin/
  ''</span>;
}
</code></pre><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="ssec-swiftpm-custom-build-flags" class="title">Custom build flags   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-swiftpm-custom-build-flags" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>If you’d like to build a different configuration than <code class="literal">release</code>:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">swiftpmBuildConfig</span> = <span class="hljs-string">"debug"</span>;
</code></pre><p>It is also possible to provide additional flags to <code class="literal">swift build</code>:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">swiftpmFlags</span> = [ <span class="hljs-string">"--disable-dead-strip"</span> ];
</code></pre><p>The default <code class="literal">buildPhase</code> already passes <code class="literal">-j</code> for parallel building.</p><p>If these two customization options are insufficient, provide your own
<code class="literal">buildPhase</code> that invokes <code class="literal">swift build</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="ssec-swiftpm-running-tests" class="title">Running tests   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-swiftpm-running-tests" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>Including <code class="literal">swiftpm</code> in your <code class="literal">nativeBuildInputs</code> also provides a default
<code class="literal">checkPhase</code>, but it must be enabled with:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">doCheck</span> = <span class="hljs-literal">true</span>;
</code></pre><p>This essentially runs: <code class="literal">swift test -c release</code></p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="ssec-swiftpm-patching-dependencies" class="title">Patching dependencies   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-swiftpm-patching-dependencies" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>In some cases, it may be necessary to patch a SwiftPM dependency. SwiftPM
dependencies are located in <code class="literal">.build/checkouts</code>, but the <code class="literal">swiftpm2nix</code> helper
provides these as symlinks to read-only <code class="literal">/nix/store</code> paths. In order to patch
them, we need to make them writable.</p><p>A special function <code class="literal">swiftpmMakeMutable</code> is available to replace the symlink
with a writable copy:</p><pre><code class="programlisting hljs language-bash" data-highlighted="yes">configurePhase = generated.configure ++ <span class="hljs-string">''</span>
  <span class="hljs-comment"># Replace the dependency symlink with a writable copy.</span>
  swiftpmMakeMutable swift-crypto
  <span class="hljs-comment"># Now apply a patch.</span>
  patch -p1 -d .build/checkouts/swift-crypto -i <span class="hljs-variable">${./some-fix.patch}</span>
<span class="hljs-string">''</span>;
</code></pre>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-swift-considerations-for-custom-build-tools" class="title">Considerations for custom build tools   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-swift-considerations-for-custom-build-tools" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="ssec-swift-linking-the-standard-library" class="title">Linking the standard library   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-swift-linking-the-standard-library" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>The <code class="literal">swift</code> package has a separate <code class="literal">lib</code> output containing just the Swift
standard library, to prevent Swift applications needing a dependency on the
full Swift compiler at run-time. Linking with the Nixpkgs Swift toolchain
already ensures binaries correctly reference the <code class="literal">lib</code> output.</p><p>Sometimes, Swift is used only to compile part of a mixed codebase, and the
link step is manual. Custom build tools often locate the standard library
relative to the <code class="literal">swift</code> compiler executable, and while the result will work,
when this path ends up in the binary, it will have the Swift compiler as an
unintended dependency.</p><p>In this case, you should investigate how your build process discovers the
standard library, and override the path. The correct path will be something
like: <code class="literal">"${swift.swift.lib}/${swift.swiftModuleSubdir}"</code></p>
</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-language-texlive" class="title" style="clear: both">TeX Live   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-language-texlive" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-language-texlive-user-guide-experimental">User’s guide (experimental new interface)</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-language-texlive-user-guide">User’s guide</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-language-texlive-custom-packages">Custom packages</a> </span></dt> </dl></div><p>Since release 15.09 there is a new TeX Live packaging that lives entirely under attribute <code class="literal">texlive</code>.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-language-texlive-user-guide-experimental" class="title">User’s guide (experimental new interface)   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-language-texlive-user-guide-experimental" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Release 23.11 ships with a new interface that will eventually replace <code class="literal">texlive.combine</code>.</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>For basic usage, use some of the prebuilt environments available at the top level, such as <code class="literal">texliveBasic</code>, <code class="literal">texliveSmall</code>. For the full list of prebuilt environments, inspect <code class="literal">texlive.schemes</code>.</p></li><li class="listitem"><p>Packages cannot be used directly but must be assembled in an environment. To create or add packages to an environment, use</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">texliveSmall.withPackages (ps: <span class="hljs-keyword">with</span> ps; [ collection-langkorean algorithms cm-super ])
</code></pre><p>The function <code class="literal">withPackages</code> can be called multiple times to add more packages.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p><span class="strong"><strong>Note.</strong></span> Within Nixpkgs, packages should only use prebuilt environments as inputs, such as <code class="literal">texliveSmall</code> or <code class="literal">texliveInfraOnly</code>, and should not depend directly on <code class="literal">texlive</code>. Further dependencies should be added by calling <code class="literal">withPackages</code>. This is to ensure that there is a consistent and simple way to override the inputs.</p></li></ul></div></li><li class="listitem"><p><code class="literal">texlive.withPackages</code> uses the same logic as <code class="literal">buildEnv</code>. Only parts of a package are installed in an environment: its ‘runtime’ files (<code class="literal">tex</code> output), binaries (<code class="literal">out</code> output), and support files (<code class="literal">tlpkg</code> output). Moreover, man and info pages are assembled into separate <code class="literal">man</code> and <code class="literal">info</code> outputs. To add only the TeX files of a package, or its documentation (<code class="literal">texdoc</code> output), just specify the outputs:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">texlive.withPackages (ps: <span class="hljs-keyword">with</span> ps; [
  texdoc <span class="hljs-comment"># recommended package to navigate the documentation</span>
  perlPackages.LaTeXML.tex <span class="hljs-comment"># tex files of LaTeXML, omit binaries</span>
  cm-super
  cm-super.texdoc <span class="hljs-comment"># documentation of cm-super</span>
])
</code></pre></li><li class="listitem"><p>All packages distributed by TeX Live, which contains most of CTAN, are available and can be found under <code class="literal">texlive.pkgs</code>:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">nix repl</span>
<span class="hljs-meta prompt_">nix-repl&gt; </span><span class="language-bash">:l &lt;nixpkgs&gt;</span>
<span class="hljs-meta prompt_">nix-repl&gt; </span><span class="language-bash">texlive.pkgs.[TAB]</span>
</code></pre><p>Note that the packages in <code class="literal">texlive.pkgs</code> are only provided for search purposes and must not be used directly.</p></li><li class="listitem"><p><span class="strong"><strong>Experimental and subject to change without notice:</strong></span> to add the documentation for all packages in the environment, use</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">texliveSmall.__overrideTeXConfig { <span class="hljs-attr">withDocs</span> = <span class="hljs-literal">true</span>; }
</code></pre><p>This can be applied before or after calling <code class="literal">withPackages</code>.</p><p>The function currently support the parameters <code class="literal">withDocs</code>, <code class="literal">withSources</code>, and <code class="literal">requireTeXPackages</code>.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-language-texlive-user-guide" class="title">User’s guide   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-language-texlive-user-guide" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>For basic usage just pull <code class="literal">texlive.combined.scheme-basic</code> for an environment with basic LaTeX support.</p></li><li class="listitem"><p>It typically won’t work to use separately installed packages together. Instead, you can build a custom set of packages like this. Most CTAN packages should be available:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">texlive.combine {
  <span class="hljs-keyword">inherit</span> (texlive) scheme-small collection-langkorean algorithms cm-super;
}
</code></pre></li><li class="listitem"><p>There are all the schemes, collections and a few thousand packages, as defined upstream (perhaps with tiny differences).</p></li><li class="listitem"><p>By default you only get executables and files needed during runtime, and a little documentation for the core packages. To change that, you need to add <code class="literal">pkgFilter</code> function to <code class="literal">combine</code>.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">texlive.combine {
  <span class="hljs-comment"># inherit (texlive) whatever-you-want;</span>
  <span class="hljs-attr">pkgFilter</span> = pkg:
    pkg.<span class="hljs-attr">tlType</span> == <span class="hljs-string">"run"</span> || pkg.<span class="hljs-attr">tlType</span> == <span class="hljs-string">"bin"</span> || pkg.hasManpages || pkg.<span class="hljs-attr">pname</span> == <span class="hljs-string">"cm-super"</span>;
  <span class="hljs-comment"># elem tlType [ "run" "bin" "doc" "source" ]</span>
  <span class="hljs-comment"># there are also other attributes: version, name</span>
}
</code></pre></li><li class="listitem"><p>You can list packages e.g. by <code class="literal">nix repl</code>.</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">nix repl</span>
<span class="hljs-meta prompt_">nix-repl&gt; </span><span class="language-bash">:l &lt;nixpkgs&gt;</span>
<span class="hljs-meta prompt_">nix-repl&gt; </span><span class="language-bash">texlive.collection-[TAB]</span>
</code></pre></li><li class="listitem"><p>Note that the wrapper assumes that the result has a chance to be useful. For example, the core executables should be present, as well as some core data files. The supported way of ensuring this is by including some scheme, for example <code class="literal">scheme-basic</code>, into the combination.</p></li><li class="listitem"><p>TeX Live packages are also available under <code class="literal">texlive.pkgs</code> as derivations with outputs <code class="literal">out</code>, <code class="literal">tex</code>, <code class="literal">texdoc</code>, <code class="literal">texsource</code>, <code class="literal">tlpkg</code>, <code class="literal">man</code>, <code class="literal">info</code>. They cannot be installed outside of <code class="literal">texlive.combine</code> but are available for other uses. To repackage a font, for instance, use</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">stdenvNoCC.mkDerivation <span class="hljs-keyword">rec</span> {
  <span class="hljs-attr">src</span> = texlive.pkgs.iwona;

  <span class="hljs-keyword">inherit</span> (src) pname version;

  <span class="hljs-attr">installPhase</span> = <span class="hljs-string">''
    runHook preInstall
    install -Dm644 fonts/opentype/nowacki/iwona/*.otf -t $out/share/fonts/opentype
    runHook postInstall
  ''</span>;
}
</code></pre><p>See <code class="literal">biber</code>, <code class="literal">iwona</code> for complete examples.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-language-texlive-custom-packages" class="title">Custom packages   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-language-texlive-custom-packages" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>You may find that you need to use an external TeX package. A derivation for such package has to provide the contents of the “texmf” directory in its <code class="literal">"tex"</code> output, according to the <a class="link" href="https://tug.ctan.org/tds/tds.html" target="_top">TeX Directory Structure</a>. Dependencies on other TeX packages can be listed in the attribute <code class="literal">tlDeps</code>.</p><p>The functions <code class="literal">texlive.combine</code> and <code class="literal">texlive.withPackages</code> recognise the following outputs:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">"out"</code>: contents are linked in the TeX Live environment, and binaries in the <code class="literal">$out/bin</code> folder are wrapped;</p></li><li class="listitem"><p><code class="literal">"tex"</code>: linked in <code class="literal">$TEXMFDIST</code>; files should follow the TDS (for instance <code class="literal">$tex/tex/latex/foiltex/foiltex.cls</code>);</p></li><li class="listitem"><p><code class="literal">"texdoc"</code>, <code class="literal">"texsource"</code>: ignored by default, treated as <code class="literal">"tex"</code>;</p></li><li class="listitem"><p><code class="literal">"tlpkg"</code>: linked in <code class="literal">$TEXMFROOT/tlpkg</code>;</p></li><li class="listitem"><p><code class="literal">"man"</code>, <code class="literal">"info"</code>, …: the other outputs are combined into separate outputs.</p></li></ul></div><p>When using <code class="literal">pkgFilter</code>, <code class="literal">texlive.combine</code> will assign <code class="literal">tlType</code> respectively <code class="literal">"bin"</code>, <code class="literal">"run"</code>, <code class="literal">"doc"</code>, <code class="literal">"source"</code>, <code class="literal">"tlpkg"</code> to the above outputs.</p><p>Here is a (very verbose) example. See also the packages <code class="literal">auctex</code>, <code class="literal">eukleides</code>, <code class="literal">mftrace</code> for more examples.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">with</span> <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; {};

<span class="hljs-keyword">let</span>
  <span class="hljs-attr">foiltex</span> = stdenvNoCC.mkDerivation {
    <span class="hljs-attr">pname</span> = <span class="hljs-string">"latex-foiltex"</span>;
    <span class="hljs-attr">version</span> = <span class="hljs-string">"2.1.4b"</span>;

    <span class="hljs-attr">outputs</span> = [ <span class="hljs-string">"tex"</span> <span class="hljs-string">"texdoc"</span> ];
    passthru.<span class="hljs-attr">tlDeps</span> = <span class="hljs-keyword">with</span> texlive; [ latex ];

    <span class="hljs-attr">srcs</span> = [
      (fetchurl {
        <span class="hljs-attr">url</span> = <span class="hljs-string">"http://mirrors.ctan.org/macros/latex/contrib/foiltex/foiltex.dtx"</span>;
        <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-/2I2xHXpZi0S988uFsGuPV6hhMw8e0U5m/P8myf42R0="</span>;
      })
      (fetchurl {
        <span class="hljs-attr">url</span> = <span class="hljs-string">"http://mirrors.ctan.org/macros/latex/contrib/foiltex/foiltex.ins"</span>;
        <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-KTm3pkd+Cpu0nSE2WfsNEa56PeXBaNfx/sOO2Vv0kyc="</span>;
      })
    ];

    <span class="hljs-attr">unpackPhase</span> = <span class="hljs-string">''
      runHook preUnpack

      for _src in $srcs; do
        cp "$_src" $(stripHash "$_src")
      done

      runHook postUnpack
    ''</span>;

    <span class="hljs-attr">nativeBuildInputs</span> = [
      (texliveSmall.withPackages (ps: <span class="hljs-keyword">with</span> ps; [ cm-super hypdoc latexmk ]))
      <span class="hljs-comment"># multiple-outputs.sh fails if $out is not defined</span>
      (writeShellScript <span class="hljs-string">"force-tex-output.sh"</span> <span class="hljs-string">''
        out="<span class="hljs-char escape_">''$</span>{tex-}"
      ''</span>)
    ];

    <span class="hljs-attr">dontConfigure</span> = <span class="hljs-literal">true</span>;

    <span class="hljs-attr">buildPhase</span> = <span class="hljs-string">''
      runHook preBuild

      # Generate the style files
      latex foiltex.ins

      # Generate the documentation
      export HOME=.
      latexmk -pdf foiltex.dtx

      runHook postBuild
    ''</span>;

    <span class="hljs-attr">installPhase</span> = <span class="hljs-string">''
      runHook preInstall

      path="$tex/tex/latex/foiltex"
      mkdir -p "$path"
      cp *.{cls,def,clo,sty} "$path/"

      path="$texdoc/doc/tex/latex/foiltex"
      mkdir -p "$path"
      cp *.pdf "$path/"

      runHook postInstall
    ''</span>;

    <span class="hljs-attr">meta</span> = <span class="hljs-keyword">with</span> lib; {
      <span class="hljs-attr">description</span> = <span class="hljs-string">"A LaTeX2e class for overhead transparencies"</span>;
      <span class="hljs-attr">license</span> = licenses.unfreeRedistributable;
      <span class="hljs-attr">maintainers</span> = <span class="hljs-keyword">with</span> maintainers; [ veprbl ];
      <span class="hljs-attr">platforms</span> = platforms.all;
    };
  };

  <span class="hljs-attr">latex_with_foiltex</span> = texliveSmall.withPackages (_: [ foiltex ]);
<span class="hljs-keyword">in</span>
  runCommand <span class="hljs-string">"test.pdf"</span> {
    <span class="hljs-attr">nativeBuildInputs</span> = [ latex_with_foiltex ];
  } <span class="hljs-string">''
cat &gt;test.tex &lt;&lt;EOF
\documentclass{foils}

\title{Presentation title}
\date{}

\begin{document}
\maketitle
\end{document}
EOF
  pdflatex test.tex
  cp test.pdf $out
''</span>
</code></pre>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="titanium" class="title" style="clear: both">Titanium   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#titanium" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#building-a-titanium-app">Building a Titanium app</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#emulating-or-simulating-the-app">Emulating or simulating the app</a> </span></dt> </dl></div><p>The Nixpkgs repository contains facilities to deploy a variety of versions of
the <a class="link" href="https://www.appcelerator.com/" target="_top">Titanium SDK</a> versions, a cross-platform
mobile app development framework using JavaScript as an implementation language,
and includes a function abstraction making it possible to build Titanium
applications for Android and iOS devices from source code.</p><p>Not all Titanium features supported – currently, it can only be used to build
Android and iOS apps.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="building-a-titanium-app" class="title">Building a Titanium app   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#building-a-titanium-app" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>We can build a Titanium app from source for Android or iOS and for debugging or
release purposes by invoking the <code class="literal">titaniumenv.buildApp {}</code> function:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">titaniumenv.buildApp {
  <span class="hljs-attr">name</span> = <span class="hljs-string">"myapp"</span>;
  <span class="hljs-attr">src</span> = ./myappsource;

  <span class="hljs-attr">preBuild</span> = <span class="hljs-string">""</span>;
  <span class="hljs-attr">target</span> = <span class="hljs-string">"android"</span>; <span class="hljs-comment"># or 'iphone'</span>
  <span class="hljs-attr">tiVersion</span> = <span class="hljs-string">"7.1.0.GA"</span>;
  <span class="hljs-attr">release</span> = <span class="hljs-literal">true</span>;

  <span class="hljs-attr">androidsdkArgs</span> = {
    <span class="hljs-attr">platformVersions</span> = [ <span class="hljs-string">"25"</span> <span class="hljs-string">"26"</span> ];
  };
  <span class="hljs-attr">androidKeyStore</span> = ./keystore;
  <span class="hljs-attr">androidKeyAlias</span> = <span class="hljs-string">"myfirstapp"</span>;
  <span class="hljs-attr">androidKeyStorePassword</span> = <span class="hljs-string">"secret"</span>;

  <span class="hljs-attr">xcodeBaseDir</span> = <span class="hljs-string">"/Applications/Xcode.app"</span>;
  <span class="hljs-attr">xcodewrapperArgs</span> = {
    <span class="hljs-attr">version</span> = <span class="hljs-string">"9.3"</span>;
  };
  <span class="hljs-attr">iosMobileProvisioningProfile</span> = ./myprovisioning.profile;
  <span class="hljs-attr">iosCertificateName</span> = <span class="hljs-string">"My Company"</span>;
  <span class="hljs-attr">iosCertificate</span> = ./mycertificate.p12;
  <span class="hljs-attr">iosCertificatePassword</span> = <span class="hljs-string">"secret"</span>;
  <span class="hljs-attr">iosVersion</span> = <span class="hljs-string">"11.3"</span>;
  <span class="hljs-attr">iosBuildStore</span> = <span class="hljs-literal">false</span>;

  <span class="hljs-attr">enableWirelessDistribution</span> = <span class="hljs-literal">true</span>;
  <span class="hljs-attr">installURL</span> = <span class="hljs-string">"/installipa.php"</span>;
}
</code></pre><p>The <code class="literal">titaniumenv.buildApp {}</code> function takes the following parameters:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>The <code class="literal">name</code> parameter refers to the name in the Nix store.</p></li><li class="listitem"><p>The <code class="literal">src</code> parameter refers to the source code location of the app that needs
to be built.</p></li><li class="listitem"><p><code class="literal">preRebuild</code> contains optional build instructions that are carried out before
the build starts.</p></li><li class="listitem"><p><code class="literal">target</code> indicates for which device the app must be built. Currently only
‘android’ and ‘iphone’ (for iOS) are supported.</p></li><li class="listitem"><p><code class="literal">tiVersion</code> can be used to optionally override the requested Titanium version
in <code class="literal">tiapp.xml</code>. If not specified, it will use the version in <code class="literal">tiapp.xml</code>.</p></li><li class="listitem"><p><code class="literal">release</code> should be set to true when building an app for submission to the
Google Playstore or Apple Appstore. Otherwise, it should be false.</p></li></ul></div><p>When the <code class="literal">target</code> has been set to <code class="literal">android</code>, we can configure the following
parameters:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>The <code class="literal">androidSdkArgs</code> parameter refers to an attribute set that propagates all
parameters to the <code class="literal">androidenv.composeAndroidPackages {}</code> function. This can
be used to install all relevant Android plugins that may be needed to perform
the Android build. If no parameters are given, it will deploy the platform
SDKs for API-levels 25 and 26 by default.</p></li></ul></div><p>When the <code class="literal">release</code> parameter has been set to true, you need to provide
parameters to sign the app:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">androidKeyStore</code> is the path to the keystore file</p></li><li class="listitem"><p><code class="literal">androidKeyAlias</code> is the key alias</p></li><li class="listitem"><p><code class="literal">androidKeyStorePassword</code> refers to the password to open the keystore file.</p></li></ul></div><p>When the <code class="literal">target</code> has been set to <code class="literal">iphone</code>, we can configure the following
parameters:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>The <code class="literal">xcodeBaseDir</code> parameter refers to the location where Xcode has been
installed. When none value is given, the above value is the default.</p></li><li class="listitem"><p>The <code class="literal">xcodewrapperArgs</code> parameter passes arbitrary parameters to the
<code class="literal">xcodeenv.composeXcodeWrapper {}</code> function. This can, for example, be used
to adjust the default version of Xcode.</p></li></ul></div><p>When <code class="literal">release</code> has been set to true, you also need to provide the following
parameters:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">iosMobileProvisioningProfile</code> refers to a mobile provisioning profile needed
for signing.</p></li><li class="listitem"><p><code class="literal">iosCertificateName</code> refers to the company name in the P12 certificate.</p></li><li class="listitem"><p><code class="literal">iosCertificate</code> refers to the path to the P12 file.</p></li><li class="listitem"><p><code class="literal">iosCertificatePassword</code> contains the password to open the P12 file.</p></li><li class="listitem"><p><code class="literal">iosVersion</code> refers to the iOS SDK version to use. It defaults to the latest
version.</p></li><li class="listitem"><p><code class="literal">iosBuildStore</code> should be set to <code class="literal">true</code> when building for the Apple Appstore
submission. For enterprise or ad-hoc builds it should be set to <code class="literal">false</code>.</p></li></ul></div><p>When <code class="literal">enableWirelessDistribution</code> has been enabled, you must also provide the
path of the PHP script (<code class="literal">installURL</code>) (that is included with the iOS build
environment) to enable wireless ad-hoc installations.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="emulating-or-simulating-the-app" class="title">Emulating or simulating the app   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#emulating-or-simulating-the-app" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>It is also possible to simulate the correspond iOS simulator build by using
<code class="literal">xcodeenv.simulateApp {}</code> and emulate an Android APK by using
<code class="literal">androidenv.emulateApp {}</code>.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="vim" class="title" style="clear: both">Vim   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#vim" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#custom-configuration">Custom configuration</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#managing-plugins-with-vim-packages">Managing plugins with Vim packages</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#managing-plugins-with-vim-plug">Managing plugins with vim-plug</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#adding-new-plugins-to-nixpkgs">Adding new plugins to nixpkgs</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#updating-plugins-in-nixpkgs">Updating plugins in nixpkgs</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#vim-out-of-tree-overlays">How to maintain an out-of-tree overlay of vim plugins ?</a> </span></dt> </dl></div><p>Both Neovim and Vim can be configured to include your favorite plugins
and additional libraries.</p><p>Loading can be deferred; see examples.</p><p>At the moment we support two different methods for managing plugins:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>Vim packages (<span class="emphasis"><em>recommended</em></span>)</p></li><li class="listitem"><p>vim-plug (vim only)</p></li></ul></div><p>Right now two Vim packages are available: <code class="literal">vim</code> which has most features that require extra
dependencies disabled and <code class="literal">vim-full</code> which has them configurable and enabled by default.</p><div class="note"><h3 class="title">Note</h3><p><code class="literal">vim_configurable</code> is a deprecated alias for <code class="literal">vim-full</code> and refers to the fact that its
build-time features are configurable. It has nothing to do with user configuration,
and both the <code class="literal">vim</code> and <code class="literal">vim-full</code> packages can be customized as explained in the next section.</p></div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="custom-configuration" class="title">Custom configuration   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#custom-configuration" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Adding custom .vimrc lines can be done using the following code:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">vim-full.customize {
  <span class="hljs-comment"># `name` optionally specifies the name of the executable and package</span>
  <span class="hljs-attr">name</span> = <span class="hljs-string">"vim-with-plugins"</span>;

  vimrcConfig.<span class="hljs-attr">customRC</span> = <span class="hljs-string">''
    set hidden
  ''</span>;
}
</code></pre><p>This configuration is used when Vim is invoked with the command specified as name, in this case <code class="literal">vim-with-plugins</code>.
You can also omit <code class="literal">name</code> to customize Vim itself. See the
<a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/applications/editors/vim/plugins/vim-utils.nix#L408" target="_top">definition of <code class="literal">vimUtils.makeCustomizable</code></a>
for all supported options.</p><p>For Neovim the <code class="literal">configure</code> argument can be overridden to achieve the same:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">neovim.override {
  <span class="hljs-attr">configure</span> = {
    <span class="hljs-attr">customRC</span> = <span class="hljs-string">''
      # here your custom configuration goes!
    ''</span>;
  };
}
</code></pre><p>If you want to use <code class="literal">neovim-qt</code> as a graphical editor, you can configure it by overriding Neovim in an overlay
or passing it an overridden Neovim:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">neovim-qt.override {
  <span class="hljs-attr">neovim</span> = neovim.override {
    <span class="hljs-attr">configure</span> = {
      <span class="hljs-attr">customRC</span> = <span class="hljs-string">''
        # your custom configuration
      ''</span>;
    };
  };
}
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="managing-plugins-with-vim-packages" class="title">Managing plugins with Vim packages   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#managing-plugins-with-vim-packages" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>To store your plugins in Vim packages (the native Vim plugin manager, see <code class="literal">:help packages</code>) the following example can be used:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">vim-full.customize {
  vimrcConfig.packages.<span class="hljs-attr">myVimPackage</span> = <span class="hljs-keyword">with</span> pkgs.vimPlugins; {
    <span class="hljs-comment"># loaded on launch</span>
    <span class="hljs-attr">start</span> = [ youcompleteme fugitive ];
    <span class="hljs-comment"># manually loadable by calling `:packadd $plugin-name`</span>
    <span class="hljs-comment"># however, if a Vim plugin has a dependency that is not explicitly listed in</span>
    <span class="hljs-comment"># opt that dependency will always be added to start to avoid confusion.</span>
    <span class="hljs-attr">opt</span> = [ phpCompletion elm-vim ];
    <span class="hljs-comment"># To automatically load a plugin when opening a filetype, add vimrc lines like:</span>
    <span class="hljs-comment"># autocmd FileType php :packadd phpCompletion</span>
  };
}
</code></pre><p><code class="literal">myVimPackage</code> is an arbitrary name for the generated package. You can choose any name you like.
For Neovim the syntax is:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">neovim.override {
  <span class="hljs-attr">configure</span> = {
    <span class="hljs-attr">customRC</span> = <span class="hljs-string">''
      # here your custom configuration goes!
    ''</span>;
    packages.<span class="hljs-attr">myVimPackage</span> = <span class="hljs-keyword">with</span> pkgs.vimPlugins; {
      <span class="hljs-comment"># see examples below how to use custom packages</span>
      <span class="hljs-attr">start</span> = [ ];
      <span class="hljs-comment"># If a Vim plugin has a dependency that is not explicitly listed in</span>
      <span class="hljs-comment"># opt that dependency will always be added to start to avoid confusion.</span>
      <span class="hljs-attr">opt</span> = [ ];
    };
  };
}
</code></pre><p>The resulting package can be added to <code class="literal">packageOverrides</code> in <code class="literal">~/.nixpkgs/config.nix</code> to make it installable:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{
  <span class="hljs-attr">packageOverrides</span> = pkgs: <span class="hljs-keyword">with</span> pkgs; {
    <span class="hljs-attr">myVim</span> = vim-full.customize {
      <span class="hljs-comment"># `name` specifies the name of the executable and package</span>
      <span class="hljs-attr">name</span> = <span class="hljs-string">"vim-with-plugins"</span>;
      <span class="hljs-comment"># add here code from the example section</span>
    };
    <span class="hljs-attr">myNeovim</span> = neovim.override {
      <span class="hljs-attr">configure</span> = {
      <span class="hljs-comment"># add code from the example section here</span>
      };
    };
  };
}
</code></pre><p>After that you can install your special grafted <code class="literal">myVim</code> or <code class="literal">myNeovim</code> packages.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="what-if-your-favourite-vim-plugin-isnt-already-packaged" class="title">What if your favourite Vim plugin isn’t already packaged?   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#what-if-your-favourite-vim-plugin-isnt-already-packaged" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>If one of your favourite plugins isn’t packaged, you can package it yourself:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ config, pkgs, ... }:

<span class="hljs-keyword">let</span>
  <span class="hljs-attr">easygrep</span> = pkgs.vimUtils.buildVimPlugin {
    <span class="hljs-attr">name</span> = <span class="hljs-string">"vim-easygrep"</span>;
    <span class="hljs-attr">src</span> = pkgs.fetchFromGitHub {
      <span class="hljs-attr">owner</span> = <span class="hljs-string">"dkprice"</span>;
      <span class="hljs-attr">repo</span> = <span class="hljs-string">"vim-easygrep"</span>;
      <span class="hljs-attr">rev</span> = <span class="hljs-string">"d0c36a77cc63c22648e792796b1815b44164653a"</span>;
      <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-bL33/S+caNmEYGcMLNCanFZyEYUOUmSsedCVBn4tV3g="</span>;
    };
  };
<span class="hljs-keyword">in</span>
{
  environment.<span class="hljs-attr">systemPackages</span> = [
    (
      pkgs.neovim.override {
        <span class="hljs-attr">configure</span> = {
          packages.<span class="hljs-attr">myPlugins</span> = <span class="hljs-keyword">with</span> pkgs.vimPlugins; {
          <span class="hljs-attr">start</span> = [
            vim-go <span class="hljs-comment"># already packaged plugin</span>
            easygrep <span class="hljs-comment"># custom package</span>
          ];
          <span class="hljs-attr">opt</span> = [];
        };
        <span class="hljs-comment"># ...</span>
      };
     }
    )
  ];
}
</code></pre><p>If your package requires building specific parts, use instead <code class="literal">pkgs.vimUtils.buildVimPlugin</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="vim-plugin-specificities" class="title">Specificities for some plugins   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#vim-plugin-specificities" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="vim-plugin-treesitter" class="title">Treesitter   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#vim-plugin-treesitter" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h5>  </div> </div></div><p>By default <code class="literal">nvim-treesitter</code> encourages you to download, compile and install
the required Treesitter grammars at run time with <code class="literal">:TSInstall</code>. This works
poorly on NixOS.  Instead, to install the <code class="literal">nvim-treesitter</code> plugins with a set
of precompiled grammars, you can use <code class="literal">nvim-treesitter.withPlugins</code> function:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">(pkgs.neovim.override {
  <span class="hljs-attr">configure</span> = {
    packages.<span class="hljs-attr">myPlugins</span> = <span class="hljs-keyword">with</span> pkgs.vimPlugins; {
      <span class="hljs-attr">start</span> = [
        (nvim-treesitter.withPlugins (
          plugins: <span class="hljs-keyword">with</span> plugins; [
            nix
            python
          ]
        ))
      ];
    };
  };
})
</code></pre><p>To enable all grammars packaged in nixpkgs, use <code class="literal">pkgs.vimPlugins.nvim-treesitter.withAllGrammars</code>.</p>
</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="managing-plugins-with-vim-plug" class="title">Managing plugins with vim-plug   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#managing-plugins-with-vim-plug" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>To use <a class="link" href="https://github.com/junegunn/vim-plug" target="_top">vim-plug</a> to manage your Vim
plugins the following example can be used:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">vim-full.customize {
  vimrcConfig.packages.<span class="hljs-attr">myVimPackage</span> = <span class="hljs-keyword">with</span> pkgs.vimPlugins; {
    <span class="hljs-comment"># loaded on launch</span>
    plug.<span class="hljs-attr">plugins</span> = [ youcompleteme fugitive phpCompletion elm-vim ];
  };
}
</code></pre><p>Note: this is not possible anymore for Neovim.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="adding-new-plugins-to-nixpkgs" class="title">Adding new plugins to nixpkgs   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#adding-new-plugins-to-nixpkgs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Nix expressions for Vim plugins are stored in <a class="link" href="https://github.com/NixOS/nixpkgs/tree/master/pkgs/applications/editors/vim/plugins" target="_top">pkgs/applications/editors/vim/plugins</a>. For the vast majority of plugins, Nix expressions are automatically generated by running <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/applications/editors/vim/plugins/updater.nix" target="_top"><code class="literal">nix-shell -p vimPluginsUpdater --run vim-plugins-updater</code></a>. This creates a <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/applications/editors/vim/plugins/generated.nix" target="_top">generated.nix</a> file based on the plugins listed in <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/applications/editors/vim/plugins/vim-plugin-names" target="_top">vim-plugin-names</a>.</p><p>After running the updater, if nvim-treesitter received an update, also run <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/applications/editors/vim/plugins/update.py" target="_top"><code class="literal">nvim-treesitter/update.py</code></a> to update the tree sitter grammars for <code class="literal">nvim-treesitter</code>.</p><p>Some plugins require overrides in order to function properly. Overrides are placed in <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/applications/editors/vim/plugins/overrides.nix" target="_top">overrides.nix</a>. Overrides are most often required when a plugin requires some dependencies, or extra steps are required during the build process. For example <code class="literal">deoplete-fish</code> requires both <code class="literal">deoplete-nvim</code> and <code class="literal">vim-fish</code>, and so the following override was added:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">deoplete-fish</span> = super.deoplete-fish.overrideAttrs(old: {
  <span class="hljs-attr">dependencies</span> = <span class="hljs-keyword">with</span> super; [ deoplete-nvim vim-fish ];
});
</code></pre><p>Sometimes plugins require an override that must be changed when the plugin is updated. This can cause issues when Vim plugins are auto-updated but the associated override isn’t updated. For these plugins, the override should be written so that it specifies all information required to install the plugin, and running <code class="literal">./update.py</code> doesn’t change the derivation for the plugin. Manually updating the override is required to update these types of plugins. An example of such a plugin is <code class="literal">LanguageClient-neovim</code>.</p><p>To add a new plugin, run <code class="literal">./update.py add "[owner]/[name]"</code>. <span class="strong"><strong>NOTE</strong></span>: This script automatically commits to your git repository. Be sure to check out a fresh branch before running.</p><p>Finally, there are some plugins that are also packaged in nodePackages because they have Javascript-related build steps, such as running webpack. Those plugins are not listed in <code class="literal">vim-plugin-names</code> or managed by <code class="literal">update.py</code> at all, and are included separately in <code class="literal">overrides.nix</code>. Currently, all these plugins are related to the <code class="literal">coc.nvim</code> ecosystem of the Language Server Protocol integration with Vim/Neovim.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="updating-plugins-in-nixpkgs" class="title">Updating plugins in nixpkgs   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#updating-plugins-in-nixpkgs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Run the update script with a GitHub API token that has at least <code class="literal">public_repo</code> access. Running the script without the token is likely to result in rate-limiting (429 errors). For steps on creating an API token, please refer to <a class="link" href="https://docs.github.com/en/free-pro-team@latest/github/authenticating-to-github/creating-a-personal-access-token" target="_top">GitHub’s token documentation</a>.</p><pre><code class="programlisting sh hljs language-bash" data-highlighted="yes">GITHUB_API_TOKEN=my_token ./pkgs/applications/editors/vim/plugins/update.py
</code></pre><p>Alternatively, set the number of processes to a lower count to avoid rate-limiting.</p><pre><code class="programlisting sh hljs language-bash" data-highlighted="yes">
nix-shell -p vimPluginsUpdater --run <span class="hljs-string">'vim-plugins-updater --proc 1'</span>
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="vim-out-of-tree-overlays" class="title">How to maintain an out-of-tree overlay of vim plugins ?   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#vim-out-of-tree-overlays" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>You can use the updater script to generate basic packages out of a custom vim
plugin list:</p><pre><code class="programlisting hljs language-undefined" data-highlighted="yes">nix-shell -p vimPluginsUpdater --run vim-plugins-updater -i vim-plugin-names -o generated.nix --no-commit
</code></pre><p>with the contents of <code class="literal">vim-plugin-names</code> being for example:</p><pre><code class="programlisting hljs language-bash" data-highlighted="yes">repo,branch,<span class="hljs-built_in">alias</span>
pwntester/octo.nvim,,
</code></pre><p>You can then reference the generated vim plugins via:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">myVimPlugins</span> = pkgs.vimPlugins.extend (
  (pkgs.callPackage ./generated.nix {})
);
</code></pre>
</div>

</div>
</div><div class="chapter"> <div class="titlepage">  <div>   <div>    <h2 id="chap-packages" class="title">Packages   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#chap-packages" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <p><strong>Table of Contents</strong></p> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-citrix">Citrix Workspace</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-darwin-builder">darwin.linux-builder</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#dlib">DLib</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-eclipse">Eclipse</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-elm">Elm</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-emacs">Emacs</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-firefox">Firefox</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-fish">Fish</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-fuse">FUSE</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-ibus-typing-booster">ibus-engines.typing-booster</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-kakoune">Kakoune</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-linux-kernel">Linux kernel</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#locales">Locales</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#etc">/etc files</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-nginx">Nginx</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-opengl">OpenGL</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-shell-helpers">Interactive shell helpers</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-steam">Steam</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#cataclysm-dark-days-ahead">Cataclysm: Dark Days Ahead</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-urxvt">Urxvt</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-weechat">WeeChat</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-xorg">X.org</a> </span></dt> </dl></div><p>This chapter contains information about how to use and maintain the Nix expressions for a number of specific packages, such as the Linux kernel or X.org.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-citrix" class="title" style="clear: both">Citrix Workspace   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-citrix" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-citrix-base">Basic usage</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-citrix-selfservice">Citrix Self-service</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-citrix-custom-certs">Custom certificates</a> </span></dt> </dl></div><p>The <a class="link" href="https://www.citrix.com/products/workspace-app/" target="_top">Citrix Workspace App</a> is a remote desktop viewer which provides access to <a class="link" href="https://www.citrix.com/products/xenapp-xendesktop/" target="_top">XenDesktop</a> installations.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-citrix-base" class="title">Basic usage   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-citrix-base" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The tarball archive needs to be downloaded manually, as the license agreements of the vendor for <a class="link" href="https://www.citrix.com/downloads/workspace-app/linux/workspace-app-for-linux-latest.html" target="_top">Citrix Workspace</a> needs to be accepted first. Then run <code class="literal">nix-prefetch-url file://$PWD/linuxx64-$version.tar.gz</code>. With the archive available in the store, the package can be built and installed with Nix.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-citrix-selfservice" class="title">Citrix Self-service   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-citrix-selfservice" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The <a class="link" href="https://support.citrix.com/article/CTX200337" target="_top">self-service</a> is an application managing Citrix desktops and applications. Please note that this feature only works with at least citrix_workspace_20_06_0 and later versions.</p><p>In order to set this up, you first have to <a class="link" href="https://its.uiowa.edu/support/article/102186" target="_top">download the <code class="literal">.cr</code> file from the Netscaler Gateway</a>. After that, you can configure the <code class="literal">selfservice</code> like this:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">storebrowse -C ~/Downloads/receiverconfig.cr</span>
<span class="hljs-meta prompt_">$ </span><span class="language-bash">selfservice</span>
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-citrix-custom-certs" class="title">Custom certificates   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-citrix-custom-certs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The <code class="literal">Citrix Workspace App</code> in <code class="literal">nixpkgs</code> trusts several certificates <a class="link" href="https://curl.haxx.se/docs/caextract.html" target="_top">from the Mozilla database</a> by default. However, several companies using Citrix might require their own corporate certificate. On distros with imperative packaging, these certs can be stored easily in <a class="link" href="https://citrix.github.io/receiver-for-linux-command-reference/" target="_top"><code class="literal">$ICAROOT</code></a>, however this directory is a store path in <code class="literal">nixpkgs</code>. In order to work around this issue, the package provides a simple mechanism to add custom certificates without rebuilding the entire package using <code class="literal">symlinkJoin</code>:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">with</span> <span class="hljs-built_in">import</span> &lt;nixpkgs&gt; { config.<span class="hljs-attr">allowUnfree</span> = <span class="hljs-literal">true</span>; };
<span class="hljs-keyword">let</span>
  <span class="hljs-attr">extraCerts</span> = [
    ./custom-cert-<span class="hljs-number">1</span>.pem
    ./custom-cert-<span class="hljs-number">2</span>.pem <span class="hljs-comment"># ...</span>
  ];
<span class="hljs-keyword">in</span> citrix_workspace.override { <span class="hljs-keyword">inherit</span> extraCerts; }
</code></pre>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-darwin-builder" class="title" style="clear: both">darwin.linux-builder   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-darwin-builder" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-darwin-builder-example-flake">Example flake usage</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-darwin-builder-reconfiguring">Reconfiguring the remote builder</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-darwin-builder-troubleshoot">Troubleshooting the generated configuration</a> </span></dt> </dl></div><p><code class="literal">darwin.linux-builder</code> provides a way to bootstrap a Linux remote builder on a macOS machine.</p><p>This requires macOS version 12.4 or later.</p><p>The remote builder runs on host port 31022 by default.
You can change it by overriding <code class="literal">virtualisation.darwin-builder.hostPort</code>.
See the <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#sec-darwin-builder-example-flake" title="Example flake usage">example</a>.</p><p>You will also need to be a trusted user for your Nix installation.  In other
words, your <code class="literal">/etc/nix/nix.conf</code> should have something like:</p><pre><code class="programlisting hljs language-nix" data-highlighted="yes"><span class="hljs-attr">extra-trusted-users</span> = &lt;your username goes here&gt;
</code></pre><p>To launch the remote builder, run the following flake:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">nix run nixpkgs#darwin.linux-builder</span>
</code></pre><p>That will prompt you to enter your <code class="literal">sudo</code> password:</p><pre><code class="programlisting hljs language-bash" data-highlighted="yes">+ sudo --reset-timestamp /nix/store/…-install-credentials.sh ./keys
Password:
</code></pre><p>… so that it can install a private key used to <code class="literal">ssh</code> into the build server.
After that the script will launch the virtual machine and automatically log you
in as the <code class="literal">builder</code> user:</p><pre><code class="programlisting hljs language-bash" data-highlighted="yes">&lt;&lt;&lt; <span class="hljs-string">Welcome to NixOS 22.11.20220901.1bd8d11 (aarch64) - ttyAMA0 &gt;&gt;&gt;

Run 'nixos-help' for the NixOS manual.

nixos login: builder (automatic login)


[builder@nixos:~]$
</span></code></pre><div class="blockquote"><blockquote class="blockquote"><p>Note: When you need to stop the VM, run <code class="literal">shutdown now</code> as the <code class="literal">builder</code> user.</p></blockquote></div><p>To delegate builds to the remote builder, add the following options to your
<code class="literal">nix.conf</code> file:</p><pre><code class="programlisting hljs language-nix" data-highlighted="yes"><span class="hljs-comment"># - Replace ${ARCH} with either aarch64 or x86_64 to match your host machine</span>
<span class="hljs-comment"># - Replace ${MAX_JOBS} with the maximum number of builds (pick 4 if you're not sure)</span>
<span class="hljs-attr">builders</span> = ssh-ng://builder@linux-builder ${ARCH}-linux /etc/nix/builder_ed25519 ${MAX_JOBS} - - - <span class="hljs-attr">c3NoLWVkMjU1MTkgQUFBQUMzTnphQzFsWkRJMU5URTVBQUFBSUpCV2N4Yi9CbGFxdDFhdU90RStGOFFVV3JVb3RpQzVxQkorVXVFV2RWQ2Igcm9vdEBuaXhvcwo=</span>

<span class="hljs-comment"># Not strictly necessary, but this will reduce your disk utilization</span>
<span class="hljs-attr">builders-use-substitutes</span> = <span class="hljs-literal">true</span>
</code></pre><p>To allow Nix to connect to a remote builder not running on port 22, you will also need to create a new file at <code class="literal">/etc/ssh/ssh_config.d/100-linux-builder.conf</code>:</p><pre><code class="programlisting hljs language-undefined" data-highlighted="yes">Host linux-builder
  Hostname localhost
  HostKeyAlias linux-builder
  Port 31022
</code></pre><p>… and then restart your Nix daemon to apply the change:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo launchctl kickstart -k system/org.nixos.nix-daemon</span>
</code></pre><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-darwin-builder-example-flake" class="title">Example flake usage   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-darwin-builder-example-flake" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><pre><code class="programlisting hljs language-nix" data-highlighted="yes">{
  <span class="hljs-attr">inputs</span> = {
    nixpkgs.<span class="hljs-attr">url</span> = <span class="hljs-string">"github:nixos/nixpkgs/nixpkgs-22.11-darwin"</span>;
    darwin.<span class="hljs-attr">url</span> = <span class="hljs-string">"github:lnl7/nix-darwin/master"</span>;
    darwin.inputs.nixpkgs.<span class="hljs-attr">follows</span> = <span class="hljs-string">"nixpkgs"</span>;
  };

  <span class="hljs-attr">outputs</span> = { self, darwin, nixpkgs, ... }@inputs:
  <span class="hljs-keyword">let</span>

    <span class="hljs-keyword">inherit</span> (darwin.lib) darwinSystem;
    <span class="hljs-attr">system</span> = <span class="hljs-string">"aarch64-darwin"</span>;
    <span class="hljs-attr">pkgs</span> = nixpkgs.legacyPackages.<span class="hljs-string">"<span class="hljs-subst">${system}</span>"</span>;
    <span class="hljs-attr">linuxSystem</span> = <span class="hljs-built_in">builtins</span>.replaceStrings [ <span class="hljs-string">"darwin"</span> ] [ <span class="hljs-string">"linux"</span> ] system;

    <span class="hljs-attr">darwin-builder</span> = nixpkgs.lib.nixosSystem {
      <span class="hljs-attr">system</span> = linuxSystem;
      <span class="hljs-attr">modules</span> = [
        <span class="hljs-string">"<span class="hljs-subst">${nixpkgs}</span>/nixos/modules/profiles/macos-builder.nix"</span>
        { <span class="hljs-attr">virtualisation</span> = {
            host.<span class="hljs-attr">pkgs</span> = pkgs;
            darwin-builder.<span class="hljs-attr">workingDirectory</span> = <span class="hljs-string">"/var/lib/darwin-builder"</span>;
          };
        };
      ];
    };
  <span class="hljs-keyword">in</span> {

    <span class="hljs-attr">darwinConfigurations</span> = {
      <span class="hljs-attr">machine1</span> = darwinSystem {
        <span class="hljs-keyword">inherit</span> system;
        <span class="hljs-attr">modules</span> = [
          {
            nix.<span class="hljs-attr">distributedBuilds</span> = <span class="hljs-literal">true</span>;
            nix.<span class="hljs-attr">buildMachines</span> = [{
              <span class="hljs-attr">hostName</span> = <span class="hljs-string">"ssh://builder@localhost"</span>;
              <span class="hljs-attr">system</span> = linuxSystem;
              <span class="hljs-attr">maxJobs</span> = <span class="hljs-number">4</span>;
              <span class="hljs-attr">supportedFeatures</span> = [ <span class="hljs-string">"kvm"</span> <span class="hljs-string">"benchmark"</span> <span class="hljs-string">"big-parallel"</span> ];
            }];

            launchd.daemons.<span class="hljs-attr">darwin-builder</span> = {
              <span class="hljs-attr">command</span> = <span class="hljs-string">"<span class="hljs-subst">${darwin-builder.config.system.build.macos-builder-installer}</span>/bin/create-builder"</span>;
              <span class="hljs-attr">serviceConfig</span> = {
                <span class="hljs-attr">KeepAlive</span> = <span class="hljs-literal">true</span>;
                <span class="hljs-attr">RunAtLoad</span> = <span class="hljs-literal">true</span>;
                <span class="hljs-attr">StandardOutPath</span> = <span class="hljs-string">"/var/log/darwin-builder.log"</span>;
                <span class="hljs-attr">StandardErrorPath</span> = <span class="hljs-string">"/var/log/darwin-builder.log"</span>;
              };
            };
          }
        ];
      };
    };

  };
}
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-darwin-builder-reconfiguring" class="title">Reconfiguring the remote builder   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-darwin-builder-reconfiguring" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Initially you should not change the remote builder configuration else you will not be
able to use the binary cache. However, after you have the remote builder running locally
you may use it to build a modified remote builder with additional storage or memory.</p><p>To do this, you just need to set the <code class="literal">virtualisation.darwin-builder.*</code> parameters as
in the example below and rebuild.</p><pre><code class="programlisting hljs language-nix" data-highlighted="yes">    <span class="hljs-attr">darwin-builder</span> = nixpkgs.lib.nixosSystem {
      <span class="hljs-attr">system</span> = linuxSystem;
      <span class="hljs-attr">modules</span> = [
        <span class="hljs-string">"<span class="hljs-subst">${nixpkgs}</span>/nixos/modules/profiles/macos-builder.nix"</span>
        {
          virtualisation.host.<span class="hljs-attr">pkgs</span> = pkgs;
          virtualisation.darwin-builder.<span class="hljs-attr">diskSize</span> = <span class="hljs-number">5120</span>;
          virtualisation.darwin-builder.<span class="hljs-attr">memorySize</span> = <span class="hljs-number">1024</span>;
          virtualisation.darwin-builder.<span class="hljs-attr">hostPort</span> = <span class="hljs-number">33022</span>;
          virtualisation.darwin-builder.<span class="hljs-attr">workingDirectory</span> = <span class="hljs-string">"/var/lib/darwin-builder"</span>;
        }
      ];
</code></pre><p>You may make any other changes to your VM in this attribute set. For example,
you could enable Docker or X11 forwarding to your Darwin host.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-darwin-builder-troubleshoot" class="title">Troubleshooting the generated configuration   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-darwin-builder-troubleshoot" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The <code class="literal">linux-builder</code> package exposes the attributes <code class="literal">nixosConfig</code> and <code class="literal">nixosOptions</code> that allow you to inspect the generated NixOS configuration in the <code class="literal">nix repl</code>. For example:</p><pre><code class="programlisting hljs language-shell" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">nix repl --file ~/src/nixpkgs --argstr system aarch64-darwin</span>
<span class="hljs-meta prompt_">
nix-repl&gt; </span><span class="language-bash">darwin.linux-builder.nixosConfig.nix.package</span>
«derivation /nix/store/...-nix-2.17.0.drv»
<span class="hljs-meta prompt_">
nix-repl&gt; </span><span class="language-bash">:p darwin.linux-builder.nixosOptions.virtualisation.memorySize.definitionsWithLocations</span>
[ { file = "/home/user/src/nixpkgs/nixos/modules/profiles/macos-builder.nix"; value = 3072; } ]

</code></pre>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="dlib" class="title" style="clear: both">DLib   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#dlib" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#compiling-without-avx-support">Compiling without AVX support</a> </span></dt> </dl></div><p><a class="link" href="http://dlib.net/" target="_top">DLib</a> is a modern, C++-based toolkit which provides several machine learning algorithms.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="compiling-without-avx-support" class="title">Compiling without AVX support   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#compiling-without-avx-support" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Especially older CPUs don’t support <a class="link" href="https://en.wikipedia.org/wiki/Advanced_Vector_Extensions" target="_top">AVX</a> (Advanced Vector Extensions) instructions that are used by DLib to optimize their algorithms.</p><p>On the affected hardware errors like <code class="literal">Illegal instruction</code> will occur. In those cases AVX support needs to be disabled:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">self: super: { <span class="hljs-attr">dlib</span> = super.dlib.override { <span class="hljs-attr">avxSupport</span> = <span class="hljs-literal">false</span>; }; }
</code></pre>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-eclipse" class="title" style="clear: both">Eclipse   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-eclipse" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>The Nix expressions related to the Eclipse platform and IDE are in <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/applications/editors/eclipse" target="_top"><code class="literal">pkgs/applications/editors/eclipse</code></a>.</p><p>Nixpkgs provides a number of packages that will install Eclipse in its various forms. These range from the bare-bones Eclipse Platform to the more fully featured Eclipse SDK or Scala-IDE packages and multiple version are often available. It is possible to list available Eclipse packages by issuing the command:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">nix-env -f <span class="hljs-string">'&lt;nixpkgs&gt;'</span> -qaP -A eclipses --description</span>
</code></pre><p>Once an Eclipse variant is installed, it can be run using the <code class="literal">eclipse</code> command, as expected. From within Eclipse, it is then possible to install plugins in the usual manner by either manually specifying an Eclipse update site or by installing the Marketplace Client plugin and using it to discover and install other plugins. This installation method provides an Eclipse installation that closely resemble a manually installed Eclipse.</p><p>If you prefer to install plugins in a more declarative manner, then Nixpkgs also offer a number of Eclipse plugins that can be installed in an <span class="emphasis"><em>Eclipse environment</em></span>. This type of environment is created using the function <code class="literal">eclipseWithPlugins</code> found inside the <code class="literal">nixpkgs.eclipses</code> attribute set. This function takes as argument <code class="literal">{ eclipse, plugins ? [], jvmArgs ? [] }</code> where <code class="literal">eclipse</code> is a one of the Eclipse packages described above, <code class="literal">plugins</code> is a list of plugin derivations, and <code class="literal">jvmArgs</code> is a list of arguments given to the JVM running the Eclipse. For example, say you wish to install the latest Eclipse Platform with the popular Eclipse Color Theme plugin and also allow Eclipse to use more RAM. You could then add:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">packageOverrides</span> = pkgs: {
  <span class="hljs-attr">myEclipse</span> = <span class="hljs-keyword">with</span> pkgs.eclipses; eclipseWithPlugins {
    <span class="hljs-attr">eclipse</span> = eclipse-platform;
    <span class="hljs-attr">jvmArgs</span> = [ <span class="hljs-string">"-Xmx2048m"</span> ];
    <span class="hljs-attr">plugins</span> = [ plugins.color-theme ];
  };
}
</code></pre><p>to your Nixpkgs configuration (<code class="literal">~/.config/nixpkgs/config.nix</code>) and install it by running <code class="literal">nix-env -f '&lt;nixpkgs&gt;' -iA myEclipse</code> and afterward run Eclipse as usual. It is possible to find out which plugins are available for installation using <code class="literal">eclipseWithPlugins</code> by running:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">nix-env -f <span class="hljs-string">'&lt;nixpkgs&gt;'</span> -qaP -A eclipses.plugins --description</span>
</code></pre><p>If there is a need to install plugins that are not available in Nixpkgs then it may be possible to define these plugins outside Nixpkgs using the <code class="literal">buildEclipseUpdateSite</code> and <code class="literal">buildEclipsePlugin</code> functions found in the <code class="literal">nixpkgs.eclipses.plugins</code> attribute set. Use the <code class="literal">buildEclipseUpdateSite</code> function to install a plugin distributed as an Eclipse update site. This function takes <code class="literal">{ name, src }</code> as argument, where <code class="literal">src</code> indicates the Eclipse update site archive. All Eclipse features and plugins within the downloaded update site will be installed. When an update site archive is not available, then the <code class="literal">buildEclipsePlugin</code> function can be used to install a plugin that consists of a pair of feature and plugin JARs. This function takes an argument <code class="literal">{ name, srcFeature, srcPlugin }</code> where <code class="literal">srcFeature</code> and <code class="literal">srcPlugin</code> are the feature and plugin JARs, respectively.</p><p>Expanding the previous example with two plugins using the above functions, we have:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">packageOverrides</span> = pkgs: {
  <span class="hljs-attr">myEclipse</span> = <span class="hljs-keyword">with</span> pkgs.eclipses; eclipseWithPlugins {
    <span class="hljs-attr">eclipse</span> = eclipse-platform;
    <span class="hljs-attr">jvmArgs</span> = [ <span class="hljs-string">"-Xmx2048m"</span> ];
    <span class="hljs-attr">plugins</span> = [
      plugins.color-theme
      (plugins.buildEclipsePlugin {
        <span class="hljs-attr">name</span> = <span class="hljs-string">"myplugin1-1.0"</span>;
        <span class="hljs-attr">srcFeature</span> = fetchurl {
          <span class="hljs-attr">url</span> = <span class="hljs-string">"http://…/features/myplugin1.jar"</span>;
          <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-123…"</span>;
        };
        <span class="hljs-attr">srcPlugin</span> = fetchurl {
          <span class="hljs-attr">url</span> = <span class="hljs-string">"http://…/plugins/myplugin1.jar"</span>;
          <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-123…"</span>;
        };
      });
      (plugins.buildEclipseUpdateSite {
        <span class="hljs-attr">name</span> = <span class="hljs-string">"myplugin2-1.0"</span>;
        <span class="hljs-attr">src</span> = fetchurl {
          <span class="hljs-attr">stripRoot</span> = <span class="hljs-literal">false</span>;
          <span class="hljs-attr">url</span> = <span class="hljs-string">"http://…/myplugin2.zip"</span>;
          <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-123…"</span>;
        };
      });
    ];
  };
}
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-elm" class="title" style="clear: both">Elm   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-elm" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>To start a development environment, run:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes">nix-shell -p elmPackages.elm elmPackages.elm-format
</code></pre><p>To update the Elm compiler, see <code class="literal">nixpkgs/pkgs/development/compilers/elm/README.md</code>.</p><p>To package Elm applications, <a class="link" href="https://github.com/hercules-ci/elm2nix#elm2nix" target="_top">read about elm2nix</a>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-emacs" class="title" style="clear: both">Emacs   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-emacs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-emacs-config">Configuring Emacs</a> </span></dt> </dl></div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-emacs-config" class="title">Configuring Emacs   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-emacs-config" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The Emacs package comes with some extra helpers to make it easier to configure. <code class="literal">emacs.pkgs.withPackages</code> allows you to manage packages from ELPA. This means that you will not have to install that packages from within Emacs. For instance, if you wanted to use <code class="literal">company</code> <code class="literal">counsel</code>, <code class="literal">flycheck</code>, <code class="literal">ivy</code>, <code class="literal">magit</code>, <code class="literal">projectile</code>, and <code class="literal">use-package</code> you could use this as a <code class="literal">~/.config/nixpkgs/config.nix</code> override:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{
  <span class="hljs-attr">packageOverrides</span> = pkgs: <span class="hljs-keyword">with</span> pkgs; {
    <span class="hljs-attr">myEmacs</span> = emacs.pkgs.withPackages (epkgs: (<span class="hljs-keyword">with</span> epkgs.melpaStablePackages; [
      company
      counsel
      flycheck
      ivy
      magit
      projectile
      use-package
    ]));
  }
}
</code></pre><p>You can install it like any other packages via <code class="literal">nix-env -iA myEmacs</code>. However, this will only install those packages. It will not <code class="literal">configure</code> them for us. To do this, we need to provide a configuration file. Luckily, it is possible to do this from within Nix! By modifying the above example, we can make Emacs load a custom config file. The key is to create a package that provides a <code class="literal">default.el</code> file in <code class="literal">/share/emacs/site-start/</code>. Emacs knows to load this file automatically when it starts.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{
  <span class="hljs-attr">packageOverrides</span> = pkgs: <span class="hljs-keyword">with</span> pkgs; <span class="hljs-keyword">rec</span> {
    <span class="hljs-attr">myEmacsConfig</span> = writeText <span class="hljs-string">"default.el"</span> <span class="hljs-string">''
      (eval-when-compile
        (require 'use-package))

      ;; load some packages

      (use-package company
        :bind ("&lt;C-tab&gt;" . company-complete)
        :diminish company-mode
        :commands (company-mode global-company-mode)
        :defer 1
        :config
        (global-company-mode))

      (use-package counsel
        :commands (counsel-descbinds)
        :bind (([remap execute-extended-command] . counsel-M-x)
               ("C-x C-f" . counsel-find-file)
               ("C-c g" . counsel-git)
               ("C-c j" . counsel-git-grep)
               ("C-c k" . counsel-ag)
               ("C-x l" . counsel-locate)
               ("M-y" . counsel-yank-pop)))

      (use-package flycheck
        :defer 2
        :config (global-flycheck-mode))

      (use-package ivy
        :defer 1
        :bind (("C-c C-r" . ivy-resume)
               ("C-x C-b" . ivy-switch-buffer)
               :map ivy-minibuffer-map
               ("C-j" . ivy-call))
        :diminish ivy-mode
        :commands ivy-mode
        :config
        (ivy-mode 1))

      (use-package magit
        :defer
        :if (executable-find "git")
        :bind (("C-x g" . magit-status)
               ("C-x G" . magit-dispatch-popup))
        :init
        (setq magit-completing-read-function 'ivy-completing-read))

      (use-package projectile
        :commands projectile-mode
        :bind-keymap ("C-c p" . projectile-command-map)
        :defer 5
        :config
        (projectile-global-mode))
    ''</span>;

    <span class="hljs-attr">myEmacs</span> = emacs.pkgs.withPackages (epkgs: (<span class="hljs-keyword">with</span> epkgs.melpaStablePackages; [
      (runCommand <span class="hljs-string">"default.el"</span> {} <span class="hljs-string">''
         mkdir -p $out/share/emacs/site-lisp
         cp <span class="hljs-subst">${myEmacsConfig}</span> $out/share/emacs/site-lisp/default.el
       ''</span>)
      company
      counsel
      flycheck
      ivy
      magit
      projectile
      use-package
    ]));
  };
}
</code></pre><p>This provides a fairly full Emacs start file. It will load in addition to the user’s personal config. You can always disable it by passing <code class="literal">-q</code> to the Emacs command.</p><p>Sometimes <code class="literal">emacs.pkgs.withPackages</code> is not enough, as this package set has some priorities imposed on packages (with the lowest priority assigned to GNU-devel ELPA, and the highest for packages manually defined in <code class="literal">pkgs/applications/editors/emacs/elisp-packages/manual-packages</code>). But you can’t control these priorities when some package is installed as a dependency. You can override it on a per-package-basis, providing all the required dependencies manually, but it’s tedious and there is always a possibility that an unwanted dependency will sneak in through some other package. To completely override such a package, you can use <code class="literal">overrideScope</code>.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">overrides</span> = self: super: <span class="hljs-keyword">rec</span> {
  <span class="hljs-attr">haskell-mode</span> = self.melpaPackages.haskell-mode;
  ...
};
((emacsPackagesFor emacs).overrideScope overrides).withPackages
  (p: <span class="hljs-keyword">with</span> p; [
    <span class="hljs-comment"># here both these package will use haskell-mode of our own choice</span>
    ghc-mod
    dante
  ])
</code></pre>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-firefox" class="title" style="clear: both">Firefox   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-firefox" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#build-wrapped-firefox-with-extensions-and-policies">Build wrapped Firefox with extensions and policies</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-firefox-troubleshooting">Troubleshooting</a> </span></dt> </dl></div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="build-wrapped-firefox-with-extensions-and-policies" class="title">Build wrapped Firefox with extensions and policies   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#build-wrapped-firefox-with-extensions-and-policies" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The <code class="literal">wrapFirefox</code> function allows to pass policies, preferences and extensions that are available to Firefox. With the help of <code class="literal">fetchFirefoxAddon</code> this allows to build a Firefox version that already comes with add-ons pre-installed:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{
  <span class="hljs-comment"># Nix firefox addons only work with the firefox-esr package.</span>
  <span class="hljs-attr">myFirefox</span> = wrapFirefox firefox-esr-unwrapped {
    <span class="hljs-attr">nixExtensions</span> = [
      (fetchFirefoxAddon {
        <span class="hljs-attr">name</span> = <span class="hljs-string">"ublock"</span>; <span class="hljs-comment"># Has to be unique!</span>
        <span class="hljs-attr">url</span> = <span class="hljs-string">"https://addons.mozilla.org/firefox/downloads/file/3679754/ublock_origin-1.31.0-an+fx.xpi"</span>;
        <span class="hljs-attr">hash</span> = <span class="hljs-string">"sha256-2e73AbmYZlZXCP5ptYVcFjQYdjDp4iPoEPEOSCVF5sA="</span>;
      })
    ];

    <span class="hljs-attr">extraPolicies</span> = {
      <span class="hljs-attr">CaptivePortal</span> = <span class="hljs-literal">false</span>;
      <span class="hljs-attr">DisableFirefoxStudies</span> = <span class="hljs-literal">true</span>;
      <span class="hljs-attr">DisablePocket</span> = <span class="hljs-literal">true</span>;
      <span class="hljs-attr">DisableTelemetry</span> = <span class="hljs-literal">true</span>;
      <span class="hljs-attr">DisableFirefoxAccounts</span> = <span class="hljs-literal">true</span>;
      <span class="hljs-attr">FirefoxHome</span> = {
        <span class="hljs-attr">Pocket</span> = <span class="hljs-literal">false</span>;
        <span class="hljs-attr">Snippets</span> = <span class="hljs-literal">false</span>;
      };
      <span class="hljs-attr">UserMessaging</span> = {
        <span class="hljs-attr">ExtensionRecommendations</span> = <span class="hljs-literal">false</span>;
        <span class="hljs-attr">SkipOnboarding</span> = <span class="hljs-literal">true</span>;
      };
      <span class="hljs-attr">SecurityDevices</span> = {
        <span class="hljs-comment"># Use a proxy module rather than `nixpkgs.config.firefox.smartcardSupport = true`</span>
        <span class="hljs-string">"PKCS#11 Proxy Module"</span> = <span class="hljs-string">"<span class="hljs-subst">${pkgs.p11-kit}</span>/lib/p11-kit-proxy.so"</span>;
      };
    };

    <span class="hljs-attr">extraPrefs</span> = <span class="hljs-string">''
      // Show more ssl cert infos
      lockPref("security.identityblock.show_extended_validation", true);
    ''</span>;
  };
}
</code></pre><p>If <code class="literal">nixExtensions != null</code>, then all manually installed add-ons will be uninstalled from your browser profile.
To view available enterprise policies, visit <a class="link" href="https://github.com/mozilla/policy-templates#enterprisepoliciesenabled" target="_top">enterprise policies</a>
or type into the Firefox URL bar: <code class="literal">about:policies#documentation</code>.
Nix installed add-ons do not have a valid signature, which is why signature verification is disabled. This does not compromise security because downloaded add-ons are checksummed and manual add-ons can’t be installed. Also, make sure that the <code class="literal">name</code> field of <code class="literal">fetchFirefoxAddon</code> is unique. If you remove an add-on from the <code class="literal">nixExtensions</code> array, rebuild and start Firefox: the removed add-on will be completely removed with all of its settings.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-firefox-troubleshooting" class="title">Troubleshooting   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-firefox-troubleshooting" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>If add-ons are marked as broken or the signature is invalid, make sure you have Firefox ESR installed. Normal Firefox does not provide the ability anymore to disable signature verification for add-ons thus nix add-ons get disabled by the normal Firefox binary.</p><p>If add-ons do not appear installed despite being defined in your nix configuration file, reset the local add-on state of your Firefox profile by clicking <code class="literal">Help -&gt; More Troubleshooting Information -&gt; Refresh Firefox</code>. This can happen if you switch from manual add-on mode to nix add-on mode and then back to manual mode and then again to nix add-on mode.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-fish" class="title" style="clear: both">Fish   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-fish" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-fish-vendor">Vendor Fish scripts</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-fish-plugins-pkg">Packaging Fish plugins</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-fish-wrapper">Fish wrapper</a> </span></dt> </dl></div><p>Fish is a “smart and user-friendly command line shell” with support for plugins.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-fish-vendor" class="title">Vendor Fish scripts   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-fish-vendor" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Any package may ship its own Fish completions, configuration snippets, and
functions. Those should be installed to
<code class="literal">$out/share/fish/vendor_{completions,conf,functions}.d</code> respectively.</p><p>When the <code class="literal">programs.fish.enable</code> and
<code class="literal">programs.fish.vendor.{completions,config,functions}.enable</code> options from the
NixOS Fish module are set to true, those paths are symlinked in the current
system environment and automatically loaded by Fish.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-fish-plugins-pkg" class="title">Packaging Fish plugins   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-fish-plugins-pkg" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>While packages providing standalone executables belong to the top level,
packages which have the sole purpose of extending Fish belong to the
<code class="literal">fishPlugins</code> scope and should be registered in
<code class="literal">pkgs/shells/fish/plugins/default.nix</code>.</p><p>The <code class="literal">buildFishPlugin</code> utility function can be used to automatically copy Fish
scripts from <code class="literal">$src/{completions,conf,conf.d,functions}</code> to the standard vendor
installation paths. It also sets up the test environment so that the optional
<code class="literal">checkPhase</code> is executed in a Fish shell with other already packaged plugins
and package-local Fish functions specified in <code class="literal">checkPlugins</code> and
<code class="literal">checkFunctionDirs</code> respectively.</p><p>See <code class="literal">pkgs/shells/fish/plugins/pure.nix</code> for an example of Fish plugin package
using <code class="literal">buildFishPlugin</code> and running unit tests with the <code class="literal">fishtape</code> test runner.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-fish-wrapper" class="title">Fish wrapper   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-fish-wrapper" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The <code class="literal">wrapFish</code> package is a wrapper around Fish which can be used to create
Fish shells initialized with some plugins as well as completions, configuration
snippets and functions sourced from the given paths. This provides a convenient
way to test Fish plugins and scripts without having to alter the environment.</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">wrapFish {
  <span class="hljs-attr">pluginPkgs</span> = <span class="hljs-keyword">with</span> fishPlugins; [ pure foreign-env ];
  <span class="hljs-attr">completionDirs</span> = [];
  <span class="hljs-attr">functionDirs</span> = [];
  <span class="hljs-attr">confDirs</span> = [ <span class="hljs-string">"/path/to/some/fish/init/dir/"</span> ];
}
</code></pre>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-fuse" class="title" style="clear: both">FUSE   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-fuse" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>Some packages rely on
<a class="link" href="https://www.kernel.org/doc/html/latest/filesystems/fuse.html" target="_top">FUSE</a> to provide
support for additional filesystems not supported by the kernel.</p><p>In general, FUSE software are primarily developed for Linux but many of them can
also run on macOS. Nixpkgs supports FUSE packages on macOS, but it requires
<a class="link" href="https://osxfuse.github.io/" target="_top">macFUSE</a> to be installed outside of Nix. macFUSE
currently isn’t packaged in Nixpkgs mainly because it includes a kernel
extension, which isn’t supported by Nix outside of NixOS.</p><p>If a package fails to run on macOS with an error message similar to the
following, it’s a likely sign that you need to have macFUSE installed.</p><pre><code class="programlisting hljs language-bash" data-highlighted="yes">dyld: Library not loaded: /usr/local/lib/libfuse.2.dylib
Referenced from: /nix/store/w8bi72bssv0bnxhwfw3xr1mvn7myf37x-sshfs-fuse-2.10/bin/sshfs
Reason: image not found
[1]    92299 abort      /nix/store/w8bi72bssv0bnxhwfw3xr1mvn7myf37x-sshfs-fuse-2.10/bin/sshfs
</code></pre><p>Package maintainers may often encounter the following error when building FUSE
packages on macOS:</p><pre><code class="programlisting hljs language-undefined" data-highlighted="yes">checking for fuse.h... no
configure: error: No fuse.h found.
</code></pre><p>This happens on autoconf based projects that use <code class="literal">AC_CHECK_HEADERS</code> or
<code class="literal">AC_CHECK_LIBS</code> to detect libfuse, and will occur even when the <code class="literal">fuse</code> package
is included in <code class="literal">buildInputs</code>. It happens because libfuse headers throw an error
on macOS if the <code class="literal">FUSE_USE_VERSION</code> macro is undefined. Many projects do define
<code class="literal">FUSE_USE_VERSION</code>, but only inside C source files. This results in the above
error at configure time because the configure script would attempt to compile
sample FUSE programs without defining <code class="literal">FUSE_USE_VERSION</code>.</p><p>There are two possible solutions for this problem in Nixpkgs:</p><div class="orderedlist"><ol class="orderedlist compact" type="1"><li class="listitem"><p>Pass <code class="literal">FUSE_USE_VERSION</code> to the configure script by adding
<code class="literal">CFLAGS=-DFUSE_USE_VERSION=25</code> in <code class="literal">configureFlags</code>. The actual value would
have to match the definition used in the upstream source code.</p></li><li class="listitem"><p>Remove <code class="literal">AC_CHECK_HEADERS</code> / <code class="literal">AC_CHECK_LIBS</code> for libfuse.</p></li></ol></div><p>However, a better solution might be to fix the build script upstream to use
<code class="literal">PKG_CHECK_MODULES</code> instead. This approach wouldn’t suffer from the problem that
<code class="literal">AC_CHECK_HEADERS</code>/<code class="literal">AC_CHECK_LIBS</code> has at the price of introducing a dependency
on pkg-config.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-ibus-typing-booster" class="title" style="clear: both">ibus-engines.typing-booster   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-ibus-typing-booster" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-ibus-typing-booster-activate">Activating the engine</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-ibus-typing-booster-customize-hunspell">Using custom hunspell dictionaries</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-ibus-typing-booster-emoji-picker">Built-in emoji picker</a> </span></dt> </dl></div><p>This package is an ibus-based completion method to speed up typing.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-ibus-typing-booster-activate" class="title">Activating the engine   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-ibus-typing-booster-activate" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>IBus needs to be configured accordingly to activate <code class="literal">typing-booster</code>. The configuration depends on the desktop manager in use. For detailed instructions, please refer to the <a class="link" href="https://mike-fabian.github.io/ibus-typing-booster/" target="_top">upstream docs</a>.</p><p>On NixOS, you need to explicitly enable <code class="literal">ibus</code> with given engines before customizing your desktop to use <code class="literal">typing-booster</code>. This can be achieved using the <code class="literal">ibus</code> module:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ pkgs, ... }: {
  i18n.<span class="hljs-attr">inputMethod</span> = {
    <span class="hljs-attr">enabled</span> = <span class="hljs-string">"ibus"</span>;
    ibus.<span class="hljs-attr">engines</span> = <span class="hljs-keyword">with</span> pkgs.ibus-engines; [ typing-booster ];
  };
}
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-ibus-typing-booster-customize-hunspell" class="title">Using custom hunspell dictionaries   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-ibus-typing-booster-customize-hunspell" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The IBus engine is based on <code class="literal">hunspell</code> to support completion in many languages. By default, the dictionaries <code class="literal">de-de</code>, <code class="literal">en-us</code>, <code class="literal">fr-moderne</code> <code class="literal">es-es</code>, <code class="literal">it-it</code>, <code class="literal">sv-se</code> and <code class="literal">sv-fi</code> are in use. To add another dictionary, the package can be overridden like this:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">ibus-engines.typing-booster.override { <span class="hljs-attr">langs</span> = [ <span class="hljs-string">"de-at"</span> <span class="hljs-string">"en-gb"</span> ]; }
</code></pre><p><span class="emphasis"><em>Note: each language passed to <code class="literal">langs</code> must be an attribute name in <code class="literal">pkgs.hunspellDicts</code>.</em></span></p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-ibus-typing-booster-emoji-picker" class="title">Built-in emoji picker   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-ibus-typing-booster-emoji-picker" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The <code class="literal">ibus-engines.typing-booster</code> package contains a program named <code class="literal">emoji-picker</code>. To display all emojis correctly, a special font such as <code class="literal">noto-fonts-color-emoji</code> is needed:</p><p>On NixOS, it can be installed using the following expression:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ pkgs, ... }: {
  fonts.<span class="hljs-attr">packages</span> = <span class="hljs-keyword">with</span> pkgs; [ noto-fonts-color-emoji ];
}
</code></pre>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-kakoune" class="title" style="clear: both">Kakoune   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-kakoune" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>Kakoune can be built to autoload plugins:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">(kakoune.override {
  <span class="hljs-attr">plugins</span> = <span class="hljs-keyword">with</span> pkgs.kakounePlugins; [ parinfer-rust ];
})
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-linux-kernel" class="title" style="clear: both">Linux kernel   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-linux-kernel" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>The Nix expressions to build the Linux kernel are in <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/os-specific/linux/kernel" target="_top"><code class="literal">pkgs/os-specific/linux/kernel</code></a>.</p><p>The function that builds the kernel has an argument <code class="literal">kernelPatches</code> which should be a list of <code class="literal">{name, patch, extraConfig}</code> attribute sets, where <code class="literal">name</code> is the name of the patch (which is included in the kernel’s <code class="literal">meta.description</code> attribute), <code class="literal">patch</code> is the patch itself (possibly compressed), and <code class="literal">extraConfig</code> (optional) is a string specifying extra options to be concatenated to the kernel configuration file (<code class="literal">.config</code>).</p><p>The kernel derivation exports an attribute <code class="literal">features</code> specifying whether optional functionality is or isn’t enabled. This is used in NixOS to implement kernel-specific behaviour. For instance, if the kernel has the <code class="literal">iwlwifi</code> feature (i.e., has built-in support for Intel wireless chipsets), then NixOS doesn’t have to build the external <code class="literal">iwlwifi</code> package:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-attr">modulesTree</span> = [kernel]
  ++ pkgs.lib.optional (!kernel.features ? iwlwifi) kernelPackages.iwlwifi
  ++ ...;
</code></pre><p>How to add a new (major) version of the Linux kernel to Nixpkgs:</p><div class="orderedlist"><ol class="orderedlist " type="1"><li class="listitem"><p>Copy the old Nix expression (e.g., <code class="literal">linux-2.6.21.nix</code>) to the new one (e.g., <code class="literal">linux-2.6.22.nix</code>) and update it.</p></li><li class="listitem"><p>Add the new kernel to the <code class="literal">kernels</code> attribute set in <code class="literal">linux-kernels.nix</code> (e.g., create an attribute <code class="literal">kernel_2_6_22</code>).</p></li><li class="listitem"><p>Now we’re going to update the kernel configuration. First unpack the kernel. Then for each supported platform (<code class="literal">i686</code>, <code class="literal">x86_64</code>, <code class="literal">uml</code>) do the following:</p><div class="orderedlist"><ol class="orderedlist " type="a"><li class="listitem"><p>Make a copy from the old config (e.g., <code class="literal">config-2.6.21-i686-smp</code>) to the new one (e.g., <code class="literal">config-2.6.22-i686-smp</code>).</p></li><li class="listitem"><p>Copy the config file for this platform (e.g., <code class="literal">config-2.6.22-i686-smp</code>) to <code class="literal">.config</code> in the kernel source tree.</p></li><li class="listitem"><p>Run <code class="literal">make oldconfig ARCH={i386,x86_64,um}</code> and answer all questions. (For the uml configuration, also add <code class="literal">SHELL=bash</code>.) Make sure to keep the configuration consistent between platforms (i.e., don’t enable some feature on <code class="literal">i686</code> and disable it on <code class="literal">x86_64</code>).</p></li><li class="listitem"><p>If needed, you can also run <code class="literal">make menuconfig</code>:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">nix-env -f <span class="hljs-string">"&lt;nixpkgs&gt;"</span> -iA ncurses</span>
<span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">export</span> NIX_CFLAGS_LINK=-lncurses</span>
<span class="hljs-meta prompt_">$ </span><span class="language-bash">make menuconfig ARCH=<span class="hljs-built_in">arch</span></span>
</code></pre></li><li class="listitem"><p>Copy <code class="literal">.config</code> over the new config file (e.g., <code class="literal">config-2.6.22-i686-smp</code>).</p></li></ol></div></li><li class="listitem"><p>Test building the kernel: <code class="literal">nix-build -A linuxKernel.kernels.kernel_2_6_22</code>. If it compiles, ship it! For extra credit, try booting NixOS with it.</p></li><li class="listitem"><p>It may be that the new kernel requires updating the external kernel modules and kernel-dependent packages listed in the <code class="literal">linuxPackagesFor</code> function in <code class="literal">linux-kernels.nix</code> (such as the NVIDIA drivers, AUFS, etc.). If the updated packages aren’t backwards compatible with older kernels, you may need to keep the older versions around.</p></li></ol></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="locales" class="title" style="clear: both">Locales   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#locales" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>To allow simultaneous use of packages linked against different versions of <code class="literal">glibc</code> with different locale archive formats, Nixpkgs patches <code class="literal">glibc</code> to rely on <code class="literal">LOCALE_ARCHIVE</code> environment variable.</p><p>On non-NixOS distributions, this variable is obviously not set. This can cause regressions in language support or even crashes in some Nixpkgs-provided programs. The simplest way to mitigate this problem is exporting the <code class="literal">LOCALE_ARCHIVE</code> variable pointing to <code class="literal">${glibcLocales}/lib/locale/locale-archive</code>. The drawback (and the reason this is not the default) is the relatively large (a hundred MiB) size of the full set of locales. It is possible to build a custom set of locales by overriding parameters <code class="literal">allLocales</code> and <code class="literal">locales</code> of the package.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="etc" class="title" style="clear: both">/etc files   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#etc" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>Certain calls in glibc require access to runtime files found in <code class="literal">/etc</code> such as <code class="literal">/etc/protocols</code> or <code class="literal">/etc/services</code> – <a class="link" href="https://linux.die.net/man/3/getprotobyname" target="_top">getprotobyname</a> is one such function.</p><p>On non-NixOS distributions these files are typically provided by packages (i.e., <a class="link" href="https://packages.debian.org/sid/netbase" target="_top">netbase</a>) if not already pre-installed in your distribution. This can cause non-reproducibility for code if they rely on these files being present.</p><p>If <a class="link" href="https://hydra.nixos.org/job/nixos/trunk-combined/nixpkgs.iana-etc.x86_64-linux" target="_top">iana-etc</a> is part of your <code class="literal">buildInputs</code>, then it will set the environment variables <code class="literal">NIX_ETC_PROTOCOLS</code> and <code class="literal">NIX_ETC_SERVICES</code> to the corresponding files in the package through a setup hook.</p><pre><code class="programlisting bash hljs language-bash" data-highlighted="yes">&gt; nix-shell -p iana-etc

[nix-shell:~]$ <span class="hljs-built_in">env</span> | grep NIX_ETC
NIX_ETC_SERVICES=/nix/store/aj866hr8fad8flnggwdhrldm0g799ccz-iana-etc-20210225/etc/services
NIX_ETC_PROTOCOLS=/nix/store/aj866hr8fad8flnggwdhrldm0g799ccz-iana-etc-20210225/etc/protocols
</code></pre><p>Nixpkg’s version of <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/development/libraries/glibc/default.nix" target="_top">glibc</a> has been patched to check for the existence of these environment variables. If the environment variables are <span class="emphasis"><em>not</em></span> set, then it will attempt to find the files at the default location within <code class="literal">/etc</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-nginx" class="title" style="clear: both">Nginx   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-nginx" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-nginx-etag">ETags on static files served from the Nix store</a> </span></dt> </dl></div><p><a class="link" href="https://nginx.org/" target="_top">Nginx</a> is a reverse proxy and lightweight webserver.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-nginx-etag" class="title">ETags on static files served from the Nix store   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-nginx-etag" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>HTTP has a couple of different mechanisms for caching to prevent clients from having to download the same content repeatedly if a resource has not changed since the last time it was requested. When nginx is used as a server for static files, it implements the caching mechanism based on the <a class="link" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Last-Modified" target="_top"><code class="literal">Last-Modified</code></a> response header automatically; unfortunately, it works by using filesystem timestamps to determine the value of the <code class="literal">Last-Modified</code> header. This doesn’t give the desired behavior when the file is in the Nix store because all file timestamps are set to 0 (for reasons related to build reproducibility).</p><p>Fortunately, HTTP supports an alternative (and more effective) caching mechanism: the <a class="link" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/ETag" target="_top"><code class="literal">ETag</code></a> response header. The value of the <code class="literal">ETag</code> header specifies some identifier for the particular content that the server is sending (e.g., a hash). When a client makes a second request for the same resource, it sends that value back in an <code class="literal">If-None-Match</code> header. If the ETag value is unchanged, then the server does not need to resend the content.</p><p>As of NixOS 19.09, the nginx package in Nixpkgs is patched such that when nginx serves a file out of <code class="literal">/nix/store</code>, the hash in the store path is used as the <code class="literal">ETag</code> header in the HTTP response, thus providing proper caching functionality. This happens automatically; you do not need to do modify any configuration to get this behavior.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-opengl" class="title" style="clear: both">OpenGL   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-opengl" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#nixos-desktop">NixOS Desktop</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#nix-on-gnulinux">Nix on GNU/Linux</a> </span></dt> </dl></div><p>OpenGL support varies depending on which hardware is used and which drivers are available and loaded.</p><p>Broadly, we support both GL vendors: Mesa and NVIDIA.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="nixos-desktop" class="title">NixOS Desktop   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#nixos-desktop" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The NixOS desktop or other non-headless configurations are the primary target for OpenGL libraries and applications. The current solution for discovering which drivers are available is based on <a class="link" href="https://gitlab.freedesktop.org/glvnd/libglvnd" target="_top">libglvnd</a>. <code class="literal">libglvnd</code> performs “vendor-neutral dispatch”, trying a variety of techniques to find the system’s GL implementation. In practice, this will be either via standard GLX for X11 users or EGL for Wayland users, and supporting either NVIDIA or Mesa extensions.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="nix-on-gnulinux" class="title">Nix on GNU/Linux   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#nix-on-gnulinux" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>If you are using a non-NixOS GNU/Linux/X11 desktop with free software video drivers, consider launching OpenGL-dependent programs from Nixpkgs with Nixpkgs versions of <code class="literal">libglvnd</code> and <code class="literal">mesa.drivers</code> in <code class="literal">LD_LIBRARY_PATH</code>. For Mesa drivers, the Linux kernel version doesn’t have to match nixpkgs.</p><p>For proprietary video drivers, you might have luck with also adding the corresponding video driver package.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-shell-helpers" class="title" style="clear: both">Interactive shell helpers   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-shell-helpers" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>Some packages provide the shell integration to be more useful. But unlike other systems, nix doesn’t have a standard <code class="literal">share</code> directory location. This is why a bunch <code class="literal">PACKAGE-share</code> scripts are shipped that print the location of the corresponding shared folder. Current list of such packages is as following:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">fzf</code> : <code class="literal">fzf-share</code></p></li></ul></div><p>E.g. <code class="literal">fzf</code> can then be used in the <code class="literal">.bashrc</code> like this:</p><pre><code class="programlisting bash hljs language-bash" data-highlighted="yes"><span class="hljs-built_in">source</span> <span class="hljs-string">"<span class="hljs-subst">$(fzf-share)</span>/completion.bash"</span>
<span class="hljs-built_in">source</span> <span class="hljs-string">"<span class="hljs-subst">$(fzf-share)</span>/key-bindings.bash"</span>
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-steam" class="title" style="clear: both">Steam   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-steam" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-steam-nix">Steam in Nix</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-steam-play">How to play</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-steam-troub">Troubleshooting</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-steam-run">steam-run</a> </span></dt> </dl></div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-steam-nix" class="title">Steam in Nix   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-steam-nix" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Steam is distributed as a <code class="literal">.deb</code> file, for now only as an i686 package (the amd64 package only has documentation). When unpacked, it has a script called <code class="literal">steam</code> that in Ubuntu (their target distro) would go to <code class="literal">/usr/bin</code>. When run for the first time, this script copies some files to the user’s home, which include another script that is the ultimate responsible for launching the steam binary, which is also in <code class="literal">$HOME</code>.</p><p>Nix problems and constraints:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>We don’t have <code class="literal">/bin/bash</code> and many scripts point there. Same thing for <code class="literal">/usr/bin/python</code>.</p></li><li class="listitem"><p>We don’t have the dynamic loader in <code class="literal">/lib</code>.</p></li><li class="listitem"><p>The <code class="literal">steam.sh</code> script in <code class="literal">$HOME</code> cannot be patched, as it is checked and rewritten by steam.</p></li><li class="listitem"><p>The steam binary cannot be patched, it’s also checked.</p></li></ul></div><p>The current approach to deploy Steam in NixOS is composing a FHS-compatible chroot environment, as documented <a class="link" href="https://sandervanderburg.blogspot.com/2013/09/composing-fhs-compatible-chroot.html" target="_top">here</a>. This allows us to have binaries in the expected paths without disrupting the system, and to avoid patching them to work in a non FHS environment.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-steam-play" class="title">How to play   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-steam-play" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Use <code class="literal">programs.steam.enable = true;</code> if you want to add steam to <code class="literal">systemPackages</code> and also enable a few workarounds as well as Steam controller support or other Steam supported controllers such as the DualShock 4 or Nintendo Switch Pro Controller.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-steam-troub" class="title">Troubleshooting   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-steam-troub" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><span class="strong"><strong>Steam fails to start. What do I do?</strong></span></p><p>Try to run</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes">strace steam
</code></pre><p>to see what is causing steam to fail.</p></li><li class="listitem"><p><span class="strong"><strong>Using the FOSS Radeon or nouveau (nvidia) drivers</strong></span></p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p>The <code class="literal">newStdcpp</code> parameter was removed since NixOS 17.09 and should not be needed anymore.</p></li><li class="listitem"><p>Steam ships statically linked with a version of <code class="literal">libcrypto</code> that conflicts with the one dynamically loaded by radeonsi_dri.so. If you get the error:</p><pre><code class="programlisting hljs language-undefined" data-highlighted="yes">steam.sh: line 713: 7842 Segmentation fault (core dumped)
</code></pre><p>have a look at <a class="link" href="https://github.com/NixOS/nixpkgs/pull/20269" target="_top">this pull request</a>.</p></li></ul></div></li><li class="listitem"><p><span class="strong"><strong>Java</strong></span></p><div class="orderedlist"><ol class="orderedlist compact" type="1"><li class="listitem"><p>There is no java in steam chrootenv by default. If you get a message like:</p></li></ol></div><pre><code class="programlisting hljs language-bash" data-highlighted="yes">/home/foo/.local/share/Steam/SteamApps/common/towns/towns.sh: line 1: java: <span class="hljs-built_in">command</span> not found
</code></pre><p>you need to add:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">steam.override { <span class="hljs-attr">withJava</span> = <span class="hljs-literal">true</span>; };
</code></pre></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-steam-run" class="title">steam-run   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-steam-run" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The FHS-compatible chroot used for Steam can also be used to run other Linux games that expect a FHS environment. To use it, install the <code class="literal">steam-run</code> package and run the game with:</p><pre><code class="programlisting hljs language-bash" data-highlighted="yes">steam-run ./foo
</code></pre>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="cataclysm-dark-days-ahead" class="title" style="clear: both">Cataclysm: Dark Days Ahead   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#cataclysm-dark-days-ahead" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#how-to-install-cataclysm-dda">How to install Cataclysm DDA</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#important-note-for-overriding-packages">Important note for overriding packages</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#customizing-with-mods">Customizing with mods</a> </span></dt> </dl></div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="how-to-install-cataclysm-dda" class="title">How to install Cataclysm DDA   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#how-to-install-cataclysm-dda" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>To install the latest stable release of Cataclysm DDA to your profile, execute
<code class="literal">nix-env -f "&lt;nixpkgs&gt;" -iA cataclysm-dda</code>. For the curses build (build
without tiles), install <code class="literal">cataclysmDDA.stable.curses</code>. Note: <code class="literal">cataclysm-dda</code> is
an alias to <code class="literal">cataclysmDDA.stable.tiles</code>.</p><p>If you like access to a development build of your favorite git revision,
override <code class="literal">cataclysm-dda-git</code> (or <code class="literal">cataclysmDDA.git.curses</code> if you like curses
build):</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">cataclysm-dda-git.override {
  <span class="hljs-attr">version</span> = <span class="hljs-string">"YYYY-MM-DD"</span>;
  <span class="hljs-attr">rev</span> = <span class="hljs-string">"YOUR_FAVORITE_REVISION"</span>;
  <span class="hljs-attr">sha256</span> = <span class="hljs-string">"CHECKSUM_OF_THE_REVISION"</span>;
}
</code></pre><p>The sha256 checksum can be obtained by</p><pre><code class="programlisting sh hljs language-bash" data-highlighted="yes">nix-prefetch-url --unpack <span class="hljs-string">"https://github.com/CleverRaven/Cataclysm-DDA/archive/<span class="hljs-variable">${YOUR_FAVORITE_REVISION}</span>.tar.gz"</span>
</code></pre><p>The default configuration directory is <code class="literal">~/.cataclysm-dda</code>. If you prefer
<code class="literal">$XDG_CONFIG_HOME/cataclysm-dda</code>, override the derivation:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">cataclysm-dda.override {
  <span class="hljs-attr">useXdgDir</span> = <span class="hljs-literal">true</span>;
}
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="important-note-for-overriding-packages" class="title">Important note for overriding packages   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#important-note-for-overriding-packages" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>After applying <code class="literal">overrideAttrs</code>, you need to fix <code class="literal">passthru.pkgs</code> and
<code class="literal">passthru.withMods</code> attributes either manually or by using <code class="literal">attachPkgs</code>:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">let</span>
  <span class="hljs-comment"># You enabled parallel building.</span>
  <span class="hljs-attr">myCDDA</span> = cataclysm-dda-git.overrideAttrs (_: {
    <span class="hljs-attr">enableParallelBuilding</span> = <span class="hljs-literal">true</span>;
  });

  <span class="hljs-comment"># Unfortunately, this refers to the package before overriding and</span>
  <span class="hljs-comment"># parallel building is still disabled.</span>
  <span class="hljs-attr">badExample</span> = myCDDA.withMods (_: []);

  <span class="hljs-keyword">inherit</span> (cataclysmDDA) attachPkgs pkgs wrapCDDA;

  <span class="hljs-comment"># You can fix it by hand</span>
  <span class="hljs-attr">goodExample1</span> = myCDDA.overrideAttrs (old: {
    <span class="hljs-attr">passthru</span> = old.passthru // {
      <span class="hljs-attr">pkgs</span> = pkgs.override { <span class="hljs-attr">build</span> = goodExample1; };
      <span class="hljs-attr">withMods</span> = wrapCDDA goodExample1;
    };
  });

  <span class="hljs-comment"># or by using a helper function `attachPkgs`.</span>
  <span class="hljs-attr">goodExample2</span> = attachPkgs pkgs myCDDA;
<span class="hljs-keyword">in</span>

<span class="hljs-comment"># badExample                     # parallel building disabled</span>
<span class="hljs-comment"># goodExample1.withMods (_: [])  # parallel building enabled</span>
goodExample2.withMods (_: [])    <span class="hljs-comment"># parallel building enabled</span>
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="customizing-with-mods" class="title">Customizing with mods   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#customizing-with-mods" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>To install Cataclysm DDA with mods of your choice, you can use <code class="literal">withMods</code>
attribute:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">cataclysm-dda.withMods (mods: <span class="hljs-keyword">with</span> mods; [
  tileset.UndeadPeople
])
</code></pre><p>All mods, soundpacks, and tilesets available in nixpkgs are found in
<code class="literal">cataclysmDDA.pkgs</code>.</p><p>Here is an example to modify existing mods and/or add more mods not available
in nixpkgs:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes"><span class="hljs-keyword">let</span>
  <span class="hljs-attr">customMods</span> = self: super: lib.recursiveUpdate super {
    <span class="hljs-comment"># Modify existing mod</span>
    tileset.<span class="hljs-attr">UndeadPeople</span> = super.tileset.UndeadPeople.overrideAttrs (old: {
      <span class="hljs-comment"># If you like to apply a patch to the tileset for example</span>
      <span class="hljs-attr">patches</span> = [ ./path/to/your.patch ];
    });

    <span class="hljs-comment"># Add another mod</span>
    mod.<span class="hljs-attr">Awesome</span> = cataclysmDDA.buildMod {
      <span class="hljs-attr">modName</span> = <span class="hljs-string">"Awesome"</span>;
      <span class="hljs-attr">version</span> = <span class="hljs-string">"0.x"</span>;
      <span class="hljs-attr">src</span> = fetchFromGitHub {
        <span class="hljs-attr">owner</span> = <span class="hljs-string">"Someone"</span>;
        <span class="hljs-attr">repo</span> = <span class="hljs-string">"AwesomeMod"</span>;
        <span class="hljs-attr">rev</span> = <span class="hljs-string">"..."</span>;
        <span class="hljs-attr">hash</span> = <span class="hljs-string">"..."</span>;
      };
      <span class="hljs-comment"># Path to be installed in the unpacked source (default: ".")</span>
      <span class="hljs-attr">modRoot</span> = <span class="hljs-string">"contents/under/this/path/will/be/installed"</span>;
    };

    <span class="hljs-comment"># Add another soundpack</span>
    soundpack.<span class="hljs-attr">Fantastic</span> = cataclysmDDA.buildSoundPack {
      <span class="hljs-comment"># ditto</span>
    };

    <span class="hljs-comment"># Add another tileset</span>
    tileset.<span class="hljs-attr">SuperDuper</span> = cataclysmDDA.buildTileSet {
      <span class="hljs-comment"># ditto</span>
    };
  };
<span class="hljs-keyword">in</span>
cataclysm-dda.withMods (mods: <span class="hljs-keyword">with</span> mods.extend customMods; [
  tileset.UndeadPeople
  mod.Awesome
  soundpack.Fantastic
  tileset.SuperDuper
])
</code></pre>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-urxvt" class="title" style="clear: both">Urxvt   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-urxvt" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-urxvt-conf">Configuring urxvt</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-urxvt-pkg">Packaging urxvt plugins</a> </span></dt> </dl></div><p>Urxvt, also known as rxvt-unicode, is a highly customizable terminal emulator.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-urxvt-conf" class="title">Configuring urxvt   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-urxvt-conf" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>In <code class="literal">nixpkgs</code>, urxvt is provided by the package <code class="literal">rxvt-unicode</code>. It can be configured to include your choice of plugins, reducing its closure size from the default configuration which includes all available plugins. To make use of this functionality, use an overlay or directly install an expression that overrides its configuration, such as:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">rxvt-unicode.override {
  <span class="hljs-attr">configure</span> = { availablePlugins, ... }: {
    <span class="hljs-attr">plugins</span> = <span class="hljs-keyword">with</span> availablePlugins; [ perls resize-font vtwheel ];
  };
}
</code></pre><p>If the <code class="literal">configure</code> function returns an attrset without the <code class="literal">plugins</code> attribute, <code class="literal">availablePlugins</code> will be used automatically.</p><p>In order to add plugins but also keep all default plugins installed, it is possible to use the following method:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">rxvt-unicode.override {
  <span class="hljs-attr">configure</span> = { availablePlugins, ... }: {
    <span class="hljs-attr">plugins</span> = (<span class="hljs-built_in">builtins</span>.attrValues availablePlugins) ++ [ custom-plugin ];
  };
}
</code></pre><p>To get a list of all the plugins available, open the Nix REPL and run</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes"><span class="hljs-meta prompt_">$ </span><span class="language-bash">nix repl</span>
:l &lt;nixpkgs&gt;
map (p: p.name) pkgs.rxvt-unicode.plugins
</code></pre><p>Alternatively, if your shell is bash or zsh and have completion enabled, type <code class="literal">nixpkgs.rxvt-unicode.plugins.&lt;tab&gt;</code>.</p><p>In addition to <code class="literal">plugins</code> the options <code class="literal">extraDeps</code> and <code class="literal">perlDeps</code> can be used to install extra packages. <code class="literal">extraDeps</code> can be used, for example, to provide <code class="literal">xsel</code> (a clipboard manager) to the clipboard plugin, without installing it globally:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">rxvt-unicode.override {
  <span class="hljs-attr">configure</span> = { availablePlugins, ... }: {
    <span class="hljs-attr">pluginsDeps</span> = [ xsel ];
  };
}
</code></pre><p><code class="literal">perlDeps</code> is a handy way to provide Perl packages to your custom plugins (in <code class="literal">$HOME/.urxvt/ext</code>). For example, if you need <code class="literal">AnyEvent</code> you can do:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">rxvt-unicode.override {
  <span class="hljs-attr">configure</span> = { availablePlugins, ... }: {
    <span class="hljs-attr">perlDeps</span> = <span class="hljs-keyword">with</span> perlPackages; [ AnyEvent ];
  };
}
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-urxvt-pkg" class="title">Packaging urxvt plugins   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-urxvt-pkg" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>Urxvt plugins resides in <code class="literal">pkgs/applications/misc/rxvt-unicode-plugins</code>. To add a new plugin, create an expression in a subdirectory and add the package to the set in <code class="literal">pkgs/applications/misc/rxvt-unicode-plugins/default.nix</code>.</p><p>A plugin can be any kind of derivation, the only requirement is that it should always install perl scripts in <code class="literal">$out/lib/urxvt/perl</code>. Look for existing plugins for examples.</p><p>If the plugin is itself a Perl package that needs to be imported from other plugins or scripts, add the following passthrough:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">passthru.<span class="hljs-attr">perlPackages</span> = [ <span class="hljs-string">"self"</span> ];
</code></pre><p>This will make the urxvt wrapper pick up the dependency and set up the Perl path accordingly.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-weechat" class="title" style="clear: both">WeeChat   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-weechat" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>WeeChat can be configured to include your choice of plugins, reducing its closure size from the default configuration which includes all available plugins. To make use of this functionality, install an expression that overrides its configuration, such as:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">weechat.override {<span class="hljs-attr">configure</span> = {availablePlugins, ...}: {
    <span class="hljs-attr">plugins</span> = <span class="hljs-keyword">with</span> availablePlugins; [ python perl ];
  }
}
</code></pre><p>If the <code class="literal">configure</code> function returns an attrset without the <code class="literal">plugins</code> attribute, <code class="literal">availablePlugins</code> will be used automatically.</p><p>The plugins currently available are <code class="literal">python</code>, <code class="literal">perl</code>, <code class="literal">ruby</code>, <code class="literal">guile</code>, <code class="literal">tcl</code> and <code class="literal">lua</code>.</p><p>The Python and Perl plugins allows the addition of extra libraries. For instance, the <code class="literal">inotify.py</code> script in <code class="literal">weechat-scripts</code> requires D-Bus or libnotify, and the <code class="literal">fish.py</code> script requires <code class="literal">pycrypto</code>. To use these scripts, use the plugin’s <code class="literal">withPackages</code> attribute:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">weechat.override { <span class="hljs-attr">configure</span> = {availablePlugins, ...}: {
    <span class="hljs-attr">plugins</span> = <span class="hljs-keyword">with</span> availablePlugins; [
            (python.withPackages (ps: <span class="hljs-keyword">with</span> ps; [ pycrypto python-dbus ]))
        ];
    };
}
</code></pre><p>In order to also keep all default plugins installed, it is possible to use the following method:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">weechat.override { <span class="hljs-attr">configure</span> = { availablePlugins, ... }: {
  <span class="hljs-attr">plugins</span> = <span class="hljs-built_in">builtins</span>.attrValues (availablePlugins // {
    <span class="hljs-attr">python</span> = availablePlugins.python.withPackages (ps: <span class="hljs-keyword">with</span> ps; [ pycrypto python-dbus ]);
  });
}; }
</code></pre><p>WeeChat allows to set defaults on startup using the <code class="literal">--run-command</code>. The <code class="literal">configure</code> method can be used to pass commands to the program:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">weechat.override {
  <span class="hljs-attr">configure</span> = { availablePlugins, ... }: {
    <span class="hljs-attr">init</span> = <span class="hljs-string">''
      /set foo bar
      /server add libera irc.libera.chat
    ''</span>;
  };
}
</code></pre><p>Further values can be added to the list of commands when running <code class="literal">weechat --run-command "your-commands"</code>.</p><p>Additionally, it’s possible to specify scripts to be loaded when starting <code class="literal">weechat</code>. These will be loaded before the commands from <code class="literal">init</code>:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">weechat.override {
  <span class="hljs-attr">configure</span> = { availablePlugins, ... }: {
    <span class="hljs-attr">scripts</span> = <span class="hljs-keyword">with</span> pkgs.weechatScripts; [
      weechat-xmpp weechat-matrix-bridge wee-slack
    ];
    <span class="hljs-attr">init</span> = <span class="hljs-string">''
      /set plugins.var.python.jabber.key "val"
    ''</span>:
  };
}
</code></pre><p>In <code class="literal">nixpkgs</code> there’s a subpackage which contains derivations for WeeChat scripts. Such derivations expect a <code class="literal">passthru.scripts</code> attribute, which contains a list of all scripts inside the store path. Furthermore, all scripts have to live in <code class="literal">$out/share</code>. An exemplary derivation looks like this:</p><pre><code class="programlisting nix hljs language-nix" data-highlighted="yes">{ stdenv, fetchurl }:

stdenv.mkDerivation {
  <span class="hljs-attr">name</span> = <span class="hljs-string">"exemplary-weechat-script"</span>;
  <span class="hljs-attr">src</span> = fetchurl {
    <span class="hljs-attr">url</span> = <span class="hljs-string">"https://scripts.tld/your-scripts.tar.gz"</span>;
    <span class="hljs-attr">hash</span> = <span class="hljs-string">"..."</span>;
  };
  passthru.<span class="hljs-attr">scripts</span> = [ <span class="hljs-string">"foo.py"</span> <span class="hljs-string">"bar.lua"</span> ];
  <span class="hljs-attr">installPhase</span> = <span class="hljs-string">''
    mkdir $out/share
    cp foo.py $out/share
    cp bar.lua $out/share
  ''</span>;
}
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-xorg" class="title" style="clear: both">X.org   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-xorg" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#katamari-tarballs">Katamari Tarballs</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#individual-tarballs">Individual Tarballs</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#generating-nix-expressions">Generating Nix Expressions</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#overriding-the-generator">Overriding the Generator</a> </span></dt> </dl></div><p>The Nix expressions for the X.org packages reside in <code class="literal">pkgs/servers/x11/xorg/default.nix</code>. This file is automatically generated from lists of tarballs in an X.org release. As such it should not be modified directly; rather, you should modify the lists, the generator script or the file <code class="literal">pkgs/servers/x11/xorg/overrides.nix</code>, in which you can override or add to the derivations produced by the generator.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="katamari-tarballs" class="title">Katamari Tarballs   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#katamari-tarballs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>X.org upstream releases used to include <a class="link" href="https://en.wiktionary.org/wiki/%E3%81%8B%E3%81%9F%E3%81%BE%E3%82%8A" target="_top">katamari</a> releases, which included a holistic recommended version for each tarball, up until 7.7. To create a list of tarballs in a katamari release:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes">export release="X11R7.7"
export url="mirror://xorg/$release/src/everything/"
cat $(PRINT_PATH=1 nix-prefetch-url $url | tail -n 1) \
  | perl -e 'while (&lt;&gt;) { if (/(href|HREF)="([^"]*.bz2)"/) { print "$ENV{'url'}$2\n"; }; }' \
  | sort &gt; "tarballs-$release.list"
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="individual-tarballs" class="title">Individual Tarballs   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#individual-tarballs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The upstream release process for <a class="link" href="https://x.org/wiki/Releases/7.8/" target="_top">X11R7.8</a> does not include a planned katamari. Instead, each component of X.org is released as its own tarball. We maintain <code class="literal">pkgs/servers/x11/xorg/tarballs.list</code> as a list of tarballs for each individual package. This list includes X.org core libraries and protocol descriptions, extra newer X11 interface libraries, like <code class="literal">xorg.libxcb</code>, and classic utilities which are largely unused but still available if needed, like <code class="literal">xorg.imake</code>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="generating-nix-expressions" class="title">Generating Nix Expressions   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#generating-nix-expressions" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>The generator is invoked as follows:</p><pre><code class="programlisting ShellSession hljs language-ShellSession" data-highlighted="yes">cd pkgs/servers/x11/xorg
&lt;tarballs.list perl ./generate-expr-from-tarballs.pl
</code></pre><p>For each of the tarballs in the <code class="literal">.list</code> files, the script downloads it, unpacks it, and searches its <code class="literal">configure.ac</code> and <code class="literal">*.pc.in</code> files for dependencies. This information is used to generate <code class="literal">default.nix</code>. The generator caches downloaded tarballs between runs. Pay close attention to the <code class="literal">NOT FOUND: $NAME</code> messages at the end of the run, since they may indicate missing dependencies. (Some might be optional dependencies, however.)</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="overriding-the-generator" class="title">Overriding the Generator   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#overriding-the-generator" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>If the expression for a package requires derivation attributes that the generator cannot figure out automatically (say, <code class="literal">patches</code> or a <code class="literal">postInstall</code> hook), you should modify <code class="literal">pkgs/servers/x11/xorg/overrides.nix</code>.</p>
</div>

</div>
</div>
</div><div class="part"> <div class="titlepage">  <div>   <div>    <h1 id="part-development" class="title">Development of Nixpkgs   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#part-development" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h1>  </div> </div></div><div class="partintro"><p>This section shows you how Nixpkgs is being developed and how you can interact with the contributors and the latest updates.
If you are interested in contributing yourself, see <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/CONTRIBUTING.md" target="_top">CONTRIBUTING.md</a>.</p><div class="toc"> <p><strong>Table of Contents</strong></p> <dl class="toc">  <dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-opening-issues">Opening issues</a> </span></dt> </dl></div></div><div class="chapter"> <div class="titlepage">  <div>   <div>    <h2 id="sec-opening-issues" class="title">Opening issues   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-opening-issues" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>Make sure you have a <a class="link" href="https://github.com/signup/free" target="_top">GitHub account</a></p></li><li class="listitem"><p>Make sure there is no open issue on the topic</p></li><li class="listitem"><p><a class="link" href="https://github.com/NixOS/nixpkgs/issues/new/choose" target="_top">Submit a new issue</a> by choosing the kind of topic and fill out the template</p></li></ul></div>
</div>
</div><div class="part"> <div class="titlepage">  <div>   <div>    <h1 id="part-contributing" class="title">Contributing to Nixpkgs   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#part-contributing" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h1>  </div> </div></div><div class="partintro"><div class="toc"> <p><strong>Table of Contents</strong></p> <dl class="toc">  <dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-quick-start">Quick Start to Adding a Package</a> </span></dt><dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-conventions">Coding conventions</a> </span></dt><dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-submitting-changes">Submitting changes</a> </span></dt><dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-vulnerability-roundup">Vulnerability Roundup</a> </span></dt><dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-reviewing-contributions">Reviewing contributions</a> </span></dt><dt> <span class="chapter">  <a href="https://nixos.org/manual/nixpkgs/stable/#chap-contributing">Contributing to Nixpkgs documentation</a> </span></dt> </dl></div></div><div class="chapter"> <div class="titlepage">  <div>   <div>    <h2 id="chap-quick-start" class="title">Quick Start to Adding a Package   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#chap-quick-start" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/README.md" target="_top">pkgs/README.md</a>.</p>
</div><div class="chapter"> <div class="titlepage">  <div>   <div>    <h2 id="chap-conventions" class="title">Coding conventions   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#chap-conventions" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <p><strong>Table of Contents</strong></p> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-syntax">Syntax</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-package-naming">Package naming</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-organisation">File naming and organisation</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-sources">Fetching Sources</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-source-hashes">Obtaining source hash</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-patches">Patches</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-package-tests">Package tests</a> </span></dt> </dl></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/CONTRIBUTING.md" target="_top">CONTRIBUTING.md</a>.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-syntax" class="title" style="clear: both">Syntax   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-syntax" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/CONTRIBUTING.md" target="_top">CONTRIBUTING.md</a>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-package-naming" class="title" style="clear: both">Package naming   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-package-naming" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/README.md" target="_top">pkgs/README.md</a>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-organisation" class="title" style="clear: both">File naming and organisation   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-organisation" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-versioning">Versioning</a> </span></dt> </dl></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/CONTRIBUTING.md" target="_top">CONTRIBUTING.md</a>.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-versioning" class="title">Versioning   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-versioning" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/README.md" target="_top">pkgs/README.md</a>.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-sources" class="title" style="clear: both">Fetching Sources   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-sources" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/README.md" target="_top">pkgs/README.md</a>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-source-hashes" class="title" style="clear: both">Obtaining source hash   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-source-hashes" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-source-hashes-security">Obtaining hashes securely</a> </span></dt> </dl></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/README.md" target="_top">pkgs/README.md</a>.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-source-hashes-security" class="title">Obtaining hashes securely   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-source-hashes-security" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/README.md" target="_top">pkgs/README.md</a>.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-patches" class="title" style="clear: both">Patches   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-patches" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/README.md" target="_top">pkgs/README.md</a>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-package-tests" class="title" style="clear: both">Package tests   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-package-tests" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-inline-package-tests-writing">Writing inline package tests</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-package-tests-writing">Writing larger package tests</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-package-tests-running">Running package tests</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-package-tests-examples">Examples of package tests</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-nixos-tests-linking">Linking NixOS module tests to a package</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-import-from-derivation">Import From Derivation</a> </span></dt> </dl></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/README.md" target="_top">pkgs/README.md</a>.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-inline-package-tests-writing" class="title">Writing inline package tests   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-inline-package-tests-writing" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/README.md" target="_top">pkgs/README.md</a>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-package-tests-writing" class="title">Writing larger package tests   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-package-tests-writing" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/README.md" target="_top">pkgs/README.md</a>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-package-tests-running" class="title">Running package tests   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-package-tests-running" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/README.md" target="_top">pkgs/README.md</a>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-package-tests-examples" class="title">Examples of package tests   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-package-tests-examples" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/README.md" target="_top">pkgs/README.md</a>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-nixos-tests-linking" class="title">Linking NixOS module tests to a package   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-nixos-tests-linking" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/README.md" target="_top">pkgs/README.md</a>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="ssec-import-from-derivation" class="title">Import From Derivation   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#ssec-import-from-derivation" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/README.md" target="_top">pkgs/README.md</a>.</p>
</div>

</div>

</div><div class="chapter"> <div class="titlepage">  <div>   <div>    <h2 id="chap-submitting-changes" class="title">Submitting changes   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#chap-submitting-changes" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <p><strong>Table of Contents</strong></p> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-submitting-changes">Submitting changes</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-submitting-security-fixes">Submitting security fixes</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-deprecating-packages">Deprecating/removing packages</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-pull-request-template">Pull Request Template</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-hotfixing-pull-requests">Hotfixing pull requests</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-commit-policy">Commit policy</a> </span></dt> </dl></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/CONTRIBUTING.md" target="_top">CONTRIBUTING.md</a>.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="submitting-changes-submitting-changes" class="title" style="clear: both">Submitting changes   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-submitting-changes" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/CONTRIBUTING.md" target="_top">CONTRIBUTING.md</a>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="submitting-changes-submitting-security-fixes" class="title" style="clear: both">Submitting security fixes   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-submitting-security-fixes" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/README.md" target="_top">pkgs/README.md</a>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="submitting-changes-deprecating-packages" class="title" style="clear: both">Deprecating/removing packages   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-deprecating-packages" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#steps-to-remove-a-package-from-nixpkgs">Steps to remove a package from Nixpkgs</a> </span></dt> </dl></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/README.md" target="_top">pkgs/README.md</a>.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="steps-to-remove-a-package-from-nixpkgs" class="title">Steps to remove a package from Nixpkgs   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#steps-to-remove-a-package-from-nixpkgs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/README.md" target="_top">pkgs/README.md</a>.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="submitting-changes-pull-request-template" class="title" style="clear: both">Pull Request Template   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-pull-request-template" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-tested-with-sandbox">Tested using sandboxing</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-platform-diversity">Built on platform(s)</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-nixos-tests">Tested via one or more NixOS test(s) if existing and applicable for the change (look inside nixos/tests)</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-tested-compilation">Tested compilation of all pkgs that depend on this change using <code class="literal">nixpkgs-review</code></a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-tested-execution">Tested execution of all binary files (usually in <code class="literal">./result/bin/</code>)</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-contribution-standards">Meets Nixpkgs contribution standards</a> </span></dt> </dl></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/CONTRIBUTING.md" target="_top">CONTRIBUTING.md</a>.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="submitting-changes-tested-with-sandbox" class="title">Tested using sandboxing   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-tested-with-sandbox" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/CONTRIBUTING.md" target="_top">CONTRIBUTING.md</a>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="submitting-changes-platform-diversity" class="title">Built on platform(s)   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-platform-diversity" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/CONTRIBUTING.md" target="_top">CONTRIBUTING.md</a>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="submitting-changes-nixos-tests" class="title">Tested via one or more NixOS test(s) if existing and applicable for the change (look inside nixos/tests)   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-nixos-tests" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/CONTRIBUTING.md" target="_top">CONTRIBUTING.md</a>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="submitting-changes-tested-compilation" class="title">Tested compilation of all pkgs that depend on this change using <code class="literal">nixpkgs-review</code>   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-tested-compilation" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/CONTRIBUTING.md" target="_top">CONTRIBUTING.md</a>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="submitting-changes-tested-execution" class="title">Tested execution of all binary files (usually in <code class="literal">./result/bin/</code>)   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-tested-execution" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/CONTRIBUTING.md" target="_top">CONTRIBUTING.md</a>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="submitting-changes-contribution-standards" class="title">Meets Nixpkgs contribution standards   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-contribution-standards" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/CONTRIBUTING.md" target="_top">CONTRIBUTING.md</a>.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="submitting-changes-hotfixing-pull-requests" class="title" style="clear: both">Hotfixing pull requests   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-hotfixing-pull-requests" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/CONTRIBUTING.md" target="_top">CONTRIBUTING.md</a>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="submitting-changes-commit-policy" class="title" style="clear: both">Commit policy   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-commit-policy" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-branches">Branches</a> </span></dt> </dl></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/CONTRIBUTING.md" target="_top">CONTRIBUTING.md</a>.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="submitting-changes-branches" class="title">Branches   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-branches" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>  </div> </div></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/CONTRIBUTING.md" target="_top">CONTRIBUTING.md</a>.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="submitting-changes-master-branch" class="title">Master branch   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-master-branch" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/CONTRIBUTING.md" target="_top">CONTRIBUTING.md</a>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="submitting-changes-staging-branch" class="title">Staging branch   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-staging-branch" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/CONTRIBUTING.md" target="_top">CONTRIBUTING.md</a>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="submitting-changes-staging-next-branch" class="title">Staging-next branch   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-staging-next-branch" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/CONTRIBUTING.md" target="_top">CONTRIBUTING.md</a>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="submitting-changes-stable-release-branches" class="title">Stable release branches   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-stable-release-branches" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/CONTRIBUTING.md" target="_top">CONTRIBUTING.md</a>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="submitting-changes-stable-release-branches-automatic-backports" class="title">Automatically backporting a Pull Request   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-stable-release-branches-automatic-backports" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/CONTRIBUTING.md" target="_top">CONTRIBUTING.md</a>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="submitting-changes-stable-release-branches-manual-backports" class="title">Manually backporting changes   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-stable-release-branches-manual-backports" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/CONTRIBUTING.md" target="_top">CONTRIBUTING.md</a>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="acceptable-backport-criteria" class="title">Acceptable backport criteria   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#acceptable-backport-criteria" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>  </div> </div></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/CONTRIBUTING.md" target="_top">CONTRIBUTING.md</a>.</p>
</div>

</div>

</div>

</div><div class="chapter"> <div class="titlepage">  <div>   <div>    <h2 id="chap-vulnerability-roundup" class="title">Vulnerability Roundup   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#chap-vulnerability-roundup" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <p><strong>Table of Contents</strong></p> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#vulnerability-roundup-issues">Issues</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#vulnerability-roundup-triaging-and-fixing">Triaging and Fixing</a> </span></dt> </dl></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/README.md" target="_top">pkgs/README.md</a>.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="vulnerability-roundup-issues" class="title" style="clear: both">Issues   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#vulnerability-roundup-issues" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/README.md" target="_top">pkgs/README.md</a>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="vulnerability-roundup-triaging-and-fixing" class="title" style="clear: both">Triaging and Fixing   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#vulnerability-roundup-triaging-and-fixing" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/README.md" target="_top">pkgs/README.md</a>.</p>
</div>

</div><div class="chapter"> <div class="titlepage">  <div>   <div>    <h2 id="chap-reviewing-contributions" class="title">Reviewing contributions   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#chap-reviewing-contributions" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <p><strong>Table of Contents</strong></p> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#reviewing-contributions-package-updates">Package updates</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#reviewing-contributions-new-packages">New packages</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#reviewing-contributions-module-updates">Module updates</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#reviewing-contributions-new-modules">New modules</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#reviewing-contributions-individual-maintainer-list">Individual maintainer list</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#reviewing-contributions-maintainer-teams">Maintainer teams</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#reviewing-contributions-other-submissions">Other submissions</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#reviewing-contributions--merging-pull-requests">Merging pull requests</a> </span></dt> </dl></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/CONTRIBUTING.md" target="_top">CONTRIBUTING.md</a>.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="reviewing-contributions-package-updates" class="title" style="clear: both">Package updates   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#reviewing-contributions-package-updates" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/README.md" target="_top">pkgs/README.md</a>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="reviewing-contributions-new-packages" class="title" style="clear: both">New packages   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#reviewing-contributions-new-packages" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/README.md" target="_top">pkgs/README.md</a>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="reviewing-contributions-module-updates" class="title" style="clear: both">Module updates   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#reviewing-contributions-module-updates" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/nixos/README.md" target="_top">nixos/README.md</a>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="reviewing-contributions-new-modules" class="title" style="clear: both">New modules   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#reviewing-contributions-new-modules" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/nixos/README.md" target="_top">nixos/README.md</a>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="reviewing-contributions-individual-maintainer-list" class="title" style="clear: both">Individual maintainer list   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#reviewing-contributions-individual-maintainer-list" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/maintainers/README.md" target="_top">maintainers/README.md</a>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="reviewing-contributions-maintainer-teams" class="title" style="clear: both">Maintainer teams   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#reviewing-contributions-maintainer-teams" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/maintainers/README.md" target="_top">maintainers/README.md</a>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="reviewing-contributions-other-submissions" class="title" style="clear: both">Other submissions   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#reviewing-contributions-other-submissions" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/CONTRIBUTING.md" target="_top">CONTRIBUTING.md</a>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="reviewing-contributions--merging-pull-requests" class="title" style="clear: both">Merging pull requests   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#reviewing-contributions--merging-pull-requests" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/CONTRIBUTING.md" target="_top">CONTRIBUTING.md</a>.</p>
</div>

</div><div class="chapter"> <div class="titlepage">  <div>   <div>    <h2 id="chap-contributing" class="title">Contributing to Nixpkgs documentation   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#chap-contributing" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><div class="toc"> <p><strong>Table of Contents</strong></p> <dl class="toc">  <dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-contributing-devmode">devmode</a> </span></dt><dt> <span class="section">  <a href="https://nixos.org/manual/nixpkgs/stable/#sec-contributing-markup">Syntax</a> </span></dt> </dl></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/doc/README.md" target="_top">doc/README.md</a>.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-contributing-devmode" class="title" style="clear: both">devmode   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-contributing-devmode" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/doc/README.md" target="_top">doc/README.md</a>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-contributing-markup" class="title" style="clear: both">Syntax   <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="https://nixos.org/manual/nixpkgs/stable/#sec-contributing-markup" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>  </div> </div></div><p>This section has been moved to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/doc/README.md" target="_top">doc/README.md</a>.</p>
</div>

</div>
</div>
 </div>

 
  <script src="./Nixpkgs Manual_files/manual-version-switch.js"></script><div style="background: #333333;color: #FFFFFF;padding: 0.5em 1em;position: fixed;bottom: 0.5em;right: 0.5em;font-size: 0.8em;"><div style="text-align: right;cursor: pointer;"><span>v: stable</span> <strong aria-hidden="true">＋</strong><strong style="display: none;" aria-hidden="true">－</strong></div><dl style="width: 240px;margin: 0 0 1em 0;display: none;"><dt style="color: #999999;">Channels:</dt><dd style="display: inline-block;margin-left: 1em;"><a style="color: #FFFFFF;font-weight: bold;text-decoration: none;" href="https://nixos.org/manual/nixpkgs/unstable">unstable (24.05)</a></dd><dd style="display: inline-block;margin-left: 1em;"><a style="color: #FFFFFF;font-weight: bold;text-decoration: none;" href="https://nixos.org/manual/nixpkgs/stable">stable (23.11)</a></dd></dl></div>

</body></html>