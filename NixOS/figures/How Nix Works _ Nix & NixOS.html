<!DOCTYPE html>
<!-- saved from url=(0039)https://nixos.org/guides/how-nix-works/ -->
<html lang="en" data-astro-cid-sckkx6r4=""><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>How Nix Works | Nix &amp; NixOS</title><link rel="canonical" href="https://nixos.org/guides/how-nix-works/"><meta name="description" content="Nix is a tool that takes a unique approach to package management and system configuration. Learn how to make reproducible, declarative and reliable systems."><meta name="robots" content="index, follow"><link rel="sitemap" href="https://nixos.org/sitemap-index.xml"><link rel="icon" href="https://nixos.org/_astro/flake-blue.Bf2X2kC4_Z1yqDoT.svg" type="image/svg+xml"><link rel="alternate" type="application/rss+xml" title="Complete RSS Feed" href="https://nixos.org/blog/feed.xml"><link rel="alternate" type="application/rss+xml" title="Newsletters RSS Feed" href="https://nixos.org/blog/newsletters-rss.xml"><link rel="alternate" type="application/rss+xml" title="Announcements RSS Feed" href="https://nixos.org/blog/announcements-rss.xml"><link rel="alternate" type="application/rss+xml" title="Stories RSS Feed" href="https://nixos.org/blog/stories-rss.xml"><meta name="viewport" content="width=device-width"><meta name="generator" content="Astro v4.5.9"><meta name="google-site-verification" content="ir-07nYvo3u3x_VmkTO1wCfYJ8uC-SrVBGR7hZgqPSE"><link rel="stylesheet" href="./How Nix Works _ Nix &amp; NixOS_files/hoisted.CRUcWqPs.css">
<link rel="stylesheet" href="./How Nix Works _ Nix &amp; NixOS_files/blog.B9uh496O.css">
<link rel="stylesheet" href="./How Nix Works _ Nix &amp; NixOS_files/event-funding.BA7gmdE4.css"><script type="module" src="./How Nix Works _ Nix &amp; NixOS_files/hoisted.CJN1g1GC.js"></script><style>                      .htmx-indicator{opacity:0}                      .htmx-request .htmx-indicator{opacity:1; transition: opacity 200ms ease-in;}                      .htmx-request.htmx-indicator{opacity:1; transition: opacity 200ms ease-in;}                    </style></head> <body class="min-h-screen flex flex-col bg-white text-gray-950 vsc-initialized" data-astro-cid-sckkx6r4=""> <header role="banner" class="bg-white text-black font-extralight drop-shadow-[0_8px_2px_rgba(0,0,0,0.2)]"> <div class="md:mx-auto px-4 sm:max-w-[736px] md:max-w-[960px] lg:max-w-[1168px] flex flex-col md:flex-row justify-between md:items-center">  <div class="text-4xl font-normal gap-2 flex justify-between md:justify-start items-center my-2"> <a href="https://nixos.org/" class="select-none gap-2 flex justify-between md:justify-start items-center"> <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="svg2" version="1.1" viewBox="0 0 547.76 484.317" class="h-16 w-auto" alt="Nixos Logo"><defs id="defs4"><lineargradient id="linearGradient5562"><stop id="stop5564" offset="0" style="stop-color:#699ad7;stop-opacity:1"></stop><stop id="stop5566" offset=".243" style="stop-color:#7eb1dd;stop-opacity:1"></stop><stop id="stop5568" offset="1" style="stop-color:#7ebae4;stop-opacity:1"></stop></lineargradient><lineargradient id="linearGradient5053"><stop id="stop5055" offset="0" style="stop-color:#415e9a;stop-opacity:1"></stop><stop id="stop5057" offset=".232" style="stop-color:#4a6baf;stop-opacity:1"></stop><stop id="stop5059" offset="1" style="stop-color:#5277c3;stop-opacity:1"></stop></lineargradient><lineargradient id="linearGradient5960"><stop id="stop5962" offset="0" style="stop-color:#637ddf;stop-opacity:1"></stop><stop id="stop5964" offset=".232" style="stop-color:#649afa;stop-opacity:1"></stop><stop id="stop5966" offset="1" style="stop-color:#719efa;stop-opacity:1"></stop></lineargradient><lineargradient xlink:href="#linearGradient5960" id="linearGradient5855" x1="213.956" x2="282.261" y1="338.624" y2="515.971" gradientTransform="translate(983.36 601.389)" gradientUnits="userSpaceOnUse"></lineargradient><lineargradient xlink:href="#linearGradient5562" id="linearGradient5384" x1="200.597" x2="290.087" y1="351.411" y2="506.188" gradientTransform="translate(70.65 -1055.151)" gradientUnits="userSpaceOnUse"></lineargradient><lineargradient xlink:href="#linearGradient5053" id="linearGradient5386" x1="-584.199" x2="-496.297" y1="782.336" y2="937.714" gradientTransform="translate(864.696 -1491.34)" gradientUnits="userSpaceOnUse"></lineargradient></defs><g id="layer1" style="display:inline" transform="translate(-132.582 958.04)"><path id="path4861" d="M309.404-710.252 431.6-498.577l-56.157.527-32.623-56.87-32.857 56.566-27.902-.011-14.29-24.69 46.81-80.49-33.23-57.826z" style="color:#000;clip-rule:nonzero;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:#000;solid-opacity:1;fill:#5277c3;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:3;stroke-linecap:butt;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto;enable-background:accumulate"></path><path id="use4863" d="M353.51-797.443 231.291-585.78l-28.535-48.37 32.938-56.688-65.415-.172-13.941-24.17 14.236-24.72 93.112.293 33.464-57.69z" style="color:#000;clip-rule:nonzero;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:#000;solid-opacity:1;fill:#7ebae4;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:3;stroke-linecap:butt;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto;enable-background:accumulate"></path><path id="use4865" d="m362.885-628.243 244.415.012-27.623 48.897-65.562-.182 32.56 56.737-13.962 24.159-28.527.032-46.301-80.784-66.693-.136z" style="color:#000;clip-rule:nonzero;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:#000;solid-opacity:1;fill:#7ebae4;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:3;stroke-linecap:butt;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto;enable-background:accumulate"></path><path id="use4867" d="M505.143-720.989 382.946-932.664l56.157-.527 32.624 56.87 32.856-56.566 27.903.011 14.29 24.69-46.81 80.49 33.23 57.826z" style="color:#000;clip-rule:nonzero;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:#000;solid-opacity:1;fill:#7ebae4;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:3;stroke-linecap:butt;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto;enable-background:accumulate"></path><path id="path4873" d="M309.404-710.252 431.6-498.577l-56.157.527-32.623-56.87-32.857 56.566-27.902-.011-14.29-24.69 46.81-80.49-33.23-57.826z" style="color:#000;clip-rule:nonzero;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:#000;solid-opacity:1;fill:#5277c3;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:3;stroke-linecap:butt;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto;enable-background:accumulate"></path><path id="use4875" d="m451.336-803.533-244.414-.012 27.622-48.896 65.562.181-32.558-56.737 13.96-24.158 28.528-.032 46.301 80.784 66.693.135z" style="color:#000;clip-rule:nonzero;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:#000;solid-opacity:1;fill:#5277c3;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:3;stroke-linecap:butt;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto;enable-background:accumulate"></path><path id="use4877" d="m460.872-633.842 122.217-211.664 28.535 48.37-32.938 56.688 65.415.172 13.941 24.17-14.236 24.72-93.112-.293-33.464 57.69z" style="color:#000;clip-rule:nonzero;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:#000;solid-opacity:1;fill:#5277c3;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:3;stroke-linecap:butt;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto;enable-background:accumulate"></path></g><g id="layer3" style="display:inline;opacity:1" transform="translate(-132.582 958.04)"><path id="path3336-6" d="m309.549-710.388 122.197 211.675-56.157.527-32.624-56.87-32.856 56.566-27.903-.011-14.29-24.69 46.81-80.49-33.23-57.826z" style="opacity:1;fill:url(#linearGradient5384);fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:3;stroke-linecap:butt;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"></path><use xlink:href="#path3336-6" id="use3439-6" width="100%" height="100%" x="0" y="0" transform="rotate(60 407.112 -715.787)"></use><use xlink:href="#path3336-6" id="use3445-0" width="100%" height="100%" x="0" y="0" transform="rotate(-60 407.312 -715.7)"></use><use xlink:href="#path3336-6" id="use3449-5" width="100%" height="100%" x="0" y="0" transform="rotate(180 407.419 -715.756)"></use><path id="path4260-0" d="m309.549-710.388 122.197 211.675-56.157.527-32.624-56.87-32.856 56.566-27.903-.011-14.29-24.69 46.81-80.49-33.23-57.826z" style="color:#000;clip-rule:nonzero;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:#000;solid-opacity:1;fill:url(#linearGradient5386);fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:3;stroke-linecap:butt;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto;enable-background:accumulate"></path><use xlink:href="#path4260-0" id="use4354-5" width="100%" height="100%" x="0" y="0" style="display:inline" transform="rotate(120 407.34 -716.084)"></use><use xlink:href="#path4260-0" id="use4362-2" width="100%" height="100%" x="0" y="0" style="display:inline" transform="rotate(-120 407.288 -715.87)"></use></g></svg> <svg xmlns="http://www.w3.org/2000/svg" id="svg2" version="1.1" viewBox="0 0 586.737 484.317" class="h-16 block md:hidden xl:block w-auto" alt="Nixos Logo Text"><g id="g5329" style="display:inline" transform="translate(-132.582 958.04)"><g id="text5407" aria-label="Nix" style="font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:395.097px;line-height:125%;font-family:Carlito;-inkscape-font-specification:Carlito;letter-spacing:0;word-spacing:0;display:inline;opacity:1;fill:#000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" transform="translate(-614.208)"><path id="path4683" d="M969.153-847.118h-30.817v139.864c0 19.755.79 50.967 1.975 85.736h-1.185c-15.409-28.842-32.793-56.499-45.041-75.464l-96.799-150.136h-42.275v267.875h30.817v-139.864c0-19.755-.79-56.894-1.975-91.267h1.185c22.916 39.904 36.349 62.03 48.992 80.995l96.799 150.136h38.324z" style="font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-family:Vegur;-inkscape-font-specification:Vegur"></path><path id="path4685" d="M1027.825-579.243h33.188V-770.47h-33.188zm16.594-219.278c11.458 0 20.545-9.088 20.545-20.545 0-11.458-9.087-20.545-20.545-20.545-11.458 0-20.545 9.087-20.545 20.545 0 11.457 9.087 20.545 20.545 20.545z" style="font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-family:Vegur;-inkscape-font-specification:Vegur"></path><path id="path4687" d="M1267.779-770.47h-37.93l-46.621 70.328h-1.186l-45.04-70.328h-41.09l68.351 93.243v1.186l-70.722 96.798h37.93l49.781-75.858h1.186l49.782 75.858h41.09l-72.303-98.379v-1.185z" style="font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-family:Vegur;-inkscape-font-specification:Vegur"></path></g></g></svg> </a> <button aria-label="Main Navigation Toggle" class="bg-nixlightblue block md:hidden p-4 rounded-lg" id="navigation-toggle"> <span class="bg-white block w-8 h-1 mb-1.5"></span> <span class="bg-white block w-8 h-1 mb-1.5"></span> <span class="bg-white block w-8 h-1"></span> </button> </div> <nav aria-label="Main Navigation" role="menubar" class="pb-4 md:pb-0 flex-col md:flex-row gap-0.5 md:gap-5 md:flex hidden" id="navbar-menu"> <a class="pt-8 pb-6 text-center text-nixsemidarkblue md:text-black md:hover:border-b-nixlightblue border-b-4 border-b-nixlighterblue md:border-b-transparent bg-nixlighterblue md:bg-transparent" href="https://nixos.org/explore">Explore</a><a class="pt-8 pb-6 text-center text-nixsemidarkblue md:text-black md:hover:border-b-nixlightblue border-b-4 border-b-nixlighterblue md:border-b-transparent bg-nixlighterblue md:bg-transparent" href="https://nixos.org/download">Download</a><a class="pt-8 pb-6 text-center text-nixsemidarkblue md:text-black md:hover:border-b-nixlightblue border-b-4 border-b-nixlighterblue md:border-b-transparent bg-nixlighterblue md:bg-transparent" href="https://nixos.org/learn">Learn</a><a class="pt-8 pb-6 text-center text-nixsemidarkblue md:text-black md:hover:border-b-nixlightblue border-b-4 border-b-nixlighterblue md:border-b-transparent bg-nixlighterblue md:bg-transparent" href="https://nixos.org/community">Community</a><a class="pt-8 pb-6 text-center text-nixsemidarkblue md:text-black md:hover:border-b-nixlightblue border-b-4 border-b-nixlighterblue md:border-b-transparent bg-nixlighterblue md:bg-transparent" href="https://nixos.org/blog">Blog</a><a class="pt-8 pb-6 text-center text-nixsemidarkblue md:text-black md:hover:border-b-nixlightblue border-b-4 border-b-nixlighterblue md:border-b-transparent bg-nixlighterblue md:bg-transparent" href="https://nixos.org/donate">Donate</a> <a target="_blank" rel="noreferrer noopener" class="pt-8 md:pt-7 pb-6 text-center text-nixsemidarkblue md:text-black md:hover:border-b-nixlightblue border-b-4 border-b-nixlighterblue md:border-b-transparent bg-nixlighterblue md:bg-transparent" href="https://search.nixos.org/" arial-label="Nixos package and options search"> <svg width="1em" height="1em" viewBox="0 0 24 24" alt="Search" class="h-8 w-8 text-nixdarkblue hidden md:block" data-icon="mdi:search">  <symbol id="ai:mdi:search"><path fill="currentColor" d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5l-1.5 1.5l-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16A6.5 6.5 0 0 1 3 9.5A6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14S14 12 14 9.5S12 5 9.5 5"></path></symbol><use xlink:href="#ai:mdi:search"></use>  </svg> <span class="inline-block md:hidden">Search</span> </a> </nav>  </div> </header> <script lang="ts">
    const navigationToggle= document.getElementById("navigation-toggle");
    const navbarMenu = document.getElementById("navbar-menu");

    function toggleMenu() {
        navbarMenu.classList.toggle("hidden");
        navbarMenu.classList.toggle("flex")
    }
    toggleMenu();

    navigationToggle.addEventListener("click", () => toggleMenu());
</script> <main class="flex-1" data-astro-cid-sckkx6r4="">  <div class="inline-svg-header-nixdarkblue bg-bottom bg-no-repeat bg-cover py-24 hidden md:block"> <div class="md:mx-auto px-4 sm:max-w-[736px] md:max-w-[960px] lg:max-w-[1168px] text-white grid grid-cols-3">  <div class="flex flex-col gap-4 col-span-2"> <a href="https://nixos.org/learn" class="!text-white -mb-4 -mt-6 invisible md:visible"> <span class="text-nixblue">←</span> Back
</a> <h1 class="text-4xl font-bold font-heading text-left"> How Nix Works </h1>  </div>  </div> </div> <div class="bg-nixdarkblue text-white md:hidden"> <div class="md:mx-auto px-4 sm:max-w-[736px] md:max-w-[960px] lg:max-w-[1168px] px-12 py-16">  <h1 class="text-3xl font-bold text-center"> How Nix Works </h1>  </div> </div> <div class="md:mx-auto px-4 sm:max-w-[736px] md:max-w-[960px] lg:max-w-[1168px] my-8">  <article> <p>Nix is a <em>purely functional package manager</em>. This means that it treats packages like values in purely functional programming languages such as Haskell — they are built by functions that don’t have side-effects, and they never change after they have been built. Nix stores packages in the <em>Nix store</em>, usually the directory <code>/nix/store</code>, where each package has its own unique subdirectory such as</p>
<pre class="border-1 bg-[#3a3a3a] px-4 py-4 rounded-3xl my-2 mb-4 overflow-x-auto font-mono font-[500] bg-nixlighterblue border-nixlighterblue text-black shadow-[inset_0_0_1rem_0_rgba(0,0,0,0.1)]"><code class="font-bold bg-transparent border-none w-full p-0"></code><span>/nix/store/b6gvzjyb2pg0kjfwrjmg1vfhh54ad73z-firefox-33.1/</span>
</pre>
<p>where <code>b6gvzjyb2pg0…</code> is a unique identifier for the package that captures all its dependencies (it’s a cryptographic hash of the package’s build dependency graph). This enables many powerful features.</p>
<h2 id="multiple-versions">Multiple versions</h2>
<p>You can have multiple versions or variants of a package installed at the same time. This is especially important when different applications have dependencies on different versions of the same package — it prevents the “DLL hell”. Because of the hashing scheme, different versions of a package end up in different paths in the Nix store, so they don’t interfere with each other.</p>
<p>An important consequence is that operations like upgrading or uninstalling an application cannot break other applications, since these operations never “destructively” update or delete files that are used by other packages.</p>
<h2 id="complete-dependencies">Complete dependencies</h2>
<p>When you’re making a package for a package management system, like RPM, you are supposed to declare its dependencies, but you can’t easily guarantee that your dependency declaration is complete. If you forget a dependency, that you have separately installed on your machine, then the component may build and work correctly on <em>your</em> machine, but failing on the end user’s machine.</p>
<p>Nix ensures that package dependency specifications are complete.</p>
<p>Under Nix, a build process will only find resources that have been declared explicitly as dependencies. There’s no way it can build until everything it needs has been correctly declared. If it builds, you will know you’ve provided a complete declaration.</p>
<p>Once a build is complete, ongoing runtime dependencies are detected automatically.</p>
<h2 id="multi-user-support">Multi-user support</h2>
<p>Starting at version 0.11, Nix has multi-user support. This means that non-privileged users can securely install software. Each user can have a different <em>profile</em>, a set of packages in the Nix store that appear in the user’s PATH. If a user installs a package that another user has already installed previously, the package won’t be built or downloaded a second time. At the same time, it is not possible for one user to inject a Trojan horse into a package that might be used by another user.</p>
<h2 id="atomic-upgrades-and-rollbacks">Atomic upgrades and rollbacks</h2>
<p>Since package management operations never overwrite packages in the Nix store but just add new versions in different paths, they are <em>atomic</em>. So during a package upgrade, there is no time window in which the package has some files from the old version and some files from the new version — which would be bad because a program might well crash if it’s started during that period.</p>
<p>And since packages aren’t overwritten, the old versions are still there after an upgrade. This means that you can <em>roll back</em> to the old version:</p>
<pre class="astro-code vesper" style="background-color:#3a3a3a;color:#6ad541;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FFAB0D">$</span><span style="color:#FFFFFF"> nix-env</span><span style="color:#FFFFFF"> --upgrade</span><span style="color:#FFFFFF"> _some-packages_</span></span>
<span class="line"><span style="color:#FFAB0D">$</span><span style="color:#FFFFFF"> nix-env</span><span style="color:#FFFFFF"> --rollback</span></span>
<span class="line"></span></code></pre>
<h2 id="garbage-collection">Garbage collection</h2>
<p>When you uninstall a package like this…</p>
<pre class="astro-code vesper" style="background-color:#3a3a3a;color:#6ad541;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FFAB0D">$</span><span style="color:#FFFFFF"> nix-env</span><span style="color:#FFFFFF"> --uninstall</span><span style="color:#FFFFFF"> firefox</span></span>
<span class="line"></span></code></pre>
<p>the package isn’t deleted from the system right away (after all, you might want to do a rollback, or it might be in the profiles of other users). Instead, unused packages can be deleted safely by running the <em>garbage collector</em>:</p>
<pre class="astro-code vesper" style="background-color:#3a3a3a;color:#6ad541;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FFAB0D">$</span><span style="color:#FFFFFF"> nix-collect-garbage</span></span>
<span class="line"></span></code></pre>
<p>This deletes all packages that aren’t in use by any user profile or by a currently running program.</p>
<h2 id="functional-package-language">Functional package language</h2>
<p>Packages are built from <em>Nix expressions</em>, which is a simple functional language. A Nix expression describes everything that goes into a package build action (a “derivation”): other packages, sources, the build script, environment variables for the build script, etc. Nix tries very hard to ensure that Nix expressions are <em>deterministic</em>: building a Nix expression twice should yield the same result.</p>
<p>Because it’s a functional language, it’s easy to support building variants of a package: turn the Nix expression into a function and call it any number of times with the appropriate arguments. Due to the hashing scheme, variants don’t conflict with each other in the Nix store.</p>
<h2 id="transparent-sourcebinary-deployment">Transparent source/binary deployment</h2>
<p>Nix expressions generally describe how to build a package from source, so an installation action like</p>
<pre class="astro-code vesper" style="background-color:#3a3a3a;color:#6ad541;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FFAB0D">$</span><span style="color:#FFFFFF"> nix-env</span><span style="color:#FFFFFF"> --install</span><span style="color:#FFFFFF"> firefox</span></span>
<span class="line"></span></code></pre>
<p><em>could</em> cause quite a bit of build activity, as not only Firefox but also all its dependencies (all the way up to the C library and the compiler) would have to built, at least if they are not already in the Nix store. This is a <em>source deployment model</em>. For most users, building from source is not very pleasant as it takes far too long. However, Nix can automatically skip building from source and instead use a <em>binary cache</em>, a web server that provides pre-built binaries. For instance, when asked to build <code>/nix/store/b6gvzjyb2pg0…-firefox-33.1</code> from source, Nix would first check if the file <a href="http://cache.nixos.org/b6gvzjyb2pg0%E2%80%A6.narinfo">http://cache.nixos.org/b6gvzjyb2pg0….narinfo</a> exists, and if so, fetch the pre-built binary referenced from there; otherwise, it would fall back to building from source.</p>
<h2 id="nix-packages-collection">Nix Packages collection</h2>
<p>We provide a large set of Nix expressions containing thousands of existing Unix packages, the <a href="https://github.com/NixOS/nixpkgs"><em>Nix Packages collection</em> (Nixpkgs)</a>.</p>
<h2 id="portability">Portability</h2>
<p>Nix runs on Linux and macOS.</p>
<h1 id="how-nixos-works">How NixOS works?</h1>
<p>NixOS is based on <a href="https://nixos.org/">Nix</a>, a purely functional package management system. Nix stores all packages in isolation from each other under paths such as</p>
<pre class="border-1 bg-[#3a3a3a] px-4 py-4 rounded-3xl my-2 mb-4 overflow-x-auto font-mono font-[500] bg-nixlighterblue border-nixlighterblue text-black shadow-[inset_0_0_1rem_0_rgba(0,0,0,0.1)]"><code class="font-bold bg-transparent border-none w-full p-0"></code><span>/nix/store/5rnfzla9kcx4mj5zdc7nlnv8na1najvg-firefox-3.5.4/</span>
</pre>
<p>The string <code>5rnf...</code> is a cryptographic hash of all input used to build the package. Packages are never overwritten after they have been built; instead, if you change the build description of a package (its ‘Nix expression’), it’s rebuilt and installed in a different path in <code>/nix/store</code> so it doesn’t interfere with the old version. NixOS extends this by using Nix not only to build packages, but also things like configuration files. For instance, the configuration of the SSH daemon is also built from a Nix expression and stored under a path like</p>
<pre class="border-1 bg-[#3a3a3a] px-4 py-4 rounded-3xl my-2 mb-4 overflow-x-auto font-mono font-[500] bg-nixlighterblue border-nixlighterblue text-black shadow-[inset_0_0_1rem_0_rgba(0,0,0,0.1)]"><code class="font-bold bg-transparent border-none w-full p-0"></code><span>/nix/store/s2sjbl85xnrc18rl4fhn56irkxqxyk4p-sshd\_config</span>
</pre>
<p>By building entire system configurations from a Nix expression, NixOS ensures that such configurations don’t overwrite each other, can be rolled back, and so on.</p>
<p>A big implication of the way that Nix/NixOS stores packages is that there is no <code>/bin</code>, <code>/sbin</code>, <code>/lib</code>, <code>/usr</code>, and so on. Instead all packages are kept in <code>/nix/store</code>. (The only exception is a symlink <code>/bin/sh</code> to Bash in the Nix store.) Not using ‘global’ directories such as <code>/bin</code> is what allows multiple versions of a package to coexist. Nix does have a <code>/etc</code> to keep system-wide configuration files, but most files in that directory are symlinks to generated files in <code>/nix/store</code>.</p>
<h2 id="declarative-system-configuration-model">Declarative system configuration model</h2>
<p>In NixOS, the entire operating system — the kernel, applications, system packages, configuration files, and so on — is built by the <a href="https://nixos.org/">Nix package manager</a> from a description in a purely functional build language. The fact that it’s purely functional essentially means that building a new configuration cannot overwrite previous configurations. Most of the other features follow from this.</p>
<p>You configure a NixOS system by writing a specification of the functionality that you want on your machine in <code>/etc/nixos/configuration.nix</code>. For instance, here is a minimal configuration of a machine running an SSH daemon:</p>
<pre class="astro-code vesper" style="background-color:#3a3a3a;color:#6ad541;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#6AD541">{</span></span>
<span class="line"><span style="color:#7EBAE4">  boot</span><span style="color:#6AD541">.</span><span style="color:#7EBAE4">loader</span><span style="color:#6AD541">.</span><span style="color:#7EBAE4">grub</span><span style="color:#6AD541">.</span><span style="color:#7EBAE4">device</span><span style="color:#7EBAE4"> =</span><span style="color:#FFFFFF"> "/dev/sda"</span><span style="color:#6AD541">;</span></span>
<span class="line"><span style="color:#7EBAE4">  fileSystems</span><span style="color:#6AD541">.</span><span style="color:#FFFFFF">"/"</span><span style="color:#6AD541">.</span><span style="color:#7EBAE4">device</span><span style="color:#7EBAE4"> =</span><span style="color:#FFFFFF"> "/dev/sda1"</span><span style="color:#6AD541">;</span></span>
<span class="line"><span style="color:#7EBAE4">  services</span><span style="color:#6AD541">.</span><span style="color:#7EBAE4">sshd</span><span style="color:#6AD541">.</span><span style="color:#7EBAE4">enable</span><span style="color:#7EBAE4"> =</span><span style="color:#6AD541"> true;</span></span>
<span class="line"><span style="color:#6AD541">}</span></span>
<span class="line"></span></code></pre>
<p>After changing <code>/etc/nixos/configuration.nix</code>, you realise the configuration by running this command:</p>
<pre class="astro-code vesper" style="background-color:#3a3a3a;color:#6ad541;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FFAB0D">$</span><span style="color:#FFFFFF"> nixos-rebuild</span><span style="color:#FFFFFF"> switch</span></span>
<span class="line"></span></code></pre>
<p>This command does everything necessary to make the configuration happen, including downloading and compiling OpenSSH, generating the configuration files for the SSH server, and so on.</p>
<h2 id="reliable-upgrades">Reliable upgrades</h2>
<p>Another advantage of purely functional package management is that <code>nixos-rebuild switch</code> will always produce the same result, regardless of what packages or configuration files you already had on your system. Thus, upgrading a system is as reliable as reinstalling from scratch.</p>
<h2 id="atomic-upgrades">Atomic upgrades</h2>
<p>NixOS has a <em>transactional</em> approach to configuration management: configuration changes such as upgrades are <em>atomic</em>. This means that if the upgrade to a new configuration is interrupted — say, the power fails half-way through — the system will still be in a consistent state: it will either boot in the old or the new configuration. In most other systems, you’ll end up in an inconsistent state, and your machine may not even boot anymore.</p>
<h2 id="rollbacks">Rollbacks</h2>
<p>Because the files of a new configuration don’t overwrite old ones, you can (atomically) roll back to a previous configuration. For instance, if after a <code>nixos-rebuild switch</code> you discover that you don’t like the new configuration, you can just go back:</p>
<pre class="astro-code vesper" style="background-color:#3a3a3a;color:#6ad541;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FFAB0D">$</span><span style="color:#FFFFFF"> nixos-rebuild</span><span style="color:#FFFFFF"> switch</span><span style="color:#FFFFFF"> --rollback</span></span>
<span class="line"></span></code></pre>
<p><a href="./How Nix Works _ Nix &amp; NixOS_files/nixos-grub.png"><img src="./How Nix Works _ Nix &amp; NixOS_files/nixos-grub.png" alt="Grub boot menu"></a></p>
<p>In fact, all old system configurations automatically show up in the Grub boot menu. So if the new configuration crashes or doesn’t boot properly, you can just roll back by selecting an older configuration in the <a href="./How Nix Works _ Nix &amp; NixOS_files/nixos-grub.png">Grub boot menu</a>. Rollbacks are very fast: it doesn’t involve lots of files having to be restored from copies.</p>
<h2 id="reproducible-system-configurations">Reproducible system configurations</h2>
<p>NixOS’ declarative configuration model makes it easy to reproduce a system configuration on another machine (for instance, to test a change in a test environment before doing it on the production server). You just copy the <code>configuration.nix</code> file to the target NixOS machine and run <code>nixos-rebuild switch</code>. This will give you the same configuration (kernel, applications, system services, and so on) except for ‘mutable state’ (such as the stuff that lives in <code>/var</code>).</p>
<h2 id="safe-to-test-changes">Safe to test changes</h2>
<p>NixOS makes it safe to test potentially dangerous changes to the system, because you can always roll back. (Unless you screw up the boot loader, that is…) For instance, whether the change is as simple as enabling a system service, or as large as rebuilding the entire system with a new version of Glibc, you can test it by doing:</p>
<pre class="astro-code vesper" style="background-color:#3a3a3a;color:#6ad541;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FFAB0D">$</span><span style="color:#FFFFFF"> nixos-rebuild</span><span style="color:#FFFFFF"> test</span></span>
<span class="line"></span></code></pre>
<p>This builds and activates the new configuration, but doesn’t make it the boot default. Thus, rebooting the system will take you back to the previous, known-good configuration.</p>
<p>An even nicer way to test changes is the following:</p>
<pre class="astro-code vesper" style="background-color:#3a3a3a;color:#6ad541;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FFAB0D">$</span><span style="color:#FFFFFF"> nixos-rebuild</span><span style="color:#FFFFFF"> build-vm</span></span>
<span class="line"><span style="color:#FFAB0D">$</span><span style="color:#FFFFFF"> ./result/bin/run-</span><span style="color:#7EBAE4">\*</span><span style="color:#FFFFFF">-vm</span></span>
<span class="line"></span></code></pre>
<p>This builds and starts a virtual machine that contains the new system configuration (i.e. a clone of the configuration of the host machine, with any changes that you made to configuration.nix). The VM doesn’t share any data with the host, so you can safely experiment inside the VM. The <code>build-vm</code> command is very efficient (it doesn’t require a disk image for the VM to be created), so it’s a very effective way to test changes.</p> </article>  </div>  </main> <footer> <div class="bg-nixdarkerblue text-white font-light clear-both"> <div class="md:mx-auto px-4 sm:max-w-[736px] md:max-w-[960px] lg:max-w-[1168px] undefined">  <div class="flex flex-col sm:flex-row flex-wrap py-8 gap-y-8"> <div class="basis-1/2 lg:basis-1/4"> <h4 class="text-xl font-bold font-heading text-nixdarkblue mb-4">The Project</h4> <ul class="space-y-2 font-extralight"> <li><a href="https://status.nixos.org/">Channel Status</a></li><li><a href="https://search.nixos.org/packages">Packages search</a></li><li><a href="https://search.nixos.org/options">Options search</a></li><li><a href="https://reproducible.nixos.org/">Reproducible Builds Status</a></li><li><a href="https://nixos.org/community/teams/security">Security</a></li> </ul> </div><div class="basis-1/2 lg:basis-1/4"> <h4 class="text-xl font-bold font-heading text-nixdarkblue mb-4">Get in Touch</h4> <ul class="space-y-2 font-extralight"> <li><a href="https://discourse.nixos.org/">Forum</a></li><li><a href="https://matrix.to/#/#community:nixos.org">Matrix Chat</a></li><li><a href="https://nixos.org/community/commercial-support">Commercial support</a></li> </ul> </div><div class="basis-1/2 lg:basis-1/4"> <h4 class="text-xl font-bold font-heading text-nixdarkblue mb-4">Contribute</h4> <ul class="space-y-2 font-extralight"> <li><a href="https://nix.dev/contributing/how-to-contribute">Contributing Guide</a></li><li><a href="https://nixos.org/donate">Donate</a></li> </ul> </div><div class="basis-1/2 lg:basis-1/4"> <h4 class="text-xl font-bold font-heading text-nixdarkblue mb-4">Stay up to Date</h4> <ul class="space-y-2 font-extralight"> <li><a href="https://nixos.org/blog/">Blog</a></li><li><a href="https://weekly.nixos.org/">Newsletter</a></li> </ul> </div> </div> <hr class="border-nixlightblue"> <div class="flex flex-col lg:flex-row flex-wrap py-8 gap-8 lg:gap-0 font-extralight"> <div class="basis-1/2 flex flex-row flex flex-row gap-2"> <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 550.416 484.317" class="inline-block w-16 h-16"><defs><lineargradient id="a"><stop offset="0" style="stop-color:#fff;stop-opacity:1"></stop><stop offset=".243" style="stop-color:#fff;stop-opacity:1"></stop><stop offset="1" style="stop-color:#fff;stop-opacity:1"></stop></lineargradient><lineargradient id="b"><stop offset="0" style="stop-color:#fff;stop-opacity:1"></stop><stop offset=".232" style="stop-color:#fff;stop-opacity:1"></stop><stop offset="1" style="stop-color:#fff;stop-opacity:1"></stop></lineargradient><lineargradient xlink:href="#a" id="c" x1="200.597" x2="290.087" y1="351.411" y2="506.188" gradientTransform="translate(70.65 -1055.151)" gradientUnits="userSpaceOnUse"></lineargradient><lineargradient xlink:href="#b" id="e" x1="-584.199" x2="-496.297" y1="782.336" y2="937.714" gradientTransform="translate(864.696 -1491.34)" gradientUnits="userSpaceOnUse"></lineargradient></defs><g style="display:inline;opacity:1" transform="translate(-132.651 958.04)"><path id="d" d="m309.549-710.388 122.197 211.675-56.157.527-32.624-56.87-32.856 56.566-27.903-.011-14.29-24.69 46.81-80.49-33.23-57.826z" style="opacity:1;fill:url(#c);fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:3;stroke-linecap:butt;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"></path><use xlink:href="#d" width="100%" height="100%" transform="rotate(60 407.112 -715.787)"></use><use xlink:href="#d" width="100%" height="100%" transform="rotate(-60 407.312 -715.7)"></use><use xlink:href="#d" width="100%" height="100%" transform="rotate(180 407.419 -715.756)"></use><path id="f" d="m309.549-710.388 122.197 211.675-56.157.527-32.624-56.87-32.856 56.566-27.903-.011-14.29-24.69 46.81-80.49-33.23-57.826z" style="color:#fff;clip-rule:nonzero;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:#fff;solid-opacity:1;fill:url(#e);fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:3;stroke-linecap:butt;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto;enable-background:accumulate"></path><use xlink:href="#f" width="100%" height="100%" style="display:inline" transform="rotate(120 407.34 -716.084)"></use><use xlink:href="#f" width="100%" height="100%" style="display:inline" transform="rotate(-120 407.288 -715.87)"></use></g></svg> <div class="flex flex-col justify-center"> <div>Copyright © 2023 NixOS contributors</div> <a href="https://github.com/NixOS/nixos-homepage/blob/master/LICENSES/CC-BY-SA-4.0.txt"> <abbr title="Creative Commons Attribution Share Alike 4.0 International">
CC-BY-SA-4.0
</abbr> </a> </div> </div> <hr class="lg:hidden border-nixlightblue"> <div class="basis-1/2 flex flex-row justify-between lg:justify-end gap-4 font-extralight"> <h4 class="my-auto">Connect with us:</h4> <div class="my-auto flex flex-row gap-3"> <a href="https://chaos.social/@nixos_org" aria-label="Connect with us on Mastodon"> <svg width="1em" height="1em" viewBox="0 0 24 24" alt="Mastodon" class="w-7 h-7" data-icon="simple-icons:mastodon">  <symbol id="ai:simple-icons:mastodon"><path fill="currentColor" d="M23.268 5.313c-.35-2.578-2.617-4.61-5.304-5.004C17.51.242 15.792 0 11.813 0h-.03c-3.98 0-4.835.242-5.288.309C3.882.692 1.496 2.518.917 5.127C.64 6.412.61 7.837.661 9.143c.074 1.874.088 3.745.26 5.611c.118 1.24.325 2.47.62 3.68c.55 2.237 2.777 4.098 4.96 4.857c2.336.792 4.849.923 7.256.38c.265-.061.527-.132.786-.213c.585-.184 1.27-.39 1.774-.753a.057.057 0 0 0 .023-.043v-1.809a.052.052 0 0 0-.02-.041a.053.053 0 0 0-.046-.01a20.282 20.282 0 0 1-4.709.545c-2.73 0-3.463-1.284-3.674-1.818a5.593 5.593 0 0 1-.319-1.433a.053.053 0 0 1 .066-.054c1.517.363 3.072.546 4.632.546c.376 0 .75 0 1.125-.01c1.57-.044 3.224-.124 4.768-.422c.038-.008.077-.015.11-.024c2.435-.464 4.753-1.92 4.989-5.604c.008-.145.03-1.52.03-1.67c.002-.512.167-3.63-.024-5.545m-3.748 9.195h-2.561V8.29c0-1.309-.55-1.976-1.67-1.976c-1.23 0-1.846.79-1.846 2.35v3.403h-2.546V8.663c0-1.56-.617-2.35-1.848-2.35c-1.112 0-1.668.668-1.67 1.977v6.218H4.822V8.102c0-1.31.337-2.35 1.011-3.12c.696-.77 1.608-1.164 2.74-1.164c1.311 0 2.302.5 2.962 1.498l.638 1.06l.638-1.06c.66-.999 1.65-1.498 2.96-1.498c1.13 0 2.043.395 2.74 1.164c.675.77 1.012 1.81 1.012 3.12z"></path></symbol><use xlink:href="#ai:simple-icons:mastodon"></use>  </svg> </a><a href="https://twitter.com/nixos_org" aria-label="Connect with us on Twitter"> <svg width="1em" height="1em" viewBox="0 0 24 24" alt="Twitter" class="w-7 h-7" data-icon="simple-icons:twitter">  <symbol id="ai:simple-icons:twitter"><path fill="currentColor" d="M21.543 7.104c.015.211.015.423.015.636c0 6.507-4.954 14.01-14.01 14.01v-.003A13.94 13.94 0 0 1 0 19.539a9.88 9.88 0 0 0 7.287-2.041a4.93 4.93 0 0 1-4.6-3.42a4.916 4.916 0 0 0 2.223-.084A4.926 4.926 0 0 1 .96 9.167v-.062a4.887 4.887 0 0 0 2.235.616A4.928 4.928 0 0 1 1.67 3.148a13.98 13.98 0 0 0 10.15 5.144a4.929 4.929 0 0 1 8.39-4.49a9.868 9.868 0 0 0 3.128-1.196a4.941 4.941 0 0 1-2.165 2.724A9.828 9.828 0 0 0 24 4.555a10.019 10.019 0 0 1-2.457 2.549"></path></symbol><use xlink:href="#ai:simple-icons:twitter"></use>  </svg> </a><a href="https://www.youtube.com/channel/UC3vIimi9q4AT8EgxYp_dWIw" aria-label="Connect with us on Youtube"> <svg width="1em" height="1em" viewBox="0 0 24 24" alt="Youtube" class="w-7 h-7" data-icon="simple-icons:youtube">  <symbol id="ai:simple-icons:youtube"><path fill="currentColor" d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814M9.545 15.568V8.432L15.818 12z"></path></symbol><use xlink:href="#ai:simple-icons:youtube"></use>  </svg> </a><a href="https://github.com/NixOS" aria-label="Connect with us on GitHub"> <svg width="1em" height="1em" viewBox="0 0 24 24" alt="GitHub" class="w-7 h-7" data-icon="simple-icons:github">  <symbol id="ai:simple-icons:github"><path fill="currentColor" d="M12 .297c-6.63 0-12 5.373-12 12c0 5.303 3.438 9.8 8.205 11.385c.6.113.82-.258.82-.577c0-.285-.01-1.04-.015-2.04c-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729c1.205.084 1.838 1.236 1.838 1.236c1.07 1.835 2.809 1.305 3.495.998c.108-.776.417-1.305.76-1.605c-2.665-.3-5.466-1.332-5.466-5.93c0-1.31.465-2.38 1.235-3.22c-.135-.303-.54-1.523.105-3.176c0 0 1.005-.322 3.3 1.23c.96-.267 1.98-.399 3-.405c1.02.006 2.04.138 3 .405c2.28-1.552 3.285-1.23 3.285-1.23c.645 1.653.24 2.873.12 3.176c.765.84 1.23 1.91 1.23 3.22c0 4.61-2.805 5.625-5.475 5.92c.42.36.81 1.096.81 2.22c0 1.606-.015 2.896-.015 3.286c0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></symbol><use xlink:href="#ai:simple-icons:github"></use>  </svg> </a> </div> </div> </div>  </div> </div> </footer>  </body></html>